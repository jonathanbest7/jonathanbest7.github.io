<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/bitbug_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/bitbug_favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jonathanbest7.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="re2国赛分赛区repuzzle是个upx壳，自动脱壳没脱掉，原来是upx的特征被改了，下面UPX全部被改成了vmp，全部恢复成UPX再脱壳就行，但不能调试，应该是文件到内存的偏移存在问题。  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556">
<meta property="og:type" content="article">
<meta property="og:title" content="re2">
<meta property="og:url" content="https://jonathanbest7.github.io/2022/07/05/re2/index.html">
<meta property="og:site_name" content="bj777的blog">
<meta property="og:description" content="re2国赛分赛区repuzzle是个upx壳，自动脱壳没脱掉，原来是upx的特征被改了，下面UPX全部被改成了vmp，全部恢复成UPX再脱壳就行，但不能调试，应该是文件到内存的偏移存在问题。  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220705231608958.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151134283.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151228497.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151237196.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151245375.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151255502.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151322255.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151527692.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151556289.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151843891.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220706163158211.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707202353900.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707105839618.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707204945097.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200200022.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200238598.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200306368.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200509986.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708092459410.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708165947660.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220711181535411.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114127868.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114211385.png">
<meta property="og:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220719184430550.png">
<meta property="article:published_time" content="2022-07-05T15:14:01.000Z">
<meta property="article:modified_time" content="2022-08-10T07:29:21.323Z">
<meta property="article:author" content="bj777">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jonathanbest7.github.io/Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220705231608958.png">

<link rel="canonical" href="https://jonathanbest7.github.io/2022/07/05/re2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>re2 | bj777的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">bj777的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习每一瞬间</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">33</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/07/05/re2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          re2
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-05 23:14:01" itemprop="dateCreated datePublished" datetime="2022-07-05T23:14:01+08:00">2022-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 15:29:21" itemprop="dateModified" datetime="2022-08-10T15:29:21+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="re2"><a href="#re2" class="headerlink" title="re2"></a>re2</h1><h2 id="国赛分赛区re"><a href="#国赛分赛区re" class="headerlink" title="国赛分赛区re"></a>国赛分赛区re</h2><h3 id="puzzle"><a href="#puzzle" class="headerlink" title="puzzle"></a>puzzle</h3><p>是个upx壳，自动脱壳没脱掉，原来是upx的特征被改了，下面UPX全部被改成了vmp，全部恢复成UPX再脱壳就行，但不能调试，应该是文件到内存的偏移存在问题。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220705231608958.png" alt="image-20220705231608958"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> *(_QWORD *)v20 = fmt_Fprintf((__int64)&amp;off_505F00, qword_588528, <span class="string">&quot;Input: &quot;</span>, <span class="number">7LL</span>, v2, <span class="number">0LL</span>, <span class="number">0LL</span>, v16, v17, v18);</span><br><span class="line">  v38[<span class="number">0</span>] = <span class="string">&quot;\b&quot;</span>;</span><br><span class="line">  v38[<span class="number">1</span>] = v35;</span><br><span class="line">  v11 = &amp;off_505EE0;</span><br><span class="line">  v12 = (__int64 *)qword_588520;</span><br><span class="line">  *(_QWORD *)v13 = <span class="string">&quot;%s&quot;</span>;</span><br><span class="line">  *(_QWORD *)&amp;v13[<span class="number">8</span>] = <span class="number">2LL</span>;</span><br><span class="line">  *(_QWORD *)&amp;v13[<span class="number">16</span>] = v38;</span><br><span class="line">  v14 = <span class="number">1LL</span>;</span><br><span class="line">  v15 = <span class="number">1LL</span>;</span><br><span class="line">  fmt_Fscanf((__int64)v1, v0, (<span class="type">const</span> <span class="type">char</span> *)&amp;off_505EE0);</span><br><span class="line">  <span class="keyword">if</span> ( !v17 )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = v35;</span><br><span class="line">    v4 = <span class="number">0LL</span>;</span><br><span class="line">    v5 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v4 &lt; <span class="number">9</span> )<span class="comment">//主要加密</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; <span class="number">9</span>; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        v1 = (__int64 *)v40[<span class="number">3</span> * v4 - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( v40[<span class="number">3</span> * v4] &lt;= (<span class="type">unsigned</span> __int64)i )</span><br><span class="line">          sub_466740((__int64)v11, (__int64)v12);</span><br><span class="line">        v0 = *((<span class="type">unsigned</span> __int8 *)v1 + i);</span><br><span class="line">        <span class="keyword">if</span> ( !(_BYTE)v0 )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = v3[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v7 &lt;= v5 )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">          <span class="keyword">if</span> ( v7 &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">            sub_466740((__int64)v11, (__int64)v12);</span><br><span class="line">          v8 = *(<span class="type">unsigned</span> __int8 *)(v5 + *v3);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v8 &lt; <span class="string">&#x27;0&#x27;</span> || (<span class="type">unsigned</span> __int8)v8 &gt; <span class="string">&#x27;9&#x27;</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">          v0 = (<span class="type">unsigned</span> <span class="type">int</span>)(v8 - <span class="number">48</span>);</span><br><span class="line">          *((_BYTE *)v1 + i) = v0;</span><br><span class="line">          ++v5;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3[<span class="number">1</span>] == v5 &amp;&amp; (v15 = sub_4B8720((__int64)&amp;v39, <span class="number">9LL</span>, <span class="number">9</span>, v13[<span class="number">8</span>]), v13[<span class="number">8</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      v17 = runtime_stringtoslicebyte((__int64)v34, *v35, v35[<span class="number">1</span>], *(__int64 *)&amp;v13[<span class="number">8</span>], *(__int64 *)&amp;v13[<span class="number">16</span>], v14);</span><br><span class="line">      v16 = sub_4938A0(*(__int64 *)&amp;v13[<span class="number">8</span>], *(__int64 *)&amp;v13[<span class="number">16</span>], v14, *(__int128 *)&amp;v13[<span class="number">8</span>]);</span><br><span class="line">      v32 = *(_OWORD *)&amp;v13[<span class="number">8</span>];</span><br><span class="line">      v33 = *(_OWORD *)&amp;v13[<span class="number">8</span>];</span><br><span class="line">      runtime_convT2Enoptr((__int64)&amp;unk_4C6160, (__int64)&amp;v33, *(__int64 *)v13, *(__int64 *)&amp;v13[<span class="number">8</span>]);</span><br><span class="line">      v37 = *(_OWORD *)v13;</span><br><span class="line">      v11 = &amp;off_505F00;</span><br><span class="line">      v12 = (__int64 *)qword_588528;</span><br><span class="line">      *(_QWORD *)v13 = <span class="string">&quot;Your flag is flag&#123;%x&#125;async stack too l&quot;</span>;</span><br><span class="line">      *(_QWORD *)&amp;v13[<span class="number">8</span>] = <span class="number">21LL</span>;</span><br><span class="line">      *(_QWORD *)&amp;v13[<span class="number">16</span>] = &amp;v37;</span><br><span class="line">      v14 = <span class="number">1LL</span>;</span><br><span class="line">      v15 = <span class="number">1LL</span>;</span><br><span class="line">      fmt_Fprintf((__int64)v1, v0, v9);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">LABEL_13:</span><br><span class="line">      v36[<span class="number">0</span>] = &amp;unk_4C5940;</span><br><span class="line">      v36[<span class="number">1</span>] = &amp;off_504828;                     <span class="comment">// Wrong！</span></span><br><span class="line">      *(_QWORD *)&amp;v19 = fmt_Fprintln((__int64)&amp;off_505F00, qword_588528, (__int64)v36, <span class="number">1LL</span>, <span class="number">1LL</span>, v14, v15, v16);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是个go程序，直接找到main_main发现符号表并没有损坏，直接看，发现应该是个数独，毕竟这一周做了两道数独了。</p>
<p>但是从静态是看不到数独的图的，所以只能动态，用程序脱壳后的程序并不能动调，所以得手动跟，比较不好跟。</p>
<p>直接找到rsp的地址后，步入sub_5AB660</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151134283.png" alt="image-20220803151134283"></p>
<p>sub_5AB700</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151228497.png" alt="image-20220803151228497"></p>
<p>sub_5AF500</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151237196.png" alt="image-20220803151237196"></p>
<p>sub_5ADBA0</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151245375.png" alt="image-20220803151245375"></p>
<p>sub_5D4300</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151255502.png" alt="image-20220803151255502"></p>
<p>到sub_628C40</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151322255.png" alt="image-20220803151322255"></p>
<p>发现call    rax ; sub_628C40进去就是main_main，发现了加载地图的地方</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151527692.png" alt="image-20220803151527692"></p>
<p>查看v48</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151556289.png" alt="image-20220803151556289"></p>
<p>就是地图</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151843891.png" alt="image-20220803151843891"></p>
<p>得到flag</p>
<h3 id="havetea"><a href="#havetea" class="headerlink" title="havetea"></a>havetea</h3><p>动调可以发现就是一个tea加密和xtea加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220706163158211.png" alt="image-20220706163158211"></p>
<p>发现输入16字节，8字节传入，进行两次tea加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x9E3779B9</span> * <span class="number">32</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9E3779B9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[] = &#123; <span class="number">0xE66F0E9E</span>, <span class="number">0x42A17CD6</span> &#125;, k[<span class="number">4</span>] = &#123; <span class="number">0x9e</span>,<span class="number">0x37</span>,<span class="number">0x79</span>,<span class="number">0xb9</span> &#125;, v1[] = &#123;  <span class="number">0x5BDDE878</span>, <span class="number">0xD236F4AD</span> &#125;;</span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]); </span><br><span class="line">    decrypt(v1, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v1[<span class="number">0</span>], v1[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">倒序就是密码：please_drink_tea</span><br></pre></td></tr></table></figure>

<p>然后就是一个xtea加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x9E3779B9</span>, sum = delta * num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[] = &#123; <span class="number">0x7D758E0A</span>, <span class="number">0xEDAFF6AD</span> &#125;, v1[] = &#123; <span class="number">0x9DDE7E86</span>, <span class="number">0xE3D36CD5</span> &#125;, v2[] = &#123; <span class="number">0xABD3C82E</span>, <span class="number">0x6B7B2CFE</span> &#125;, v3[] = &#123; <span class="number">0x2C6608C2</span>, <span class="number">0x0686A1DA</span> &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>] = &#123; <span class="number">0x61656C70</span>, <span class="number">0x645F6573</span>, <span class="number">0x6B6E6972</span>, <span class="number">0x6165745F</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> r = <span class="number">32</span>;<span class="comment">//num_rounds建议取值为32</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    decipher(r, v, k);</span><br><span class="line">    decipher(r, v1, k);</span><br><span class="line">    decipher(r, v2, k);</span><br><span class="line">    decipher(r, v3, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v1[<span class="number">0</span>], v1[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v2[<span class="number">0</span>], v2[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v3[<span class="number">0</span>], v3[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>倒序转换成字符就行了</p>
<p>_rdtsc</p>
<h3 id="creak3"><a href="#creak3" class="headerlink" title="creak3"></a>creak3</h3><p>用jadx打开发现很简单加密，就是把flag{xxxxxxxxx}中间的密文传进check函数，直接去so文件找jni发现关键check函数</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707202353900.png" alt="image-20220707202353900"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_4700</span><span class="params">(__int64 *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  _DWORD *v4; <span class="comment">// r14</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4h] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+8h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+Ch] [rbp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+10h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+14h] [rbp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+18h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = (*(__int64 (__fastcall **)(__int64 *, __int64, _QWORD))(*a1 + <span class="number">1352</span>))(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_3D70(v3) == <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">16</span>;</span><br><span class="line">    v4 = <span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_4330(v3, v4, &amp;v10) )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *a1;</span><br><span class="line">      v6 = <span class="string">&quot;Bad format&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = *v4 ^ <span class="number">0x39DEB332</span>;</span><br><span class="line">      v11 = v4[<span class="number">1</span>] ^ v9;</span><br><span class="line">      v12 = v4[<span class="number">2</span>] ^ v11;</span><br><span class="line">      v8 = v4[<span class="number">3</span>] ^ v12;</span><br><span class="line">      <span class="keyword">if</span> ( sub_43F0((__int64)&amp;v9) &amp;&amp; (<span class="type">unsigned</span> __int8)sub_44E0(&amp;v11) &amp;&amp; (<span class="type">unsigned</span> __int8)sub_4630(&amp;v8) )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *a1;</span><br><span class="line">        v6 = <span class="string">&quot;right flag!!!&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *a1;</span><br><span class="line">        v6 = <span class="string">&quot;sorry,wrong flag.&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = *a1;</span><br><span class="line">    v6 = <span class="string">&quot;length of input is not enough!!!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (*(__int64 (__fastcall **)(__int64 *, <span class="type">const</span> <span class="type">char</span> *))(v5 + <span class="number">1336</span>))(a1, v6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序的意思就是要输入一个32位的flag，然后每两个一组变成16进制，变成16位，4个4个一组，先进行异或，然后进入三个函数验证</p>
<p>第一个函数是sha1加密，4字节还知道一个字节</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">            arr = [i1, i2, <span class="number">0xe9</span>,i4]</span><br><span class="line">            <span class="keyword">if</span>(hashlib.sha1(<span class="built_in">bytes</span>(arr)).hexdigest().lower() == <span class="string">&quot;2e60865e94119223c4657eac98d744ee909e66b8&quot;</span>):  </span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">hex</span>(i1),<span class="built_in">hex</span>(i2),<span class="number">0xe9</span>,<span class="built_in">hex</span>(i4))</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>第二个函数刚开始没看出来，后面发现是sm4加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707105839618.png" alt="image-20220707105839618"></p>
<p>不难发现是sm4的cbc模式，那么需要找到key和iv，发现是0-0xf，直接写脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SM4_ENCRYPT     1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SM4_DECRYPT     0</span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 context structure</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> mode;                   <span class="comment">/*!&lt;  encrypt/decrypt   */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>];       <span class="comment">/*!&lt;  SM4 subkeys       */</span></span><br><span class="line">&#125;</span><br><span class="line">sm4_context;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment">* \param key      16-byte secret key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_enc</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment">* \param key      16-byte secret key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_dec</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context</span></span><br><span class="line"><span class="comment">* \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment">* \param length   length of the input data</span></span><br><span class="line"><span class="comment">* \param input    input block</span></span><br><span class="line"><span class="comment">* \param output   output block</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_ecb</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context</span></span><br><span class="line"><span class="comment">* \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment">* \param length   length of the input data</span></span><br><span class="line"><span class="comment">* \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment">* \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment">* \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_cbc</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 32-bit integer manipulation macros (big endian)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> GET_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_ULONG_BE(n,b,i)                             \</span></span><br><span class="line"><span class="meta">&#123;                                                       \</span></span><br><span class="line"><span class="meta">    (n) = ( (unsigned long) (b)[(i)    ] &lt;&lt; 24 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 1] &lt;&lt; 16 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 2] &lt;&lt;  8 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 3]       );       \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PUT_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PUT_ULONG_BE(n,b,i)                             \</span></span><br><span class="line"><span class="meta">&#123;                                                       \</span></span><br><span class="line"><span class="meta">    (b)[(i)    ] = (unsigned char) ( (n) &gt;&gt; 24 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 1] = (unsigned char) ( (n) &gt;&gt; 16 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 2] = (unsigned char) ( (n) &gt;&gt;  8 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 3] = (unsigned char) ( (n)       );       \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*rotate shift left marco definition</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SHL(x,n) (((x) &amp; 0xFFFFFFFF) &lt;&lt; n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x,n) (SHL((x),n) | ((x) &gt;&gt; (32 - n)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SWAP(a,b) &#123; unsigned long t = a; a = b; b = t; t = 0; &#125;</span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Expanded SM4 S-boxes</span></span><br><span class="line"><span class="comment">/* Sbox table: 8bits input convert to 8 bits output*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> SboxTable[<span class="number">16</span>][<span class="number">16</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	&#123; <span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* System parameter */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> FK[<span class="number">4</span>] =</span><br><span class="line">&#123; <span class="number">0xa3b1bac6</span>,<span class="number">0x56aa3350</span>,<span class="number">0x677d9197</span>,<span class="number">0xb27022dc</span> &#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* fixed parameter */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> CK[<span class="number">32</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	<span class="number">0x00070e15</span>,<span class="number">0x1c232a31</span>,<span class="number">0x383f464d</span>,<span class="number">0x545b6269</span>,</span><br><span class="line">	<span class="number">0x70777e85</span>,<span class="number">0x8c939aa1</span>,<span class="number">0xa8afb6bd</span>,<span class="number">0xc4cbd2d9</span>,</span><br><span class="line">	<span class="number">0xe0e7eef5</span>,<span class="number">0xfc030a11</span>,<span class="number">0x181f262d</span>,<span class="number">0x343b4249</span>,</span><br><span class="line">	<span class="number">0x50575e65</span>,<span class="number">0x6c737a81</span>,<span class="number">0x888f969d</span>,<span class="number">0xa4abb2b9</span>,</span><br><span class="line">	<span class="number">0xc0c7ced5</span>,<span class="number">0xdce3eaf1</span>,<span class="number">0xf8ff060d</span>,<span class="number">0x141b2229</span>,</span><br><span class="line">	<span class="number">0x30373e45</span>,<span class="number">0x4c535a61</span>,<span class="number">0x686f767d</span>,<span class="number">0x848b9299</span>,</span><br><span class="line">	<span class="number">0xa0a7aeb5</span>,<span class="number">0xbcc3cad1</span>,<span class="number">0xd8dfe6ed</span>,<span class="number">0xf4fb0209</span>,</span><br><span class="line">	<span class="number">0x10171e25</span>,<span class="number">0x2c333a41</span>,<span class="number">0x484f565d</span>,<span class="number">0x646b7279</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private function:</span></span><br><span class="line"><span class="comment">* look up in SboxTable and get the related value.</span></span><br><span class="line"><span class="comment">* args:    [in] inch: 0x00~0xFF (8 bits unsigned value).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">sm4Sbox</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> inch)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> *pTable = (<span class="type">unsigned</span> <span class="type">char</span> *)SboxTable;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> retVal = (<span class="type">unsigned</span> <span class="type">char</span>)(pTable[inch]);</span><br><span class="line">	<span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private F(Lt) function:</span></span><br><span class="line"><span class="comment">* &quot;T algorithm&quot; == &quot;L algorithm&quot; + &quot;t algorithm&quot;.</span></span><br><span class="line"><span class="comment">* args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment">* return: c: c is calculated with line algorithm &quot;L&quot; and nonline algorithm &quot;t&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4Lt</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> c = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">		b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">	GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">		c = bb ^ (ROTL(bb, <span class="number">2</span>)) ^ (ROTL(bb, <span class="number">10</span>)) ^ (ROTL(bb, <span class="number">18</span>)) ^ (ROTL(bb, <span class="number">24</span>));</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private F function:</span></span><br><span class="line"><span class="comment">* Calculating and getting encryption/decryption contents.</span></span><br><span class="line"><span class="comment">* args:    [in] x0: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x1: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x2: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x3: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] rk: encryption/decryption key;</span></span><br><span class="line"><span class="comment">* return the contents of encryption/decryption contents.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4F</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> x0, <span class="type">unsigned</span> <span class="type">long</span> x1, <span class="type">unsigned</span> <span class="type">long</span> x2, <span class="type">unsigned</span> <span class="type">long</span> x3, <span class="type">unsigned</span> <span class="type">long</span> rk)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (x0^sm4Lt(x1^x2^x3^rk));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* private function:</span></span><br><span class="line"><span class="comment">* Calculating round encryption key.</span></span><br><span class="line"><span class="comment">* args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment">* return: sk[i]: i&#123;0,1,2,3,...31&#125;.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4CalciRK</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> rk = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">		b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">	GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">		rk = bb ^ (ROTL(bb, <span class="number">13</span>)) ^ (ROTL(bb, <span class="number">23</span>));</span><br><span class="line">	<span class="keyword">return</span> rk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sm4_setkey</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> SK[<span class="number">32</span>], <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> MK[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> k[<span class="number">36</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">0</span>], key, <span class="number">0</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">1</span>], key, <span class="number">4</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">2</span>], key, <span class="number">8</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">3</span>], key, <span class="number">12</span>);</span><br><span class="line">	k[<span class="number">0</span>] = MK[<span class="number">0</span>] ^ FK[<span class="number">0</span>];</span><br><span class="line">	k[<span class="number">1</span>] = MK[<span class="number">1</span>] ^ FK[<span class="number">1</span>];</span><br><span class="line">	k[<span class="number">2</span>] = MK[<span class="number">2</span>] ^ FK[<span class="number">2</span>];</span><br><span class="line">	k[<span class="number">3</span>] = MK[<span class="number">3</span>] ^ FK[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span> (; i&lt;<span class="number">32</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k[i + <span class="number">4</span>] = k[i] ^ (sm4CalciRK(k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>] ^ CK[i]));</span><br><span class="line">		SK[i] = k[i + <span class="number">4</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 standard one round processing</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sm4_one_round</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> ulbuf[<span class="number">36</span>];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(ulbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(ulbuf));</span><br><span class="line">	GET_ULONG_BE(ulbuf[<span class="number">0</span>], input, <span class="number">0</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">1</span>], input, <span class="number">4</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">2</span>], input, <span class="number">8</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">3</span>], input, <span class="number">12</span>)</span><br><span class="line">		<span class="keyword">while</span> (i&lt;<span class="number">32</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ulbuf[i + <span class="number">4</span>] = sm4F(ulbuf[i], ulbuf[i + <span class="number">1</span>], ulbuf[i + <span class="number">2</span>], ulbuf[i + <span class="number">3</span>], sk[i]);</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">35</span>], output, <span class="number">0</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">34</span>], output, <span class="number">4</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">33</span>], output, <span class="number">8</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">32</span>], output, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_enc</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class="line">	sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_dec</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class="line">	sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		SWAP(ctx-&gt;sk[i], ctx-&gt;sk[<span class="number">31</span> - i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_ecb</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line">		input += <span class="number">16</span>;</span><br><span class="line">		output += <span class="number">16</span>;</span><br><span class="line">		length -= <span class="number">16</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_cbc</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mode == SM4_ENCRYPT)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">				output[i] = (<span class="type">unsigned</span> <span class="type">char</span>)(input[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">			sm4_one_round(ctx-&gt;sk, output, output);</span><br><span class="line">			<span class="built_in">memcpy</span>(iv, output, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">			input += <span class="number">16</span>;</span><br><span class="line">			output += <span class="number">16</span>;</span><br><span class="line">			length -= <span class="number">16</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">memcpy</span>(temp, input, <span class="number">16</span>);</span><br><span class="line">			sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">				output[i] = (<span class="type">unsigned</span> <span class="type">char</span>)(output[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memcpy</span>(iv, temp, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">			input += <span class="number">16</span>;</span><br><span class="line">			output += <span class="number">16</span>;</span><br><span class="line">			length -= <span class="number">16</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>] = &#123; <span class="number">0xD4</span>, <span class="number">0xD9</span>, <span class="number">0x76</span>, <span class="number">0xED</span>, <span class="number">0x8C</span>, <span class="number">0xFD</span>, <span class="number">0x9E</span>, <span class="number">0x36</span>, <span class="number">0x75</span>, <span class="number">0xCF</span>, <span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">0x56</span>, <span class="number">0x3A</span>, <span class="number">0xE6</span>, <span class="number">0xBF</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span> &#125;;</span><br><span class="line">	sm4_context ctx;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	//encrypt testing</span></span><br><span class="line"><span class="comment">	sm4_setkey_enc(&amp;ctx,key);</span></span><br><span class="line"><span class="comment">	sm4_crypt_ecb(&amp;ctx,1,16,input,output);</span></span><br><span class="line"><span class="comment">	for(i=0;i&lt;16;i++)</span></span><br><span class="line"><span class="comment">		printf(&quot;%02x &quot;, output[i]);</span></span><br><span class="line"><span class="comment">	printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//decrypt testing</span></span><br><span class="line">	sm4_setkey_dec(&amp;ctx, key);</span><br><span class="line">	sm4_crypt_cbc(&amp;ctx, <span class="number">0</span>, <span class="number">16</span>, iv, input, output);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;<span class="number">16</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02x\n&quot;</span>, output[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第三个函数就是个base64直接搞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#输出数组</span><br><span class="line">import base64</span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">diy_base = <span class="string">&#x27;abcdefghijklmnpoqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&#x27;</span></span><br><span class="line">s = <span class="string">&#x27;cpVVnW&#x27;</span></span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(len(s)-2):</span></span><br><span class="line"><span class="string">	ss += base[diy_base.find(s[i])]</span></span><br><span class="line"><span class="string">ss += &#x27;</span>==&#x27;</span><br><span class="line">a = base64.b64decode(ss)</span><br><span class="line">print(<span class="built_in">list</span>(<span class="built_in">map</span>(hex,a)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再进行异或，转换两次小端序就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v8 =  <span class="number">0x37efeb08</span></span><br><span class="line">v11 =  <span class="number">0x8275e5d1</span></span><br><span class="line">v12 = <span class="number">0xff540b2d</span></span><br><span class="line">v9 = <span class="number">0x09e948b0</span></span><br><span class="line">flag =[<span class="number">0</span>] * <span class="number">4</span></span><br><span class="line">flag[<span class="number">0</span>] = v9 ^ <span class="number">0x39DEB332</span></span><br><span class="line">flag[<span class="number">1</span>] = v9 ^ v11</span><br><span class="line">flag[<span class="number">2</span>] = v11 ^v12</span><br><span class="line">flag[<span class="number">3</span>] = v12 ^ v8</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">3</span>]))</span><br></pre></td></tr></table></figure>

<h3 id="creakme4"><a href="#creakme4" class="headerlink" title="creakme4"></a>creakme4</h3><p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707204945097.png" alt="image-20220707204945097"></p>
<p>还是直接看so文件</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200200022.png" alt="image-20220708200200022"></p>
<p>findcript直接找到是blowfish加密，之前做过这个加密：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200238598.png" alt="image-20220708200238598"></p>
<p>然后下面发现还有个加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200306368.png" alt="image-20220708200306368"></p>
<p>findcrypt并没有检测出，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_142B8</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// w23</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// w3</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// w4</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// w5</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// w6</span></span><br><span class="line">  <span class="type">void</span> *v11; <span class="comment">// x7</span></span><br><span class="line">  __int64 v12; <span class="comment">// x21</span></span><br><span class="line">  __int64 v13; <span class="comment">// x0</span></span><br><span class="line">  __int64 v14; <span class="comment">// x19</span></span><br><span class="line">  __int64 v16; <span class="comment">// [xsp+0h] [xbp-E0h] BYREF</span></span><br><span class="line">  __int64 v17[<span class="number">2</span>]; <span class="comment">// [xsp+8h] [xbp-D8h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [xsp+18h] [xbp-C8h]</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">8</span>]; <span class="comment">// [xsp+20h] [xbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v20[<span class="number">96</span>]; <span class="comment">// [xsp+28h] [xbp-B8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">8</span>]; <span class="comment">// [xsp+88h] [xbp-58h] BYREF</span></span><br><span class="line">  _QWORD v22[<span class="number">2</span>]; <span class="comment">// [xsp+90h] [xbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">1945572552</span>;</span><br><span class="line">  v22[<span class="number">1</span>] = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  v17[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  ptr = <span class="number">0LL</span>;</span><br><span class="line">  v17[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(a5);</span><br><span class="line">  sub_14FE0((<span class="type">int</span>)v17, (<span class="type">int</span>)a5, v6, v7, v8, v9, v10, v11);</span><br><span class="line">  v12 = (*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="number">1352LL</span>))(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  sub_13FC8(v12, v21);</span><br><span class="line">  v16 = <span class="number">0xE7CDAB8967452301</span>LL;</span><br><span class="line">  sub_1054C(&amp;v16, v20, <span class="number">0LL</span>);</span><br><span class="line">  sub_10C84(v22, v19, v20);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v19[<span class="number">0</span>] == <span class="number">228</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">1</span>] == <span class="number">234</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">2</span>] == <span class="number">196</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">3</span>] == <span class="number">129</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">4</span>] == <span class="number">185</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">5</span>] == <span class="number">254</span></span><br><span class="line">    &amp;&amp; v19[<span class="number">6</span>] == <span class="number">38</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">7</span>] == <span class="number">188</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = (*(__int64 (__fastcall **)(__int64, <span class="type">void</span> *))(*(_QWORD *)a1 + <span class="number">1336LL</span>))(a1, &amp;unk_3C090);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    (*(<span class="type">void</span> (__fastcall **)(__int64, __int64, __int64))(*(_QWORD *)a1 + <span class="number">1360LL</span>))(a1, a3, v12);</span><br><span class="line">    v13 = (*(__int64 (__fastcall **)(__int64, <span class="type">void</span> *))(*(_QWORD *)a1 + <span class="number">1336LL</span>))(a1, &amp;unk_3C050);</span><br><span class="line">  &#125;</span><br><span class="line">  v14 = v13;</span><br><span class="line">  <span class="keyword">while</span> ( v5 != <span class="number">847613141</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (v17[<span class="number">0</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">847613141</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">-519487832</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">-519487832</span> )</span><br><span class="line">      <span class="keyword">return</span> v14;</span><br><span class="line">  &#125;</span><br><span class="line">  operator <span class="title function_">delete</span><span class="params">(ptr)</span>;</span><br><span class="line">  <span class="keyword">return</span> v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200509986.png" alt="image-20220708200509986"></p>
<p>学了des加密后，发现这有8个s盒，应该是个des，并没有魔改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> Blowfish</span><br><span class="line">key = <span class="string">b&#x27;\x12\x34\x56\x78\x9a\xbc\xde\xff&#x27;</span></span><br><span class="line">enc_data = <span class="built_in">bytes</span>([<span class="number">0x92</span>, <span class="number">0xB1</span>, <span class="number">0xC0</span>, <span class="number">0x8D</span>, <span class="number">0x7D</span>, <span class="number">0x4D</span>, <span class="number">0x02</span>, <span class="number">0XB6</span>])</span><br><span class="line">cipher = Blowfish.new(key, Blowfish.MODE_ECB) </span><br><span class="line">dec = cipher.decrypt(enc_data) </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dec:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">key = <span class="built_in">bytes</span>([<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xab</span>, <span class="number">0xcd</span>, <span class="number">0xe7</span>])</span><br><span class="line">enc_data = <span class="built_in">bytes</span>([<span class="number">0xE4</span>, <span class="number">0XEA</span>, <span class="number">0XC4</span>, <span class="number">0X81</span>, <span class="number">0xB9</span>, <span class="number">0xFE</span>, <span class="number">0x26</span>, <span class="number">0xBC</span>])</span><br><span class="line">cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">dec = cipher.decrypt(enc_data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dec:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h3 id="analgo"><a href="#analgo" class="headerlink" title="analgo"></a>analgo</h3><p>又是go语言，发现有一段brainfuck</p>
<p>直接在对比处下断点来查看输入后经过加密会怎么变化。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708092459410.png" alt="image-20220708092459410"></p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708165947660.png" alt="image-20220708165947660"></p>
<p>在比较处patch一下</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入：<span class="number">111111111111111111111111111111111111111111</span></span><br><span class="line">输出：<span class="number">0</span><span class="built_in">F</span> <span class="number">5291</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br><span class="line">输入：<span class="number">211111111111111111111111111111111111111111</span></span><br><span class="line">输出：C2 <span class="number">5291</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br><span class="line">输入：<span class="number">112111111111111111111111111111111111111111</span></span><br><span class="line">输出：<span class="number">0</span><span class="built_in">F</span> <span class="number">7</span><span class="built_in">F</span> <span class="number">40</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br></pre></td></tr></table></figure>

<p>很明显字节与字节之间并无明显关联，对程序进行单字节爆破处理，这是我第二次见这样的脚本，上次还是在hgame。。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">list</span>(<span class="string">&#x27;fl1111111111111111111111111111111111111111\n&#x27;</span>)<span class="comment">#确定前两个字符从而递归推出下面字符</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">0x2a</span>):</span><br><span class="line">    <span class="built_in">bin</span> = <span class="built_in">bytearray</span>(<span class="built_in">open</span>(<span class="string">&quot;analgo.exe&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()) </span><br><span class="line">    <span class="built_in">bin</span>[<span class="number">0xb3045</span>] = i </span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&quot;analgo.exe&quot;</span>,<span class="string">&quot;wb&quot;</span>).write(<span class="built_in">bin</span>)<span class="comment">#将之后的值写入文件</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string.printable:<span class="comment">#爆破</span></span><br><span class="line">        data[i] = j </span><br><span class="line">        pipe = subprocess.Popen(<span class="string">&quot;./analgo.exe&quot;</span>,bufsize=<span class="number">2</span>,stdout=subprocess.PIPE,stdin=subprocess.PIPE)<span class="comment">#创建管道</span></span><br><span class="line">        pipe.stdin.write(<span class="built_in">bytes</span>(<span class="string">&quot;&quot;</span>.join(data).encode(<span class="string">&quot;utf-8&quot;</span>))) <span class="comment">#将该字符写入文件进行验证</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;right!\n&#x27;</span> == pipe.stdout.read():<span class="comment">#如果子进程输出right</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(data))<span class="comment">#输出结果</span></span><br></pre></td></tr></table></figure>

<p>flag{568a3cdd-77e1-4c42-9fee-127e27a5744e}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">subprocess.run(args, *, stdin=<span class="literal">None</span>, <span class="built_in">input</span>=<span class="literal">None</span>, stdout=<span class="literal">None</span>, stderr=<span class="literal">None</span>, capture_output=<span class="literal">False</span>, shell=<span class="literal">False</span>, cwd=<span class="literal">None</span>, timeout=<span class="literal">None</span>, check=<span class="literal">False</span>, encoding=<span class="literal">None</span>, errors=<span class="literal">None</span>, text=<span class="literal">None</span>, env=<span class="literal">None</span>, universal_newlines=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">args：表示要执行的命令。必须是一个字符串，字符串参数列表。</span><br><span class="line">stdin、stdout 和 stderr：子进程的标准输入、输出和错误。其值可以是 subprocess.PIPE、subprocess.DEVNULL、一个已经存在的文件描述符、已经打开的文件对象或者 <span class="literal">None</span>。subprocess.PIPE 表示为子进程创建新的管道。subprocess.DEVNULL 表示使用 os.devnull。默认使用的是 <span class="literal">None</span>，表示什么都不做。另外，stderr 可以合并到 stdout 里一起输出。</span><br><span class="line">timeout：设置命令超时时间。如果命令执行时间超时，子进程将被杀死，并弹出 TimeoutExpired 异常。</span><br><span class="line">check：如果该参数设置为 <span class="literal">True</span>，并且进程退出状态码不是 <span class="number">0</span>，则弹 出 CalledProcessError 异常。</span><br><span class="line">encoding: 如果指定了该参数，则 stdin、stdout 和 stderr 可以接收字符串数据，并以该编码方式编码。否则只接收 <span class="built_in">bytes</span> 类型的数据。</span><br><span class="line">shell：如果该参数为 <span class="literal">True</span>，将通过操作系统的 shell 执行指定的命令</span><br></pre></td></tr></table></figure>

<h3 id="rota"><a href="#rota" class="headerlink" title="rota"></a>rota</h3><p>这题还是比较简单的</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220711181535411.png" alt="image-20220711181535411"></p>
<p>显然base64换表加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v13 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>i64; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;unk_7FF75F6B6040 + i) = (*((_BYTE *)&amp;unk_7FF75F6B6040 + i) + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  si128 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF75F6B4340);</span><br><span class="line">  v15 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF75F6B4350);</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  v17 = _mm_cvtsi32_si128(<span class="number">6u</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v18 = _mm_add_epi32(_mm_cvtepu8_epi32(*(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6040 + v16)), si128);</span><br><span class="line">    v19 = _mm_and_si128(</span><br><span class="line">            _mm_shuffle_epi32(</span><br><span class="line">              _mm_shufflehi_epi16(</span><br><span class="line">                _mm_shufflelo_epi16(</span><br><span class="line">                  _mm_sub_epi32(</span><br><span class="line">                    v18,</span><br><span class="line">                    _mm_sll_epi32(</span><br><span class="line">                      _mm_sra_epi32(_mm_add_epi32(_mm_and_si128(_mm_cmpgt_epi32((__m128i)<span class="number">0</span>i64, v18), v15), v18), v17),</span><br><span class="line">                      v17)),</span><br><span class="line">                  <span class="number">216</span>),</span><br><span class="line">                <span class="number">216</span>),</span><br><span class="line">              <span class="number">216</span>),</span><br><span class="line">            (__m128i)xmmword_7FF75F6B4360);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6040 + v16) = _mm_cvtsi128_si32(_mm_packus_epi16(v19, v19));</span><br><span class="line">    v20 = _mm_add_epi32(_mm_cvtepu8_epi32(*(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6044 + v16)), si128);</span><br><span class="line">    v21 = _mm_and_si128(</span><br><span class="line">            _mm_shuffle_epi32(</span><br><span class="line">              _mm_shufflehi_epi16(</span><br><span class="line">                _mm_shufflelo_epi16(</span><br><span class="line">                  _mm_sub_epi32(</span><br><span class="line">                    v20,</span><br><span class="line">                    _mm_sll_epi32(</span><br><span class="line">                      _mm_sra_epi32(_mm_add_epi32(_mm_and_si128(_mm_cmpgt_epi32((__m128i)<span class="number">0</span>i64, v20), v15), v20), v17),</span><br><span class="line">                      v17)),</span><br><span class="line">                  <span class="number">216</span>),</span><br><span class="line">                <span class="number">216</span>),</span><br><span class="line">              <span class="number">216</span>),</span><br><span class="line">            (__m128i)xmmword_7FF75F6B4360);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6044 + v16) = _mm_cvtsi128_si32(_mm_packus_epi16(v21, v21));</span><br><span class="line">    v16 += <span class="number">8</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v16 &lt; <span class="number">64</span> );</span><br><span class="line">&#125;</span><br><span class="line">sub_7FF75F6B10E0((__int64)v24);</span><br><span class="line">sub_7FF75F6B1E10(v24, (__int64)v32, (__int64)encode2);</span><br></pre></td></tr></table></figure>

<p>下面这其实都没啥，最主要的是sub_7FF75F6B1E10函数v32是传进来的base64加密函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __fastcall <span class="title function_">sub_7FF75F6B1E10</span><span class="params">(_BYTE *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// bl</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> result; <span class="comment">// al</span></span><br><span class="line">  __int64 v7; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v9; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// r8</span></span><br><span class="line">  __int64 v12; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// bl</span></span><br><span class="line">  __int64 v14; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// r8</span></span><br><span class="line">  __int64 v17; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v18; <span class="comment">// bl</span></span><br><span class="line">  __int64 v19; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v21; <span class="comment">// r8</span></span><br><span class="line">  __int64 v22; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v23; <span class="comment">// bl</span></span><br><span class="line">  __int64 v24; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v25; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v26; <span class="comment">// r8</span></span><br><span class="line">  __int64 v27; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v28; <span class="comment">// bl</span></span><br><span class="line">  __int64 v29; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v30; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v31; <span class="comment">// r8</span></span><br><span class="line">  __int64 v32; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v33; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  v3 = a1[<span class="number">192</span>];</span><br><span class="line">  v4 = (_BYTE *)(a3 + <span class="number">1</span>);</span><br><span class="line">  v5 = a1[<span class="number">193</span>];</span><br><span class="line">  result = a1[<span class="number">194</span>];</span><br><span class="line">  v7 = a2 - a3;</span><br><span class="line">  v9 = <span class="number">9</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 - <span class="number">1</span>] != aXiizduaoglak6j[v10] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v10 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v10) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v11 = v5;</span><br><span class="line">    v12 = (v5 + a1[(v3 + (_BYTE)v10) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v13 = (v3 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v14 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v12 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v13;</span><br><span class="line">    *(v4 - <span class="number">1</span>) = aXiizduaoglak6j[v14];</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v11 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7] != aXiizduaoglak6j[v15] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v15 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v15) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v16 = v5;</span><br><span class="line">    v17 = (v5 + a1[(v13 + (_BYTE)v15) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v18 = (v13 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v19 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v17 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v18;</span><br><span class="line">    *v4 = aXiizduaoglak6j[v19];</span><br><span class="line">    <span class="keyword">if</span> ( !v18 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v16 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v20 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">1</span>] != aXiizduaoglak6j[v20] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v20 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v20) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v21 = v5;</span><br><span class="line">    v22 = (v5 + a1[(v18 + (_BYTE)v20) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v23 = (v18 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v24 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v22 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v23;</span><br><span class="line">    v4[<span class="number">1</span>] = aXiizduaoglak6j[v24];</span><br><span class="line">    <span class="keyword">if</span> ( !v23 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v21 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v25 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">2</span>] != aXiizduaoglak6j[v25] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v25 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v25) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v26 = v5;</span><br><span class="line">    v27 = (v5 + a1[(v23 + (_BYTE)v25) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v28 = (v23 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v29 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v27 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v28;</span><br><span class="line">    v4[<span class="number">2</span>] = aXiizduaoglak6j[v29];</span><br><span class="line">    <span class="keyword">if</span> ( !v28 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v26 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">3</span>] != aXiizduaoglak6j[v30] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v30 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v30) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v31 = v5;</span><br><span class="line">    v32 = (v5 + a1[(v28 + (_BYTE)v30) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v3 = (v28 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v33 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v32 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v3;</span><br><span class="line">    v4[<span class="number">3</span>] = aXiizduaoglak6j[v33];</span><br><span class="line">    <span class="keyword">if</span> ( !v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v31 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v4 += <span class="number">5</span>;</span><br><span class="line">    --v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v9 );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5个地方结构相似，发现其实只用看懂一个就行，原数据在v4，我们可以直接爆破，然后直接对比就行，其实不难。每个结构其实是对一个字符进行的加密，那么每一次do while就是加密5个，但我们可以直接单个爆破。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">cmp = <span class="string">&quot;ksPhS/34MXifj+Ibtjud2Tikj5HkA7iTpbaNELBebOaIm&quot;</span></span><br><span class="line">base_change = <span class="string">&quot;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb&quot;</span></span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">a1 = [<span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x2C</span>, <span class="number">0x36</span>, <span class="number">0x1D</span>, <span class="number">0x12</span>, <span class="number">0x1E</span>, <span class="number">0x0C</span>, <span class="number">0x1A</span>, <span class="number">0x3C</span>, <span class="number">0x29</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x14</span>, <span class="number">0x3D</span>, <span class="number">0x3B</span>, <span class="number">0x19</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x1F</span>, <span class="number">0x30</span>, <span class="number">0x05</span>, <span class="number">0x38</span>, <span class="number">0x03</span>, <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x17</span>, <span class="number">0x21</span>, <span class="number">0x2E</span>, <span class="number">0x04</span>, <span class="number">0x18</span>, <span class="number">0x23</span>, <span class="number">0x2B</span>, <span class="number">0x02</span>, <span class="number">0x27</span>, <span class="number">0x37</span>, <span class="number">0x1C</span>, <span class="number">0x24</span>, <span class="number">0x39</span>, <span class="number">0x3F</span>, <span class="number">0x35</span>, <span class="number">0x2D</span>, <span class="number">0x26</span>, <span class="number">0x13</span>, <span class="number">0x2A</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x3E</span>, <span class="number">0x01</span>, <span class="number">0x28</span>, <span class="number">0x2F</span>, <span class="number">0x32</span>, <span class="number">0x22</span>, <span class="number">0x0D</span>, <span class="number">0x06</span>, <span class="number">0x25</span>, <span class="number">0x3A</span>, <span class="number">0x09</span>, <span class="number">0x0F</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x15</span>, <span class="number">0x31</span>, <span class="number">0x0C</span>, <span class="number">0x2C</span>, <span class="number">0x0D</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, <span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x17</span>, <span class="number">0x1A</span>, <span class="number">0x33</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x04</span>, <span class="number">0x1B</span>, <span class="number">0x0B</span>, <span class="number">0x34</span>, <span class="number">0x12</span>, <span class="number">0x38</span>, <span class="number">0x27</span>, <span class="number">0x0E</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x2E</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x3E</span>, <span class="number">0x3A</span>, <span class="number">0x05</span>, <span class="number">0x1E</span>, <span class="number">0x36</span>, <span class="number">0x08</span>, <span class="number">0x32</span>, <span class="number">0x29</span>, <span class="number">0x19</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3F</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x18</span>, <span class="number">0x16</span>, <span class="number">0x35</span>, <span class="number">0x25</span>, <span class="number">0x0A</span>, <span class="number">0x2D</span>, <span class="number">0x28</span>, <span class="number">0x26</span>, <span class="number">0x15</span>, <span class="number">0x11</span>, <span class="number">0x07</span>, <span class="number">0x1D</span>, <span class="number">0x2A</span>, <span class="number">0x0F</span>, <span class="number">0x1F</span>, <span class="number">0x14</span>, <span class="number">0x01</span>, <span class="number">0x1C</span>, <span class="number">0x03</span>, <span class="number">0x2F</span>, <span class="number">0x13</span>, <span class="number">0x0D</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x07</span>, <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x23</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x25</span>, <span class="number">0x2B</span>, <span class="number">0x21</span>, <span class="number">0x33</span>, <span class="number">0x18</span>, <span class="number">0x27</span>, <span class="number">0x29</span>, <span class="number">0x02</span>, <span class="number">0x2F</span>, <span class="number">0x28</span>, <span class="number">0x30</span>, <span class="number">0x0E</span>, <span class="number">0x19</span>, <span class="number">0x3C</span>, <span class="number">0x08</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x3D</span>, <span class="number">0x2E</span>, <span class="number">0x05</span>, <span class="number">0x15</span>, <span class="number">0x2C</span>, <span class="number">0x1C</span>, <span class="number">0x36</span>, <span class="number">0x22</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x38</span>, <span class="number">0x0A</span>, <span class="number">0x3F</span>, <span class="number">0x1A</span>, <span class="number">0x04</span>, <span class="number">0x26</span>, <span class="number">0x16</span>, <span class="number">0x2A</span>, <span class="number">0x3A</span>, <span class="number">0x1F</span>, <span class="number">0x2D</span>, <span class="number">0x32</span>, <span class="number">0x06</span>, <span class="number">0x37</span>, <span class="number">0x03</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x1D</span>, <span class="number">0x12</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x3E</span>, <span class="number">0x39</span>, <span class="number">0x0F</span>, <span class="number">0x14</span>]</span><br><span class="line">flag1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">45</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> base_change:</span><br><span class="line">        x = base_change.find(j)</span><br><span class="line">        v17 = a1[(i + x) &amp; <span class="number">0x3f</span>] &amp; <span class="number">0x3f</span></span><br><span class="line">        v14 = a1[(a1[v17 + <span class="number">64</span>] ) + <span class="number">128</span>]</span><br><span class="line">        <span class="keyword">if</span> base_change[v14] == cmp[i]:</span><br><span class="line">            flag1 += j</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag1)-<span class="number">1</span>):</span><br><span class="line">    flag += base[base_change.find(flag1[i])]</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br></pre></td></tr></table></figure>

<h3 id="gocode"><a href="#gocode" class="headerlink" title="gocode"></a>gocode</h3><p>这个题字节码逆向，还是go的，不过这个go比之前做的友善多了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">main_main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v0; <span class="comment">// rdi</span></span><br><span class="line">  __int64 count; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 opcode; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// rsi</span></span><br><span class="line">  _QWORD *v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v12; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v14; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v17; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v19; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v20; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v22; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v23; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v24; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v25; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v26; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v27; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v28; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v29; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">void</span> **v30; <span class="comment">// [rsp+0h] [rbp-CD0h]</span></span><br><span class="line">  __int64 v31; <span class="comment">// [rsp+8h] [rbp-CC8h]</span></span><br><span class="line">  _QWORD *v32; <span class="comment">// [rsp+20h] [rbp-CB0h]</span></span><br><span class="line">  __int128 v33; <span class="comment">// [rsp+28h] [rbp-CA8h]</span></span><br><span class="line">  __int64 v34; <span class="comment">// [rsp+38h] [rbp-C98h]</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp+40h] [rbp-C90h]</span></span><br><span class="line">  _QWORD *v36; <span class="comment">// [rsp+50h] [rbp-C80h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v37; <span class="comment">// [rsp+58h] [rbp-C78h]</span></span><br><span class="line">  __int64 v38; <span class="comment">// [rsp+68h] [rbp-C68h]</span></span><br><span class="line">  __int64 v39; <span class="comment">// [rsp+70h] [rbp-C60h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v40; <span class="comment">// [rsp+78h] [rbp-C58h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v41; <span class="comment">// [rsp+80h] [rbp-C50h] BYREF</span></span><br><span class="line">  __int128 v42[<span class="number">2</span>]; <span class="comment">// [rsp+88h] [rbp-C48h] BYREF</span></span><br><span class="line">  __int64 v43[<span class="number">374</span>]; <span class="comment">// [rsp+A8h] [rbp-C28h] BYREF</span></span><br><span class="line">  __int64 v44; <span class="comment">// [rsp+C58h] [rbp-78h] BYREF</span></span><br><span class="line">  __int64 v45; <span class="comment">// [rsp+C60h] [rbp-70h]</span></span><br><span class="line">  _QWORD v46[<span class="number">2</span>]; <span class="comment">// [rsp+C68h] [rbp-68h] BYREF</span></span><br><span class="line">  _QWORD v47[<span class="number">2</span>]; <span class="comment">// [rsp+C78h] [rbp-58h] BYREF</span></span><br><span class="line">  _QWORD v48[<span class="number">2</span>]; <span class="comment">// [rsp+C88h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v49[<span class="number">2</span>]; <span class="comment">// [rsp+C98h] [rbp-38h] BYREF</span></span><br><span class="line">  _QWORD v50[<span class="number">2</span>]; <span class="comment">// [rsp+CA8h] [rbp-28h] BYREF</span></span><br><span class="line">  _QWORD v51[<span class="number">2</span>]; <span class="comment">// [rsp+CB8h] [rbp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;v41 &lt;= *(_QWORD *)(*(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  qmemcpy(v43, <span class="string">&quot;\n&quot;</span>, <span class="keyword">sizeof</span>(v43));</span><br><span class="line">  v0 = (<span class="type">unsigned</span> __int64)&amp;v44;</span><br><span class="line">  <span class="built_in">memset</span>(v42, <span class="number">0</span>, <span class="keyword">sizeof</span>(v42));</span><br><span class="line">  count = <span class="number">0LL</span>;</span><br><span class="line">  v2 = <span class="number">0LL</span>;</span><br><span class="line">  v3 = <span class="number">0LL</span>;</span><br><span class="line">  v4 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)count &gt;= <span class="number">0x176</span> )</span><br><span class="line">      runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">    v37 = v2;</span><br><span class="line">    v44 = v3;</span><br><span class="line">    v38 = count;</span><br><span class="line">    opcode = v43[count];</span><br><span class="line">    <span class="keyword">if</span> ( opcode &lt;= <span class="number">0xC</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( opcode &gt; <span class="number">0xE</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">switch</span> ( opcode )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xF</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v22 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v22 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v23 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v23 &gt;= <span class="number">4</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_97;</span><br><span class="line">          v24 = *((_QWORD *)v42 + v23);</span><br><span class="line">          <span class="keyword">if</span> ( !v24 )</span><br><span class="line">          &#123;</span><br><span class="line">            v31 = runtime_panicdivide(v30);</span><br><span class="line">LABEL_97:</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          &#125;</span><br><span class="line">          v0 = v3;</span><br><span class="line">          *((_QWORD *)v42 + v22) /= v24;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xAA</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v25 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v25 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v26 = *((_QWORD *)v42 + v25);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v27 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v27 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v0 = *((_QWORD *)v42 + v27);</span><br><span class="line">          <span class="keyword">if</span> ( v0 != v26 )</span><br><span class="line">          &#123;</span><br><span class="line">            v47[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">            v47[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">            fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v47, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">            v31 = os_Exit(<span class="number">0LL</span>);</span><br><span class="line">            count = v38;</span><br><span class="line">            v2 = v37;</span><br><span class="line">            v3 = v44;</span><br><span class="line">          &#125;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xBB</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v28 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v28 &gt;= v2 )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v29 = *(_QWORD *)(v3 + <span class="number">8</span> * v28);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v0 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v0 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          *((_QWORD *)v42 + v0) = v29;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">13</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v18 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v18 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v19 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v19 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v18) - *((_QWORD *)v42 + v19);</span><br><span class="line">      *((_QWORD *)v42 + v18) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v20 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v20 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v21 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v21 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v21) * *((_QWORD *)v42 + v20);</span><br><span class="line">      *((_QWORD *)v42 + v20) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_12:</span><br><span class="line">    <span class="keyword">if</span> ( count &gt;= <span class="number">374</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v46[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">      v46[<span class="number">1</span>] = &amp;off_DA0B78;</span><br><span class="line">      fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v46, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( opcode &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v6 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v6 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v7 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v7) ^ *((_QWORD *)v42 + v6);</span><br><span class="line">      *((_QWORD *)v42 + v6) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v0 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v8 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      *((_QWORD *)v42 + v8) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( opcode != <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">11</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0LL</span>; ; i = v41 )</span><br><span class="line">      &#123;</span><br><span class="line">        v0 = qword_E23C38;</span><br><span class="line">        <span class="keyword">if</span> ( (__int64)i &gt;= qword_E23C38 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( i + <span class="number">2</span> &gt; qword_E23C38 )</span><br><span class="line">          runtime_panicSliceAlen((__int64)v30, v31);</span><br><span class="line">        <span class="keyword">if</span> ( i &gt; i + <span class="number">2</span> )</span><br><span class="line">          runtime_panicSliceB((__int64)v30, v31);</span><br><span class="line">        v41 = i + <span class="number">2</span>;</span><br><span class="line">        v45 = v3;</span><br><span class="line">        v40 = v4;</span><br><span class="line">        v39 = v2;</span><br><span class="line">        v34 = strconv_ParseUint(qword_E23C30 + i, <span class="number">2LL</span>, <span class="number">16LL</span>, <span class="number">32LL</span>, (__int64)v32, v33);</span><br><span class="line">        v10 = v32;</span><br><span class="line">        <span class="keyword">if</span> ( (_QWORD)v33 )</span><br><span class="line">        &#123;</span><br><span class="line">          v48[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">          v48[<span class="number">1</span>] = &amp;off_DA0B68;</span><br><span class="line">          fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v48, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v11 = v39;</span><br><span class="line">        v12 = v39 + <span class="number">1</span>;</span><br><span class="line">        v13 = v40;</span><br><span class="line">        <span class="keyword">if</span> ( v40 &lt; v39 + <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v36 = v32;</span><br><span class="line">          runtime_growslice((__int64)<span class="string">&quot;\b&quot;</span>, v45, v39, v40, v39 + <span class="number">1</span>, <span class="number">0LL</span>, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">          v14 = v33;</span><br><span class="line">          v13 = v34;</span><br><span class="line">          v12 = *((_QWORD *)&amp;v33 + <span class="number">1</span>) + <span class="number">1LL</span>;</span><br><span class="line">          v10 = v36;</span><br><span class="line">          v11 = v39;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v14 = v45;</span><br><span class="line">        &#125;</span><br><span class="line">        *(_QWORD *)(v14 + <span class="number">8</span> * v11) = v10;</span><br><span class="line">        count = v38;</span><br><span class="line">        v4 = v13;</span><br><span class="line">        v3 = v14;</span><br><span class="line">        v2 = v12;</span><br><span class="line">      &#125;</span><br><span class="line">      ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v15 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v15 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v16 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v16 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v16) + *((_QWORD *)v42 + v15);</span><br><span class="line">      *((_QWORD *)v42 + v15) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  v51[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">  v51[<span class="number">1</span>] = &amp;off_DA0B48;</span><br><span class="line">  v35 = fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v51, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">  v50[<span class="number">0</span>] = <span class="string">&quot;\b&quot;</span>;</span><br><span class="line">  v50[<span class="number">1</span>] = &amp;qword_E23C30;</span><br><span class="line">  v30 = &amp;off_DA21F8;</span><br><span class="line">  v31 = qword_E23420;</span><br><span class="line">  v32 = v50;</span><br><span class="line">  *(_QWORD *)&amp;v33 = <span class="number">1LL</span>;</span><br><span class="line">  *((_QWORD *)&amp;v33 + <span class="number">1</span>) = <span class="number">1LL</span>;</span><br><span class="line">  fmt_Fscanf(v0, (__int64)v50, <span class="string">&quot;%37s&quot;</span>, &amp;qword_E23C30);</span><br><span class="line">  <span class="keyword">if</span> ( v35 )</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ( qword_E23C38 == <span class="number">37</span> &amp;&amp; *(_DWORD *)qword_E23C30 == <span class="string">&#x27;&#123;LCP&#x27;</span> &amp;&amp; *(_BYTE *)(qword_E23C30 + <span class="number">36</span>) == <span class="number">125</span> )<span class="comment">// 检测长度和PCL&#123;&#125;</span></span><br><span class="line">  &#123;</span><br><span class="line">    qword_E23C38 = <span class="number">32LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( dword_E66C60 )</span><br><span class="line">    &#123;</span><br><span class="line">      v0 = (<span class="type">unsigned</span> __int64)&amp;qword_E23C30;</span><br><span class="line">      runtime_gcWriteBarrierBX(&amp;qword_E23C30, v50, v17);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      qword_E23C30 += <span class="number">4LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    count = v38 + <span class="number">1</span>;</span><br><span class="line">    v2 = v37;</span><br><span class="line">    v3 = v44;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  v49[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">  v49[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">  fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v49, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, v34);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令集都在v43里，我们可以dump出来的，发现也就是几种指令，三个一组。前两个0xa和0xb是为了验证输入格式是否正确</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x03</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x11B</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x7901</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x1FF6</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x21E</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x3331</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x68</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x152</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x33</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0E</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x441</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x6B</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x10E</span>, <span class="number">0xAA</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x9E</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x0B</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x36CE</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x682D</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x15</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x1AE</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x3709</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x0D</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x68</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0xFA</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x1E</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0E</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x18C</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x6B</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x83</span>, <span class="number">0xAA</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x47</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0xAA</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xF</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v22 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v22 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v23 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v23 &gt;= <span class="number">4</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_97;</span><br><span class="line">          v24 = *((_QWORD *)v42 + v23);</span><br><span class="line">          <span class="keyword">if</span> ( !v24 )</span><br><span class="line">          &#123;</span><br><span class="line">            v31 = runtime_panicdivide(v30);</span><br><span class="line">LABEL_97:</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          &#125;</span><br><span class="line">          v0 = v3;</span><br><span class="line">          *((_QWORD *)v42 + v22) /= v24;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xf，那么后两位操作数进行一个相除</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xAA</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v25 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v25 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v26 = *((_QWORD *)v42 + v25);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v27 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v27 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v0 = *((_QWORD *)v42 + v27);</span><br><span class="line">          <span class="keyword">if</span> ( v0 != v26 )</span><br><span class="line">          &#123;</span><br><span class="line">            v47[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">            v47[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">            fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v47, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">            v31 = os_Exit(<span class="number">0LL</span>);</span><br><span class="line">            count = v38;</span><br><span class="line">            v2 = v37;</span><br><span class="line">            v3 = v44;</span><br><span class="line">          &#125;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xAA，就退出程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xBB</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v28 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v28 &gt;= v2 )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v29 = *(_QWORD *)(v3 + <span class="number">8</span> * v28);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v0 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v0 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          *((_QWORD *)v42 + v0) = v29;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xbb，是一个赋值reg[0] &#x3D; input[0]</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">13</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v18 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v18 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v19 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v19 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v18) - *((_QWORD *)v42 + v19);</span><br><span class="line">      *((_QWORD *)v42 + v18) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>opcode &#x3D;&#x3D; 13，是一个减法，第一个操作数减去第二个操作数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( opcode &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v6 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v6 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v7 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v7) ^ *((_QWORD *)v42 + v6);</span><br><span class="line">      *((_QWORD *)v42 + v6) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 1，那么是个异或</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v0 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v8 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      *((_QWORD *)v42 + v8) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 2，是个赋值等于第二个操作数</p>
<p>用脚本恢复一下，发现可以用z3解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">283</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">30977</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8182</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">542</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">13105</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">104</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">338</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">51</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1089</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">107</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">270</span>, <span class="number">170</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">158</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">14030</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">26669</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">430</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">14089</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">104</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">30</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">396</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">107</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">131</span>, <span class="number">170</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">71</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(opcode), <span class="number">3</span>):</span><br><span class="line">     op = opcode[i]</span><br><span class="line">     num1 = opcode[i + <span class="number">1</span>]</span><br><span class="line">     num2 = opcode[i + <span class="number">2</span>]</span><br><span class="line">     <span class="keyword">if</span> op == <span class="number">0xbb</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] = input[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xaa</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;if buf[<span class="subst">&#123;num1&#125;</span>] != buf[<span class="subst">&#123;num2&#125;</span>] goto exit&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xf</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] /= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xd</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] -= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xe</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] *= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0x1</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] ^= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0x2</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] = <span class="subst">&#123;num2&#125;</span>&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xc</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] += buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;gg&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">283</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">30977</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">8182</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">542</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[0]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">13105</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[4]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[5]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[6]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">104</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">338</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">51</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">1089</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">107</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">270</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[2]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">158</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[7]</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[11]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">14030</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[11]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">26669</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">21</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">430</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[0]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">14089</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[12]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[13]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[14]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">104</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">250</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">30</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">396</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">107</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">131</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[2]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">71</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[15]</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">flag = [BitVec(<span class="string">&quot;x%d&quot;</span> % i ,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(flag[<span class="number">1</span>] + flag[<span class="number">2</span>] == <span class="number">283</span>)</span><br><span class="line">s.add((((flag[<span class="number">0</span>] + flag[<span class="number">1</span>]) * flag[<span class="number">2</span>]) - flag[<span class="number">3</span>]) == <span class="number">30977</span>)</span><br><span class="line">s.add((flag[<span class="number">0</span>] * (flag[<span class="number">2</span>] ^ <span class="number">99</span>)) - flag[<span class="number">1</span>] + flag[<span class="number">3</span>] == <span class="number">8182</span>)</span><br><span class="line">s.add((flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + flag[<span class="number">2</span>] + flag[<span class="number">3</span>]) == <span class="number">542</span>)</span><br><span class="line">s.add(((flag[<span class="number">0</span>] * flag[<span class="number">3</span>]) - flag[<span class="number">1</span>] + flag[<span class="number">2</span>]) == <span class="number">13105</span>)</span><br><span class="line"></span><br><span class="line">s.add((flag[<span class="number">4</span>] + <span class="number">99</span>) ^ <span class="number">104</span> == <span class="number">338</span>)</span><br><span class="line">s.add((flag[<span class="number">5</span>] - <span class="number">51</span>) * <span class="number">99</span> == <span class="number">1089</span>)</span><br><span class="line">s.add((flag[<span class="number">6</span>] ^ <span class="number">99</span>) + <span class="number">107</span> == <span class="number">270</span>)</span><br><span class="line">s.add(flag[<span class="number">7</span>] == <span class="number">158</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * flag[<span class="number">11</span>] == <span class="number">14030</span>)</span><br><span class="line">s.add((flag[<span class="number">8</span>] + flag[<span class="number">9</span>]) * flag[<span class="number">10</span>] - flag[<span class="number">11</span>] == <span class="number">26669</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * (flag[<span class="number">10</span>] ^ <span class="number">99</span>) - flag[<span class="number">9</span>] + flag[<span class="number">11</span>] == <span class="number">21</span>)</span><br><span class="line">s.add((flag[<span class="number">8</span>] + flag[<span class="number">9</span>] + flag[<span class="number">10</span>] + flag[<span class="number">11</span>]) == <span class="number">430</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * flag[<span class="number">11</span>] - flag[<span class="number">9</span>] + flag[<span class="number">10</span>] == <span class="number">14089</span>)</span><br><span class="line">s.add((flag[<span class="number">12</span>] + <span class="number">99</span>) ^ <span class="number">104</span> == <span class="number">250</span>)</span><br><span class="line">s.add((flag[<span class="number">13</span>] - <span class="number">30</span>) * <span class="number">99</span> == <span class="number">396</span>)</span><br><span class="line">s.add((flag[<span class="number">14</span>] ^ <span class="number">99</span>) + <span class="number">107</span> == <span class="number">131</span>)</span><br><span class="line">s.add(flag[<span class="number">15</span>] == <span class="number">71</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;unsat&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到的结果取0xff然后拼接就对了</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">x</span><span class="number">12</span> <span class="operator">=</span> <span class="number">47</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">9</span> <span class="operator">=</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">4</span> <span class="operator">=</span> <span class="number">215</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">6</span> <span class="operator">=</span> <span class="number">192</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">8</span> <span class="operator">=</span> <span class="number">230</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">2</span> <span class="operator">=</span> <span class="number">32847</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">1</span> <span class="operator">=</span> <span class="number">32972</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">10</span> <span class="operator">=</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">11</span> <span class="operator">=</span> <span class="number">61</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">0</span> <span class="operator">=</span> <span class="number">189</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">3</span> <span class="operator">=</span> <span class="number">70</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">15</span> <span class="operator">=</span> <span class="number">71</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">13</span> <span class="operator">=</span> <span class="number">34</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">7</span> <span class="operator">=</span> <span class="number">158</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">5</span> <span class="operator">=</span> <span class="number">62</span>]</span><br></pre></td></tr></table></figure>

<p>PCL{bdcc4f46d73ec09ee628633d2f227b47}</p>
<h2 id="dsctf"><a href="#dsctf" class="headerlink" title="dsctf"></a>dsctf</h2><h3 id="catchme"><a href="#catchme" class="headerlink" title="catchme"></a>catchme</h3><p>这题太折磨了，其实逻辑巨简单，就是一个aes和base64，，但其中的密文和密钥全部要先进行异或。当时看密文感觉不对，就想着动调，但里面反调试太多了，现在看着其实交叉引用就能定位到，只是简单的xor。</p>
<p>jadx看到关键函数是check函数，直接在so文件搜索不到，应该是JNI <em>OnLoad里使用RegisterNatives注册check sub</em> B2A4</p>
<p>jni里，本来以为 sub_AEC8是关键函数，但后面那个aes数据解密出来是：Congratulations,but tryagain?</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114127868.png" alt="image-20220718114127868"></p>
<p>通过交叉引用发现，key和对比数据都进行了异或</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114211385.png" alt="image-20220718114211385"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">key = <span class="string">&quot;\x24&lt;=76!5&amp;?72*rrrrS&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(key[i]) ^ <span class="number">0x53</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">data = <span class="string">&quot;&quot;</span></span><br><span class="line">data_encode = [<span class="number">0x4F</span>, <span class="number">0x1C</span>, <span class="number">0x36</span>, <span class="number">0x49</span>, <span class="number">0x09</span>, <span class="number">0x3A</span>, <span class="number">0x3F</span>, <span class="number">0x07</span>, <span class="number">0x4D</span>, <span class="number">0x3D</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x0A</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0x06</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x20</span>, <span class="number">0x4A</span>, <span class="number">0x1B</span>, <span class="number">0x51</span>, <span class="number">0x51</span>, <span class="number">0x6C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_encode)):</span><br><span class="line">    data += <span class="built_in">chr</span>(data_encode[i] ^ <span class="number">0x6c</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">base = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">diy_base = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()+/&quot;</span></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;#pZ%eVSk!QNUlfNIjemL&amp;w==&quot;&quot;&quot;</span></span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">2</span>):</span><br><span class="line">    ss += base[diy_base.find(s[i])]</span><br><span class="line">ss += <span class="string">&quot;==&quot;</span></span><br><span class="line">a = base64.b64decode(ss)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">hex</span>, a)))</span><br><span class="line">x = [<span class="number">0</span>] * <span class="built_in">len</span>(flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    x[i] = <span class="built_in">hex</span>(<span class="built_in">ord</span>(flag[i]))</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>

<p>之后aes解密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">	AES_CYPHER_128,</span><br><span class="line">	AES_CYPHER_192,</span><br><span class="line">	AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Encryption Rounds</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span> <span class="number">128</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span> <span class="number">192</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span> <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">10</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">12</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nk[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">6</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nb[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes Rcon:</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* WARNING: Rcon is designed starting from 1 to 15, not 0 to 14.</span></span><br><span class="line"><span class="comment">*          FIPS-197 Page 9: &quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* i    |   0     1     2     3     4     5     6     7     8     9    10    11    12    13    14</span></span><br><span class="line"><span class="comment">* -----+------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*      | [01]  [02]  [04]  [08]  [10]  [20]  [40]  [80]  [1b]  [36]  [6c]  [d8]  [ab]  [4d]  [9a]</span></span><br><span class="line"><span class="comment">* RCON | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> g_aes_rcon[] = &#123;</span><br><span class="line">	<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes sbox and invert-sbox</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_sub_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_rot_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = val;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_swap_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* nr: number of rounds</span></span><br><span class="line"><span class="comment">* nb: number of columns comprising the state, nb = 4 dwords (16 bytes)</span></span><br><span class="line"><span class="comment">* nk: number of 32-bit words comprising cipher key, nk = 4, 6, 8 (KeyLength/(4*8))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_expansion</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *round)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span>  t;</span><br><span class="line">	<span class="type">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		w[i] = *((<span class="type">uint32_t</span> *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">			t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">			t = aes_sub_dword(t);</span><br><span class="line">			t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">			t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			t = w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_add_round_key</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *round, <span class="type">int</span> nr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span> *s = (<span class="type">uint32_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtime</span><span class="params">(<span class="type">uint8_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtimes</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">int</span> ts)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		x = aes_xtime(x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_mul</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">uint8_t</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* encrypt: y has only 2 bits: can be 1, 2 or 3</span></span><br><span class="line"><span class="comment">	* decrypt: y could be any value of 9, b, d, or e</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_encrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = v[j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">inv_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">		<span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_decrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> p = s[j] ^ v[j];</span><br><span class="line">			v[j] = data[i + j];</span><br><span class="line">			data[i + j] = p;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_128_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">		<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">		<span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_192_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_256_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">		<span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="comment">//数据</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0xda</span>, <span class="number">0x96</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x54</span>, <span class="number">0xa4</span>, <span class="number">0xd1</span>, <span class="number">0x3</span>, <span class="number">0x54</span>, <span class="number">0x95</span>, <span class="number">0xf3</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0xe9</span>, <span class="number">0x8b</span>, <span class="number">0xeb</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//密钥</span></span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x77</span>, <span class="number">0x6f</span>, <span class="number">0x6e</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x66</span>, <span class="number">0x75</span>, <span class="number">0x6c</span>,<span class="number">0x64</span>, <span class="number">0x61</span>,<span class="number">0x79</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>&#125;;</span><br><span class="line">	<span class="comment">//向量</span></span><br><span class="line">	<span class="type">uint8_t</span> iv[] = &#123;<span class="number">0x3c</span>, <span class="number">0x3d</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x21</span>, <span class="number">0x35</span>, <span class="number">0x26</span>, <span class="number">0x3f</span>, <span class="number">0x37</span>,<span class="number">0x32</span>, <span class="number">0x2a</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x53</span>&#125;;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">sizeof</span>(key))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//ECB</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">24</span>:aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">32</span>:aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="comment">//CBC</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	case 16:aes_decrypt_cbc(AES_CYPHER_128, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 24:aes_decrypt_cbc(AES_CYPHER_192, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 32:aes_decrypt_cbc(AES_CYPHER_256, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到：flag{weu&#x2F;.,iopl}</p>
<h3 id="FFunction"><a href="#FFunction" class="headerlink" title="FFunction"></a>FFunction</h3><p>这题搞得其实有点晕，好多信息要猜测，给了很多文件，我们找到关键my_plugin这个dll文件，在f函数中调试断点。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220719184430550.png" alt="image-20220719184430550"></p>
<p>发现tea加密，提取数据，又发现传进来的数据进行了疑似base64的加密，据说只能猜。而且flag长度也要猜。。。。。。我们提取密文，解密一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//加密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0x79B99E37</span> &lt;&lt; <span class="number">5</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x79B99E37</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> k[]=&#123;<span class="number">0x0BABEC0FE</span>,<span class="number">0x0DEADBEEF</span>,<span class="number">0x0FACEB00C</span>,<span class="number">0xDEADC0DE</span>&#125;,v[]=&#123;<span class="number">0x5C15754C</span>, <span class="number">0xD1D781E7</span>, <span class="number">0x501BF173</span>, <span class="number">0xCB4DB222</span>, <span class="number">0x215D61F5</span>, <span class="number">0x3FCA9EE7</span>, <span class="number">0x7C76B5C7</span>, <span class="number">0xC7DD8CB9</span>, <span class="number">0x990D23FA</span>, <span class="number">0x0BAB1AD3</span>, <span class="number">0x8E12C932</span>, <span class="number">0xD307BAF2</span>, <span class="number">0xE52DD123</span>, <span class="number">0xFBB68F2C</span>, <span class="number">0xBDD853E3</span>, <span class="number">0x892E1E4E</span>, <span class="number">0x39DD66FA</span>, <span class="number">0x87FEEC65</span>, <span class="number">0x307C5E60</span>, <span class="number">0x340C6C00</span>&#125;;</span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    decrypt(v+<span class="number">2</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">4</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">6</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">8</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">10</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">12</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">14</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">16</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">18</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">20</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">2</span>],v[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">4</span>],v[<span class="number">5</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">6</span>],v[<span class="number">7</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">8</span>],v[<span class="number">9</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">10</span>],v[<span class="number">11</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">12</span>],v[<span class="number">13</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">14</span>],v[<span class="number">15</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">16</span>],v[<span class="number">17</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">18</span>],v[<span class="number">19</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">20</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>decode小端序拼接一下，两两相加进行一个base64解密，然后再手动搞一下flag就对了，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a=<span class="string">&quot;30014006400460044007500230035008600c400a600e6003600c300930016004300340025004400d7007500250086002600f5006300050083007400e3000500a600840055007400970033001600e500a&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ccc=re.findall(<span class="string">&quot;.&#123;2&#125;&quot;</span>,a)</span><br><span class="line">ccc=[<span class="built_in">int</span>(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> ccc]</span><br><span class="line">fl=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ccc),<span class="number">2</span>):</span><br><span class="line">    fl+=(<span class="built_in">chr</span>(ccc[index]+ccc[index+<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(fl[::-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(fl[::-<span class="number">1</span>]).decode())</span><br><span class="line"><span class="comment">#Zn1sIWEhZ0N7X0VobXRwMTB3d19lcnJlX3RGdDF1</span></span><br><span class="line"><span class="comment">#f&#125;l!a!gC&#123;_Ehmtp10ww_erre_tFt1u</span></span><br></pre></td></tr></table></figure>

<p>手动一下：<strong>flag{Emp0wer_F1utter_w1th_C!!}</strong></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/29/re1/" rel="prev" title="re1">
      <i class="fa fa-chevron-left"></i> re1
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AFwp/" rel="next" title="蓝帽杯wp">
      蓝帽杯wp <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#re2"><span class="nav-text">re2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BD%E8%B5%9B%E5%88%86%E8%B5%9B%E5%8C%BAre"><span class="nav-text">国赛分赛区re</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#puzzle"><span class="nav-text">puzzle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#havetea"><span class="nav-text">havetea</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creak3"><span class="nav-text">creak3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creakme4"><span class="nav-text">creakme4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#analgo"><span class="nav-text">analgo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rota"><span class="nav-text">rota</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gocode"><span class="nav-text">gocode</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dsctf"><span class="nav-text">dsctf</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#catchme"><span class="nav-text">catchme</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FFunction"><span class="nav-text">FFunction</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bj777"
      src="/images/bitbug_favicon.ico">
  <p class="site-author-name" itemprop="name">bj777</p>
  <div class="site-description" itemprop="description">一位逆向菜狗</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jonathanbest7" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jonathanbest7" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/506611735@qq.com" title="E-Mail → 506611735@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/bang-ji-1" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;bang-ji-1" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bj777</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  
		<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
		<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
		<script type="text/javascript" src="/js/src/fireworks.js"></script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
