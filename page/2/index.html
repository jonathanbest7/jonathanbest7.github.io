<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/bitbug_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/bitbug_favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jonathanbest7.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一位逆向菜狗">
<meta property="og:type" content="website">
<meta property="og:title" content="bj777的blog">
<meta property="og:url" content="https://jonathanbest7.github.io/page/2/index.html">
<meta property="og:site_name" content="bj777的blog">
<meta property="og:description" content="一位逆向菜狗">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="bj777">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jonathanbest7.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>bj777的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">bj777的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习每一瞬间</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">29</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AFwp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AFwp/" class="post-title-link" itemprop="url">蓝帽杯wp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-12 22:29:35 / 修改时间：22:55:06" itemprop="dateCreated datePublished" datetime="2022-07-12T22:29:35+08:00">2022-07-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="蓝帽杯"><a href="#蓝帽杯" class="headerlink" title="蓝帽杯"></a>蓝帽杯</h1><p>这蓝帽杯太卷了，差点被干到复赛都进不了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_7FF6308E5890</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v0; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *input; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  _QWORD *v3; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbx</span></span><br><span class="line">  _QWORD *v6; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *v7; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  _QWORD *v9; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v11; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v12; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v13; <span class="comment">// rcx</span></span><br><span class="line">  _QWORD *v14; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v15; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v17; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 *v18; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v19; <span class="comment">// rdx</span></span><br><span class="line">  _QWORD *v20; <span class="comment">// rax</span></span><br><span class="line">  __int64 v21; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v22; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v23; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v24; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v25; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v26; <span class="comment">// rcx</span></span><br><span class="line">  __m128i v27; <span class="comment">// xmm4</span></span><br><span class="line">  __int64 v28; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v29; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v30; <span class="comment">// rcx</span></span><br><span class="line">  __m128i v31; <span class="comment">// [rsp+20h] [rbp-78h] BYREF</span></span><br><span class="line">  __m128i v32; <span class="comment">// [rsp+30h] [rbp-68h] BYREF</span></span><br><span class="line">  __int64 v33; <span class="comment">// [rsp+40h] [rbp-58h] BYREF</span></span><br><span class="line">  __int64 v34; <span class="comment">// [rsp+48h] [rbp-50h]</span></span><br><span class="line">  __m128i v35; <span class="comment">// [rsp+50h] [rbp-48h] BYREF</span></span><br><span class="line">  __int64 v36; <span class="comment">// [rsp+60h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v37; <span class="comment">// [rsp+68h] [rbp-30h]</span></span><br><span class="line"></span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E57E0);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E57D0);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E57C0);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E57B0);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E57A0);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E5790);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E5780);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E5770);</span><br><span class="line">  sub_7FF6308E0500(&amp;unk_7FF6308E5760);</span><br><span class="line">  <span class="built_in">printf</span>(Format, <span class="number">1</span>i64);</span><br><span class="line">  v0 = (<span class="type">const</span> <span class="type">char</span> *)off_7FF6308E8100(<span class="number">0</span>i64);</span><br><span class="line">  LODWORD(input) = <span class="built_in">scanf</span>(v0);</span><br><span class="line">  v3 = input;</span><br><span class="line">  <span class="keyword">if</span> ( input )</span><br><span class="line">    *(input - <span class="number">2</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( qword_7FF6308FF200 )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(_QWORD *)(qword_7FF6308FF200 - <span class="number">16</span>);</span><br><span class="line">    v2 = qword_7FF6308FF200 - <span class="number">16</span>;</span><br><span class="line">    *(_QWORD *)(qword_7FF6308FF200 - <span class="number">16</span>) = v4 - <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(v4 - <span class="number">8</span>) &lt;= <span class="number">7</span> )</span><br><span class="line">      sub_7FF6308D9580(off_7FF6308EA350 + <span class="number">3</span>, v2);</span><br><span class="line">  &#125;</span><br><span class="line">  qword_7FF6308FF200 = (__int64)v3;</span><br><span class="line">  v5 = <span class="number">0</span>i64;</span><br><span class="line">  v6 = (_QWORD *)sub_7FF6308DC000(<span class="number">5</span>i64, v2);</span><br><span class="line">  v7 = v6;</span><br><span class="line">  <span class="keyword">if</span> ( !v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">      sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !*v6 )</span><br><span class="line">      sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *v6 &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">      sub_7FF6308DF460(v5, *v6 - <span class="number">1</span>i64);</span><br><span class="line">    v8 = *v3;</span><br><span class="line">    <span class="keyword">if</span> ( *v3 &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">      sub_7FF6308DF460(v5, v8 - <span class="number">1</span>);</span><br><span class="line">    *((_BYTE *)v6 + v5 + <span class="number">16</span>) = *((_BYTE *)v3 + v5 + <span class="number">16</span>);</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v5 &lt;= <span class="number">4</span> );</span><br><span class="line">  <span class="keyword">if</span> ( *v6 != <span class="number">5</span>i64 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  v9 = v6 + <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *((_DWORD *)v7 + <span class="number">4</span>) != dword_7FF6308E9E00 )<span class="comment">// 判断前五个是不是flag&#123;</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  <span class="keyword">if</span> ( *((_BYTE *)v9 + <span class="number">4</span>) != byte_7FF6308E9E04 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  v11 = (<span class="type">unsigned</span> __int64 *)qword_7FF6308FF200;</span><br><span class="line">  <span class="keyword">if</span> ( !qword_7FF6308FF200 || *(_QWORD *)qword_7FF6308FF200 != <span class="string">&#x27;*&#x27;</span> || *(_BYTE *)(qword_7FF6308FF200 + <span class="number">57</span>) != <span class="string">&#x27;&#125;&#x27;</span> )<span class="comment">// 判断位数是否是42，并且最后一位是否是&#125;</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  v12 = <span class="number">0</span>i64;</span><br><span class="line">  v14 = (_QWORD *)sub_7FF6308DC000(<span class="number">18</span>i64, v8);</span><br><span class="line">  <span class="keyword">if</span> ( !v14 )</span><br><span class="line">    sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v15 = *v14;</span><br><span class="line">    <span class="keyword">if</span> ( *v14 &lt;= (<span class="type">unsigned</span> __int64)v12 )</span><br><span class="line">      sub_7FF6308DF460(v12, v15 - <span class="number">1</span>);</span><br><span class="line">    v16 = v12 + <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v12 + <span class="number">5</span> &lt; <span class="number">0</span> || v16 &lt; v12 )</span><br><span class="line">      sub_7FF6308DAFB0(v13, v15);</span><br><span class="line">    <span class="keyword">if</span> ( *v11 &lt;= v16 )</span><br><span class="line">      sub_7FF6308DF460(v12 + <span class="number">5</span>, *v11 - <span class="number">1</span>);</span><br><span class="line">    *((_BYTE *)v14 + v12++ + <span class="number">16</span>) = *((_BYTE *)v11 + v16 + <span class="number">16</span>);<span class="comment">// 提取前18位</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v12 &lt;= <span class="number">17</span> );</span><br><span class="line">  v17 = <span class="number">0</span>i64;</span><br><span class="line">  sub_7FF6308E4380((__int64)v14, <span class="number">10</span>i64, &amp;xmmword_7FF6308FF1B0);<span class="comment">// 能看到取了前18位并且检验是否有-</span></span><br><span class="line">  v18 = (<span class="type">unsigned</span> __int64 *)qword_7FF6308FF200;</span><br><span class="line">  v20 = (_QWORD *)sub_7FF6308DC000(<span class="number">18</span>i64, v19);</span><br><span class="line">  <span class="keyword">if</span> ( !v20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v18 )</span><br><span class="line">      sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v18 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !*v20 )</span><br><span class="line">      sub_7FF6308DF460(<span class="number">0</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">    sub_7FF6308DF460(<span class="number">23</span>i64, <span class="number">-1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v22 = *v20;</span><br><span class="line">    <span class="keyword">if</span> ( *v20 &lt;= (<span class="type">unsigned</span> __int64)v17 )</span><br><span class="line">      sub_7FF6308DF460(v17, v22 - <span class="number">1</span>);</span><br><span class="line">    v23 = v17 + <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 + <span class="number">23</span> &lt; <span class="number">0</span> || v23 &lt; v17 )</span><br><span class="line">      sub_7FF6308DAFB0(v21, v22);</span><br><span class="line">    <span class="keyword">if</span> ( *v18 &lt;= v23 )</span><br><span class="line">      sub_7FF6308DF460(v17 + <span class="number">23</span>, *v18 - <span class="number">1</span>);</span><br><span class="line">    *((_BYTE *)v20 + v17++ + <span class="number">16</span>) = *((_BYTE *)v18 + v23 + <span class="number">16</span>);<span class="comment">// 后18位</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v17 &lt;= <span class="number">17</span> );</span><br><span class="line">  sub_7FF6308E4380((__int64)v20, <span class="number">10</span>i64, &amp;xmmword_7FF6308FF170);</span><br><span class="line">  sub_7FF6308E4380((__int64)&amp;unk_7FF6308E9DC0, <span class="number">10</span>i64, &amp;xmmword_7FF6308FF190);</span><br><span class="line">  sub_7FF6308E4380((__int64)&amp;unk_7FF6308E9D80, <span class="number">10</span>i64, &amp;xmmword_7FF6308FF1A0);</span><br><span class="line">  v32 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF190);</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1B0);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)sub_7FF6308E50C0(&amp;v32, &amp;v31) )<span class="comment">//判断范围</span></span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  v32 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1B0);</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1A0);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)sub_7FF6308E50C0(&amp;v32, &amp;v31) )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">  v33 = <span class="number">0</span>i64;</span><br><span class="line">  v34 = <span class="number">0</span>i64;</span><br><span class="line">  v32 = (__m128i)xmmword_7FF6308FF1B0;</span><br><span class="line">  v31 = (__m128i)xmmword_7FF6308FF1B0;</span><br><span class="line">  math(&amp;v32, &amp;v31, (__int64)&amp;v33);              <span class="comment">// 前两个参数存着前18位</span></span><br><span class="line">  v24 = v33;</span><br><span class="line">  <span class="keyword">if</span> ( v33 )</span><br><span class="line">    *(_QWORD *)(v33 - <span class="number">16</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (_QWORD)xmmword_7FF6308FF1D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    v25 = xmmword_7FF6308FF1D0 - <span class="number">16</span>;</span><br><span class="line">    v26 = *(_QWORD *)(xmmword_7FF6308FF1D0 - <span class="number">16</span>) - <span class="number">8</span>i64;</span><br><span class="line">    *(_QWORD *)(xmmword_7FF6308FF1D0 - <span class="number">16</span>) = v26;</span><br><span class="line">    <span class="keyword">if</span> ( v26 &lt;= <span class="number">7</span> )</span><br><span class="line">      sub_7FF6308D9580(off_7FF6308EA350 + <span class="number">3</span>, v25);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;xmmword_7FF6308FF1D0 = v24;</span><br><span class="line">  v35 = <span class="number">0u</span>i64;</span><br><span class="line">  BYTE8(xmmword_7FF6308FF1D0) = v34;</span><br><span class="line">  v32 = (__m128i)xmmword_7FF6308FF170;</span><br><span class="line">  v31 = (__m128i)xmmword_7FF6308FF170;</span><br><span class="line">  math(&amp;v32, &amp;v31, (__int64)&amp;v35);              <span class="comment">// 相乘得到</span></span><br><span class="line">  v27 = _mm_load_si128(&amp;v35);</span><br><span class="line">  v36 = <span class="number">0</span>i64;</span><br><span class="line">  v37 = <span class="number">0</span>i64;</span><br><span class="line">  v32 = v27;</span><br><span class="line">  multiply(&amp;v32, <span class="number">11</span>i64, &amp;v36);                  <span class="comment">// 也就是后18位相乘之后在乘11</span></span><br><span class="line">  v28 = v36;</span><br><span class="line">  <span class="keyword">if</span> ( v36 )</span><br><span class="line">    *(_QWORD *)(v36 - <span class="number">16</span>) += <span class="number">8</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (_QWORD)xmmword_7FF6308FF160 )</span><br><span class="line">  &#123;</span><br><span class="line">    v29 = xmmword_7FF6308FF160 - <span class="number">16</span>;</span><br><span class="line">    v30 = *(_QWORD *)(xmmword_7FF6308FF160 - <span class="number">16</span>) - <span class="number">8</span>i64;</span><br><span class="line">    *(_QWORD *)(xmmword_7FF6308FF160 - <span class="number">16</span>) = v30;</span><br><span class="line">    <span class="keyword">if</span> ( v30 &lt;= <span class="number">7</span> )</span><br><span class="line">      sub_7FF6308D9580(off_7FF6308EA350 + <span class="number">3</span>, v29);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;xmmword_7FF6308FF160 = v28;</span><br><span class="line">  v32 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1D0);</span><br><span class="line">  BYTE8(xmmword_7FF6308FF160) = v37;</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF160);</span><br><span class="line">  jian(v32.m128i_i64, v31.m128i_i64, (__int64)&amp;xmmword_7FF6308FF1E0);<span class="comment">// 进行减法</span></span><br><span class="line">  sub_7FF6308E4380((__int64)&amp;unk_7FF6308E9D50, <span class="number">10</span>i64, &amp;xmmword_7FF6308FF1C0);</span><br><span class="line">  v32 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1E0);</span><br><span class="line">  v31 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF6308FF1C0);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)cmp(&amp;v32, &amp;v31) )       <span class="comment">// 对比数据</span></span><br><span class="line">  &#123;</span><br><span class="line">    qword_7FF6308ED6A0 = <span class="number">1</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_15:</span><br><span class="line">    <span class="keyword">if</span> ( qword_7FF6308ED6A0 != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">printf</span>(&amp;byte_7FF6308E9D00, <span class="number">1</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(a0, <span class="number">1</span>i64);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题dump出来是不对的，直接调试程序找到主要逻辑，但这个逻辑很难看懂啊。最后发现是个简单的运算，算的就是x^2 - 11 *y^2 &#x3D; 9,当x的范围在</p>
<p>100000000000000000&lt;x&lt;999999999999999999时的情况，解一下方程得到flag，注意要加一个-才对</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/07/05/re2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/05/re2/" class="post-title-link" itemprop="url">re2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-05 23:14:01" itemprop="dateCreated datePublished" datetime="2022-07-05T23:14:01+08:00">2022-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 15:29:21" itemprop="dateModified" datetime="2022-08-10T15:29:21+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="re2"><a href="#re2" class="headerlink" title="re2"></a>re2</h1><h2 id="国赛分赛区re"><a href="#国赛分赛区re" class="headerlink" title="国赛分赛区re"></a>国赛分赛区re</h2><h3 id="puzzle"><a href="#puzzle" class="headerlink" title="puzzle"></a>puzzle</h3><p>是个upx壳，自动脱壳没脱掉，原来是upx的特征被改了，下面UPX全部被改成了vmp，全部恢复成UPX再脱壳就行，但不能调试，应该是文件到内存的偏移存在问题。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220705231608958.png" alt="image-20220705231608958"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> *(_QWORD *)v20 = fmt_Fprintf((__int64)&amp;off_505F00, qword_588528, <span class="string">&quot;Input: &quot;</span>, <span class="number">7LL</span>, v2, <span class="number">0LL</span>, <span class="number">0LL</span>, v16, v17, v18);</span><br><span class="line">  v38[<span class="number">0</span>] = <span class="string">&quot;\b&quot;</span>;</span><br><span class="line">  v38[<span class="number">1</span>] = v35;</span><br><span class="line">  v11 = &amp;off_505EE0;</span><br><span class="line">  v12 = (__int64 *)qword_588520;</span><br><span class="line">  *(_QWORD *)v13 = <span class="string">&quot;%s&quot;</span>;</span><br><span class="line">  *(_QWORD *)&amp;v13[<span class="number">8</span>] = <span class="number">2LL</span>;</span><br><span class="line">  *(_QWORD *)&amp;v13[<span class="number">16</span>] = v38;</span><br><span class="line">  v14 = <span class="number">1LL</span>;</span><br><span class="line">  v15 = <span class="number">1LL</span>;</span><br><span class="line">  fmt_Fscanf((__int64)v1, v0, (<span class="type">const</span> <span class="type">char</span> *)&amp;off_505EE0);</span><br><span class="line">  <span class="keyword">if</span> ( !v17 )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = v35;</span><br><span class="line">    v4 = <span class="number">0LL</span>;</span><br><span class="line">    v5 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v4 &lt; <span class="number">9</span> )<span class="comment">//主要加密</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; <span class="number">9</span>; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        v1 = (__int64 *)v40[<span class="number">3</span> * v4 - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> ( v40[<span class="number">3</span> * v4] &lt;= (<span class="type">unsigned</span> __int64)i )</span><br><span class="line">          sub_466740((__int64)v11, (__int64)v12);</span><br><span class="line">        v0 = *((<span class="type">unsigned</span> __int8 *)v1 + i);</span><br><span class="line">        <span class="keyword">if</span> ( !(_BYTE)v0 )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = v3[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v7 &lt;= v5 )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">          <span class="keyword">if</span> ( v7 &lt;= (<span class="type">unsigned</span> __int64)v5 )</span><br><span class="line">            sub_466740((__int64)v11, (__int64)v12);</span><br><span class="line">          v8 = *(<span class="type">unsigned</span> __int8 *)(v5 + *v3);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v8 &lt; <span class="string">&#x27;0&#x27;</span> || (<span class="type">unsigned</span> __int8)v8 &gt; <span class="string">&#x27;9&#x27;</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">          v0 = (<span class="type">unsigned</span> <span class="type">int</span>)(v8 - <span class="number">48</span>);</span><br><span class="line">          *((_BYTE *)v1 + i) = v0;</span><br><span class="line">          ++v5;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3[<span class="number">1</span>] == v5 &amp;&amp; (v15 = sub_4B8720((__int64)&amp;v39, <span class="number">9LL</span>, <span class="number">9</span>, v13[<span class="number">8</span>]), v13[<span class="number">8</span>]) )</span><br><span class="line">    &#123;</span><br><span class="line">      v17 = runtime_stringtoslicebyte((__int64)v34, *v35, v35[<span class="number">1</span>], *(__int64 *)&amp;v13[<span class="number">8</span>], *(__int64 *)&amp;v13[<span class="number">16</span>], v14);</span><br><span class="line">      v16 = sub_4938A0(*(__int64 *)&amp;v13[<span class="number">8</span>], *(__int64 *)&amp;v13[<span class="number">16</span>], v14, *(__int128 *)&amp;v13[<span class="number">8</span>]);</span><br><span class="line">      v32 = *(_OWORD *)&amp;v13[<span class="number">8</span>];</span><br><span class="line">      v33 = *(_OWORD *)&amp;v13[<span class="number">8</span>];</span><br><span class="line">      runtime_convT2Enoptr((__int64)&amp;unk_4C6160, (__int64)&amp;v33, *(__int64 *)v13, *(__int64 *)&amp;v13[<span class="number">8</span>]);</span><br><span class="line">      v37 = *(_OWORD *)v13;</span><br><span class="line">      v11 = &amp;off_505F00;</span><br><span class="line">      v12 = (__int64 *)qword_588528;</span><br><span class="line">      *(_QWORD *)v13 = <span class="string">&quot;Your flag is flag&#123;%x&#125;async stack too l&quot;</span>;</span><br><span class="line">      *(_QWORD *)&amp;v13[<span class="number">8</span>] = <span class="number">21LL</span>;</span><br><span class="line">      *(_QWORD *)&amp;v13[<span class="number">16</span>] = &amp;v37;</span><br><span class="line">      v14 = <span class="number">1LL</span>;</span><br><span class="line">      v15 = <span class="number">1LL</span>;</span><br><span class="line">      fmt_Fprintf((__int64)v1, v0, v9);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">LABEL_13:</span><br><span class="line">      v36[<span class="number">0</span>] = &amp;unk_4C5940;</span><br><span class="line">      v36[<span class="number">1</span>] = &amp;off_504828;                     <span class="comment">// Wrong！</span></span><br><span class="line">      *(_QWORD *)&amp;v19 = fmt_Fprintln((__int64)&amp;off_505F00, qword_588528, (__int64)v36, <span class="number">1LL</span>, <span class="number">1LL</span>, v14, v15, v16);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是个go程序，直接找到main_main发现符号表并没有损坏，直接看，发现应该是个数独，毕竟这一周做了两道数独了。</p>
<p>但是从静态是看不到数独的图的，所以只能动态，用程序脱壳后的程序并不能动调，所以得手动跟，比较不好跟。</p>
<p>直接找到rsp的地址后，步入sub_5AB660</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151134283.png" alt="image-20220803151134283"></p>
<p>sub_5AB700</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151228497.png" alt="image-20220803151228497"></p>
<p>sub_5AF500</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151237196.png" alt="image-20220803151237196"></p>
<p>sub_5ADBA0</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151245375.png" alt="image-20220803151245375"></p>
<p>sub_5D4300</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151255502.png" alt="image-20220803151255502"></p>
<p>到sub_628C40</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151322255.png" alt="image-20220803151322255"></p>
<p>发现call    rax ; sub_628C40进去就是main_main，发现了加载地图的地方</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151527692.png" alt="image-20220803151527692"></p>
<p>查看v48</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151556289.png" alt="image-20220803151556289"></p>
<p>就是地图</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220803151843891.png" alt="image-20220803151843891"></p>
<p>得到flag</p>
<h3 id="havetea"><a href="#havetea" class="headerlink" title="havetea"></a>havetea</h3><p>动调可以发现就是一个tea加密和xtea加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220706163158211.png" alt="image-20220706163158211"></p>
<p>发现输入16字节，8字节传入，进行两次tea加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0x9E3779B9</span> * <span class="number">32</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9E3779B9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[] = &#123; <span class="number">0xE66F0E9E</span>, <span class="number">0x42A17CD6</span> &#125;, k[<span class="number">4</span>] = &#123; <span class="number">0x9e</span>,<span class="number">0x37</span>,<span class="number">0x79</span>,<span class="number">0xb9</span> &#125;, v1[] = &#123;  <span class="number">0x5BDDE878</span>, <span class="number">0xD236F4AD</span> &#125;;</span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]); </span><br><span class="line">    decrypt(v1, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v1[<span class="number">0</span>], v1[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">倒序就是密码：please_drink_tea</span><br></pre></td></tr></table></figure>

<p>然后就是一个xtea加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x9E3779B9</span>, sum = delta * num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[] = &#123; <span class="number">0x7D758E0A</span>, <span class="number">0xEDAFF6AD</span> &#125;, v1[] = &#123; <span class="number">0x9DDE7E86</span>, <span class="number">0xE3D36CD5</span> &#125;, v2[] = &#123; <span class="number">0xABD3C82E</span>, <span class="number">0x6B7B2CFE</span> &#125;, v3[] = &#123; <span class="number">0x2C6608C2</span>, <span class="number">0x0686A1DA</span> &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>] = &#123; <span class="number">0x61656C70</span>, <span class="number">0x645F6573</span>, <span class="number">0x6B6E6972</span>, <span class="number">0x6165745F</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> r = <span class="number">32</span>;<span class="comment">//num_rounds建议取值为32</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    decipher(r, v, k);</span><br><span class="line">    decipher(r, v1, k);</span><br><span class="line">    decipher(r, v2, k);</span><br><span class="line">    decipher(r, v3, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v1[<span class="number">0</span>], v1[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v2[<span class="number">0</span>], v2[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>, v3[<span class="number">0</span>], v3[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>倒序转换成字符就行了</p>
<p>_rdtsc</p>
<h3 id="creak3"><a href="#creak3" class="headerlink" title="creak3"></a>creak3</h3><p>用jadx打开发现很简单加密，就是把flag{xxxxxxxxx}中间的密文传进check函数，直接去so文件找jni发现关键check函数</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707202353900.png" alt="image-20220707202353900"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_4700</span><span class="params">(__int64 *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  _DWORD *v4; <span class="comment">// r14</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4h] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+8h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+Ch] [rbp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+10h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+14h] [rbp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+18h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v3 = (*(__int64 (__fastcall **)(__int64 *, __int64, _QWORD))(*a1 + <span class="number">1352</span>))(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_3D70(v3) == <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">16</span>;</span><br><span class="line">    v4 = <span class="built_in">malloc</span>(<span class="number">0x80</span>uLL);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_4330(v3, v4, &amp;v10) )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *a1;</span><br><span class="line">      v6 = <span class="string">&quot;Bad format&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = *v4 ^ <span class="number">0x39DEB332</span>;</span><br><span class="line">      v11 = v4[<span class="number">1</span>] ^ v9;</span><br><span class="line">      v12 = v4[<span class="number">2</span>] ^ v11;</span><br><span class="line">      v8 = v4[<span class="number">3</span>] ^ v12;</span><br><span class="line">      <span class="keyword">if</span> ( sub_43F0((__int64)&amp;v9) &amp;&amp; (<span class="type">unsigned</span> __int8)sub_44E0(&amp;v11) &amp;&amp; (<span class="type">unsigned</span> __int8)sub_4630(&amp;v8) )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *a1;</span><br><span class="line">        v6 = <span class="string">&quot;right flag!!!&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *a1;</span><br><span class="line">        v6 = <span class="string">&quot;sorry,wrong flag.&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = *a1;</span><br><span class="line">    v6 = <span class="string">&quot;length of input is not enough!!!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (*(__int64 (__fastcall **)(__int64 *, <span class="type">const</span> <span class="type">char</span> *))(v5 + <span class="number">1336</span>))(a1, v6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序的意思就是要输入一个32位的flag，然后每两个一组变成16进制，变成16位，4个4个一组，先进行异或，然后进入三个函数验证</p>
<p>第一个函数是sha1加密，4字节还知道一个字节</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">        <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xff</span>):</span><br><span class="line">            arr = [i1, i2, <span class="number">0xe9</span>,i4]</span><br><span class="line">            <span class="keyword">if</span>(hashlib.sha1(<span class="built_in">bytes</span>(arr)).hexdigest().lower() == <span class="string">&quot;2e60865e94119223c4657eac98d744ee909e66b8&quot;</span>):  </span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">hex</span>(i1),<span class="built_in">hex</span>(i2),<span class="number">0xe9</span>,<span class="built_in">hex</span>(i4))</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>第二个函数刚开始没看出来，后面发现是sm4加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707105839618.png" alt="image-20220707105839618"></p>
<p>不难发现是sm4的cbc模式，那么需要找到key和iv，发现是0-0xf，直接写脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SM4_ENCRYPT     1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SM4_DECRYPT     0</span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 context structure</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> mode;                   <span class="comment">/*!&lt;  encrypt/decrypt   */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>];       <span class="comment">/*!&lt;  SM4 subkeys       */</span></span><br><span class="line">&#125;</span><br><span class="line">sm4_context;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment">* \param key      16-byte secret key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_enc</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context to be initialized</span></span><br><span class="line"><span class="comment">* \param key      16-byte secret key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_dec</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context</span></span><br><span class="line"><span class="comment">* \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment">* \param length   length of the input data</span></span><br><span class="line"><span class="comment">* \param input    input block</span></span><br><span class="line"><span class="comment">* \param output   output block</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_ecb</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* \brief          SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment">* \param ctx      SM4 context</span></span><br><span class="line"><span class="comment">* \param mode     SM4_ENCRYPT or SM4_DECRYPT</span></span><br><span class="line"><span class="comment">* \param length   length of the input data</span></span><br><span class="line"><span class="comment">* \param iv       initialization vector (updated after use)</span></span><br><span class="line"><span class="comment">* \param input    buffer holding the input data</span></span><br><span class="line"><span class="comment">* \param output   buffer holding the output data</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_cbc</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span>;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 32-bit integer manipulation macros (big endian)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> GET_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GET_ULONG_BE(n,b,i)                             \</span></span><br><span class="line"><span class="meta">&#123;                                                       \</span></span><br><span class="line"><span class="meta">    (n) = ( (unsigned long) (b)[(i)    ] &lt;&lt; 24 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 1] &lt;&lt; 16 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 2] &lt;&lt;  8 )        \</span></span><br><span class="line"><span class="meta">        | ( (unsigned long) (b)[(i) + 3]       );       \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PUT_ULONG_BE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PUT_ULONG_BE(n,b,i)                             \</span></span><br><span class="line"><span class="meta">&#123;                                                       \</span></span><br><span class="line"><span class="meta">    (b)[(i)    ] = (unsigned char) ( (n) &gt;&gt; 24 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 1] = (unsigned char) ( (n) &gt;&gt; 16 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 2] = (unsigned char) ( (n) &gt;&gt;  8 );       \</span></span><br><span class="line"><span class="meta">    (b)[(i) + 3] = (unsigned char) ( (n)       );       \</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*rotate shift left marco definition</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>  SHL(x,n) (((x) &amp; 0xFFFFFFFF) &lt;&lt; n)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x,n) (SHL((x),n) | ((x) &gt;&gt; (32 - n)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SWAP(a,b) &#123; unsigned long t = a; a = b; b = t; t = 0; &#125;</span></span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Expanded SM4 S-boxes</span></span><br><span class="line"><span class="comment">/* Sbox table: 8bits input convert to 8 bits output*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> SboxTable[<span class="number">16</span>][<span class="number">16</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	&#123; <span class="number">0xd6</span>,<span class="number">0x90</span>,<span class="number">0xe9</span>,<span class="number">0xfe</span>,<span class="number">0xcc</span>,<span class="number">0xe1</span>,<span class="number">0x3d</span>,<span class="number">0xb7</span>,<span class="number">0x16</span>,<span class="number">0xb6</span>,<span class="number">0x14</span>,<span class="number">0xc2</span>,<span class="number">0x28</span>,<span class="number">0xfb</span>,<span class="number">0x2c</span>,<span class="number">0x05</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x2b</span>,<span class="number">0x67</span>,<span class="number">0x9a</span>,<span class="number">0x76</span>,<span class="number">0x2a</span>,<span class="number">0xbe</span>,<span class="number">0x04</span>,<span class="number">0xc3</span>,<span class="number">0xaa</span>,<span class="number">0x44</span>,<span class="number">0x13</span>,<span class="number">0x26</span>,<span class="number">0x49</span>,<span class="number">0x86</span>,<span class="number">0x06</span>,<span class="number">0x99</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x9c</span>,<span class="number">0x42</span>,<span class="number">0x50</span>,<span class="number">0xf4</span>,<span class="number">0x91</span>,<span class="number">0xef</span>,<span class="number">0x98</span>,<span class="number">0x7a</span>,<span class="number">0x33</span>,<span class="number">0x54</span>,<span class="number">0x0b</span>,<span class="number">0x43</span>,<span class="number">0xed</span>,<span class="number">0xcf</span>,<span class="number">0xac</span>,<span class="number">0x62</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xe4</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0xa9</span>,<span class="number">0xc9</span>,<span class="number">0x08</span>,<span class="number">0xe8</span>,<span class="number">0x95</span>,<span class="number">0x80</span>,<span class="number">0xdf</span>,<span class="number">0x94</span>,<span class="number">0xfa</span>,<span class="number">0x75</span>,<span class="number">0x8f</span>,<span class="number">0x3f</span>,<span class="number">0xa6</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x47</span>,<span class="number">0x07</span>,<span class="number">0xa7</span>,<span class="number">0xfc</span>,<span class="number">0xf3</span>,<span class="number">0x73</span>,<span class="number">0x17</span>,<span class="number">0xba</span>,<span class="number">0x83</span>,<span class="number">0x59</span>,<span class="number">0x3c</span>,<span class="number">0x19</span>,<span class="number">0xe6</span>,<span class="number">0x85</span>,<span class="number">0x4f</span>,<span class="number">0xa8</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x68</span>,<span class="number">0x6b</span>,<span class="number">0x81</span>,<span class="number">0xb2</span>,<span class="number">0x71</span>,<span class="number">0x64</span>,<span class="number">0xda</span>,<span class="number">0x8b</span>,<span class="number">0xf8</span>,<span class="number">0xeb</span>,<span class="number">0x0f</span>,<span class="number">0x4b</span>,<span class="number">0x70</span>,<span class="number">0x56</span>,<span class="number">0x9d</span>,<span class="number">0x35</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x1e</span>,<span class="number">0x24</span>,<span class="number">0x0e</span>,<span class="number">0x5e</span>,<span class="number">0x63</span>,<span class="number">0x58</span>,<span class="number">0xd1</span>,<span class="number">0xa2</span>,<span class="number">0x25</span>,<span class="number">0x22</span>,<span class="number">0x7c</span>,<span class="number">0x3b</span>,<span class="number">0x01</span>,<span class="number">0x21</span>,<span class="number">0x78</span>,<span class="number">0x87</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xd4</span>,<span class="number">0x00</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x9f</span>,<span class="number">0xd3</span>,<span class="number">0x27</span>,<span class="number">0x52</span>,<span class="number">0x4c</span>,<span class="number">0x36</span>,<span class="number">0x02</span>,<span class="number">0xe7</span>,<span class="number">0xa0</span>,<span class="number">0xc4</span>,<span class="number">0xc8</span>,<span class="number">0x9e</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xea</span>,<span class="number">0xbf</span>,<span class="number">0x8a</span>,<span class="number">0xd2</span>,<span class="number">0x40</span>,<span class="number">0xc7</span>,<span class="number">0x38</span>,<span class="number">0xb5</span>,<span class="number">0xa3</span>,<span class="number">0xf7</span>,<span class="number">0xf2</span>,<span class="number">0xce</span>,<span class="number">0xf9</span>,<span class="number">0x61</span>,<span class="number">0x15</span>,<span class="number">0xa1</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xe0</span>,<span class="number">0xae</span>,<span class="number">0x5d</span>,<span class="number">0xa4</span>,<span class="number">0x9b</span>,<span class="number">0x34</span>,<span class="number">0x1a</span>,<span class="number">0x55</span>,<span class="number">0xad</span>,<span class="number">0x93</span>,<span class="number">0x32</span>,<span class="number">0x30</span>,<span class="number">0xf5</span>,<span class="number">0x8c</span>,<span class="number">0xb1</span>,<span class="number">0xe3</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x1d</span>,<span class="number">0xf6</span>,<span class="number">0xe2</span>,<span class="number">0x2e</span>,<span class="number">0x82</span>,<span class="number">0x66</span>,<span class="number">0xca</span>,<span class="number">0x60</span>,<span class="number">0xc0</span>,<span class="number">0x29</span>,<span class="number">0x23</span>,<span class="number">0xab</span>,<span class="number">0x0d</span>,<span class="number">0x53</span>,<span class="number">0x4e</span>,<span class="number">0x6f</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0xd5</span>,<span class="number">0xdb</span>,<span class="number">0x37</span>,<span class="number">0x45</span>,<span class="number">0xde</span>,<span class="number">0xfd</span>,<span class="number">0x8e</span>,<span class="number">0x2f</span>,<span class="number">0x03</span>,<span class="number">0xff</span>,<span class="number">0x6a</span>,<span class="number">0x72</span>,<span class="number">0x6d</span>,<span class="number">0x6c</span>,<span class="number">0x5b</span>,<span class="number">0x51</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x8d</span>,<span class="number">0x1b</span>,<span class="number">0xaf</span>,<span class="number">0x92</span>,<span class="number">0xbb</span>,<span class="number">0xdd</span>,<span class="number">0xbc</span>,<span class="number">0x7f</span>,<span class="number">0x11</span>,<span class="number">0xd9</span>,<span class="number">0x5c</span>,<span class="number">0x41</span>,<span class="number">0x1f</span>,<span class="number">0x10</span>,<span class="number">0x5a</span>,<span class="number">0xd8</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x0a</span>,<span class="number">0xc1</span>,<span class="number">0x31</span>,<span class="number">0x88</span>,<span class="number">0xa5</span>,<span class="number">0xcd</span>,<span class="number">0x7b</span>,<span class="number">0xbd</span>,<span class="number">0x2d</span>,<span class="number">0x74</span>,<span class="number">0xd0</span>,<span class="number">0x12</span>,<span class="number">0xb8</span>,<span class="number">0xe5</span>,<span class="number">0xb4</span>,<span class="number">0xb0</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x89</span>,<span class="number">0x69</span>,<span class="number">0x97</span>,<span class="number">0x4a</span>,<span class="number">0x0c</span>,<span class="number">0x96</span>,<span class="number">0x77</span>,<span class="number">0x7e</span>,<span class="number">0x65</span>,<span class="number">0xb9</span>,<span class="number">0xf1</span>,<span class="number">0x09</span>,<span class="number">0xc5</span>,<span class="number">0x6e</span>,<span class="number">0xc6</span>,<span class="number">0x84</span> &#125;,</span><br><span class="line">	&#123; <span class="number">0x18</span>,<span class="number">0xf0</span>,<span class="number">0x7d</span>,<span class="number">0xec</span>,<span class="number">0x3a</span>,<span class="number">0xdc</span>,<span class="number">0x4d</span>,<span class="number">0x20</span>,<span class="number">0x79</span>,<span class="number">0xee</span>,<span class="number">0x5f</span>,<span class="number">0x3e</span>,<span class="number">0xd7</span>,<span class="number">0xcb</span>,<span class="number">0x39</span>,<span class="number">0x48</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* System parameter */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> FK[<span class="number">4</span>] =</span><br><span class="line">&#123; <span class="number">0xa3b1bac6</span>,<span class="number">0x56aa3350</span>,<span class="number">0x677d9197</span>,<span class="number">0xb27022dc</span> &#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* fixed parameter */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> CK[<span class="number">32</span>] =</span><br><span class="line">&#123;</span><br><span class="line">	<span class="number">0x00070e15</span>,<span class="number">0x1c232a31</span>,<span class="number">0x383f464d</span>,<span class="number">0x545b6269</span>,</span><br><span class="line">	<span class="number">0x70777e85</span>,<span class="number">0x8c939aa1</span>,<span class="number">0xa8afb6bd</span>,<span class="number">0xc4cbd2d9</span>,</span><br><span class="line">	<span class="number">0xe0e7eef5</span>,<span class="number">0xfc030a11</span>,<span class="number">0x181f262d</span>,<span class="number">0x343b4249</span>,</span><br><span class="line">	<span class="number">0x50575e65</span>,<span class="number">0x6c737a81</span>,<span class="number">0x888f969d</span>,<span class="number">0xa4abb2b9</span>,</span><br><span class="line">	<span class="number">0xc0c7ced5</span>,<span class="number">0xdce3eaf1</span>,<span class="number">0xf8ff060d</span>,<span class="number">0x141b2229</span>,</span><br><span class="line">	<span class="number">0x30373e45</span>,<span class="number">0x4c535a61</span>,<span class="number">0x686f767d</span>,<span class="number">0x848b9299</span>,</span><br><span class="line">	<span class="number">0xa0a7aeb5</span>,<span class="number">0xbcc3cad1</span>,<span class="number">0xd8dfe6ed</span>,<span class="number">0xf4fb0209</span>,</span><br><span class="line">	<span class="number">0x10171e25</span>,<span class="number">0x2c333a41</span>,<span class="number">0x484f565d</span>,<span class="number">0x646b7279</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private function:</span></span><br><span class="line"><span class="comment">* look up in SboxTable and get the related value.</span></span><br><span class="line"><span class="comment">* args:    [in] inch: 0x00~0xFF (8 bits unsigned value).</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">sm4Sbox</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> inch)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> *pTable = (<span class="type">unsigned</span> <span class="type">char</span> *)SboxTable;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> retVal = (<span class="type">unsigned</span> <span class="type">char</span>)(pTable[inch]);</span><br><span class="line">	<span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private F(Lt) function:</span></span><br><span class="line"><span class="comment">* &quot;T algorithm&quot; == &quot;L algorithm&quot; + &quot;t algorithm&quot;.</span></span><br><span class="line"><span class="comment">* args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment">* return: c: c is calculated with line algorithm &quot;L&quot; and nonline algorithm &quot;t&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4Lt</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> c = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">		b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">	GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">		c = bb ^ (ROTL(bb, <span class="number">2</span>)) ^ (ROTL(bb, <span class="number">10</span>)) ^ (ROTL(bb, <span class="number">18</span>)) ^ (ROTL(bb, <span class="number">24</span>));</span><br><span class="line">	<span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* private F function:</span></span><br><span class="line"><span class="comment">* Calculating and getting encryption/decryption contents.</span></span><br><span class="line"><span class="comment">* args:    [in] x0: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x1: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x2: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] x3: original contents;</span></span><br><span class="line"><span class="comment">* args:    [in] rk: encryption/decryption key;</span></span><br><span class="line"><span class="comment">* return the contents of encryption/decryption contents.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4F</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> x0, <span class="type">unsigned</span> <span class="type">long</span> x1, <span class="type">unsigned</span> <span class="type">long</span> x2, <span class="type">unsigned</span> <span class="type">long</span> x3, <span class="type">unsigned</span> <span class="type">long</span> rk)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (x0^sm4Lt(x1^x2^x3^rk));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/* private function:</span></span><br><span class="line"><span class="comment">* Calculating round encryption key.</span></span><br><span class="line"><span class="comment">* args:    [in] a: a is a 32 bits unsigned value;</span></span><br><span class="line"><span class="comment">* return: sk[i]: i&#123;0,1,2,3,...31&#125;.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">sm4CalciRK</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> ka)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> bb = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> rk = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>];</span><br><span class="line">	PUT_ULONG_BE(ka, a, <span class="number">0</span>)</span><br><span class="line">		b[<span class="number">0</span>] = sm4Sbox(a[<span class="number">0</span>]);</span><br><span class="line">	b[<span class="number">1</span>] = sm4Sbox(a[<span class="number">1</span>]);</span><br><span class="line">	b[<span class="number">2</span>] = sm4Sbox(a[<span class="number">2</span>]);</span><br><span class="line">	b[<span class="number">3</span>] = sm4Sbox(a[<span class="number">3</span>]);</span><br><span class="line">	GET_ULONG_BE(bb, b, <span class="number">0</span>)</span><br><span class="line">		rk = bb ^ (ROTL(bb, <span class="number">13</span>)) ^ (ROTL(bb, <span class="number">23</span>));</span><br><span class="line">	<span class="keyword">return</span> rk;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sm4_setkey</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> SK[<span class="number">32</span>], <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> MK[<span class="number">4</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> k[<span class="number">36</span>];</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">0</span>], key, <span class="number">0</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">1</span>], key, <span class="number">4</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">2</span>], key, <span class="number">8</span>);</span><br><span class="line">	GET_ULONG_BE(MK[<span class="number">3</span>], key, <span class="number">12</span>);</span><br><span class="line">	k[<span class="number">0</span>] = MK[<span class="number">0</span>] ^ FK[<span class="number">0</span>];</span><br><span class="line">	k[<span class="number">1</span>] = MK[<span class="number">1</span>] ^ FK[<span class="number">1</span>];</span><br><span class="line">	k[<span class="number">2</span>] = MK[<span class="number">2</span>] ^ FK[<span class="number">2</span>];</span><br><span class="line">	k[<span class="number">3</span>] = MK[<span class="number">3</span>] ^ FK[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">for</span> (; i&lt;<span class="number">32</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		k[i + <span class="number">4</span>] = k[i] ^ (sm4CalciRK(k[i + <span class="number">1</span>] ^ k[i + <span class="number">2</span>] ^ k[i + <span class="number">3</span>] ^ CK[i]));</span><br><span class="line">		SK[i] = k[i + <span class="number">4</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 standard one round processing</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">sm4_one_round</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> sk[<span class="number">32</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> ulbuf[<span class="number">36</span>];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(ulbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(ulbuf));</span><br><span class="line">	GET_ULONG_BE(ulbuf[<span class="number">0</span>], input, <span class="number">0</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">1</span>], input, <span class="number">4</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">2</span>], input, <span class="number">8</span>)</span><br><span class="line">		GET_ULONG_BE(ulbuf[<span class="number">3</span>], input, <span class="number">12</span>)</span><br><span class="line">		<span class="keyword">while</span> (i&lt;<span class="number">32</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			ulbuf[i + <span class="number">4</span>] = sm4F(ulbuf[i], ulbuf[i + <span class="number">1</span>], ulbuf[i + <span class="number">2</span>], ulbuf[i + <span class="number">3</span>], sk[i]);</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">35</span>], output, <span class="number">0</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">34</span>], output, <span class="number">4</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">33</span>], output, <span class="number">8</span>);</span><br><span class="line">	PUT_ULONG_BE(ulbuf[<span class="number">32</span>], output, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 key schedule (128-bit, encryption)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_enc</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class="line">	sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4 key schedule (128-bit, decryption)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_setkey_dec</span><span class="params">(sm4_context *ctx, <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	ctx-&gt;mode = SM4_ENCRYPT;</span><br><span class="line">	sm4_setkey(ctx-&gt;sk, key);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		SWAP(ctx-&gt;sk[i], ctx-&gt;sk[<span class="number">31</span> - i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4-ECB block encryption/decryption</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_ecb</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line">		input += <span class="number">16</span>;</span><br><span class="line">		output += <span class="number">16</span>;</span><br><span class="line">		length -= <span class="number">16</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* SM4-CBC buffer encryption/decryption</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sm4_crypt_cbc</span><span class="params">(sm4_context *ctx,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> mode,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> length,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>],</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *input,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">char</span> *output)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> temp[<span class="number">16</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (mode == SM4_ENCRYPT)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">				output[i] = (<span class="type">unsigned</span> <span class="type">char</span>)(input[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">			sm4_one_round(ctx-&gt;sk, output, output);</span><br><span class="line">			<span class="built_in">memcpy</span>(iv, output, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">			input += <span class="number">16</span>;</span><br><span class="line">			output += <span class="number">16</span>;</span><br><span class="line">			length -= <span class="number">16</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="comment">/* SM4_DECRYPT */</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">while</span> (length &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">memcpy</span>(temp, input, <span class="number">16</span>);</span><br><span class="line">			sm4_one_round(ctx-&gt;sk, input, output);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++)</span><br><span class="line">				output[i] = (<span class="type">unsigned</span> <span class="type">char</span>)(output[i] ^ iv[i]);</span><br><span class="line"></span><br><span class="line">			<span class="built_in">memcpy</span>(iv, temp, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">			input += <span class="number">16</span>;</span><br><span class="line">			output += <span class="number">16</span>;</span><br><span class="line">			length -= <span class="number">16</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">16</span>] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">16</span>] = &#123; <span class="number">0xD4</span>, <span class="number">0xD9</span>, <span class="number">0x76</span>, <span class="number">0xED</span>, <span class="number">0x8C</span>, <span class="number">0xFD</span>, <span class="number">0x9E</span>, <span class="number">0x36</span>, <span class="number">0x75</span>, <span class="number">0xCF</span>, <span class="number">0x39</span>, <span class="number">0x20</span>, <span class="number">0x56</span>, <span class="number">0x3A</span>, <span class="number">0xE6</span>, <span class="number">0xBF</span> &#125;;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">16</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> iv[<span class="number">16</span>] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span> &#125;;</span><br><span class="line">	sm4_context ctx;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">long</span> i;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	//encrypt testing</span></span><br><span class="line"><span class="comment">	sm4_setkey_enc(&amp;ctx,key);</span></span><br><span class="line"><span class="comment">	sm4_crypt_ecb(&amp;ctx,1,16,input,output);</span></span><br><span class="line"><span class="comment">	for(i=0;i&lt;16;i++)</span></span><br><span class="line"><span class="comment">		printf(&quot;%02x &quot;, output[i]);</span></span><br><span class="line"><span class="comment">	printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//decrypt testing</span></span><br><span class="line">	sm4_setkey_dec(&amp;ctx, key);</span><br><span class="line">	sm4_crypt_cbc(&amp;ctx, <span class="number">0</span>, <span class="number">16</span>, iv, input, output);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;<span class="number">16</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02x\n&quot;</span>, output[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第三个函数就是个base64直接搞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#输出数组</span><br><span class="line">import base64</span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">diy_base = <span class="string">&#x27;abcdefghijklmnpoqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&#x27;</span></span><br><span class="line">s = <span class="string">&#x27;cpVVnW&#x27;</span></span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(len(s)-2):</span></span><br><span class="line"><span class="string">	ss += base[diy_base.find(s[i])]</span></span><br><span class="line"><span class="string">ss += &#x27;</span>==&#x27;</span><br><span class="line">a = base64.b64decode(ss)</span><br><span class="line">print(<span class="built_in">list</span>(<span class="built_in">map</span>(hex,a)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后再进行异或，转换两次小端序就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">v8 =  <span class="number">0x37efeb08</span></span><br><span class="line">v11 =  <span class="number">0x8275e5d1</span></span><br><span class="line">v12 = <span class="number">0xff540b2d</span></span><br><span class="line">v9 = <span class="number">0x09e948b0</span></span><br><span class="line">flag =[<span class="number">0</span>] * <span class="number">4</span></span><br><span class="line">flag[<span class="number">0</span>] = v9 ^ <span class="number">0x39DEB332</span></span><br><span class="line">flag[<span class="number">1</span>] = v9 ^ v11</span><br><span class="line">flag[<span class="number">2</span>] = v11 ^v12</span><br><span class="line">flag[<span class="number">3</span>] = v12 ^ v8</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(flag[<span class="number">3</span>]))</span><br></pre></td></tr></table></figure>

<h3 id="creakme4"><a href="#creakme4" class="headerlink" title="creakme4"></a>creakme4</h3><p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220707204945097.png" alt="image-20220707204945097"></p>
<p>还是直接看so文件</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200200022.png" alt="image-20220708200200022"></p>
<p>findcript直接找到是blowfish加密，之前做过这个加密：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200238598.png" alt="image-20220708200238598"></p>
<p>然后下面发现还有个加密</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200306368.png" alt="image-20220708200306368"></p>
<p>findcrypt并没有检测出，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_142B8</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// w23</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// w3</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// w4</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// w5</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// w6</span></span><br><span class="line">  <span class="type">void</span> *v11; <span class="comment">// x7</span></span><br><span class="line">  __int64 v12; <span class="comment">// x21</span></span><br><span class="line">  __int64 v13; <span class="comment">// x0</span></span><br><span class="line">  __int64 v14; <span class="comment">// x19</span></span><br><span class="line">  __int64 v16; <span class="comment">// [xsp+0h] [xbp-E0h] BYREF</span></span><br><span class="line">  __int64 v17[<span class="number">2</span>]; <span class="comment">// [xsp+8h] [xbp-D8h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [xsp+18h] [xbp-C8h]</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">8</span>]; <span class="comment">// [xsp+20h] [xbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v20[<span class="number">96</span>]; <span class="comment">// [xsp+28h] [xbp-B8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v21[<span class="number">8</span>]; <span class="comment">// [xsp+88h] [xbp-58h] BYREF</span></span><br><span class="line">  _QWORD v22[<span class="number">2</span>]; <span class="comment">// [xsp+90h] [xbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">1945572552</span>;</span><br><span class="line">  v22[<span class="number">1</span>] = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  v17[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  ptr = <span class="number">0LL</span>;</span><br><span class="line">  v17[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="built_in">strlen</span>(a5);</span><br><span class="line">  sub_14FE0((<span class="type">int</span>)v17, (<span class="type">int</span>)a5, v6, v7, v8, v9, v10, v11);</span><br><span class="line">  v12 = (*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="number">1352LL</span>))(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  sub_13FC8(v12, v21);</span><br><span class="line">  v16 = <span class="number">0xE7CDAB8967452301</span>LL;</span><br><span class="line">  sub_1054C(&amp;v16, v20, <span class="number">0LL</span>);</span><br><span class="line">  sub_10C84(v22, v19, v20);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v19[<span class="number">0</span>] == <span class="number">228</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">1</span>] == <span class="number">234</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">2</span>] == <span class="number">196</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">3</span>] == <span class="number">129</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">4</span>] == <span class="number">185</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">5</span>] == <span class="number">254</span></span><br><span class="line">    &amp;&amp; v19[<span class="number">6</span>] == <span class="number">38</span></span><br><span class="line">    &amp;&amp; (<span class="type">unsigned</span> __int8)v19[<span class="number">7</span>] == <span class="number">188</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v13 = (*(__int64 (__fastcall **)(__int64, <span class="type">void</span> *))(*(_QWORD *)a1 + <span class="number">1336LL</span>))(a1, &amp;unk_3C090);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    (*(<span class="type">void</span> (__fastcall **)(__int64, __int64, __int64))(*(_QWORD *)a1 + <span class="number">1360LL</span>))(a1, a3, v12);</span><br><span class="line">    v13 = (*(__int64 (__fastcall **)(__int64, <span class="type">void</span> *))(*(_QWORD *)a1 + <span class="number">1336LL</span>))(a1, &amp;unk_3C050);</span><br><span class="line">  &#125;</span><br><span class="line">  v14 = v13;</span><br><span class="line">  <span class="keyword">while</span> ( v5 != <span class="number">847613141</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (v17[<span class="number">0</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      v5 = <span class="number">847613141</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">-519487832</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">-519487832</span> )</span><br><span class="line">      <span class="keyword">return</span> v14;</span><br><span class="line">  &#125;</span><br><span class="line">  operator <span class="title function_">delete</span><span class="params">(ptr)</span>;</span><br><span class="line">  <span class="keyword">return</span> v14;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708200509986.png" alt="image-20220708200509986"></p>
<p>学了des加密后，发现这有8个s盒，应该是个des，并没有魔改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> Blowfish</span><br><span class="line">key = <span class="string">b&#x27;\x12\x34\x56\x78\x9a\xbc\xde\xff&#x27;</span></span><br><span class="line">enc_data = <span class="built_in">bytes</span>([<span class="number">0x92</span>, <span class="number">0xB1</span>, <span class="number">0xC0</span>, <span class="number">0x8D</span>, <span class="number">0x7D</span>, <span class="number">0x4D</span>, <span class="number">0x02</span>, <span class="number">0XB6</span>])</span><br><span class="line">cipher = Blowfish.new(key, Blowfish.MODE_ECB) </span><br><span class="line">dec = cipher.decrypt(enc_data) </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dec:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">key = <span class="built_in">bytes</span>([<span class="number">0x01</span>, <span class="number">0x23</span>, <span class="number">0x45</span>, <span class="number">0x67</span>, <span class="number">0x89</span>, <span class="number">0xab</span>, <span class="number">0xcd</span>, <span class="number">0xe7</span>])</span><br><span class="line">enc_data = <span class="built_in">bytes</span>([<span class="number">0xE4</span>, <span class="number">0XEA</span>, <span class="number">0XC4</span>, <span class="number">0X81</span>, <span class="number">0xB9</span>, <span class="number">0xFE</span>, <span class="number">0x26</span>, <span class="number">0xBC</span>])</span><br><span class="line">cipher = DES.new(key, DES.MODE_ECB)</span><br><span class="line">dec = cipher.decrypt(enc_data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dec:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h3 id="analgo"><a href="#analgo" class="headerlink" title="analgo"></a>analgo</h3><p>又是go语言，发现有一段brainfuck</p>
<p>直接在对比处下断点来查看输入后经过加密会怎么变化。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708092459410.png" alt="image-20220708092459410"></p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220708165947660.png" alt="image-20220708165947660"></p>
<p>在比较处patch一下</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入：<span class="number">111111111111111111111111111111111111111111</span></span><br><span class="line">输出：<span class="number">0</span><span class="built_in">F</span> <span class="number">5291</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br><span class="line">输入：<span class="number">211111111111111111111111111111111111111111</span></span><br><span class="line">输出：C2 <span class="number">5291</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br><span class="line">输入：<span class="number">112111111111111111111111111111111111111111</span></span><br><span class="line">输出：<span class="number">0</span><span class="built_in">F</span> <span class="number">7</span><span class="built_in">F</span> <span class="number">40</span>D4135695D8175A99DC1B5E9DE01F62A1E42366A5E8276AA9EC2B6EADB0EF3271B4F33675B8F70F</span><br></pre></td></tr></table></figure>

<p>很明显字节与字节之间并无明显关联，对程序进行单字节爆破处理，这是我第二次见这样的脚本，上次还是在hgame。。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">list</span>(<span class="string">&#x27;fl1111111111111111111111111111111111111111\n&#x27;</span>)<span class="comment">#确定前两个字符从而递归推出下面字符</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">0x2a</span>):</span><br><span class="line">    <span class="built_in">bin</span> = <span class="built_in">bytearray</span>(<span class="built_in">open</span>(<span class="string">&quot;analgo.exe&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()) </span><br><span class="line">    <span class="built_in">bin</span>[<span class="number">0xb3045</span>] = i </span><br><span class="line">    <span class="built_in">open</span>(<span class="string">&quot;analgo.exe&quot;</span>,<span class="string">&quot;wb&quot;</span>).write(<span class="built_in">bin</span>)<span class="comment">#将之后的值写入文件</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string.printable:<span class="comment">#爆破</span></span><br><span class="line">        data[i] = j </span><br><span class="line">        pipe = subprocess.Popen(<span class="string">&quot;./analgo.exe&quot;</span>,bufsize=<span class="number">2</span>,stdout=subprocess.PIPE,stdin=subprocess.PIPE)<span class="comment">#创建管道</span></span><br><span class="line">        pipe.stdin.write(<span class="built_in">bytes</span>(<span class="string">&quot;&quot;</span>.join(data).encode(<span class="string">&quot;utf-8&quot;</span>))) <span class="comment">#将该字符写入文件进行验证</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;right!\n&#x27;</span> == pipe.stdout.read():<span class="comment">#如果子进程输出right</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(data))<span class="comment">#输出结果</span></span><br></pre></td></tr></table></figure>

<p>flag{568a3cdd-77e1-4c42-9fee-127e27a5744e}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">subprocess.run(args, *, stdin=<span class="literal">None</span>, <span class="built_in">input</span>=<span class="literal">None</span>, stdout=<span class="literal">None</span>, stderr=<span class="literal">None</span>, capture_output=<span class="literal">False</span>, shell=<span class="literal">False</span>, cwd=<span class="literal">None</span>, timeout=<span class="literal">None</span>, check=<span class="literal">False</span>, encoding=<span class="literal">None</span>, errors=<span class="literal">None</span>, text=<span class="literal">None</span>, env=<span class="literal">None</span>, universal_newlines=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">args：表示要执行的命令。必须是一个字符串，字符串参数列表。</span><br><span class="line">stdin、stdout 和 stderr：子进程的标准输入、输出和错误。其值可以是 subprocess.PIPE、subprocess.DEVNULL、一个已经存在的文件描述符、已经打开的文件对象或者 <span class="literal">None</span>。subprocess.PIPE 表示为子进程创建新的管道。subprocess.DEVNULL 表示使用 os.devnull。默认使用的是 <span class="literal">None</span>，表示什么都不做。另外，stderr 可以合并到 stdout 里一起输出。</span><br><span class="line">timeout：设置命令超时时间。如果命令执行时间超时，子进程将被杀死，并弹出 TimeoutExpired 异常。</span><br><span class="line">check：如果该参数设置为 <span class="literal">True</span>，并且进程退出状态码不是 <span class="number">0</span>，则弹 出 CalledProcessError 异常。</span><br><span class="line">encoding: 如果指定了该参数，则 stdin、stdout 和 stderr 可以接收字符串数据，并以该编码方式编码。否则只接收 <span class="built_in">bytes</span> 类型的数据。</span><br><span class="line">shell：如果该参数为 <span class="literal">True</span>，将通过操作系统的 shell 执行指定的命令</span><br></pre></td></tr></table></figure>

<h3 id="rota"><a href="#rota" class="headerlink" title="rota"></a>rota</h3><p>这题还是比较简单的</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220711181535411.png" alt="image-20220711181535411"></p>
<p>显然base64换表加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v13 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>i64; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;unk_7FF75F6B6040 + i) = (*((_BYTE *)&amp;unk_7FF75F6B6040 + i) + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  si128 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF75F6B4340);</span><br><span class="line">  v15 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF75F6B4350);</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  v17 = _mm_cvtsi32_si128(<span class="number">6u</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v18 = _mm_add_epi32(_mm_cvtepu8_epi32(*(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6040 + v16)), si128);</span><br><span class="line">    v19 = _mm_and_si128(</span><br><span class="line">            _mm_shuffle_epi32(</span><br><span class="line">              _mm_shufflehi_epi16(</span><br><span class="line">                _mm_shufflelo_epi16(</span><br><span class="line">                  _mm_sub_epi32(</span><br><span class="line">                    v18,</span><br><span class="line">                    _mm_sll_epi32(</span><br><span class="line">                      _mm_sra_epi32(_mm_add_epi32(_mm_and_si128(_mm_cmpgt_epi32((__m128i)<span class="number">0</span>i64, v18), v15), v18), v17),</span><br><span class="line">                      v17)),</span><br><span class="line">                  <span class="number">216</span>),</span><br><span class="line">                <span class="number">216</span>),</span><br><span class="line">              <span class="number">216</span>),</span><br><span class="line">            (__m128i)xmmword_7FF75F6B4360);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6040 + v16) = _mm_cvtsi128_si32(_mm_packus_epi16(v19, v19));</span><br><span class="line">    v20 = _mm_add_epi32(_mm_cvtepu8_epi32(*(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6044 + v16)), si128);</span><br><span class="line">    v21 = _mm_and_si128(</span><br><span class="line">            _mm_shuffle_epi32(</span><br><span class="line">              _mm_shufflehi_epi16(</span><br><span class="line">                _mm_shufflelo_epi16(</span><br><span class="line">                  _mm_sub_epi32(</span><br><span class="line">                    v20,</span><br><span class="line">                    _mm_sll_epi32(</span><br><span class="line">                      _mm_sra_epi32(_mm_add_epi32(_mm_and_si128(_mm_cmpgt_epi32((__m128i)<span class="number">0</span>i64, v20), v15), v20), v17),</span><br><span class="line">                      v17)),</span><br><span class="line">                  <span class="number">216</span>),</span><br><span class="line">                <span class="number">216</span>),</span><br><span class="line">              <span class="number">216</span>),</span><br><span class="line">            (__m128i)xmmword_7FF75F6B4360);</span><br><span class="line">    *(_DWORD *)((<span class="type">char</span> *)&amp;unk_7FF75F6B6044 + v16) = _mm_cvtsi128_si32(_mm_packus_epi16(v21, v21));</span><br><span class="line">    v16 += <span class="number">8</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v16 &lt; <span class="number">64</span> );</span><br><span class="line">&#125;</span><br><span class="line">sub_7FF75F6B10E0((__int64)v24);</span><br><span class="line">sub_7FF75F6B1E10(v24, (__int64)v32, (__int64)encode2);</span><br></pre></td></tr></table></figure>

<p>下面这其实都没啥，最主要的是sub_7FF75F6B1E10函数v32是传进来的base64加密函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __fastcall <span class="title function_">sub_7FF75F6B1E10</span><span class="params">(_BYTE *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// bl</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> result; <span class="comment">// al</span></span><br><span class="line">  __int64 v7; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v9; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// r8</span></span><br><span class="line">  __int64 v12; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// bl</span></span><br><span class="line">  __int64 v14; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// r8</span></span><br><span class="line">  __int64 v17; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v18; <span class="comment">// bl</span></span><br><span class="line">  __int64 v19; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v21; <span class="comment">// r8</span></span><br><span class="line">  __int64 v22; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v23; <span class="comment">// bl</span></span><br><span class="line">  __int64 v24; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v25; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v26; <span class="comment">// r8</span></span><br><span class="line">  __int64 v27; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v28; <span class="comment">// bl</span></span><br><span class="line">  __int64 v29; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v30; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v31; <span class="comment">// r8</span></span><br><span class="line">  __int64 v32; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v33; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  v3 = a1[<span class="number">192</span>];</span><br><span class="line">  v4 = (_BYTE *)(a3 + <span class="number">1</span>);</span><br><span class="line">  v5 = a1[<span class="number">193</span>];</span><br><span class="line">  result = a1[<span class="number">194</span>];</span><br><span class="line">  v7 = a2 - a3;</span><br><span class="line">  v9 = <span class="number">9</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 - <span class="number">1</span>] != aXiizduaoglak6j[v10] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v10 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v10) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v11 = v5;</span><br><span class="line">    v12 = (v5 + a1[(v3 + (_BYTE)v10) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v13 = (v3 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v14 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v12 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v13;</span><br><span class="line">    *(v4 - <span class="number">1</span>) = aXiizduaoglak6j[v14];</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v11 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7] != aXiizduaoglak6j[v15] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v15 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v15) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v16 = v5;</span><br><span class="line">    v17 = (v5 + a1[(v13 + (_BYTE)v15) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v18 = (v13 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v19 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v17 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v18;</span><br><span class="line">    *v4 = aXiizduaoglak6j[v19];</span><br><span class="line">    <span class="keyword">if</span> ( !v18 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v16 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v20 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">1</span>] != aXiizduaoglak6j[v20] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v20 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v20) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v21 = v5;</span><br><span class="line">    v22 = (v5 + a1[(v18 + (_BYTE)v20) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v23 = (v18 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v24 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v22 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v23;</span><br><span class="line">    v4[<span class="number">1</span>] = aXiizduaoglak6j[v24];</span><br><span class="line">    <span class="keyword">if</span> ( !v23 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v21 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v25 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">2</span>] != aXiizduaoglak6j[v25] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v25 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v25) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v26 = v5;</span><br><span class="line">    v27 = (v5 + a1[(v23 + (_BYTE)v25) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v28 = (v23 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v29 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v27 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v28;</span><br><span class="line">    v4[<span class="number">2</span>] = aXiizduaoglak6j[v29];</span><br><span class="line">    <span class="keyword">if</span> ( !v28 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v26 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)v4[v7 + <span class="number">3</span>] != aXiizduaoglak6j[v30] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v30 &gt;= <span class="number">64</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v30) = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v31 = v5;</span><br><span class="line">    v32 = (v5 + a1[(v28 + (_BYTE)v30) &amp; <span class="number">0x3F</span>]) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v3 = (v28 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">    v33 = (<span class="type">unsigned</span> __int8)a1[((result + a1[v32 + <span class="number">64</span>]) &amp; <span class="number">0x3F</span>) + <span class="number">128</span>];</span><br><span class="line">    a1[<span class="number">192</span>] = v3;</span><br><span class="line">    v4[<span class="number">3</span>] = aXiizduaoglak6j[v33];</span><br><span class="line">    <span class="keyword">if</span> ( !v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (v5 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">      a1[<span class="number">193</span>] = v5;</span><br><span class="line">      <span class="keyword">if</span> ( ((v31 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>) == <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = (result + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        a1[<span class="number">194</span>] = result;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v4 += <span class="number">5</span>;</span><br><span class="line">    --v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v9 );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5个地方结构相似，发现其实只用看懂一个就行，原数据在v4，我们可以直接爆破，然后直接对比就行，其实不难。每个结构其实是对一个字符进行的加密，那么每一次do while就是加密5个，但我们可以直接单个爆破。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">cmp = <span class="string">&quot;ksPhS/34MXifj+Ibtjud2Tikj5HkA7iTpbaNELBebOaIm&quot;</span></span><br><span class="line">base_change = <span class="string">&quot;XiIzDuAoGlaK6JcjM3g/9YQmHBOsxn1hLZ4w7Tt0PV5pNqUFC+rE2dSfyvWe8kRb&quot;</span></span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">a1 = [<span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x2C</span>, <span class="number">0x36</span>, <span class="number">0x1D</span>, <span class="number">0x12</span>, <span class="number">0x1E</span>, <span class="number">0x0C</span>, <span class="number">0x1A</span>, <span class="number">0x3C</span>, <span class="number">0x29</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x14</span>, <span class="number">0x3D</span>, <span class="number">0x3B</span>, <span class="number">0x19</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x1F</span>, <span class="number">0x30</span>, <span class="number">0x05</span>, <span class="number">0x38</span>, <span class="number">0x03</span>, <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x17</span>, <span class="number">0x21</span>, <span class="number">0x2E</span>, <span class="number">0x04</span>, <span class="number">0x18</span>, <span class="number">0x23</span>, <span class="number">0x2B</span>, <span class="number">0x02</span>, <span class="number">0x27</span>, <span class="number">0x37</span>, <span class="number">0x1C</span>, <span class="number">0x24</span>, <span class="number">0x39</span>, <span class="number">0x3F</span>, <span class="number">0x35</span>, <span class="number">0x2D</span>, <span class="number">0x26</span>, <span class="number">0x13</span>, <span class="number">0x2A</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x3E</span>, <span class="number">0x01</span>, <span class="number">0x28</span>, <span class="number">0x2F</span>, <span class="number">0x32</span>, <span class="number">0x22</span>, <span class="number">0x0D</span>, <span class="number">0x06</span>, <span class="number">0x25</span>, <span class="number">0x3A</span>, <span class="number">0x09</span>, <span class="number">0x0F</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x15</span>, <span class="number">0x31</span>, <span class="number">0x0C</span>, <span class="number">0x2C</span>, <span class="number">0x0D</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x09</span>, <span class="number">0x02</span>, <span class="number">0x39</span>, <span class="number">0x31</span>, <span class="number">0x17</span>, <span class="number">0x1A</span>, <span class="number">0x33</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x10</span>, <span class="number">0x04</span>, <span class="number">0x1B</span>, <span class="number">0x0B</span>, <span class="number">0x34</span>, <span class="number">0x12</span>, <span class="number">0x38</span>, <span class="number">0x27</span>, <span class="number">0x0E</span>, <span class="number">0x20</span>, <span class="number">0x2B</span>, <span class="number">0x2E</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x3E</span>, <span class="number">0x3A</span>, <span class="number">0x05</span>, <span class="number">0x1E</span>, <span class="number">0x36</span>, <span class="number">0x08</span>, <span class="number">0x32</span>, <span class="number">0x29</span>, <span class="number">0x19</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3F</span>, <span class="number">0x37</span>, <span class="number">0x30</span>, <span class="number">0x18</span>, <span class="number">0x16</span>, <span class="number">0x35</span>, <span class="number">0x25</span>, <span class="number">0x0A</span>, <span class="number">0x2D</span>, <span class="number">0x28</span>, <span class="number">0x26</span>, <span class="number">0x15</span>, <span class="number">0x11</span>, <span class="number">0x07</span>, <span class="number">0x1D</span>, <span class="number">0x2A</span>, <span class="number">0x0F</span>, <span class="number">0x1F</span>, <span class="number">0x14</span>, <span class="number">0x01</span>, <span class="number">0x1C</span>, <span class="number">0x03</span>, <span class="number">0x2F</span>, <span class="number">0x13</span>, <span class="number">0x0D</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x07</span>, <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x23</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x25</span>, <span class="number">0x2B</span>, <span class="number">0x21</span>, <span class="number">0x33</span>, <span class="number">0x18</span>, <span class="number">0x27</span>, <span class="number">0x29</span>, <span class="number">0x02</span>, <span class="number">0x2F</span>, <span class="number">0x28</span>, <span class="number">0x30</span>, <span class="number">0x0E</span>, <span class="number">0x19</span>, <span class="number">0x3C</span>, <span class="number">0x08</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x3D</span>, <span class="number">0x2E</span>, <span class="number">0x05</span>, <span class="number">0x15</span>, <span class="number">0x2C</span>, <span class="number">0x1C</span>, <span class="number">0x36</span>, <span class="number">0x22</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x38</span>, <span class="number">0x0A</span>, <span class="number">0x3F</span>, <span class="number">0x1A</span>, <span class="number">0x04</span>, <span class="number">0x26</span>, <span class="number">0x16</span>, <span class="number">0x2A</span>, <span class="number">0x3A</span>, <span class="number">0x1F</span>, <span class="number">0x2D</span>, <span class="number">0x32</span>, <span class="number">0x06</span>, <span class="number">0x37</span>, <span class="number">0x03</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x17</span>, <span class="number">0x1D</span>, <span class="number">0x12</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x3E</span>, <span class="number">0x39</span>, <span class="number">0x0F</span>, <span class="number">0x14</span>]</span><br><span class="line">flag1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">45</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> base_change:</span><br><span class="line">        x = base_change.find(j)</span><br><span class="line">        v17 = a1[(i + x) &amp; <span class="number">0x3f</span>] &amp; <span class="number">0x3f</span></span><br><span class="line">        v14 = a1[(a1[v17 + <span class="number">64</span>] ) + <span class="number">128</span>]</span><br><span class="line">        <span class="keyword">if</span> base_change[v14] == cmp[i]:</span><br><span class="line">            flag1 += j</span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag1)-<span class="number">1</span>):</span><br><span class="line">    flag += base[base_change.find(flag1[i])]</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(flag))</span><br></pre></td></tr></table></figure>

<h3 id="gocode"><a href="#gocode" class="headerlink" title="gocode"></a>gocode</h3><p>这个题字节码逆向，还是go的，不过这个go比之前做的友善多了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">main_main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v0; <span class="comment">// rdi</span></span><br><span class="line">  __int64 count; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 opcode; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// rsi</span></span><br><span class="line">  _QWORD *v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v12; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v14; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v16; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v17; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v18; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v19; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v20; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v22; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v23; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v24; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v25; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v26; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v27; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v28; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v29; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">void</span> **v30; <span class="comment">// [rsp+0h] [rbp-CD0h]</span></span><br><span class="line">  __int64 v31; <span class="comment">// [rsp+8h] [rbp-CC8h]</span></span><br><span class="line">  _QWORD *v32; <span class="comment">// [rsp+20h] [rbp-CB0h]</span></span><br><span class="line">  __int128 v33; <span class="comment">// [rsp+28h] [rbp-CA8h]</span></span><br><span class="line">  __int64 v34; <span class="comment">// [rsp+38h] [rbp-C98h]</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp+40h] [rbp-C90h]</span></span><br><span class="line">  _QWORD *v36; <span class="comment">// [rsp+50h] [rbp-C80h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v37; <span class="comment">// [rsp+58h] [rbp-C78h]</span></span><br><span class="line">  __int64 v38; <span class="comment">// [rsp+68h] [rbp-C68h]</span></span><br><span class="line">  __int64 v39; <span class="comment">// [rsp+70h] [rbp-C60h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v40; <span class="comment">// [rsp+78h] [rbp-C58h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v41; <span class="comment">// [rsp+80h] [rbp-C50h] BYREF</span></span><br><span class="line">  __int128 v42[<span class="number">2</span>]; <span class="comment">// [rsp+88h] [rbp-C48h] BYREF</span></span><br><span class="line">  __int64 v43[<span class="number">374</span>]; <span class="comment">// [rsp+A8h] [rbp-C28h] BYREF</span></span><br><span class="line">  __int64 v44; <span class="comment">// [rsp+C58h] [rbp-78h] BYREF</span></span><br><span class="line">  __int64 v45; <span class="comment">// [rsp+C60h] [rbp-70h]</span></span><br><span class="line">  _QWORD v46[<span class="number">2</span>]; <span class="comment">// [rsp+C68h] [rbp-68h] BYREF</span></span><br><span class="line">  _QWORD v47[<span class="number">2</span>]; <span class="comment">// [rsp+C78h] [rbp-58h] BYREF</span></span><br><span class="line">  _QWORD v48[<span class="number">2</span>]; <span class="comment">// [rsp+C88h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v49[<span class="number">2</span>]; <span class="comment">// [rsp+C98h] [rbp-38h] BYREF</span></span><br><span class="line">  _QWORD v50[<span class="number">2</span>]; <span class="comment">// [rsp+CA8h] [rbp-28h] BYREF</span></span><br><span class="line">  _QWORD v51[<span class="number">2</span>]; <span class="comment">// [rsp+CB8h] [rbp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;v41 &lt;= *(_QWORD *)(*(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  qmemcpy(v43, <span class="string">&quot;\n&quot;</span>, <span class="keyword">sizeof</span>(v43));</span><br><span class="line">  v0 = (<span class="type">unsigned</span> __int64)&amp;v44;</span><br><span class="line">  <span class="built_in">memset</span>(v42, <span class="number">0</span>, <span class="keyword">sizeof</span>(v42));</span><br><span class="line">  count = <span class="number">0LL</span>;</span><br><span class="line">  v2 = <span class="number">0LL</span>;</span><br><span class="line">  v3 = <span class="number">0LL</span>;</span><br><span class="line">  v4 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)count &gt;= <span class="number">0x176</span> )</span><br><span class="line">      runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">    v37 = v2;</span><br><span class="line">    v44 = v3;</span><br><span class="line">    v38 = count;</span><br><span class="line">    opcode = v43[count];</span><br><span class="line">    <span class="keyword">if</span> ( opcode &lt;= <span class="number">0xC</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( opcode &gt; <span class="number">0xE</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">switch</span> ( opcode )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xF</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v22 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v22 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v23 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v23 &gt;= <span class="number">4</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_97;</span><br><span class="line">          v24 = *((_QWORD *)v42 + v23);</span><br><span class="line">          <span class="keyword">if</span> ( !v24 )</span><br><span class="line">          &#123;</span><br><span class="line">            v31 = runtime_panicdivide(v30);</span><br><span class="line">LABEL_97:</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          &#125;</span><br><span class="line">          v0 = v3;</span><br><span class="line">          *((_QWORD *)v42 + v22) /= v24;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xAA</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v25 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v25 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v26 = *((_QWORD *)v42 + v25);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v27 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v27 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v0 = *((_QWORD *)v42 + v27);</span><br><span class="line">          <span class="keyword">if</span> ( v0 != v26 )</span><br><span class="line">          &#123;</span><br><span class="line">            v47[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">            v47[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">            fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v47, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">            v31 = os_Exit(<span class="number">0LL</span>);</span><br><span class="line">            count = v38;</span><br><span class="line">            v2 = v37;</span><br><span class="line">            v3 = v44;</span><br><span class="line">          &#125;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0xBB</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v28 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v28 &gt;= v2 )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v29 = *(_QWORD *)(v3 + <span class="number">8</span> * v28);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v0 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v0 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          *((_QWORD *)v42 + v0) = v29;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">13</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v18 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v18 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v19 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v19 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v18) - *((_QWORD *)v42 + v19);</span><br><span class="line">      *((_QWORD *)v42 + v18) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v20 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v20 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v21 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v21 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v21) * *((_QWORD *)v42 + v20);</span><br><span class="line">      *((_QWORD *)v42 + v20) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_12:</span><br><span class="line">    <span class="keyword">if</span> ( count &gt;= <span class="number">374</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v46[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">      v46[<span class="number">1</span>] = &amp;off_DA0B78;</span><br><span class="line">      fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v46, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( opcode &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v6 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v6 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v7 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v7) ^ *((_QWORD *)v42 + v6);</span><br><span class="line">      *((_QWORD *)v42 + v6) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v0 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v8 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      *((_QWORD *)v42 + v8) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( opcode != <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">11</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0LL</span>; ; i = v41 )</span><br><span class="line">      &#123;</span><br><span class="line">        v0 = qword_E23C38;</span><br><span class="line">        <span class="keyword">if</span> ( (__int64)i &gt;= qword_E23C38 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> ( i + <span class="number">2</span> &gt; qword_E23C38 )</span><br><span class="line">          runtime_panicSliceAlen((__int64)v30, v31);</span><br><span class="line">        <span class="keyword">if</span> ( i &gt; i + <span class="number">2</span> )</span><br><span class="line">          runtime_panicSliceB((__int64)v30, v31);</span><br><span class="line">        v41 = i + <span class="number">2</span>;</span><br><span class="line">        v45 = v3;</span><br><span class="line">        v40 = v4;</span><br><span class="line">        v39 = v2;</span><br><span class="line">        v34 = strconv_ParseUint(qword_E23C30 + i, <span class="number">2LL</span>, <span class="number">16LL</span>, <span class="number">32LL</span>, (__int64)v32, v33);</span><br><span class="line">        v10 = v32;</span><br><span class="line">        <span class="keyword">if</span> ( (_QWORD)v33 )</span><br><span class="line">        &#123;</span><br><span class="line">          v48[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">          v48[<span class="number">1</span>] = &amp;off_DA0B68;</span><br><span class="line">          fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v48, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v11 = v39;</span><br><span class="line">        v12 = v39 + <span class="number">1</span>;</span><br><span class="line">        v13 = v40;</span><br><span class="line">        <span class="keyword">if</span> ( v40 &lt; v39 + <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v36 = v32;</span><br><span class="line">          runtime_growslice((__int64)<span class="string">&quot;\b&quot;</span>, v45, v39, v40, v39 + <span class="number">1</span>, <span class="number">0LL</span>, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">          v14 = v33;</span><br><span class="line">          v13 = v34;</span><br><span class="line">          v12 = *((_QWORD *)&amp;v33 + <span class="number">1</span>) + <span class="number">1LL</span>;</span><br><span class="line">          v10 = v36;</span><br><span class="line">          v11 = v39;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v14 = v45;</span><br><span class="line">        &#125;</span><br><span class="line">        *(_QWORD *)(v14 + <span class="number">8</span> * v11) = v10;</span><br><span class="line">        count = v38;</span><br><span class="line">        v4 = v13;</span><br><span class="line">        v3 = v14;</span><br><span class="line">        v2 = v12;</span><br><span class="line">      &#125;</span><br><span class="line">      ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v15 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v15 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v16 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v16 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v16) + *((_QWORD *)v42 + v15);</span><br><span class="line">      *((_QWORD *)v42 + v15) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  v51[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">  v51[<span class="number">1</span>] = &amp;off_DA0B48;</span><br><span class="line">  v35 = fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v51, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">  v50[<span class="number">0</span>] = <span class="string">&quot;\b&quot;</span>;</span><br><span class="line">  v50[<span class="number">1</span>] = &amp;qword_E23C30;</span><br><span class="line">  v30 = &amp;off_DA21F8;</span><br><span class="line">  v31 = qword_E23420;</span><br><span class="line">  v32 = v50;</span><br><span class="line">  *(_QWORD *)&amp;v33 = <span class="number">1LL</span>;</span><br><span class="line">  *((_QWORD *)&amp;v33 + <span class="number">1</span>) = <span class="number">1LL</span>;</span><br><span class="line">  fmt_Fscanf(v0, (__int64)v50, <span class="string">&quot;%37s&quot;</span>, &amp;qword_E23C30);</span><br><span class="line">  <span class="keyword">if</span> ( v35 )</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> ( qword_E23C38 == <span class="number">37</span> &amp;&amp; *(_DWORD *)qword_E23C30 == <span class="string">&#x27;&#123;LCP&#x27;</span> &amp;&amp; *(_BYTE *)(qword_E23C30 + <span class="number">36</span>) == <span class="number">125</span> )<span class="comment">// 检测长度和PCL&#123;&#125;</span></span><br><span class="line">  &#123;</span><br><span class="line">    qword_E23C38 = <span class="number">32LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( dword_E66C60 )</span><br><span class="line">    &#123;</span><br><span class="line">      v0 = (<span class="type">unsigned</span> __int64)&amp;qword_E23C30;</span><br><span class="line">      runtime_gcWriteBarrierBX(&amp;qword_E23C30, v50, v17);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      qword_E23C30 += <span class="number">4LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    count = v38 + <span class="number">1</span>;</span><br><span class="line">    v2 = v37;</span><br><span class="line">    v3 = v44;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  &#125;</span><br><span class="line">  v49[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">  v49[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">  fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v49, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, v34);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令集都在v43里，我们可以dump出来的，发现也就是几种指令，三个一组。前两个0xa和0xb是为了验证输入格式是否正确</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x03</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x11B</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x7901</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x1FF6</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x21E</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x3331</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x06</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x68</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x152</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x33</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0E</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x441</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x6B</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x10E</span>, <span class="number">0xAA</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x9E</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x0B</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x36CE</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x03</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x682D</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x15</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x1AE</span>, <span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x3709</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0xBB</span>, <span class="number">0x01</span>, <span class="number">0x0D</span>, <span class="number">0xBB</span>, <span class="number">0x02</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x68</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0xFA</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x1E</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x0E</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x18C</span>, <span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x63</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x6B</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x83</span>, <span class="number">0xAA</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x01</span>, <span class="number">0x47</span>, <span class="number">0xBB</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0xAA</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xF</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v22 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v22 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v23 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v23 &gt;= <span class="number">4</span> )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_97;</span><br><span class="line">          v24 = *((_QWORD *)v42 + v23);</span><br><span class="line">          <span class="keyword">if</span> ( !v24 )</span><br><span class="line">          &#123;</span><br><span class="line">            v31 = runtime_panicdivide(v30);</span><br><span class="line">LABEL_97:</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          &#125;</span><br><span class="line">          v0 = v3;</span><br><span class="line">          *((_QWORD *)v42 + v22) /= v24;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xf，那么后两位操作数进行一个相除</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xAA</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v25 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v25 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v26 = *((_QWORD *)v42 + v25);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v27 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v27 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v0 = *((_QWORD *)v42 + v27);</span><br><span class="line">          <span class="keyword">if</span> ( v0 != v26 )</span><br><span class="line">          &#123;</span><br><span class="line">            v47[<span class="number">0</span>] = &amp;unk_D62740;</span><br><span class="line">            v47[<span class="number">1</span>] = &amp;off_DA0B58;</span><br><span class="line">            fmt_Fprintln((__int64)&amp;off_DA2218, qword_E23428, (__int64)v47, <span class="number">1LL</span>, <span class="number">1LL</span>, v33, *((__int64 *)&amp;v33 + <span class="number">1</span>), v34);</span><br><span class="line">            v31 = os_Exit(<span class="number">0LL</span>);</span><br><span class="line">            count = v38;</span><br><span class="line">            v2 = v37;</span><br><span class="line">            v3 = v44;</span><br><span class="line">          &#125;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xAA，就退出程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="number">0xBB</span>uLL:</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v28 = v43[count + <span class="number">2</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v28 &gt;= v2 )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          v29 = *(_QWORD *)(v3 + <span class="number">8</span> * v28);</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">            runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">          v0 = v43[count + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v0 &gt;= <span class="number">4</span> )</span><br><span class="line">            runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">          *((_QWORD *)v42 + v0) = v29;</span><br><span class="line">          count += <span class="number">3LL</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 0xbb，是一个赋值reg[0] &#x3D; input[0]</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">13</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v18 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v18 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v19 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v19 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v18) - *((_QWORD *)v42 + v19);</span><br><span class="line">      *((_QWORD *)v42 + v18) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>opcode &#x3D;&#x3D; 13，是一个减法，第一个操作数减去第二个操作数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( opcode &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( opcode == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v6 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v6 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v7 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      v0 = *((_QWORD *)v42 + v7) ^ *((_QWORD *)v42 + v6);</span><br><span class="line">      *((_QWORD *)v42 + v6) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 1，那么是个异或</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( opcode == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">2</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v0 = v43[count + <span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(count + <span class="number">1</span>) &gt;= <span class="number">0x176</span> )</span><br><span class="line">        runtime_panicIndex((__int64)v30, v31);</span><br><span class="line">      v8 = v43[count + <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt;= <span class="number">4</span> )</span><br><span class="line">        runtime_panicIndexU((__int64)v30, v31);</span><br><span class="line">      *((_QWORD *)v42 + v8) = v0;</span><br><span class="line">      count += <span class="number">3LL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果opcode &#x3D;&#x3D; 2，是个赋值等于第二个操作数</p>
<p>用脚本恢复一下，发现可以用z3解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">283</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">30977</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8182</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">542</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">13105</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">104</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">338</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">51</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1089</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">107</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">270</span>, <span class="number">170</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">158</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">14030</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">26669</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">430</span>, <span class="number">170</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">14089</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">187</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">187</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">104</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">250</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">30</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">396</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">99</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">107</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">131</span>, <span class="number">170</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">71</span>, <span class="number">187</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">170</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(opcode), <span class="number">3</span>):</span><br><span class="line">     op = opcode[i]</span><br><span class="line">     num1 = opcode[i + <span class="number">1</span>]</span><br><span class="line">     num2 = opcode[i + <span class="number">2</span>]</span><br><span class="line">     <span class="keyword">if</span> op == <span class="number">0xbb</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] = input[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xaa</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;if buf[<span class="subst">&#123;num1&#125;</span>] != buf[<span class="subst">&#123;num2&#125;</span>] goto exit&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xf</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] /= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xd</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] -= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xe</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] *= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0x1</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] ^= buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0x2</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] = <span class="subst">&#123;num2&#125;</span>&quot;</span>)</span><br><span class="line">     <span class="keyword">elif</span> op == <span class="number">0xc</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">f&quot;buf[<span class="subst">&#123;num1&#125;</span>] += buf[<span class="subst">&#123;num2&#125;</span>]&quot;</span>)</span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;gg&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">283</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">30977</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">8182</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">542</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[0]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">13105</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[4]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[5]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[6]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">104</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">338</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">51</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">1089</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">107</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">270</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[2]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">158</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[7]</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[11]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">14030</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="selector-tag">input</span><span class="selector-attr">[11]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="number">26669</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[2]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">21</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[10]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[0]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">430</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[1]</span> != buf<span class="selector-attr">[0]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[9]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[8]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> -= buf<span class="selector-attr">[1]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[2]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">14089</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[12]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="selector-tag">input</span><span class="selector-attr">[13]</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> = <span class="selector-tag">input</span><span class="selector-attr">[14]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">104</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">250</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[3]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">30</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> -= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> *= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="number">396</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">99</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> ^= buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[3]</span> = <span class="number">107</span></span><br><span class="line">buf<span class="selector-attr">[2]</span> += buf<span class="selector-attr">[3]</span></span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">131</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[2]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br><span class="line">buf<span class="selector-attr">[1]</span> = <span class="number">71</span></span><br><span class="line">buf<span class="selector-attr">[0]</span> = <span class="selector-tag">input</span><span class="selector-attr">[15]</span></span><br><span class="line"><span class="keyword">if</span> buf<span class="selector-attr">[0]</span> != buf<span class="selector-attr">[1]</span> goto exit</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">flag = [BitVec(<span class="string">&quot;x%d&quot;</span> % i ,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)]</span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">s.add(flag[<span class="number">1</span>] + flag[<span class="number">2</span>] == <span class="number">283</span>)</span><br><span class="line">s.add((((flag[<span class="number">0</span>] + flag[<span class="number">1</span>]) * flag[<span class="number">2</span>]) - flag[<span class="number">3</span>]) == <span class="number">30977</span>)</span><br><span class="line">s.add((flag[<span class="number">0</span>] * (flag[<span class="number">2</span>] ^ <span class="number">99</span>)) - flag[<span class="number">1</span>] + flag[<span class="number">3</span>] == <span class="number">8182</span>)</span><br><span class="line">s.add((flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + flag[<span class="number">2</span>] + flag[<span class="number">3</span>]) == <span class="number">542</span>)</span><br><span class="line">s.add(((flag[<span class="number">0</span>] * flag[<span class="number">3</span>]) - flag[<span class="number">1</span>] + flag[<span class="number">2</span>]) == <span class="number">13105</span>)</span><br><span class="line"></span><br><span class="line">s.add((flag[<span class="number">4</span>] + <span class="number">99</span>) ^ <span class="number">104</span> == <span class="number">338</span>)</span><br><span class="line">s.add((flag[<span class="number">5</span>] - <span class="number">51</span>) * <span class="number">99</span> == <span class="number">1089</span>)</span><br><span class="line">s.add((flag[<span class="number">6</span>] ^ <span class="number">99</span>) + <span class="number">107</span> == <span class="number">270</span>)</span><br><span class="line">s.add(flag[<span class="number">7</span>] == <span class="number">158</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * flag[<span class="number">11</span>] == <span class="number">14030</span>)</span><br><span class="line">s.add((flag[<span class="number">8</span>] + flag[<span class="number">9</span>]) * flag[<span class="number">10</span>] - flag[<span class="number">11</span>] == <span class="number">26669</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * (flag[<span class="number">10</span>] ^ <span class="number">99</span>) - flag[<span class="number">9</span>] + flag[<span class="number">11</span>] == <span class="number">21</span>)</span><br><span class="line">s.add((flag[<span class="number">8</span>] + flag[<span class="number">9</span>] + flag[<span class="number">10</span>] + flag[<span class="number">11</span>]) == <span class="number">430</span>)</span><br><span class="line">s.add(flag[<span class="number">8</span>] * flag[<span class="number">11</span>] - flag[<span class="number">9</span>] + flag[<span class="number">10</span>] == <span class="number">14089</span>)</span><br><span class="line">s.add((flag[<span class="number">12</span>] + <span class="number">99</span>) ^ <span class="number">104</span> == <span class="number">250</span>)</span><br><span class="line">s.add((flag[<span class="number">13</span>] - <span class="number">30</span>) * <span class="number">99</span> == <span class="number">396</span>)</span><br><span class="line">s.add((flag[<span class="number">14</span>] ^ <span class="number">99</span>) + <span class="number">107</span> == <span class="number">131</span>)</span><br><span class="line">s.add(flag[<span class="number">15</span>] == <span class="number">71</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;unsat&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到的结果取0xff然后拼接就对了</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">x</span><span class="number">12</span> <span class="operator">=</span> <span class="number">47</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">9</span> <span class="operator">=</span> <span class="number">40</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">4</span> <span class="operator">=</span> <span class="number">215</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">6</span> <span class="operator">=</span> <span class="number">192</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">8</span> <span class="operator">=</span> <span class="number">230</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">2</span> <span class="operator">=</span> <span class="number">32847</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">1</span> <span class="operator">=</span> <span class="number">32972</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">10</span> <span class="operator">=</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">11</span> <span class="operator">=</span> <span class="number">61</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">0</span> <span class="operator">=</span> <span class="number">189</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">3</span> <span class="operator">=</span> <span class="number">70</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">15</span> <span class="operator">=</span> <span class="number">71</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">13</span> <span class="operator">=</span> <span class="number">34</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">7</span> <span class="operator">=</span> <span class="number">158</span><span class="punctuation">,</span></span><br><span class="line"> <span class="keyword">x</span><span class="number">5</span> <span class="operator">=</span> <span class="number">62</span>]</span><br></pre></td></tr></table></figure>

<p>PCL{bdcc4f46d73ec09ee628633d2f227b47}</p>
<h2 id="dsctf"><a href="#dsctf" class="headerlink" title="dsctf"></a>dsctf</h2><h3 id="catchme"><a href="#catchme" class="headerlink" title="catchme"></a>catchme</h3><p>这题太折磨了，其实逻辑巨简单，就是一个aes和base64，，但其中的密文和密钥全部要先进行异或。当时看密文感觉不对，就想着动调，但里面反调试太多了，现在看着其实交叉引用就能定位到，只是简单的xor。</p>
<p>jadx看到关键函数是check函数，直接在so文件搜索不到，应该是JNI <em>OnLoad里使用RegisterNatives注册check sub</em> B2A4</p>
<p>jni里，本来以为 sub_AEC8是关键函数，但后面那个aes数据解密出来是：Congratulations,but tryagain?</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114127868.png" alt="image-20220718114127868"></p>
<p>通过交叉引用发现，key和对比数据都进行了异或</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220718114211385.png" alt="image-20220718114211385"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">key = <span class="string">&quot;\x24&lt;=76!5&amp;?72*rrrrS&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(key[i]) ^ <span class="number">0x53</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">data = <span class="string">&quot;&quot;</span></span><br><span class="line">data_encode = [<span class="number">0x4F</span>, <span class="number">0x1C</span>, <span class="number">0x36</span>, <span class="number">0x49</span>, <span class="number">0x09</span>, <span class="number">0x3A</span>, <span class="number">0x3F</span>, <span class="number">0x07</span>, <span class="number">0x4D</span>, <span class="number">0x3D</span>, <span class="number">0x22</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x0A</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0x06</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0x20</span>, <span class="number">0x4A</span>, <span class="number">0x1B</span>, <span class="number">0x51</span>, <span class="number">0x51</span>, <span class="number">0x6C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_encode)):</span><br><span class="line">    data += <span class="built_in">chr</span>(data_encode[i] ^ <span class="number">0x6c</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">base = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">diy_base = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()+/&quot;</span></span><br><span class="line">s = <span class="string">&quot;&quot;&quot;#pZ%eVSk!QNUlfNIjemL&amp;w==&quot;&quot;&quot;</span></span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">2</span>):</span><br><span class="line">    ss += base[diy_base.find(s[i])]</span><br><span class="line">ss += <span class="string">&quot;==&quot;</span></span><br><span class="line">a = base64.b64decode(ss)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">hex</span>, a)))</span><br><span class="line">x = [<span class="number">0</span>] * <span class="built_in">len</span>(flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    x[i] = <span class="built_in">hex</span>(<span class="built_in">ord</span>(flag[i]))</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure>

<p>之后aes解密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">	AES_CYPHER_128,</span><br><span class="line">	AES_CYPHER_192,</span><br><span class="line">	AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Encryption Rounds</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span> <span class="number">128</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span> <span class="number">192</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span> <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">10</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">12</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nk[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">6</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nb[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes Rcon:</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* WARNING: Rcon is designed starting from 1 to 15, not 0 to 14.</span></span><br><span class="line"><span class="comment">*          FIPS-197 Page 9: &quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* i    |   0     1     2     3     4     5     6     7     8     9    10    11    12    13    14</span></span><br><span class="line"><span class="comment">* -----+------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*      | [01]  [02]  [04]  [08]  [10]  [20]  [40]  [80]  [1b]  [36]  [6c]  [d8]  [ab]  [4d]  [9a]</span></span><br><span class="line"><span class="comment">* RCON | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> g_aes_rcon[] = &#123;</span><br><span class="line">	<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes sbox and invert-sbox</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_sub_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_rot_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = val;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_swap_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* nr: number of rounds</span></span><br><span class="line"><span class="comment">* nb: number of columns comprising the state, nb = 4 dwords (16 bytes)</span></span><br><span class="line"><span class="comment">* nk: number of 32-bit words comprising cipher key, nk = 4, 6, 8 (KeyLength/(4*8))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_expansion</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *round)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span>  t;</span><br><span class="line">	<span class="type">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		w[i] = *((<span class="type">uint32_t</span> *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">			t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">			t = aes_sub_dword(t);</span><br><span class="line">			t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">			t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			t = w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_add_round_key</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *round, <span class="type">int</span> nr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span> *s = (<span class="type">uint32_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtime</span><span class="params">(<span class="type">uint8_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtimes</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">int</span> ts)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		x = aes_xtime(x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_mul</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">uint8_t</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* encrypt: y has only 2 bits: can be 1, 2 or 3</span></span><br><span class="line"><span class="comment">	* decrypt: y could be any value of 9, b, d, or e</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_encrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = v[j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">inv_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">		<span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_decrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> p = s[j] ^ v[j];</span><br><span class="line">			v[j] = data[i + j];</span><br><span class="line">			data[i + j] = p;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_128_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">		<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">		<span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_192_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_256_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">		<span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="comment">//数据</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0xda</span>, <span class="number">0x96</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x54</span>, <span class="number">0xa4</span>, <span class="number">0xd1</span>, <span class="number">0x3</span>, <span class="number">0x54</span>, <span class="number">0x95</span>, <span class="number">0xf3</span>, <span class="number">0x48</span>, <span class="number">0x8d</span>, <span class="number">0xe9</span>, <span class="number">0x8b</span>, <span class="number">0xeb</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//密钥</span></span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x77</span>, <span class="number">0x6f</span>, <span class="number">0x6e</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x66</span>, <span class="number">0x75</span>, <span class="number">0x6c</span>,<span class="number">0x64</span>, <span class="number">0x61</span>,<span class="number">0x79</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>&#125;;</span><br><span class="line">	<span class="comment">//向量</span></span><br><span class="line">	<span class="type">uint8_t</span> iv[] = &#123;<span class="number">0x3c</span>, <span class="number">0x3d</span>, <span class="number">0x37</span>, <span class="number">0x36</span>, <span class="number">0x21</span>, <span class="number">0x35</span>, <span class="number">0x26</span>, <span class="number">0x3f</span>, <span class="number">0x37</span>,<span class="number">0x32</span>, <span class="number">0x2a</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x53</span>&#125;;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">sizeof</span>(key))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//ECB</span></span><br><span class="line">    </span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">24</span>:aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">32</span>:aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="comment">//CBC</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	case 16:aes_decrypt_cbc(AES_CYPHER_128, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 24:aes_decrypt_cbc(AES_CYPHER_192, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 32:aes_decrypt_cbc(AES_CYPHER_256, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到：flag{weu&#x2F;.,iopl}</p>
<h3 id="FFunction"><a href="#FFunction" class="headerlink" title="FFunction"></a>FFunction</h3><p>这题搞得其实有点晕，好多信息要猜测，给了很多文件，我们找到关键my_plugin这个dll文件，在f函数中调试断点。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220719184430550.png" alt="image-20220719184430550"></p>
<p>发现tea加密，提取数据，又发现传进来的数据进行了疑似base64的加密，据说只能猜。而且flag长度也要猜。。。。。。我们提取密文，解密一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//加密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, i;           <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       <span class="comment">/* basic cycle start */</span></span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0x79B99E37</span> &lt;&lt; <span class="number">5</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x79B99E37</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> k[]=&#123;<span class="number">0x0BABEC0FE</span>,<span class="number">0x0DEADBEEF</span>,<span class="number">0x0FACEB00C</span>,<span class="number">0xDEADC0DE</span>&#125;,v[]=&#123;<span class="number">0x5C15754C</span>, <span class="number">0xD1D781E7</span>, <span class="number">0x501BF173</span>, <span class="number">0xCB4DB222</span>, <span class="number">0x215D61F5</span>, <span class="number">0x3FCA9EE7</span>, <span class="number">0x7C76B5C7</span>, <span class="number">0xC7DD8CB9</span>, <span class="number">0x990D23FA</span>, <span class="number">0x0BAB1AD3</span>, <span class="number">0x8E12C932</span>, <span class="number">0xD307BAF2</span>, <span class="number">0xE52DD123</span>, <span class="number">0xFBB68F2C</span>, <span class="number">0xBDD853E3</span>, <span class="number">0x892E1E4E</span>, <span class="number">0x39DD66FA</span>, <span class="number">0x87FEEC65</span>, <span class="number">0x307C5E60</span>, <span class="number">0x340C6C00</span>&#125;;</span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    decrypt(v+<span class="number">2</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">4</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">6</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">8</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">10</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">12</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">14</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">16</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">18</span>, k);</span><br><span class="line">    decrypt(v+<span class="number">20</span>, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">2</span>],v[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">4</span>],v[<span class="number">5</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">6</span>],v[<span class="number">7</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">8</span>],v[<span class="number">9</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">10</span>],v[<span class="number">11</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">12</span>],v[<span class="number">13</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">14</span>],v[<span class="number">15</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">16</span>],v[<span class="number">17</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">18</span>],v[<span class="number">19</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">20</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>decode小端序拼接一下，两两相加进行一个base64解密，然后再手动搞一下flag就对了，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a=<span class="string">&quot;30014006400460044007500230035008600c400a600e6003600c300930016004300340025004400d7007500250086002600f5006300050083007400e3000500a600840055007400970033001600e500a&quot;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">ccc=re.findall(<span class="string">&quot;.&#123;2&#125;&quot;</span>,a)</span><br><span class="line">ccc=[<span class="built_in">int</span>(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> ccc]</span><br><span class="line">fl=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(ccc),<span class="number">2</span>):</span><br><span class="line">    fl+=(<span class="built_in">chr</span>(ccc[index]+ccc[index+<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(fl[::-<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(fl[::-<span class="number">1</span>]).decode())</span><br><span class="line"><span class="comment">#Zn1sIWEhZ0N7X0VobXRwMTB3d19lcnJlX3RGdDF1</span></span><br><span class="line"><span class="comment">#f&#125;l!a!gC&#123;_Ehmtp10ww_erre_tFt1u</span></span><br></pre></td></tr></table></figure>

<p>手动一下：<strong>flag{Emp0wer_F1utter_w1th_C!!}</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/06/29/re1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/29/re1/" class="post-title-link" itemprop="url">re1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-29 23:27:38" itemprop="dateCreated datePublished" datetime="2022-06-29T23:27:38+08:00">2022-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-29 15:42:16" itemprop="dateModified" datetime="2022-07-29T15:42:16+08:00">2022-07-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h1><p>好久没整博客了，因为博客的文件被我不小心手欠删了，但一直有写，后面有时间就传上去！中间打了很多比赛，也被虐的很惨，稍微复现几道题。</p>
<h2 id="Destdog3的几道题"><a href="#Destdog3的几道题" class="headerlink" title="Destdog3的几道题"></a>Destdog3的几道题</h2><h3 id="1、go"><a href="#1、go" class="headerlink" title="1、go"></a>1、go</h3><p>这个题目就看出来是一个go语言的逆向，go语言的逆向首先看字符串是否恢复，如果没恢复就要用到某些插件了，其次找main_main这个函数，这个函数的入口如果直接能搜到，那就很好，没搜到也没关系，我们自己写个程序从start跟到main_main来看一看。</p>
<p>如果没有任何修改的话，我们进入程序直接f5是这个场面，一直跟进函数</p>
<p><img src="/2022/06/29/re1/image-20220629233706561.png"></p>
<p>跟到下图：<img src="/2022/06/29/re1/image-20220629233806232.png"></p>
<p>我们进入runtime_mainPC函数</p>
<p><img src="/2022/06/29/re1/image-20220629233838199.png"></p>
<p>在.rdata段,通过交叉引用找到.text段的，找到main_main入口</p>
<p><img src="/2022/06/29/re1/image-20220629233926322.png"></p>
<p>这个题也是这样，不过这个程序被处理了，代码并没有变成汇编，我们找到对应地方后，点c点p给他整成函数就行</p>
<p><img src="/2022/06/29/re1/image-20220629234339050.png"></p>
<p><img src="/2022/06/29/re1/image-20220629234427308.png" alt="image-20220629234427308"></p>
<p>我们用findcrypt很轻松的查出来有两个加密，第一个是tea，第二个是aes加密</p>
<p><img src="/2022/06/29/re1/image-20220629234631877.png"></p>
<p>看着看着发现这玩意不能动态调试，应该是有反调试，但静态也能猜出来，我们先看看tea加密</p>
<p><img src="/2022/06/29/re1/image-20220629234838667.png"></p>
<p><img src="/2022/06/29/re1/image-20220629235012930.png"></p>
<p>很显然v17为key，v16位data，直接写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"> </span><br><span class="line">//加密函数</span><br><span class="line">void encrypt (uint32_t* v, uint32_t* k) &#123;</span><br><span class="line">    uint32_t v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], <span class="built_in">sum</span>=<span class="number">0</span>, i;           /* <span class="built_in">set</span> up */</span><br><span class="line">    uint32_t delta=<span class="number">0x9e3779b9</span>;                     /* a key schedule constant */</span><br><span class="line">    uint32_t k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   /* cache key */</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;                       /* basic cycle start */</span><br><span class="line">        <span class="built_in">sum</span> += delta;</span><br><span class="line">        v0 += ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + <span class="built_in">sum</span>) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + <span class="built_in">sum</span>) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">    &#125;                                              /* end cycle */</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line">//解密函数</span><br><span class="line">void decrypt (uint32_t* v, uint32_t* k) &#123;</span><br><span class="line">    uint32_t v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], <span class="built_in">sum</span>=<span class="number">0xC6EF3720</span>, i;  /* <span class="built_in">set</span> up */</span><br><span class="line">    uint32_t delta=<span class="number">0x9e3779b9</span>;                     /* a key schedule constant */</span><br><span class="line">    uint32_t k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   /* cache key */</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         /* basic cycle start */</span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + <span class="built_in">sum</span>) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + <span class="built_in">sum</span>) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        <span class="built_in">sum</span> -= delta;</span><br><span class="line">    &#125;                                              /* end cycle */</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t v[<span class="number">2</span>]=&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,k[<span class="number">4</span>]=&#123;<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    // v为要加密的数据是两个<span class="number">32</span>位无符号整数</span><br><span class="line">    // k为加密解密密钥，为<span class="number">4</span>个<span class="number">32</span>位无符号整数，即密钥长度为<span class="number">128</span>位</span><br><span class="line">    printf(<span class="string">&quot;加密前原始数据：%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    encrypt(v, k);</span><br><span class="line">    printf(<span class="string">&quot;加密后的数据：%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    printf(<span class="string">&quot;解密后的数据：%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现hint是see_sbox。。。。。。那不就是aes吗。</p>
<p>找了个js脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = [</span><br><span class="line">    <span class="number">0x34</span>, <span class="number">0xC9</span>, <span class="number">0x05</span>, <span class="number">0xB3</span>, <span class="number">0x67</span>, <span class="number">0x81</span>, <span class="number">0xC8</span>, <span class="number">0xAD</span>, <span class="number">0x20</span>, <span class="number">0xC2</span>, <span class="number">0x2F</span>, <span class="number">0x07</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0x03</span>, <span class="number">0xD6</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0x2E</span>, <span class="number">0xBA</span>, <span class="number">0xF4</span>, <span class="number">0x7C</span>, <span class="number">0x71</span>, <span class="number">0x0B</span>, <span class="number">0xEC</span>,</span><br><span class="line">    <span class="number">0xC4</span>, <span class="number">0x81</span>, <span class="number">0x34</span>, <span class="number">0xDA</span>, <span class="number">0xDC</span>, <span class="number">0xE9</span>, <span class="number">0x7E</span>, <span class="number">0xEE</span>, <span class="number">0x05</span>, <span class="number">0xCF</span>, <span class="number">0x21</span>, <span class="number">0xC7</span>,</span><br><span class="line">    <span class="number">0xD9</span>, <span class="number">0x76</span>, <span class="number">0xE1</span>, <span class="number">0x76</span>, <span class="number">0x84</span>, <span class="number">0x82</span>, <span class="number">0xDE</span>, <span class="number">0xD9</span>, <span class="number">0xCB</span>, <span class="number">0x77</span>, <span class="number">0x5E</span>, <span class="number">0xA0</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> keyiv = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;12fe32ba87654321&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(keyiv)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deci = crypto.<span class="title function_">createDecipheriv</span>(<span class="string">&#x27;aes-128-cbc&#x27;</span>, keyiv, keyiv)</span><br><span class="line"><span class="keyword">let</span> dec = deci.<span class="title function_">update</span>(<span class="title class_">Buffer</span>.<span class="title function_">from</span>(data))</span><br><span class="line">dec += deci.<span class="title function_">final</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dec)</span><br></pre></td></tr></table></figure>

<p>还有c的脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">	AES_CYPHER_128,</span><br><span class="line">	AES_CYPHER_192,</span><br><span class="line">	AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Encryption Rounds</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span> <span class="number">128</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span> <span class="number">192</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span> <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">10</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">12</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nk[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">6</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nb[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes Rcon:</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* WARNING: Rcon is designed starting from 1 to 15, not 0 to 14.</span></span><br><span class="line"><span class="comment">*          FIPS-197 Page 9: &quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* i    |   0     1     2     3     4     5     6     7     8     9    10    11    12    13    14</span></span><br><span class="line"><span class="comment">* -----+------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*      | [01]  [02]  [04]  [08]  [10]  [20]  [40]  [80]  [1b]  [36]  [6c]  [d8]  [ab]  [4d]  [9a]</span></span><br><span class="line"><span class="comment">* RCON | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> g_aes_rcon[] = &#123;</span><br><span class="line">	<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes sbox and invert-sbox</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">	<span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">	<span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">	<span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">	<span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">	<span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">	<span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">	<span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">	<span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">	<span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">	<span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">	<span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">	<span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">	<span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">	<span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">	<span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">	<span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">	<span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">	<span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">	<span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">	<span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">	<span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">	<span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">	<span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">	<span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">	<span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">	<span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">	<span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_sub_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_rot_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = val;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_swap_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* nr: number of rounds</span></span><br><span class="line"><span class="comment">* nb: number of columns comprising the state, nb = 4 dwords (16 bytes)</span></span><br><span class="line"><span class="comment">* nk: number of 32-bit words comprising cipher key, nk = 4, 6, 8 (KeyLength/(4*8))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_expansion</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *round)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span>  t;</span><br><span class="line">	<span class="type">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		w[i] = *((<span class="type">uint32_t</span> *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">			t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">			t = aes_sub_dword(t);</span><br><span class="line">			t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">			t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			t = w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_add_round_key</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *round, <span class="type">int</span> nr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span> *s = (<span class="type">uint32_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtime</span><span class="params">(<span class="type">uint8_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtimes</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">int</span> ts)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		x = aes_xtime(x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_mul</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">uint8_t</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* encrypt: y has only 2 bits: can be 1, 2 or 3</span></span><br><span class="line"><span class="comment">	* decrypt: y could be any value of 9, b, d, or e</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_encrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = v[j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">inv_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">		<span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_decrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> p = s[j] ^ v[j];</span><br><span class="line">			v[j] = data[i + j];</span><br><span class="line">			data[i + j] = p;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_128_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">		<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">		<span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_192_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_256_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">		<span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//数据</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x34</span>, <span class="number">0xC9</span>, <span class="number">0x05</span>, <span class="number">0xB3</span>, <span class="number">0x67</span>, <span class="number">0x81</span>, <span class="number">0xC8</span>, <span class="number">0xAD</span>, <span class="number">0x20</span>, <span class="number">0xC2</span>, <span class="number">0x2F</span>, <span class="number">0x07</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0x03</span>, <span class="number">0xD6</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0x2E</span>, <span class="number">0xBA</span>, <span class="number">0xF4</span>, <span class="number">0x7C</span>, <span class="number">0x71</span>, <span class="number">0x0B</span>, <span class="number">0xEC</span>,</span><br><span class="line">    <span class="number">0xC4</span>, <span class="number">0x81</span>, <span class="number">0x34</span>, <span class="number">0xDA</span>, <span class="number">0xDC</span>, <span class="number">0xE9</span>, <span class="number">0x7E</span>, <span class="number">0xEE</span>, <span class="number">0x05</span>, <span class="number">0xCF</span>, <span class="number">0x21</span>, <span class="number">0xC7</span>,</span><br><span class="line">    <span class="number">0xD9</span>, <span class="number">0x76</span>, <span class="number">0xE1</span>, <span class="number">0x76</span>, <span class="number">0x84</span>, <span class="number">0x82</span>, <span class="number">0xDE</span>, <span class="number">0xD9</span>, <span class="number">0xCB</span>, <span class="number">0x77</span>, <span class="number">0x5E</span>, <span class="number">0xA0</span>&#125;;</span><br><span class="line">	<span class="comment">//密钥</span></span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">49</span>, <span class="number">50</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">55</span>, <span class="number">54</span>, <span class="number">53</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">49</span> &#125;;</span><br><span class="line">	<span class="comment">//向量</span></span><br><span class="line">	<span class="type">uint8_t</span> iv[] = &#123;<span class="number">49</span>, <span class="number">50</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">55</span>, <span class="number">54</span>, <span class="number">53</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">49</span>&#125;;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">sizeof</span>(key))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//ECB</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">	case 16:aes_decrypt(AES_CYPHER_128, buf, sizeof(buf), key); break;</span></span><br><span class="line"><span class="comment">	case 24:aes_decrypt(AES_CYPHER_192, buf, sizeof(buf), key); break;</span></span><br><span class="line"><span class="comment">	case 32:aes_decrypt(AES_CYPHER_256, buf, sizeof(buf), key); break;</span></span><br><span class="line"><span class="comment">	//CBC</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:aes_decrypt_cbc(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">24</span>:aes_decrypt_cbc(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">32</span>:aes_decrypt_cbc(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key, iv); <span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跑出来是一样的：Dest0g3{4a9ff880-ea23-5016-b1aa-2ee3bf985533}</p>
<p>一点都没魔改的aes。</p>
<h3 id="2、ttttea"><a href="#2、ttttea" class="headerlink" title="2、ttttea"></a>2、ttttea</h3><p>这题就是个魔改的xxtea，本来以为很简单，但跑出来的脚本总是不对，才发现有TLS回调函数，里面改了delta</p>
<p><img src="/2022/06/29/re1/image-20220630170408100.png"></p>
<p><img src="/2022/06/29/re1/image-20220630170420207.png"></p>
<p>发现key是delta，这个还魔改了一个右移6</p>
<p>我们直接到exports里看tls回调函数：</p>
<p><img src="/2022/06/29/re1/image-20220630170754591.png"></p>
<p><img src="/2022/06/29/re1/image-20220630170645456.png"></p>
<p>先改了delta，然后又异或了一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x74746561</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;6^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span> *v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>)            <span class="comment">/* Coding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=<span class="number">0</span>; p&lt;n<span class="number">-1</span>; p++)</span><br><span class="line">            &#123;</span><br><span class="line">                y = v[p+<span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n<span class="number">-1</span>] += MX;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>)      <span class="comment">/* Decoding Part */</span></span><br><span class="line">    &#123;</span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span>/n;</span><br><span class="line">        sum = rounds*DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p=n<span class="number">-1</span>; p&gt;<span class="number">0</span>; p--)</span><br><span class="line">            &#123;</span><br><span class="line">                z = v[p<span class="number">-1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n<span class="number">-1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[]= &#123;<span class="number">0x2F222303</span>, <span class="number">0x43FD8836</span>, <span class="number">0x655BE821</span>, <span class="number">0xA63B1E31</span>, <span class="number">0x88DCB84B</span>, <span class="number">0x6F841980</span>, <span class="number">0x26217297</span>, <span class="number">0xBBEE64AD</span>, <span class="number">0x064D0488</span>, <span class="number">0x6BE5262F</span>, <span class="number">0x73F54B81</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>]= &#123;<span class="number">0x61</span>,<span class="number">0x65</span>,<span class="number">0x74</span>,<span class="number">0x74</span>&#125;;</span><br><span class="line">    <span class="type">int</span> n= <span class="number">11</span>; <span class="comment">//n的绝对值表示v的长度，取正表示加密，取负表示解密</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;beforecode:%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//btea(v, n, k);</span></span><br><span class="line">    <span class="comment">//printf(&quot;encode:%x %x\n&quot;,v[0],v[1]);</span></span><br><span class="line">    btea(v, -n, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">2</span>],v[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">4</span>],v[<span class="number">5</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">6</span>],v[<span class="number">7</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x\n&quot;</span>,v[<span class="number">8</span>],v[<span class="number">9</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x&quot;</span>,v[<span class="number">10</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果小端序就对了。</p>
<h2 id="鹏城杯的re"><a href="#鹏城杯的re" class="headerlink" title="鹏城杯的re"></a>鹏城杯的re</h2><p>分最少的re反而是最难的，属实难崩</p>
<h3 id="maze"><a href="#maze" class="headerlink" title="maze"></a>maze</h3><p>其实这个题逻辑和迷宫都很清晰，就是一棵树，有链表连成的树，脚本比较难写，其他还好。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_40500A</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 end; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> input; <span class="comment">// [rsp+Fh] [rbp-29h] BYREF</span></span><br><span class="line">  __int64 start; <span class="comment">// [rsp+10h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  initmap();                                    <span class="comment">// 生成地图</span></span><br><span class="line">  end = *(_QWORD *)(*(_QWORD *)(*(_QWORD *)(qword_5D3680 + <span class="number">8</span>) + <span class="number">8LL</span>) + <span class="number">8LL</span>);<span class="comment">// 终点节点</span></span><br><span class="line">  start = *(_QWORD *)(*(_QWORD *)(*(_QWORD *)(*(_QWORD *)(qword_5D36A0 + <span class="number">8</span>) + <span class="number">8LL</span>) + <span class="number">8LL</span>) + <span class="number">8LL</span>);<span class="comment">// 最初节点</span></span><br><span class="line">  *(_BYTE *)(start + <span class="number">27</span>) = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">printf</span>(&amp;unk_5D45C0, <span class="string">&quot;Welcome to Hexagonal maze\nplz enter the foot print\n&quot;</span>);</span><br><span class="line">  input = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_46D9D0(&amp;unk_5D45C0, <span class="string">&quot;&gt; &quot;</span>, <span class="number">2LL</span>);</span><br><span class="line">    sub_452070(&amp;unk_5D46E0, &amp;input);</span><br><span class="line">    main_func(&amp;start, (<span class="type">unsigned</span> <span class="type">int</span>)input);<span class="comment">//对输入进行验证</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( start != end );</span><br><span class="line">  sub_46D9D0(&amp;unk_5D45C0, <span class="string">&quot;flag is md5 your input&quot;</span>, <span class="number">22LL</span>);</span><br><span class="line">  sub_46D7E0(&amp;unk_5D45C0);</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v4 )</span><br><span class="line">    sub_52CB40();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看main_func函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">sub_404BF5</span><span class="params">(_QWORD **a1, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  _QWORD *v2; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *v3; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *result; <span class="comment">// rax</span></span><br><span class="line">  _QWORD *v5; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;l&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)*a1 + <span class="number">24</span>) || (v3 = (_QWORD *)**a1) == <span class="number">0LL</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0LL</span>);</span><br><span class="line">      *a1 = v3;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)*a1 + <span class="number">25</span>) || (v5 = (_QWORD *)(*a1)[<span class="number">1</span>]) == <span class="number">0LL</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0LL</span>);</span><br><span class="line">      *a1 = v5;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)*a1 + <span class="number">26</span>) || (v2 = (_QWORD *)(*a1)[<span class="number">2</span>]) == <span class="number">0LL</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0LL</span>);</span><br><span class="line">      *a1 = v2;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0LL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = *a1;</span><br><span class="line">  <span class="keyword">if</span> ( *((_BYTE *)*a1 + <span class="number">27</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0LL</span>);</span><br><span class="line">  *((_BYTE *)result + <span class="number">27</span>) = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入就是从“l“，”r”，“t”中选的，如果输入是l，那么对这棵树进行判断，判断其标志位是否是0，是0可通过，是1不可通过</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220705152407696.png" alt="image-20220705152407696"></p>
<p>查看这个链表组成的结构体，偏移为0x0处是代表l，偏移为0x8代表r，偏移为0x10是代表t，偏移为0x18的数代表是否通行，偏移为0x28的是代表这个节点结束。每个节点的大小是相同的，那么只需要找到地图边界的起点和终点就行。然后idapython写个脚本提取一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">0x00000000019df8f0</span>,<span class="number">0x00000000019E0310</span>] </span><br><span class="line">maze = [] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x[<span class="number">0</span>],x[<span class="number">1</span>],<span class="number">8</span>*<span class="number">6</span>): </span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>): </span><br><span class="line">        maze.append(get_qword(i+k*<span class="number">8</span>)) </span><br><span class="line"><span class="built_in">print</span>(maze)</span><br></pre></td></tr></table></figure>

<p>整理成二维数组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">map_o = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27130192</span>, <span class="number">27130528</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130144</span>, <span class="number">27130240</span>, <span class="number">0</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130192</span>, <span class="number">27130288</span>, <span class="number">27130624</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130240</span>, <span class="number">27130336</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130288</span>, <span class="number">27130384</span>, <span class="number">27130720</span>, <span class="number">65537</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130336</span>, <span class="number">27130432</span>, <span class="number">0</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130384</span>, <span class="number">0</span>, <span class="number">27130816</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27130528</span>, <span class="number">27130960</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130480</span>, <span class="number">27130576</span>, <span class="number">27130144</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130528</span>, <span class="number">27130624</span>, <span class="number">27131056</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130576</span>, <span class="number">27130672</span>, <span class="number">27130240</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130624</span>, <span class="number">27130720</span>, <span class="number">27131152</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130672</span>, <span class="number">27130768</span>, <span class="number">27130336</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130720</span>, <span class="number">27130816</span>, <span class="number">27131248</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130768</span>, <span class="number">27130864</span>, <span class="number">27130432</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130816</span>, <span class="number">0</span>, <span class="number">27131344</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27130960</span>, <span class="number">27131440</span>, <span class="number">257</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130912</span>, <span class="number">27131008</span>, <span class="number">27130480</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27130960</span>, <span class="number">27131056</span>, <span class="number">27131536</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131008</span>, <span class="number">27131104</span>, <span class="number">27130576</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131056</span>, <span class="number">27131152</span>, <span class="number">27131632</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131104</span>, <span class="number">27131200</span>, <span class="number">27130672</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131152</span>, <span class="number">27131248</span>, <span class="number">27131728</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131200</span>, <span class="number">27131296</span>, <span class="number">27130768</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131248</span>, <span class="number">27131344</span>, <span class="number">27131824</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131296</span>, <span class="number">27131392</span>, <span class="number">27130864</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131344</span>, <span class="number">0</span>, <span class="number">27131920</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27131488</span>, <span class="number">27130912</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131440</span>, <span class="number">27131536</span>, <span class="number">27131968</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131488</span>, <span class="number">27131584</span>, <span class="number">27131008</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131536</span>, <span class="number">27131632</span>, <span class="number">27132064</span>, <span class="number">65792</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131584</span>, <span class="number">27131680</span>, <span class="number">27131104</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131632</span>, <span class="number">27131728</span>, <span class="number">27132160</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131680</span>, <span class="number">27131776</span>, <span class="number">27131200</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131728</span>, <span class="number">27131824</span>, <span class="number">27132256</span>, <span class="number">257</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131776</span>, <span class="number">27131872</span>, <span class="number">27131296</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131824</span>, <span class="number">27131920</span>, <span class="number">27132352</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131872</span>, <span class="number">0</span>, <span class="number">27131392</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27132016</span>, <span class="number">27131488</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27131968</span>, <span class="number">27132064</span>, <span class="number">27132400</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132016</span>, <span class="number">27132112</span>, <span class="number">27131584</span>, <span class="number">65537</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132064</span>, <span class="number">27132160</span>, <span class="number">27132496</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132112</span>, <span class="number">27132208</span>, <span class="number">27131680</span>, <span class="number">16777216</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132160</span>, <span class="number">27132256</span>, <span class="number">27132592</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132208</span>, <span class="number">27132304</span>, <span class="number">27131776</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132256</span>, <span class="number">27132352</span>, <span class="number">27132688</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132304</span>, <span class="number">0</span>, <span class="number">27131872</span>, <span class="number">256</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">27132448</span>, <span class="number">27132016</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132400</span>, <span class="number">27132496</span>, <span class="number">0</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132448</span>, <span class="number">27132544</span>, <span class="number">27132112</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132496</span>, <span class="number">27132592</span>, <span class="number">0</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132544</span>, <span class="number">27132640</span>, <span class="number">27132208</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">49</span>, <span class="number">27132592</span>, <span class="number">27132688</span>, <span class="number">0</span>, <span class="number">65536</span>, <span class="number">0</span>, <span class="number">49</span>]</span><br><span class="line"><span class="built_in">map</span> = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">54</span>)]</span><br><span class="line">cout = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(map_o),<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">        <span class="built_in">map</span>[cout][k] = map_o[i+k-<span class="number">1</span>]</span><br><span class="line">    cout += <span class="number">1</span></span><br><span class="line"><span class="comment">#print(map)</span></span><br><span class="line">cout = <span class="number">0</span></span><br><span class="line">ea = [<span class="number">0x00000000019df8f0</span>,<span class="number">0x00000000019E0310</span>] </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ea[<span class="number">0</span>],ea[<span class="number">1</span>],<span class="number">6</span>*<span class="number">8</span>):</span><br><span class="line">    <span class="built_in">map</span>[cout][<span class="number">0</span>] = i</span><br><span class="line">    cout += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">map</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">54</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">map</span>[i][k]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">&#123;<span class="number">0x19df8f0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,  </span><br><span class="line">&#123;<span class="number">0x19df920</span>, <span class="number">0x0</span>, <span class="number">0x19df950</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df950</span>, <span class="number">0x19df920</span>, <span class="number">0x19df980</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df980</span>, <span class="number">0x19df950</span>, <span class="number">0x19df9b0</span>, <span class="number">0x19dfb00</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df9b0</span>, <span class="number">0x19df980</span>, <span class="number">0x19df9e0</span>, <span class="number">0x0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df9e0</span>, <span class="number">0x19df9b0</span>, <span class="number">0x19dfa10</span>, <span class="number">0x19dfb60</span>, <span class="number">0x10001</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa10</span>, <span class="number">0x19df9e0</span>, <span class="number">0x19dfa40</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa40</span>, <span class="number">0x19dfa10</span>, <span class="number">0x0</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa70</span>, <span class="number">0x0</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x19dfc50</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfaa0</span>, <span class="number">0x19dfa70</span>, <span class="number">0x19dfad0</span>, <span class="number">0x19df920</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfad0</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x19dfb00</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb00</span>, <span class="number">0x19dfad0</span>, <span class="number">0x19dfb30</span>, <span class="number">0x19df980</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb30</span>, <span class="number">0x19dfb00</span>, <span class="number">0x19dfb60</span>, <span class="number">0x19dfd10</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb60</span>, <span class="number">0x19dfb30</span>, <span class="number">0x19dfb90</span>, <span class="number">0x19df9e0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb90</span>, <span class="number">0x19dfb60</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x19dfd70</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfbc0</span>, <span class="number">0x19dfb90</span>, <span class="number">0x19dfbf0</span>, <span class="number">0x19dfa40</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfbf0</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x0</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc20</span>, <span class="number">0x0</span>, <span class="number">0x19dfc50</span>, <span class="number">0x19dfe30</span>, <span class="number">0x101</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc50</span>, <span class="number">0x19dfc20</span>, <span class="number">0x19dfc80</span>, <span class="number">0x19dfa70</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc80</span>, <span class="number">0x19dfc50</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x19dfe90</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfcb0</span>, <span class="number">0x19dfc80</span>, <span class="number">0x19dfce0</span>, <span class="number">0x19dfad0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfce0</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x19dfd10</span>, <span class="number">0x19dfef0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd10</span>, <span class="number">0x19dfce0</span>, <span class="number">0x19dfd40</span>, <span class="number">0x19dfb30</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd40</span>, <span class="number">0x19dfd10</span>, <span class="number">0x19dfd70</span>, <span class="number">0x19dff50</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd70</span>, <span class="number">0x19dfd40</span>, <span class="number">0x19dfda0</span>, <span class="number">0x19dfb90</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfda0</span>, <span class="number">0x19dfd70</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x19dffb0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfdd0</span>, <span class="number">0x19dfda0</span>, <span class="number">0x19dfe00</span>, <span class="number">0x19dfbf0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe00</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x0</span>, <span class="number">0x19e0010</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe30</span>, <span class="number">0x0</span>, <span class="number">0x19dfe60</span>, <span class="number">0x19dfc20</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe60</span>, <span class="number">0x19dfe30</span>, <span class="number">0x19dfe90</span>, <span class="number">0x19e0040</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe90</span>, <span class="number">0x19dfe60</span>, <span class="number">0x19dfec0</span>, <span class="number">0x19dfc80</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfec0</span>, <span class="number">0x19dfe90</span>, <span class="number">0x19dfef0</span>, <span class="number">0x19e00a0</span>, <span class="number">0x10100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfef0</span>, <span class="number">0x19dfec0</span>, <span class="number">0x19dff20</span>, <span class="number">0x19dfce0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff20</span>, <span class="number">0x19dfef0</span>, <span class="number">0x19dff50</span>, <span class="number">0x19e0100</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff50</span>, <span class="number">0x19dff20</span>, <span class="number">0x19dff80</span>, <span class="number">0x19dfd40</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff80</span>, <span class="number">0x19dff50</span>, <span class="number">0x19dffb0</span>, <span class="number">0x19e0160</span>, <span class="number">0x101</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dffb0</span>, <span class="number">0x19dff80</span>, <span class="number">0x19dffe0</span>, <span class="number">0x19dfda0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dffe0</span>, <span class="number">0x19dffb0</span>, <span class="number">0x19e0010</span>, <span class="number">0x19e01c0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,  </span><br><span class="line">&#123;<span class="number">0x19e0010</span>, <span class="number">0x19dffe0</span>, <span class="number">0x0</span>, <span class="number">0x19dfe00</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0040</span>, <span class="number">0x0</span>, <span class="number">0x19e0070</span>, <span class="number">0x19dfe60</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0070</span>, <span class="number">0x19e0040</span>, <span class="number">0x19e00a0</span>, <span class="number">0x19e01f0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e00a0</span>, <span class="number">0x19e0070</span>, <span class="number">0x19e00d0</span>, <span class="number">0x19dfec0</span>, <span class="number">0x10001</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e00d0</span>, <span class="number">0x19e00a0</span>, <span class="number">0x19e0100</span>, <span class="number">0x19e0250</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0100</span>, <span class="number">0x19e00d0</span>, <span class="number">0x19e0130</span>, <span class="number">0x19dff20</span>, <span class="number">0x1000000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0130</span>, <span class="number">0x19e0100</span>, <span class="number">0x19e0160</span>, <span class="number">0x19e02b0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0160</span>, <span class="number">0x19e0130</span>, <span class="number">0x19e0190</span>, <span class="number">0x19dff80</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0190</span>, <span class="number">0x19e0160</span>, <span class="number">0x19e01c0</span>, <span class="number">0x19e0310</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e01c0</span>, <span class="number">0x19e0190</span>, <span class="number">0x0</span>, <span class="number">0x19dffe0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e01f0</span>, <span class="number">0x0</span>, <span class="number">0x19e0220</span>, <span class="number">0x19e0070</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0220</span>, <span class="number">0x19e01f0</span>, <span class="number">0x19e0250</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0250</span>, <span class="number">0x19e0220</span>, <span class="number">0x19e0280</span>, <span class="number">0x19e00d0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0280</span>, <span class="number">0x19e0250</span>, <span class="number">0x19e02b0</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e02b0</span>, <span class="number">0x19e0280</span>, <span class="number">0x19e02e0</span>, <span class="number">0x19e0130</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e02e0</span>, <span class="number">0x19e02b0</span>, <span class="number">0x19e0310</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br></pre></td></tr></table></figure>

<p>这个二维数组被解释为第一位是节点，第二三四位是l，r，t。第5位是判断位，先给出c++写的脚本：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;String&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N=<span class="number">100005</span>;</span><br><span class="line"><span class="type">long</span> <span class="type">long</span> a[<span class="number">1000</span>][<span class="number">10</span>]=&#123;</span><br><span class="line">&#123;<span class="number">0x19df8f0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,  </span><br><span class="line">&#123;<span class="number">0x19df920</span>, <span class="number">0x0</span>, <span class="number">0x19df950</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df950</span>, <span class="number">0x19df920</span>, <span class="number">0x19df980</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df980</span>, <span class="number">0x19df950</span>, <span class="number">0x19df9b0</span>, <span class="number">0x19dfb00</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df9b0</span>, <span class="number">0x19df980</span>, <span class="number">0x19df9e0</span>, <span class="number">0x0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19df9e0</span>, <span class="number">0x19df9b0</span>, <span class="number">0x19dfa10</span>, <span class="number">0x19dfb60</span>, <span class="number">0x10001</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa10</span>, <span class="number">0x19df9e0</span>, <span class="number">0x19dfa40</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa40</span>, <span class="number">0x19dfa10</span>, <span class="number">0x0</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfa70</span>, <span class="number">0x0</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x19dfc50</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfaa0</span>, <span class="number">0x19dfa70</span>, <span class="number">0x19dfad0</span>, <span class="number">0x19df920</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfad0</span>, <span class="number">0x19dfaa0</span>, <span class="number">0x19dfb00</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb00</span>, <span class="number">0x19dfad0</span>, <span class="number">0x19dfb30</span>, <span class="number">0x19df980</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb30</span>, <span class="number">0x19dfb00</span>, <span class="number">0x19dfb60</span>, <span class="number">0x19dfd10</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb60</span>, <span class="number">0x19dfb30</span>, <span class="number">0x19dfb90</span>, <span class="number">0x19df9e0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfb90</span>, <span class="number">0x19dfb60</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x19dfd70</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfbc0</span>, <span class="number">0x19dfb90</span>, <span class="number">0x19dfbf0</span>, <span class="number">0x19dfa40</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfbf0</span>, <span class="number">0x19dfbc0</span>, <span class="number">0x0</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc20</span>, <span class="number">0x0</span>, <span class="number">0x19dfc50</span>, <span class="number">0x19dfe30</span>, <span class="number">0x101</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc50</span>, <span class="number">0x19dfc20</span>, <span class="number">0x19dfc80</span>, <span class="number">0x19dfa70</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfc80</span>, <span class="number">0x19dfc50</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x19dfe90</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfcb0</span>, <span class="number">0x19dfc80</span>, <span class="number">0x19dfce0</span>, <span class="number">0x19dfad0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfce0</span>, <span class="number">0x19dfcb0</span>, <span class="number">0x19dfd10</span>, <span class="number">0x19dfef0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd10</span>, <span class="number">0x19dfce0</span>, <span class="number">0x19dfd40</span>, <span class="number">0x19dfb30</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd40</span>, <span class="number">0x19dfd10</span>, <span class="number">0x19dfd70</span>, <span class="number">0x19dff50</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfd70</span>, <span class="number">0x19dfd40</span>, <span class="number">0x19dfda0</span>, <span class="number">0x19dfb90</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfda0</span>, <span class="number">0x19dfd70</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x19dffb0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfdd0</span>, <span class="number">0x19dfda0</span>, <span class="number">0x19dfe00</span>, <span class="number">0x19dfbf0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe00</span>, <span class="number">0x19dfdd0</span>, <span class="number">0x0</span>, <span class="number">0x19e0010</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe30</span>, <span class="number">0x0</span>, <span class="number">0x19dfe60</span>, <span class="number">0x19dfc20</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe60</span>, <span class="number">0x19dfe30</span>, <span class="number">0x19dfe90</span>, <span class="number">0x19e0040</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfe90</span>, <span class="number">0x19dfe60</span>, <span class="number">0x19dfec0</span>, <span class="number">0x19dfc80</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfec0</span>, <span class="number">0x19dfe90</span>, <span class="number">0x19dfef0</span>, <span class="number">0x19e00a0</span>, <span class="number">0x10100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dfef0</span>, <span class="number">0x19dfec0</span>, <span class="number">0x19dff20</span>, <span class="number">0x19dfce0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff20</span>, <span class="number">0x19dfef0</span>, <span class="number">0x19dff50</span>, <span class="number">0x19e0100</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff50</span>, <span class="number">0x19dff20</span>, <span class="number">0x19dff80</span>, <span class="number">0x19dfd40</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dff80</span>, <span class="number">0x19dff50</span>, <span class="number">0x19dffb0</span>, <span class="number">0x19e0160</span>, <span class="number">0x101</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dffb0</span>, <span class="number">0x19dff80</span>, <span class="number">0x19dffe0</span>, <span class="number">0x19dfda0</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19dffe0</span>, <span class="number">0x19dffb0</span>, <span class="number">0x19e0010</span>, <span class="number">0x19e01c0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,  </span><br><span class="line">&#123;<span class="number">0x19e0010</span>, <span class="number">0x19dffe0</span>, <span class="number">0x0</span>, <span class="number">0x19dfe00</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0040</span>, <span class="number">0x0</span>, <span class="number">0x19e0070</span>, <span class="number">0x19dfe60</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0070</span>, <span class="number">0x19e0040</span>, <span class="number">0x19e00a0</span>, <span class="number">0x19e01f0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e00a0</span>, <span class="number">0x19e0070</span>, <span class="number">0x19e00d0</span>, <span class="number">0x19dfec0</span>, <span class="number">0x10001</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e00d0</span>, <span class="number">0x19e00a0</span>, <span class="number">0x19e0100</span>, <span class="number">0x19e0250</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0100</span>, <span class="number">0x19e00d0</span>, <span class="number">0x19e0130</span>, <span class="number">0x19dff20</span>, <span class="number">0x1000000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0130</span>, <span class="number">0x19e0100</span>, <span class="number">0x19e0160</span>, <span class="number">0x19e02b0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0160</span>, <span class="number">0x19e0130</span>, <span class="number">0x19e0190</span>, <span class="number">0x19dff80</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0190</span>, <span class="number">0x19e0160</span>, <span class="number">0x19e01c0</span>, <span class="number">0x19e0310</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e01c0</span>, <span class="number">0x19e0190</span>, <span class="number">0x0</span>, <span class="number">0x19dffe0</span>, <span class="number">0x100</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e01f0</span>, <span class="number">0x0</span>, <span class="number">0x19e0220</span>, <span class="number">0x19e0070</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0220</span>, <span class="number">0x19e01f0</span>, <span class="number">0x19e0250</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0250</span>, <span class="number">0x19e0220</span>, <span class="number">0x19e0280</span>, <span class="number">0x19e00d0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e0280</span>, <span class="number">0x19e0250</span>, <span class="number">0x19e02b0</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e02b0</span>, <span class="number">0x19e0280</span>, <span class="number">0x19e02e0</span>, <span class="number">0x19e0130</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;,</span><br><span class="line">&#123;<span class="number">0x19e02e0</span>, <span class="number">0x19e02b0</span>, <span class="number">0x19e0310</span>, <span class="number">0x0</span>, <span class="number">0x10000</span>, <span class="number">0x0</span>, <span class="number">0x31</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n=<span class="number">54</span>,h[N],cnt,tot,st,ed,pr[N];</span><br><span class="line"><span class="type">bool</span> v[N];</span><br><span class="line">map&lt;<span class="type">long</span> <span class="type">long</span>,<span class="type">int</span>&gt;mp;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">qwe</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> ne,to;</span><br><span class="line">	string va;</span><br><span class="line">&#125;e[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> u,<span class="type">int</span> v,string w)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//cout&lt;&lt;u&lt;&lt;&quot; &quot;&lt;&lt;v&lt;&lt;&quot; &quot;&lt;&lt;w&lt;&lt;endl;</span></span><br><span class="line">	cnt++;</span><br><span class="line">	e[cnt].ne=h[u];</span><br><span class="line">	e[cnt].to=v;</span><br><span class="line">	e[cnt].va=w;</span><br><span class="line">	h[u]=cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">		<span class="keyword">if</span>(!mp[a[i][<span class="number">0</span>]])</span><br><span class="line">			mp[a[i][<span class="number">0</span>]]=++tot;</span><br><span class="line">		</span><br><span class="line">	st=mp[<span class="number">0x19e0100</span>];</span><br><span class="line">	ed=mp[<span class="number">0x19df9b0</span>];</span><br><span class="line">	<span class="comment">// cout&lt;&lt;st&lt;&lt;&quot; &quot;&lt;&lt;ed&lt;&lt;endl;</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment">//lrt</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(!(a[i][<span class="number">4</span>]&amp;<span class="number">0x1</span>))<span class="comment">//l</span></span><br><span class="line">			<span class="built_in">add</span>(mp[a[i][<span class="number">0</span>]],mp[a[i][<span class="number">1</span>]],<span class="string">&quot;l&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!(a[i][<span class="number">4</span>]&amp;<span class="number">0x100</span>))<span class="comment">//r</span></span><br><span class="line">			<span class="built_in">add</span>(mp[a[i][<span class="number">0</span>]],mp[a[i][<span class="number">2</span>]],<span class="string">&quot;r&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!(a[i][<span class="number">4</span>]&amp;<span class="number">0x10000</span>))<span class="comment">//t</span></span><br><span class="line">			<span class="built_in">add</span>(mp[a[i][<span class="number">0</span>]],mp[a[i][<span class="number">3</span>]],<span class="string">&quot;t&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	queue&lt;pair&lt;<span class="type">int</span>,string&gt; &gt;q;</span><br><span class="line">	v[st]=<span class="number">1</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(st,<span class="string">&quot;&quot;</span>));</span><br><span class="line">	<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		pair&lt;<span class="type">int</span>,string&gt;u=q.<span class="built_in">front</span>();</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="comment">// cout&lt;&lt;u.first&lt;&lt;endl;</span></span><br><span class="line">		<span class="keyword">if</span>(u.first==ed)</span><br><span class="line">		&#123;</span><br><span class="line">			cout&lt;&lt;u.second&lt;&lt;endl;</span><br><span class="line">			<span class="comment">//return 0;</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=h[u.first];i;i=e[i].ne)</span><br><span class="line">			<span class="keyword">if</span>(!v[e[i].to])</span><br><span class="line">			&#123;</span><br><span class="line">				v[e[i].to]=<span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(e[i].to,u.second+e[i].va));</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看别人的wp发现还能用pwntools来搞，学习一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">cmds = [<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;t&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">cmd_list</span>):</span><br><span class="line">    n=<span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = process(<span class="string">&#x27;./maze&#x27;</span>)</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> cmd_list:</span><br><span class="line">            p.sendline(i)</span><br><span class="line">            rev = p.recvuntil(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            n += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(rev)</span><br><span class="line">        p.close()</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ff</span>(<span class="params">cmd_list,f1</span>):</span><br><span class="line">    cmds = [<span class="string">&#x27;r&#x27;</span>,<span class="string">&#x27;l&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cmds:</span><br><span class="line">        c = [k <span class="keyword">for</span> k <span class="keyword">in</span> cmd_list]</span><br><span class="line">        c.append(i)</span><br><span class="line">        <span class="comment">#print(c)</span></span><br><span class="line">        <span class="comment">#print(cmd_list)</span></span><br><span class="line">        <span class="keyword">if</span> f(c) == <span class="built_in">len</span>(c):</span><br><span class="line">            c = ff(c,f1)</span><br><span class="line">            f1.write(<span class="built_in">str</span>(c))</span><br><span class="line">            f1.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(c)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    f1= <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    cmd_list=[]</span><br><span class="line">    ff(cmd_list,f1)</span><br><span class="line">    f1.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>respect,很牛的方法，这个方法不需要idapython导出数据，直接程序里进行dfs跑。</p>
<h2 id="HWS的一道逆向"><a href="#HWS的一道逆向" class="headerlink" title="HWS的一道逆向"></a>HWS的一道逆向</h2><p>re1</p>
<p>是一道魔改的tea，不过魔改的力度属实有点大。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int128 v6[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-38h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+40h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="keyword">sizeof</span>(v6));</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  sub_140001020(<span class="string">&quot;I prefer TeaProPlus! can you give me this?\n&quot;</span>);</span><br><span class="line">  sub_140001020(<span class="string">&quot;TeaProPlus code:&quot;</span>);</span><br><span class="line">  sub_140001080(<span class="string">&quot;%32s&quot;</span>);</span><br><span class="line">  sub_1400010E0(v3, v6);</span><br><span class="line">  v4 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)v6 + v4) == byte_1400032F0[v4] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)++v4 &gt;= <span class="number">0x20</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140001020(<span class="string">&quot;Oh yeah! Good code! flag&#123;(your input)&#125;\n&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;oh NO!I want to drink TeaProPlus&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接看sub_1400010E0函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1400010E0</span><span class="params">(__int64 a1, <span class="type">unsigned</span> <span class="type">int</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// er9</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// er14</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// er15</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// er12</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// er13</span></span><br><span class="line">  _DWORD *v10; <span class="comment">// r11</span></span><br><span class="line">  _DWORD *v11; <span class="comment">// r10</span></span><br><span class="line">  __int64 v12; <span class="comment">// rbx</span></span><br><span class="line">  _DWORD *v13; <span class="comment">// r9</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">bool</span> v15; <span class="comment">// zf</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// [rsp+40h] [rbp+8h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+48h] [rbp+10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// [rsp+50h] [rbp+18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = a2[<span class="number">7</span>];</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = a2[<span class="number">1</span>];</span><br><span class="line">  v5 = *a2;</span><br><span class="line">  v6 = a2[<span class="number">2</span>];</span><br><span class="line">  v7 = a2[<span class="number">3</span>];</span><br><span class="line">  v8 = a2[<span class="number">4</span>];</span><br><span class="line">  v9 = a2[<span class="number">5</span>];</span><br><span class="line">  v16 = a2[<span class="number">6</span>];</span><br><span class="line">  v18 = v2;</span><br><span class="line">  v17 = <span class="number">12</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 -= <span class="number">1640531527</span>;</span><br><span class="line">    v10 = &amp;dword_140004038[(v3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>];</span><br><span class="line">    v5 += ((v3 ^ v4) + (*v10 ^ v2)) ^ (((<span class="number">16</span> * v2) ^ (v4 &gt;&gt; <span class="number">3</span>)) + ((v2 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v4)));</span><br><span class="line">    *a2 = v5;</span><br><span class="line">    v11 = &amp;dword_140004038[(v3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span> ^ <span class="number">1</span>i64];</span><br><span class="line">    v4 += ((*v11 ^ v5) + (v3 ^ v6)) ^ (((<span class="number">16</span> * v5) ^ (v6 &gt;&gt; <span class="number">3</span>)) + ((v5 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v6)));</span><br><span class="line">    a2[<span class="number">1</span>] = v4;</span><br><span class="line">    v12 = (v3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span> ^ <span class="number">3</span>i64;</span><br><span class="line">    v13 = &amp;dword_140004038[(v3 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span> ^ <span class="number">2</span>i64];</span><br><span class="line">    v6 += ((v3 ^ v7) + (*v13 ^ v4)) ^ (((<span class="number">16</span> * v4) ^ (v7 &gt;&gt; <span class="number">3</span>)) + ((v4 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v7)));</span><br><span class="line">    a2[<span class="number">2</span>] = v6;</span><br><span class="line">    v7 += ((v3 ^ v8) + (dword_140004038[v12] ^ v6)) ^ (((<span class="number">16</span> * v6) ^ (v8 &gt;&gt; <span class="number">3</span>)) + ((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v8)));</span><br><span class="line">    a2[<span class="number">3</span>] = v7;</span><br><span class="line">    v8 += ((v3 ^ v9) + (*v10 ^ v7)) ^ (((<span class="number">16</span> * v7) ^ (v9 &gt;&gt; <span class="number">3</span>)) + ((v7 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v9)));</span><br><span class="line">    a2[<span class="number">4</span>] = v8;</span><br><span class="line">    v9 += ((*v11 ^ v8) + (v3 ^ v16)) ^ (((<span class="number">16</span> * v8) ^ (v16 &gt;&gt; <span class="number">3</span>)) + ((v8 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v16)));</span><br><span class="line">    a2[<span class="number">5</span>] = v9;</span><br><span class="line">    LODWORD(v10) = (((v3 ^ v18) + (*v13 ^ v9)) ^ (((<span class="number">16</span> * v9) ^ (v18 &gt;&gt; <span class="number">3</span>)) + ((v9 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v18)))) + v16;</span><br><span class="line">    a2[<span class="number">6</span>] = (<span class="type">unsigned</span> <span class="type">int</span>)v10;</span><br><span class="line">    v16 = (<span class="type">unsigned</span> <span class="type">int</span>)v10;</span><br><span class="line">    result = v3 ^ v5;</span><br><span class="line">    v18 += (result + (dword_140004038[v12] ^ (<span class="type">unsigned</span> <span class="type">int</span>)v10)) ^ (((<span class="number">16</span> * (_DWORD)v10) ^ (v5 &gt;&gt; <span class="number">3</span>))</span><br><span class="line">                                                                  + (((<span class="type">unsigned</span> <span class="type">int</span>)v10 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v5)));</span><br><span class="line">    v15 = v17-- == <span class="number">1</span>;</span><br><span class="line">    v2 = v18;</span><br><span class="line">    a2[<span class="number">7</span>] = v18;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( !v15 );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现比较恶心，魔改的有点魔鬼，所以先进行恢复加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">//解密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>],v2=v[<span class="number">2</span>],v3=v[<span class="number">3</span>],v4=v[<span class="number">4</span>],v5=v[<span class="number">5</span>],v6=v[<span class="number">6</span>],v7=v[<span class="number">7</span>], sum=<span class="number">0x9E3779B9</span>*<span class="number">12</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x9E3779B9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">12</span>; i++) &#123;  </span><br><span class="line">        v7-=((sum^v0)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">3</span>]^v6))^(((v6&lt;&lt;<span class="number">4</span>)^(v0&gt;&gt;<span class="number">3</span>))+((v6&gt;&gt;<span class="number">5</span>)^(v0&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v6-=((sum^v7)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">2</span>]^v5))^(((v5&lt;&lt;<span class="number">4</span>)^(v7&gt;&gt;<span class="number">3</span>))+((v5&gt;&gt;<span class="number">5</span>)^(v7&lt;&lt;<span class="number">2</span>)));        </span><br><span class="line">        v5-=((sum^v6)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">1</span>]^v4))^(((v4&lt;&lt;<span class="number">4</span>)^(v6&gt;&gt;<span class="number">3</span>))+((v4&gt;&gt;<span class="number">5</span>)^(v6&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v4-=((sum^v5)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>]^v3))^(((v3&lt;&lt;<span class="number">4</span>)^(v5&gt;&gt;<span class="number">3</span>))+((v3&gt;&gt;<span class="number">5</span>)^(v5&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v3-=((sum^v4)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">3</span>]^v2))^(((v2&lt;&lt;<span class="number">4</span>)^(v4&gt;&gt;<span class="number">3</span>))+((v2&gt;&gt;<span class="number">5</span>)^(v4&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v2-=((sum^v3)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">2</span>]^v1))^(((v1&lt;&lt;<span class="number">4</span>)^(v3&gt;&gt;<span class="number">3</span>))+((v1&gt;&gt;<span class="number">5</span>)^(v3&lt;&lt;<span class="number">2</span>)));         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1-=((k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">1</span>]^v0)+(sum^v2))^(((v0&lt;&lt;<span class="number">4</span>)^(v2&gt;&gt;<span class="number">3</span>))+((v0&gt;&gt;<span class="number">5</span>)^(v2&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v0-=((sum^v1)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>]^v7))^(((v7&lt;&lt;<span class="number">4</span>)^(v1&gt;&gt;<span class="number">3</span>))+((v7&gt;&gt;<span class="number">5</span>)^(v1&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;v[<span class="number">2</span>]=v2;v[<span class="number">3</span>]=v3;v[<span class="number">4</span>]=v4;v[<span class="number">5</span>]=v5;v[<span class="number">6</span>]=v6;v[<span class="number">7</span>]=v7;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>],v2=v[<span class="number">2</span>],v3=v[<span class="number">3</span>],v4=v[<span class="number">4</span>],v5=v[<span class="number">5</span>],v6=v[<span class="number">6</span>],v7=v[<span class="number">7</span>], sum=<span class="number">0</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x9E3779B9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">12</span>; i++) &#123;  </span><br><span class="line">        sum += delta;</span><br><span class="line">        v0+=((sum^v1)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>]^v7))^(((v7&lt;&lt;<span class="number">4</span>)^(v1&gt;&gt;<span class="number">3</span>))+((v7&gt;&gt;<span class="number">5</span>)^(v1&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v1+=((k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">1</span>]^v0)+(sum^v2))^(((v0&lt;&lt;<span class="number">4</span>)^(v2&gt;&gt;<span class="number">3</span>))+((v0&gt;&gt;<span class="number">5</span>)^(v2&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v2+=((sum^v3)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">2</span>]^v1))^(((v1&lt;&lt;<span class="number">4</span>)^(v3&gt;&gt;<span class="number">3</span>))+((v1&gt;&gt;<span class="number">5</span>)^(v3&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v3+=((sum^v4)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">3</span>]^v2))^(((v2&lt;&lt;<span class="number">4</span>)^(v4&gt;&gt;<span class="number">3</span>))+((v2&gt;&gt;<span class="number">5</span>)^(v4&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v4+=((sum^v5)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>]^v3))^(((v3&lt;&lt;<span class="number">4</span>)^(v5&gt;&gt;<span class="number">3</span>))+((v3&gt;&gt;<span class="number">5</span>)^(v5&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v5+=((sum^v6)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">1</span>]^v4))^(((v4&lt;&lt;<span class="number">4</span>)^(v6&gt;&gt;<span class="number">3</span>))+((v4&gt;&gt;<span class="number">5</span>)^(v6&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v6+=((sum^v7)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">2</span>]^v5))^(((v5&lt;&lt;<span class="number">4</span>)^(v7&gt;&gt;<span class="number">3</span>))+((v5&gt;&gt;<span class="number">5</span>)^(v7&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">        v7+=((sum^v0)+(k[(sum&gt;&gt;<span class="number">2</span>)&amp;<span class="number">3</span>^<span class="number">3</span>]^v6))^(((v6&lt;&lt;<span class="number">4</span>)^(v0&gt;&gt;<span class="number">3</span>))+((v6&gt;&gt;<span class="number">5</span>)^(v0&lt;&lt;<span class="number">2</span>)));</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;v[<span class="number">2</span>]=v2;v[<span class="number">3</span>]=v3;v[<span class="number">4</span>]=v4;v[<span class="number">5</span>]=v5;v[<span class="number">6</span>]=v6;v[<span class="number">7</span>]=v7;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//测试</span></span><br><span class="line">    <span class="comment">//uint32_t v[8]=&#123;0x31313131,0x31313131,0x31313131,0x31313131,0x31313131,0x31313131,0x31313131,0x31313131&#125;,k[4]=&#123;0x1234,0x2345,0x4567,0x6789&#125;;</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">8</span>]=&#123;<span class="number">0x10BD3B47</span>, <span class="number">0x6155E0F9</span>, <span class="number">0x6AF7EBC5</span>, <span class="number">0x8D23435F</span>, <span class="number">0x1A091605</span>, <span class="number">0xD43D40EF</span>, <span class="number">0xB4B16A67</span>, <span class="number">0x6B3578A9</span>&#125;,k[<span class="number">4</span>]=&#123;<span class="number">0x1234</span>,<span class="number">0x2345</span>,<span class="number">0x4567</span>,<span class="number">0x6789</span>&#125;;</span><br><span class="line">    <span class="comment">//encrypt(v, k);</span></span><br><span class="line">    <span class="comment">//printf(&quot;encode:%x %x %x %x %x %x %x %x\n&quot;,v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7]);</span></span><br><span class="line">    decrypt(v, k);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;decode:%x %x %x %x %x %x %x %x\n&quot;</span>,v[<span class="number">0</span>],v[<span class="number">1</span>],v[<span class="number">2</span>],v[<span class="number">3</span>],v[<span class="number">4</span>],v[<span class="number">5</span>],v[<span class="number">6</span>],v[<span class="number">7</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行恢复加密过后，逆序写解密就行</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/06/23/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/23/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-23 01:06:21" itemprop="dateCreated datePublished" datetime="2022-06-23T01:06:21+08:00">2022-06-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/06/17/ciscnctf2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/17/ciscnctf2022/" class="post-title-link" itemprop="url">ciscnctf2022/</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-17 09:43:34" itemprop="dateCreated datePublished" datetime="2022-06-17T09:43:34+08:00">2022-06-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:31:14" itemprop="dateModified" datetime="2022-07-18T00:31:14+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ciscnctf2022"><a href="#ciscnctf2022" class="headerlink" title="ciscnctf2022"></a>ciscnctf2022</h1><p>好久没有写博客了，由于期末原因，国赛的逆向还没复现，今天复现一下，总的来说，国赛的三道题，其中两道都是语文题，蚌埠住了。</p>
<h2 id="baby-tree"><a href="#baby-tree" class="headerlink" title="baby_tree"></a>baby_tree</h2><p>记得找了很多工具发现并不能转换，所以只能硬看swift的ast代码</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617094847961.png" alt="image-20220617094847961"></p>
<p>首先我们能发现对比字符串和key的位置</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617100004163.png" alt="image-20220617100004163"></p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617095951534.png" alt="image-20220617095951534"></p>
<p>继续往下看在625行大概是调用了check函数，其中传入了两个参数，分别是data和key</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617103522582.png" alt="image-20220617103522582"></p>
<p>Original init:这个应该是初始化一下,Processed init:这个是运行函数。接下来我们直接查check函数，发现是在最初。</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617104011665.png" alt="image-20220617104011665"></p>
<p>这个地方可以研究一下，其实是传入两个参数，string类型的，这个函数应该是bool类型，这么长的一段并无什么运算符，但可能是将两个string类型转换成数组，一个是b数组，一个是k数组，其中b数组应该是encode的位置，k数组应该就是key。接下来在70行又声明了4个变量r0，r1，r2，r3。继续看在第99行进入循环。</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617104939675.png" alt="image-20220617104939675"></p>
<p>这个循环长度不难猜出是0-cout(b)-4，但如果没看到的话，估计后面几位会错。接下来是个赋值条件，形成第一个元组（r0，r1，r2，r3）</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617105646948.png" alt="image-20220617105646948"></p>
<p>assign_expr和load_expr都是赋值的意思下面通过value的值变换可以猜测，r0,r1,r2,r3 &#x3D; b[0],b[1],b[2],b[3]</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617110005652.png" alt="image-20220617110005652"></p>
<p>我们分析一个加密：</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617114011203.png" alt="image-20220617114011203"></p>
<p>可以看出，缩进代表运算顺序，缩进越多优先级越高，argument后是参数，extension.后是运算符，那么上述图片可以表示为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b[i+<span class="number">0</span>] = r2 ^ ((k[<span class="number">0</span>] + (r0 &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0xff</span>)</span><br></pre></td></tr></table></figure>

<p>那么接下来的跟上述是一样的可分析出大概逻辑：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(b)-<span class="number">3</span>):</span><br><span class="line">    r0,r1,r2,r3=b[i],b[i+<span class="number">1</span>],b[i+<span class="number">2</span>],b[i+<span class="number">3</span>]</span><br><span class="line">	b[i+<span class="number">0</span>] = r2 ^ ((k[<span class="number">0</span>] + (r0 &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0xff</span>)</span><br><span class="line">	b[i+<span class="number">1</span>] = r3 ^ ((k[<span class="number">1</span>] + (r1 &gt;&gt; <span class="number">2</span>)) &amp; <span class="number">0xff</span>)</span><br><span class="line">	b[i+<span class="number">2</span>] = r0 ^ k[<span class="number">2</span>]</span><br><span class="line">	b[i+<span class="number">3</span>] = r1 ^ k[<span class="number">3</span>]</span><br><span class="line">    k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>] = k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>], k[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>我们直接写出解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">key = <span class="string">b&quot;345y&quot;</span></span><br><span class="line">k=<span class="built_in">list</span>(key)</span><br><span class="line">cmp = [<span class="number">88</span>, <span class="number">35</span>, <span class="number">88</span>, <span class="number">225</span>, <span class="number">7</span>, <span class="number">201</span>, <span class="number">57</span>, <span class="number">94</span>, <span class="number">77</span>, <span class="number">56</span>, <span class="number">75</span>, <span class="number">168</span>, <span class="number">72</span>, <span class="number">218</span>, <span class="number">64</span>, <span class="number">91</span>, <span class="number">16</span>, <span class="number">101</span>, <span class="number">32</span>, <span class="number">207</span>, <span class="number">73</span>, <span class="number">130</span>, <span class="number">74</span>, <span class="number">128</span>, <span class="number">76</span>, <span class="number">201</span>, <span class="number">16</span>, <span class="number">248</span>, <span class="number">41</span>, <span class="number">205</span>, <span class="number">103</span>, <span class="number">84</span>, <span class="number">91</span>, <span class="number">99</span>, <span class="number">79</span>, <span class="number">202</span>, <span class="number">22</span>, <span class="number">131</span>, <span class="number">63</span>, <span class="number">255</span>, <span class="number">20</span>, <span class="number">16</span>]</span><br><span class="line">b = [<span class="number">0</span>]*<span class="built_in">len</span>(cmp)</span><br><span class="line">k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>] =  k[<span class="number">2</span>], k[<span class="number">3</span>], k[<span class="number">0</span>], k[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    r1 = cmp[i+<span class="number">3</span>] ^ k[<span class="number">3</span>]</span><br><span class="line">    r0 = cmp[i+<span class="number">2</span>] ^ k[<span class="number">2</span>]</span><br><span class="line">    r3 = cmp[i+<span class="number">1</span>] ^ (<span class="number">0xff</span> &amp; (k[<span class="number">1</span>] + (r1 &gt;&gt; <span class="number">2</span>)))</span><br><span class="line">    r2 = cmp[i] ^ (<span class="number">0xff</span> &amp; (k[<span class="number">0</span>] + (r0 &gt;&gt; <span class="number">4</span>)))</span><br><span class="line">    k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>] = k[<span class="number">3</span>], k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>]</span><br><span class="line">    cmp[i], cmp[i+<span class="number">1</span>], cmp[i+<span class="number">2</span>], cmp[i+<span class="number">3</span>] = r0, r1, r2, r3</span><br><span class="line"><span class="built_in">print</span>(cmp)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cmp)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(cmp[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;30831242-56db-45b4-96fd-1f47e60da99d&#125;</span></span><br></pre></td></tr></table></figure>

<p>本以为这个题就是阅读题的极限了，没想到下一题也是阅读题。</p>
<h2 id="babycode"><a href="#babycode" class="headerlink" title="babycode"></a>babycode</h2><p>这个题给了一个.mrb文件后缀是将 ruby 代码编译为 mruby 字节码作为字符串并评估字符串化字节码，通过010前面字符RITE0300，可以判断出mruby的版本是3.1.0，我们下载<a target="_blank" rel="noopener" href="https://github.com/mruby/mruby/releases/tag/3.1.0%E6%BA%90%E7%A0%81%EF%BC%8C%E9%A6%96%E5%85%88%E8%A6%81%E5%AE%89%E8%A3%85sudo">https://github.com/mruby/mruby/releases/tag/3.1.0源码，首先要安装sudo</a> apt-get install rake，接下来make，然后进入bin里就可以使用mruby了.&#x2F;mruby -v -b babycode.mrb.</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617144108971.png" alt="image-20220617144108971"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line">mruby <span class="number">3.1</span><span class="number">.0</span> (<span class="number">2022</span><span class="number">-05</span><span class="number">-12</span>)</span><br><span class="line">irep <span class="number">0x56306d9014d0</span> nregs=<span class="number">5</span> nlocals=<span class="number">2</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">2</span> ilen=<span class="number">55</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">      <span class="number">000</span> LOADNIL       R2</span><br><span class="line">      <span class="number">002</span> LOADNIL       R3</span><br><span class="line">      <span class="number">004</span> CLASS         R2      :Crypt</span><br><span class="line">      <span class="number">007</span> EXEC          R2      I(<span class="number">0</span>:<span class="number">0x56306d901580</span>)</span><br><span class="line">      <span class="number">010</span> TCLASS        R2</span><br><span class="line">      <span class="number">012</span> METHOD        R3      I(<span class="number">1</span>:<span class="number">0x56306d901d80</span>)</span><br><span class="line">      <span class="number">015</span> DEF           R2      :check</span><br><span class="line">      <span class="number">018</span> SSEND         R2      :gets   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">022</span> SEND          R2      :chomp  n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">026</span> MOVE          R1      R2              ; R1:p</span><br><span class="line">      <span class="number">029</span> MOVE          R3      R1              ; R1:p</span><br><span class="line">      <span class="number">032</span> SSEND         R2      :check  n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">036</span> JMPNOT        R2      <span class="number">050</span></span><br><span class="line">      <span class="number">040</span> STRING        R3      L(<span class="number">0</span>)    ; yes</span><br><span class="line">      <span class="number">043</span> SSEND         R2      :<span class="built_in">puts</span>   n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">047</span> JMP           <span class="number">052</span></span><br><span class="line">      <span class="number">050</span> LOADNIL       R2</span><br><span class="line">      <span class="number">052</span> RETURN        R2</span><br><span class="line">      <span class="number">054</span> STOP</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901580</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">1</span> reps=<span class="number">1</span> ilen=<span class="number">12</span></span><br><span class="line">      <span class="number">000</span> LOADNIL       R1</span><br><span class="line">      <span class="number">002</span> LOADNIL       R2</span><br><span class="line">      <span class="number">004</span> CLASS         R1      :CIPHER</span><br><span class="line">      <span class="number">007</span> EXEC          R1      I(<span class="number">0</span>:<span class="number">0x56306d901650</span>)</span><br><span class="line">      <span class="number">010</span> RETURN        R1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901650</span> nregs=<span class="number">3</span> nlocals=<span class="number">1</span> pools=<span class="number">0</span> syms=<span class="number">6</span> reps=<span class="number">4</span> ilen=<span class="number">55</span></span><br><span class="line">      <span class="number">000</span> LOADI32       R1      <span class="number">305419896</span></span><br><span class="line">      <span class="number">006</span> SETCONST      XX      R1</span><br><span class="line">      <span class="number">009</span> LOADI         R1      <span class="number">16</span></span><br><span class="line">      <span class="number">012</span> SETCONST      YY      R1</span><br><span class="line">      <span class="number">015</span> LOADSELF      R1</span><br><span class="line">      <span class="number">017</span> SCLASS                R1</span><br><span class="line">      <span class="number">019</span> METHOD        R2      I(<span class="number">0</span>:<span class="number">0x56306d901790</span>)</span><br><span class="line">      <span class="number">022</span> DEF           R1      :encrypt</span><br><span class="line">      <span class="number">025</span> TCLASS        R1</span><br><span class="line">      <span class="number">027</span> METHOD        R2      I(<span class="number">1</span>:<span class="number">0x56306d901830</span>)</span><br><span class="line">      <span class="number">030</span> DEF           R1      :encrypt</span><br><span class="line">      <span class="number">033</span> SSEND         R1      :private        n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">037</span> TCLASS        R1</span><br><span class="line">      <span class="number">039</span> METHOD        R2      I(<span class="number">2</span>:<span class="number">0x56306d901b50</span>)</span><br><span class="line">      <span class="number">042</span> DEF           R1      :to_key</span><br><span class="line">      <span class="number">045</span> TCLASS        R1</span><br><span class="line">      <span class="number">047</span> METHOD        R2      I(<span class="number">3</span>:<span class="number">0x56306d901c20</span>)</span><br><span class="line">      <span class="number">050</span> DEF           R1      :enc_one</span><br><span class="line">      <span class="number">053</span> RETURN        R1</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901790</span> nregs=<span class="number">9</span> nlocals=<span class="number">5</span> pools=<span class="number">0</span> syms=<span class="number">3</span> reps=<span class="number">0</span> ilen=<span class="number">29</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:cip</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> GETCONST      R5      CIPHER</span><br><span class="line">      <span class="number">007</span> SEND          R5      :new    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">011</span> MOVE          R4      R5              ; R4:cip</span><br><span class="line">      <span class="number">014</span> MOVE          R5      R4              ; R4:cip</span><br><span class="line">      <span class="number">017</span> MOVE          R6      R1              ; R1:t</span><br><span class="line">      <span class="number">020</span> MOVE          R7      R2              ; R2:p</span><br><span class="line">      <span class="number">023</span> SEND          R5      :encrypt        n=<span class="number">2</span> (<span class="number">0x02</span>)</span><br><span class="line">      <span class="number">027</span> RETURN        R5</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901830</span> nregs=<span class="number">16</span> nlocals=<span class="number">11</span> pools=<span class="number">1</span> syms=<span class="number">8</span> reps=<span class="number">1</span> ilen=<span class="number">346</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:t</span><br><span class="line">  R2:p</span><br><span class="line">  R3:&amp;</span><br><span class="line">  R4:key</span><br><span class="line">  R5:c</span><br><span class="line">  R6:n</span><br><span class="line">  R7:num1</span><br><span class="line">  R8:num2</span><br><span class="line">  R9:enum1</span><br><span class="line">  R10:enum2</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">2</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x80000</span>)</span><br><span class="line">      <span class="number">004</span> MOVE          R12     R2              ; R2:p</span><br><span class="line">      <span class="number">007</span> SSEND         R11     :to_key n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">011</span> MOVE          R4      R11             ; R4:key</span><br><span class="line">      <span class="number">014</span> ARRAY         R5      R5      <span class="number">0</span>       ; R5:c</span><br><span class="line">      <span class="number">017</span> LOADI_0       R6                      ; R6:n</span><br><span class="line">      <span class="number">019</span> MOVE          R11     R6              ; R6:n</span><br><span class="line">      <span class="number">022</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">025</span> SEND          R12     :length n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">029</span> LT            R11     R12</span><br><span class="line">      <span class="number">031</span> JMPNOT        R11     <span class="number">327</span></span><br><span class="line">      <span class="number">035</span> MOVE          R11     R1              ; R1:t</span><br><span class="line">      <span class="number">038</span> MOVE          R12     R6              ; R6:n</span><br><span class="line">      <span class="number">041</span> GETIDX        R11     R12</span><br><span class="line">      <span class="number">043</span> SEND          R11     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">047</span> SEND          R11     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">051</span> LOADI         R12     <span class="number">24</span></span><br><span class="line">      <span class="number">054</span> SEND          R11     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">058</span> MOVE          R7      R11             ; R7:num1</span><br><span class="line">      <span class="number">061</span> MOVE          R11     R7              ; R7:num1</span><br><span class="line">      <span class="number">064</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">067</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">070</span> ADDI          R13     <span class="number">1</span></span><br><span class="line">      <span class="number">073</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">075</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">079</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">083</span> LOADI         R13     <span class="number">16</span></span><br><span class="line">      <span class="number">086</span> SEND          R12     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">090</span> ADD           R11     R12</span><br><span class="line">      <span class="number">092</span> MOVE          R7      R11             ; R7:num1</span><br><span class="line">      <span class="number">095</span> MOVE          R11     R7              ; R7:num1</span><br><span class="line">      <span class="number">098</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">101</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">104</span> ADDI          R13     <span class="number">2</span></span><br><span class="line">      <span class="number">107</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">109</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">113</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">117</span> LOADI         R13     <span class="number">8</span></span><br><span class="line">      <span class="number">120</span> SEND          R12     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">124</span> ADD           R11     R12</span><br><span class="line">      <span class="number">126</span> MOVE          R7      R11             ; R7:num1</span><br><span class="line">      <span class="number">129</span> MOVE          R11     R7              ; R7:num1</span><br><span class="line">      <span class="number">132</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">135</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">138</span> ADDI          R13     <span class="number">3</span></span><br><span class="line">      <span class="number">141</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">143</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">147</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">151</span> ADD           R11     R12</span><br><span class="line">      <span class="number">153</span> MOVE          R7      R11             ; R7:num1</span><br><span class="line">      <span class="number">156</span> MOVE          R11     R1              ; R1:t</span><br><span class="line">      <span class="number">159</span> MOVE          R12     R6              ; R6:n</span><br><span class="line">      <span class="number">162</span> ADDI          R12     <span class="number">4</span></span><br><span class="line">      <span class="number">165</span> GETIDX        R11     R12</span><br><span class="line">      <span class="number">167</span> SEND          R11     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">171</span> SEND          R11     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">175</span> LOADI         R12     <span class="number">24</span></span><br><span class="line">      <span class="number">178</span> SEND          R11     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">182</span> MOVE          R8      R11             ; R8:num2</span><br><span class="line">      <span class="number">185</span> MOVE          R11     R8              ; R8:num2</span><br><span class="line">      <span class="number">188</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">191</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">194</span> ADDI          R13     <span class="number">5</span></span><br><span class="line">      <span class="number">197</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">199</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">203</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">207</span> LOADI         R13     <span class="number">16</span></span><br><span class="line">      <span class="number">210</span> SEND          R12     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">214</span> ADD           R11     R12</span><br><span class="line">      <span class="number">216</span> MOVE          R8      R11             ; R8:num2</span><br><span class="line">      <span class="number">219</span> MOVE          R11     R8              ; R8:num2</span><br><span class="line">      <span class="number">222</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">225</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">228</span> ADDI          R13     <span class="number">6</span></span><br><span class="line">      <span class="number">231</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">233</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">237</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">241</span> LOADI         R13     <span class="number">8</span></span><br><span class="line">      <span class="number">244</span> SEND          R12     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">248</span> ADD           R11     R12</span><br><span class="line">      <span class="number">250</span> MOVE          R8      R11             ; R8:num2</span><br><span class="line">      <span class="number">253</span> MOVE          R11     R8              ; R8:num2</span><br><span class="line">      <span class="number">256</span> MOVE          R12     R1              ; R1:t</span><br><span class="line">      <span class="number">259</span> MOVE          R13     R6              ; R6:n</span><br><span class="line">      <span class="number">262</span> ADDI          R13     <span class="number">7</span></span><br><span class="line">      <span class="number">265</span> GETIDX        R12     R13</span><br><span class="line">      <span class="number">267</span> SEND          R12     :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">271</span> SEND          R12     :to_i   n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">275</span> ADD           R11     R12</span><br><span class="line">      <span class="number">277</span> MOVE          R8      R11             ; R8:num2</span><br><span class="line">      <span class="number">280</span> MOVE          R12     R7              ; R7:num1</span><br><span class="line">      <span class="number">283</span> MOVE          R13     R8              ; R8:num2</span><br><span class="line">      <span class="number">286</span> MOVE          R14     R4              ; R4:key</span><br><span class="line">      <span class="number">289</span> SSEND         R11     :enc_one        n=<span class="number">3</span> (<span class="number">0x03</span>)</span><br><span class="line">      <span class="number">293</span> AREF          R9      R11     <span class="number">0</span>       ; R9:enum1</span><br><span class="line">      <span class="number">297</span> AREF          R10     R11     <span class="number">1</span>       ; R10:enum2</span><br><span class="line">      <span class="number">301</span> MOVE          R11     R5              ; R5:c</span><br><span class="line">      <span class="number">304</span> MOVE          R12     R9              ; R9:enum1</span><br><span class="line">      <span class="number">307</span> SEND          R11     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">311</span> MOVE          R11     R5              ; R5:c</span><br><span class="line">      <span class="number">314</span> MOVE          R12     R10             ; R10:enum2</span><br><span class="line">      <span class="number">317</span> SEND          R11     :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">321</span> ADDI          R6      <span class="number">8</span>               ; R6:n</span><br><span class="line">      <span class="number">324</span> JMP           <span class="number">019</span></span><br><span class="line">      <span class="number">327</span> MOVE          R11     R5              ; R5:c</span><br><span class="line">      <span class="number">330</span> BLOCK         R12     <span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x56306d901a80</span>)</span></span><br><span class="line">      333 SENDB         R11     :collect        n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">337</span> STRING        R12     <span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>    ;</span><br><span class="line">      <span class="number">340</span> SEND          R11     :join   n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">344</span> RETURN        R11</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901a80</span> nregs=<span class="number">7</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:x</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> STRING        R4      L(<span class="number">0</span>)    ; %<span class="number">.8</span>x</span><br><span class="line">      <span class="number">007</span> MOVE          R5      R1              ; R1:x</span><br><span class="line">      <span class="number">010</span> SSEND         R3      :<span class="built_in">sprintf</span>        n=<span class="number">2</span> (<span class="number">0x02</span>)</span><br><span class="line">      <span class="number">014</span> RETURN        R3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901b50</span> nregs=<span class="number">6</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">1</span> reps=<span class="number">0</span> ilen=<span class="number">16</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> MOVE          R3      R1              ; R1:p</span><br><span class="line">      <span class="number">007</span> STRING        R4      <span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>    ; L*</span><br><span class="line">      <span class="number">010</span> SEND          R3      :unpack n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">014</span> RETURN        R3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901c20</span> nregs=<span class="number">11</span> nlocals=<span class="number">8</span> pools=<span class="number">0</span> syms=<span class="number">2</span> reps=<span class="number">1</span> ilen=<span class="number">42</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:num1</span><br><span class="line">  R2:num2</span><br><span class="line">  R3:key</span><br><span class="line">  R4:&amp;</span><br><span class="line">  R5:y</span><br><span class="line">  R6:z</span><br><span class="line">  R7:s</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">3</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0xc0000</span>)</span><br><span class="line">      <span class="number">004</span> MOVE          R8      R1              ; R1:num1</span><br><span class="line">      <span class="number">007</span> MOVE          R9      R2              ; R2:num2</span><br><span class="line">      <span class="number">010</span> LOADI_0       R10</span><br><span class="line">      <span class="number">012</span> MOVE          R5      R8              ; R5:y</span><br><span class="line">      <span class="number">015</span> MOVE          R6      R9              ; R6:z</span><br><span class="line">      <span class="number">018</span> MOVE          R7      R10             ; R7:s</span><br><span class="line">      <span class="number">021</span> GETCONST      R8      YY</span><br><span class="line">      <span class="number">024</span> BLOCK         R9      <span class="title function_">I</span><span class="params">(<span class="number">0</span>:<span class="number">0x56306d901cf0</span>)</span></span><br><span class="line">      027 SENDB         R8      :times  n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">031</span> MOVE          R8      R5              ; R5:y</span><br><span class="line">      <span class="number">034</span> MOVE          R9      R6              ; R6:z</span><br><span class="line">      <span class="number">037</span> ARRAY         R8      R8      <span class="number">2</span></span><br><span class="line">      <span class="number">040</span> RETURN        R8</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901cf0</span> nregs=<span class="number">10</span> nlocals=<span class="number">3</span> pools=<span class="number">1</span> syms=<span class="number">5</span> reps=<span class="number">0</span> ilen=<span class="number">186</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:i</span><br><span class="line">  R2:&amp;</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> GETUPVAR      R3      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">008</span> GETUPVAR      R4      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">012</span> LOADI_3       R5</span><br><span class="line">      <span class="number">014</span> SEND          R4      :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">018</span> GETUPVAR      R5      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">022</span> LOADI_5       R6</span><br><span class="line">      <span class="number">024</span> SEND          R5      :&gt;&gt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">028</span> SEND          R4      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">032</span> GETUPVAR      R5      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">036</span> ADD           R4      R5</span><br><span class="line">      <span class="number">038</span> GETUPVAR      R5      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">042</span> GETUPVAR      R6      <span class="number">3</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">046</span> GETUPVAR      R7      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">050</span> LOADI         R8      <span class="number">11</span></span><br><span class="line">      <span class="number">053</span> SEND          R7      :&gt;&gt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">057</span> ADDI          R7      <span class="number">1</span></span><br><span class="line">      <span class="number">060</span> LOADI_3       R8</span><br><span class="line">      <span class="number">062</span> SEND          R7      :&amp;      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">066</span> GETIDX        R6      R7</span><br><span class="line">      <span class="number">068</span> ADD           R5      R6</span><br><span class="line">      <span class="number">070</span> SEND          R4      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">074</span> ADD           R3      R4</span><br><span class="line">      <span class="number">076</span> SETUPVAR      R3      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">080</span> LOADL         R4      L(<span class="number">0</span>)    ; <span class="number">4294967295</span></span><br><span class="line">      <span class="number">083</span> SEND          R3      :&amp;      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">087</span> SETUPVAR      R3      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">091</span> GETUPVAR      R3      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">095</span> GETCONST      R4      XX</span><br><span class="line">      <span class="number">098</span> ADD           R3      R4</span><br><span class="line">      <span class="number">100</span> SETUPVAR      R3      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">104</span> GETUPVAR      R3      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">108</span> GETUPVAR      R4      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">112</span> LOADI_3       R5</span><br><span class="line">      <span class="number">114</span> SEND          R4      :&lt;&lt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">118</span> GETUPVAR      R5      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">122</span> LOADI_5       R6</span><br><span class="line">      <span class="number">124</span> SEND          R5      :&gt;&gt;     n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">128</span> SEND          R4      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">132</span> GETUPVAR      R5      <span class="number">5</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">136</span> ADD           R4      R5</span><br><span class="line">      <span class="number">138</span> GETUPVAR      R5      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">142</span> GETUPVAR      R6      <span class="number">3</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">146</span> GETUPVAR      R7      <span class="number">7</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">150</span> ADDI          R7      <span class="number">1</span></span><br><span class="line">      <span class="number">153</span> LOADI_3       R8</span><br><span class="line">      <span class="number">155</span> SEND          R7      :&amp;      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">159</span> GETIDX        R6      R7</span><br><span class="line">      <span class="number">161</span> ADD           R5      R6</span><br><span class="line">      <span class="number">163</span> SEND          R4      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">167</span> ADD           R3      R4</span><br><span class="line">      <span class="number">169</span> SETUPVAR      R3      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">173</span> LOADL         R4      L(<span class="number">0</span>)    ; <span class="number">4294967295</span></span><br><span class="line">      <span class="number">176</span> SEND          R3      :&amp;      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">180</span> SETUPVAR      R3      <span class="number">6</span>       <span class="number">0</span></span><br><span class="line">      <span class="number">184</span> RETURN        R3</span><br><span class="line"></span><br><span class="line">irep <span class="number">0x56306d901d80</span> nregs=<span class="number">13</span> nlocals=<span class="number">8</span> pools=<span class="number">2</span> syms=<span class="number">7</span> reps=<span class="number">0</span> ilen=<span class="number">128</span></span><br><span class="line">local variable names:</span><br><span class="line">  R1:p</span><br><span class="line">  R2:&amp;</span><br><span class="line">  R3:i</span><br><span class="line">  R4:lst_ch</span><br><span class="line">  R5:c</span><br><span class="line">  R6:k</span><br><span class="line">  R7:cipher_text</span><br><span class="line">      <span class="number">000</span> ENTER         <span class="number">1</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span> (<span class="number">0x40000</span>)</span><br><span class="line">      <span class="number">004</span> LOADI_0       R3                      ; R3:i</span><br><span class="line">      <span class="number">006</span> LOADI_0       R4                      ; R4:lst_ch</span><br><span class="line">      <span class="number">008</span> MOVE          R8      R3              ; R3:i</span><br><span class="line">      <span class="number">011</span> MOVE          R9      R1              ; R1:p</span><br><span class="line">      <span class="number">014</span> SEND          R9      :length n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">018</span> LT            R8      R9</span><br><span class="line">      <span class="number">020</span> JMPNOT        R8      <span class="number">086</span></span><br><span class="line">      <span class="number">024</span> MOVE          R8      R1              ; R1:p</span><br><span class="line">      <span class="number">027</span> MOVE          R9      R3              ; R3:i</span><br><span class="line">      <span class="number">030</span> GETIDX        R8      R9</span><br><span class="line">      <span class="number">032</span> SEND          R8      :ord    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">036</span> MOVE          R5      R8              ; R5:c</span><br><span class="line">      <span class="number">039</span> MOVE          R8      R5              ; R5:c</span><br><span class="line">      <span class="number">042</span> MOVE          R9      R4              ; R4:lst_ch</span><br><span class="line">      <span class="number">045</span> SEND          R8      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">049</span> MOVE          R9      R3              ; R3:i</span><br><span class="line">      <span class="number">052</span> ADDI          R9      <span class="number">1</span></span><br><span class="line">      <span class="number">055</span> SEND          R8      :^      n=<span class="number">1</span> (<span class="number">0x01</span>)</span><br><span class="line">      <span class="number">059</span> SEND          R8      :chr    n=<span class="number">0</span> (<span class="number">0x00</span>)</span><br><span class="line">      <span class="number">063</span> MOVE          R9      R1              ; R1:p</span><br><span class="line">      <span class="number">066</span> MOVE          R10     R3              ; R3:i</span><br><span class="line">      <span class="number">069</span> MOVE          R11     R8</span><br><span class="line">      <span class="number">072</span> SETIDX        R9      R10     R11</span><br><span class="line">      <span class="number">074</span> MOVE          R8      R5              ; R5:c</span><br><span class="line">      <span class="number">077</span> MOVE          R4      R8              ; R4:lst_ch</span><br><span class="line">      <span class="number">080</span> ADDI          R3      <span class="number">1</span>               ; R3:i</span><br><span class="line">      <span class="number">083</span> JMP           <span class="number">008</span></span><br><span class="line">      <span class="number">086</span> STRING        R6      <span class="title function_">L</span><span class="params">(<span class="number">0</span>)</span>    ; aaaassssddddffff      ; R6:k</span><br><span class="line">      <span class="number">089</span> GETCONST      R8      Crypt</span><br><span class="line">      <span class="number">092</span> GETMCNST      R8      R8::CIPHER</span><br><span class="line">      <span class="number">095</span> MOVE          R9      R1              ; R1:p</span><br><span class="line">      <span class="number">098</span> MOVE          R10     R6              ; R6:k</span><br><span class="line">      <span class="number">101</span> SEND          R8      :encrypt        n=<span class="number">2</span> (<span class="number">0x02</span>)</span><br><span class="line">      <span class="number">105</span> MOVE          R7      R8              ; R7:cipher_text</span><br><span class="line">      <span class="number">108</span> MOVE          R8      R7              ; R7:cipher_text</span><br><span class="line">      <span class="number">111</span> STRING        R9      <span class="title function_">L</span><span class="params">(<span class="number">1</span>)</span>    ; f469358b7f165145116e127ad6105917bce5225d6d62a714c390c5ed93b22d8b6b102a8813488fdb</span><br><span class="line">      <span class="number">114</span> EQ            R8      R9</span><br><span class="line">      <span class="number">116</span> JMPNOT        R8      <span class="number">124</span></span><br><span class="line">      <span class="number">120</span> LOADT         R8</span><br><span class="line">      <span class="number">122</span> RETURN        R8</span><br><span class="line">      <span class="number">124</span> LOADF         R8</span><br><span class="line">      <span class="number">126</span> RETURN        R8</span><br></pre></td></tr></table></figure>

<p>经典阅读文档，那天做题的时候大概就已经猜出来是xtea加密，但是应该是还是有别的加密。当然这次再对照着opcode看，在xtea加密前还有一个异或。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* take 64 bits of data in v[0] and v[1] and 128 bits of key[0] - key[3] */</span></span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0</span>, delta=<span class="number">0x12345678</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum&gt;&gt;<span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], delta=<span class="number">0x12345678</span>, sum=delta*num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">3</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum+<span class="number">1</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">3</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[((sum&gt;&gt;<span class="number">11</span>)+<span class="number">1</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[]=&#123;<span class="number">0xf469358b</span>, <span class="number">0x7f165145</span>, <span class="number">0x116e127a</span>, <span class="number">0xd6105917</span>, <span class="number">0xbce5225d</span>, <span class="number">0x6d62a714</span>, <span class="number">0xc390c5ed</span>, <span class="number">0x93b22d8b</span>, <span class="number">0x6b102a88</span>, <span class="number">0x13488fdb</span> &#125;,k[<span class="number">4</span>]=&#123;<span class="string">&#x27;aaaa&#x27;</span>,<span class="string">&#x27;ssss&#x27;</span>,<span class="string">&#x27;dddd&#x27;</span>,<span class="string">&#x27;ffff&#x27;</span>&#125;; </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> r=<span class="number">32</span>;<span class="comment">//num_rounds建议取值为32</span></span><br><span class="line">    <span class="comment">// v为要加密的数据是两个32位无符号整数</span></span><br><span class="line">    <span class="comment">// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;++i)&#123;</span><br><span class="line">        decipher(<span class="number">16</span>, &amp;v[i*<span class="number">2</span>], k);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%08x%08x&quot;</span>,v[i*<span class="number">2</span>],v[i*<span class="number">2</span>+<span class="number">1</span>]); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//67080e02194b500d5c585f0b5e40461511470a08154211560d47491e04031d262771217626242765</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;67080e02194b500d5c585f0b5e40461511470a08154211560d47491e04031d262771217626242765&#x27;</span>)</span><br><span class="line">a = <span class="built_in">list</span>(a)</span><br><span class="line">x=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    a[i] ^= x ^ (i+<span class="number">1</span>)</span><br><span class="line">    x = a[i]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(a))</span><br><span class="line"><span class="comment"># flag&#123;6ad1c70c-daa4-11ec-9d64-0242ac1200&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="secreeeeet"><a href="#secreeeeet" class="headerlink" title="secreeeeet"></a>secreeeeet</h2><p>这类题在外国的ctf见过一次，就是通过加密算法生成图片文件，我们要做的就是解密png文件。代码很多但多数无用，找到主要代码就行</p>
<p>我们通过自己构造flag.png尝试加密，发现每次加密都不一样，可能跟随机数有关</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617155208038.png" alt="image-20220617155208038"></p>
<p>发现在main函数开头调用了Xtime_get_ticks获取时间戳，动态调试发现sub_140004940函数将时间戳从数字变为字符串</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617155639380.png" alt="image-20220617155639380"></p>
<p>找到主要加密处；这个地方有点逆天，不知道是啥东西，经查阅应该是rabbit流加密</p>
<p><img src="/2022/06/17/ciscnctf2022/image-20220617155754520.png" alt="image-20220617155754520"></p>
<p>借用REtard师傅的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line"># https://github.com/Robin-Pwner/Rabbit-Cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTL8(v, n):</span><br><span class="line">    return (((v &lt;&lt; n) &amp; 0xff) | ((v &gt;&gt; (8-n)) &amp; 0xff))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTL16(v, n):</span><br><span class="line">    return (((v &lt;&lt; n) &amp; 0xffff) | ((v &gt;&gt; (16-n)) &amp; 0xffff))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTL32(v, n):</span><br><span class="line">    return (((v &lt;&lt; n) &amp; 0xffffffff) | ((v &gt;&gt; (32-n)) &amp; 0xffffffff))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTL64(v, n):</span><br><span class="line">    return (((v &lt;&lt; n) &amp; 0xffffffffffffffff) | ((v &gt;&gt; (64-n)) &amp; 0xffffffffffffffff))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTR8(v, n):</span><br><span class="line">    return ROTL(V, 8-n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTR16(v, n):</span><br><span class="line">    return ROTL(V, 16-n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTR32(v, n):</span><br><span class="line">    return ROTL(V, 32-n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def ROTR64(v, n):</span><br><span class="line">    return ROTL(V, 64-n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def SWAP32(v):</span><br><span class="line">    return ((ROTL32(v, 8) &amp; 0x00ff00ff) | (ROTL32(v, 24) &amp; 0xff00ff00))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Rabbit_state(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.x = [0]*8</span><br><span class="line">        self.c = [0]*8</span><br><span class="line">        self.carry = 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Rabbit_ctx(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.m = Rabbit_state()</span><br><span class="line">        self.w = Rabbit_state()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Rabbit(object):</span><br><span class="line">    def __init__(self, key, iv):</span><br><span class="line">        self.ctx = Rabbit_ctx()</span><br><span class="line">        self.set_key(key)</span><br><span class="line">        if(len(iv)):</span><br><span class="line">            self.set_iv(iv)</span><br><span class="line"></span><br><span class="line">    def g_func(self, x):</span><br><span class="line">        x = x &amp; 0xffffffff</span><br><span class="line">        x = (x*x) &amp; 0xffffffffffffffff</span><br><span class="line">        result = (x &gt;&gt; 32) ^ (x &amp; 0xffffffff)</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    def set_key(self, key: bytes):</span><br><span class="line">        # generate four subkeys</span><br><span class="line">        key0, key1, key2, key3 = struct.unpack(&#x27;&lt;4I&#x27;, key)</span><br><span class="line">        s = self.ctx.m</span><br><span class="line">        # generate initial state variables</span><br><span class="line">        s.x[0] = key0</span><br><span class="line">        s.x[2] = key1</span><br><span class="line">        s.x[4] = key2</span><br><span class="line">        s.x[6] = key3</span><br><span class="line">        s.x[1] = ((key3 &lt;&lt; 16) &amp; 0xffffffff) | ((key2 &gt;&gt; 16) &amp; 0xffff)</span><br><span class="line">        s.x[3] = ((key0 &lt;&lt; 16) &amp; 0xffffffff) | ((key3 &gt;&gt; 16) &amp; 0xffff)</span><br><span class="line">        s.x[5] = ((key1 &lt;&lt; 16) &amp; 0xffffffff) | ((key0 &gt;&gt; 16) &amp; 0xffff)</span><br><span class="line">        s.x[7] = ((key2 &lt;&lt; 16) &amp; 0xffffffff) | ((key1 &gt;&gt; 16) &amp; 0xffff)</span><br><span class="line">        # generate initial counter values</span><br><span class="line">        s.c[0] = ROTL32(key2, 16)</span><br><span class="line">        s.c[2] = ROTL32(key3, 16)</span><br><span class="line">        s.c[4] = ROTL32(key0, 16)</span><br><span class="line">        s.c[6] = ROTL32(key1, 16)</span><br><span class="line">        s.c[1] = (key0 &amp; 0xffff0000) | (key1 &amp; 0xffff)</span><br><span class="line">        s.c[3] = (key1 &amp; 0xffff0000) | (key2 &amp; 0xffff)</span><br><span class="line">        s.c[5] = (key2 &amp; 0xffff0000) | (key3 &amp; 0xffff)</span><br><span class="line">        s.c[7] = (key3 &amp; 0xffff0000) | (key0 &amp; 0xffff)</span><br><span class="line">        s.carry = 0</span><br><span class="line"></span><br><span class="line">        # Iterate system four times</span><br><span class="line">        for i in range(4):</span><br><span class="line">            self.next_state(self.ctx.m)</span><br><span class="line"></span><br><span class="line">        for i in range(8):</span><br><span class="line">            # modify the counters</span><br><span class="line">            self.ctx.m.c[i] ^= self.ctx.m.x[(i+4) &amp; 7]</span><br><span class="line"></span><br><span class="line">        # Copy master instance to work instance</span><br><span class="line">        self.ctx.w = self.copy_state(self.ctx.m)</span><br><span class="line"></span><br><span class="line">    def copy_state(self, state):</span><br><span class="line">        n = Rabbit_state()</span><br><span class="line">        n.carry = state.carry</span><br><span class="line"></span><br><span class="line">        for i, j in enumerate(state.x):</span><br><span class="line">            n.x[i] = j</span><br><span class="line">        for i, j in enumerate(state.c):</span><br><span class="line">            n.c[i] = j</span><br><span class="line">        return n</span><br><span class="line"></span><br><span class="line">    def set_iv(self, iv: bytes):</span><br><span class="line">        # generate four subvectors</span><br><span class="line">        v = [0]*4</span><br><span class="line">        v[0], v[2] = struct.unpack(&#x27;&lt;2I&#x27;, iv)</span><br><span class="line">        v[1] = (v[0] &gt;&gt; 16) | (v[2] &amp; 0xffff0000)</span><br><span class="line">        v[3] = ((v[2] &lt;&lt; 16) | (v[0] &amp; 0x0000ffff)) &amp; 0xffffffff</span><br><span class="line">        # Modify work&#x27;s counter values</span><br><span class="line">        for i in range(8):</span><br><span class="line">            self.ctx.w.c[i] = self.ctx.m.c[i] ^ v[i &amp; 3]</span><br><span class="line">        # Copy state variables but not carry flag</span><br><span class="line">        tmp = []</span><br><span class="line"></span><br><span class="line">        for cc in self.ctx.m.x:</span><br><span class="line">            tmp += [cc]</span><br><span class="line">        self.ctx.w.x = tmp</span><br><span class="line"></span><br><span class="line">        # Iterate system four times</span><br><span class="line">        for i in range(4):</span><br><span class="line">            self.next_state(self.ctx.w)</span><br><span class="line"></span><br><span class="line">    def next_state(self, state):</span><br><span class="line">        g = [0]*8</span><br><span class="line">        x = [0x4D34D34D, 0xD34D34D3, 0x34D34D34]</span><br><span class="line">        # calculate new counter values</span><br><span class="line">        for i in range(8):</span><br><span class="line">            tmp = state.c[i]</span><br><span class="line">            state.c[i] = (state.c[i]+x[i % 3]+state.carry) &amp; 0xffffffff</span><br><span class="line">            state.carry = (state.c[i] &lt; tmp)</span><br><span class="line">        # calculate the g-values</span><br><span class="line">        for i in range(8):</span><br><span class="line">            g[i] = self.g_func(state.x[i]+state.c[i])</span><br><span class="line">        # calculate new state values</span><br><span class="line"></span><br><span class="line">        j = 7</span><br><span class="line">        i = 0</span><br><span class="line">        while(i &lt; 8):</span><br><span class="line">            state.x[i] = (g[i] + ROTL32(g[j], 16) +</span><br><span class="line">                          ROTL32(g[j-1], 16)) &amp; 0xffffffff</span><br><span class="line">            i += 1</span><br><span class="line">            j += 1</span><br><span class="line">            state.x[i] = (g[i] + ROTL32(g[j &amp; 7], 8) + g[j-1]) &amp; 0xffffffff</span><br><span class="line">            i += 1</span><br><span class="line">            j += 1</span><br><span class="line">            j &amp;= 7</span><br><span class="line"></span><br><span class="line">    def crypt(self, msg):</span><br><span class="line">        plain = b&quot;&quot;</span><br><span class="line">        l = len(msg)</span><br><span class="line">        c = self.ctx</span><br><span class="line">        x = [0]*4</span><br><span class="line">        start = 0</span><br><span class="line">        while(True):</span><br><span class="line">            self.next_state(c.w)</span><br><span class="line">            for i in range(4):</span><br><span class="line">                x[i] = c.w.x[i &lt;&lt; 1]</span><br><span class="line">            x[0] ^= (c.w.x[5] &gt;&gt; 16) ^ (c.w.x[3] &lt;&lt; 16)</span><br><span class="line">            x[1] ^= (c.w.x[7] &gt;&gt; 16) ^ (c.w.x[5] &lt;&lt; 16)</span><br><span class="line">            x[2] ^= (c.w.x[1] &gt;&gt; 16) ^ (c.w.x[7] &lt;&lt; 16)</span><br><span class="line">            x[3] ^= (c.w.x[3] &gt;&gt; 16) ^ (c.w.x[1] &lt;&lt; 16)</span><br><span class="line">            b = [0]*16</span><br><span class="line">            for i, j in enumerate(x):</span><br><span class="line">                for z in range(4):</span><br><span class="line">                    b[z+4*i] = 0xff &amp; (j &gt;&gt; (8*z))</span><br><span class="line">            for i in range(16):</span><br><span class="line">                plain += bytes([(msg[start]) ^ b[i]])</span><br><span class="line">                start += 1</span><br><span class="line">                if(start == l):</span><br><span class="line">                    return plain</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>py3版本的rabbit</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rabbit_cipher <span class="keyword">import</span> Rabbit</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_subs</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">return</span> key.translate(<span class="string">b&#x27;&#x27;</span>.maketrans(<span class="string">b&#x27;0123456789&#x27;</span>, <span class="string">b&#x27;qscfthnjik&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_expand</span>(<span class="params">key</span>):</span><br><span class="line">    expand = <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(key):</span><br><span class="line">            expand[i] = key[i]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            expand[i] = (expand[i - <span class="number">1</span>] + expand[i - <span class="number">2</span>]) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(expand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_crypt</span>(<span class="params">msg, key</span>):</span><br><span class="line">    <span class="keyword">return</span> Rabbit(key_expand(key_subs(key)), <span class="string">b&#x27;\x01\x02\x03\x04\x05\x06\x07\x08&#x27;</span>).crypt(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(<span class="params"><span class="number">100000</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_crypt_lru</span>(<span class="params">msg, key</span>):</span><br><span class="line">    <span class="keyword">return</span> secret_crypt(msg, key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">data, key</span>):</span><br><span class="line">    data = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        data[i] ^= key[i % <span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bruteforce_key</span>(<span class="params">enc_msg</span>):</span><br><span class="line">    png_fixed_header = <span class="string">b&#x27;\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> k3 <span class="keyword">in</span> product(string.digits, repeat=<span class="number">3</span>):</span><br><span class="line">        key3 = <span class="string">&#x27;&#x27;</span>.join(k3).encode()</span><br><span class="line">        <span class="keyword">for</span> k5 <span class="keyword">in</span> product(string.digits, repeat=<span class="number">5</span>):</span><br><span class="line">            key5 = <span class="string">&#x27;&#x27;</span>.join(k5).encode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\rprocess&#x27;</span>, key3, key5, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> xor(secret_crypt_lru(enc_msg, key5), key3) == png_fixed_header:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> (key3, key5)</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;not found&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag_png_enc = <span class="built_in">open</span>(<span class="string">&#x27;flag.png.enc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">key3, key5 = bruteforce_key(flag_png_enc[:<span class="number">0x10</span>]) <span class="comment"># (2, 80106)</span></span><br><span class="line">flag_png = xor(secret_crypt_lru(flag_png_enc, key5), key3)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;flag.png&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>).write(flag_png)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只需要爆破两个key然后逆向rabbit即可</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/04/17/starCTF2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/17/starCTF2022/" class="post-title-link" itemprop="url">XCTF2022</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-17 22:20:45" itemprop="dateCreated datePublished" datetime="2022-04-17T22:20:45+08:00">2022-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:52:53" itemprop="dateModified" datetime="2022-07-18T00:52:53+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CTF"><a href="#CTF" class="headerlink" title="*CTF"></a>*CTF</h1><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="Simple-File-System"><a href="#Simple-File-System" class="headerlink" title="Simple File System"></a><strong>Simple File System</strong></h3><p>给了一个file文件，一个png文件，一个elf文件</p>
<p>我们对elf文件进行分析</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_5615516A1488</span><span class="params">(<span class="type">int</span> a1, <span class="type">const</span> <span class="type">char</span> **a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v4; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> *v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp-38h] [rbp-1048h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp-34h] [rbp-1044h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp-30h] [rbp-1040h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp-2Ch] [rbp-103Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v14; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v17; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v19; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v20; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v21; <span class="comment">// [rsp-28h] [rbp-1038h]</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [rsp-24h] [rbp-1034h]</span></span><br><span class="line">  <span class="type">int</span> v23; <span class="comment">// [rsp-20h] [rbp-1030h]</span></span><br><span class="line">  <span class="type">time_t</span> v24; <span class="comment">// [rsp-18h] [rbp-1028h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v25[<span class="number">16</span>]; <span class="comment">// [rsp-10h] [rbp-1020h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v26[<span class="number">1024</span>]; <span class="comment">// [rsp+3F0h] [rbp-C20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v27[<span class="number">1024</span>]; <span class="comment">// [rsp+7F0h] [rbp-820h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v28[<span class="number">1032</span>]; <span class="comment">// [rsp+BF0h] [rbp-420h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v29; <span class="comment">// [rsp+FF8h] [rbp-18h]</span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp+1000h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v30 = v2;</span><br><span class="line">  v29 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;use: %s &lt;diskfile&gt; &lt;nblocks&gt;\n&quot;</span>, *a2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = (<span class="type">unsigned</span> <span class="type">int</span>)atoi(a2[<span class="number">2</span>]);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A3BEC(a2[<span class="number">1</span>], v4) )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = __errno_location();</span><br><span class="line">    v6 = strerror(*v5);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;couldn&#x27;t initialize %s: %s\n&quot;</span>, a2[<span class="number">1</span>], v6);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = sub_5615516A3C9E();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;opened emulated disk image %s with %d blocks\n&quot;</span>, a2[<span class="number">1</span>], v7);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; simplefs&gt; &quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !fgets(v25, <span class="number">1024</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v25[<span class="number">0</span>] != <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v25[<span class="built_in">strlen</span>(v25) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      v12 = __isoc99_sscanf(v25, <span class="string">&quot;%s %s %s&quot;</span>, v26, v27, v28);</span><br><span class="line">      <span class="keyword">if</span> ( v12 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;format&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A2357() )</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;disk formatted.&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;format failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: format&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;mount&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A27C2() )</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;disk mounted.&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;mount failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: mount&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;debug&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">1</span> )</span><br><span class="line">            sub_5615516A24BB();</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: debug&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;getsize&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v14 = atoi(v27);</span><br><span class="line">            v13 = sub_5615516A3014(v14);</span><br><span class="line">            <span class="keyword">if</span> ( v13 &lt; <span class="number">0</span> )</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;getsize failed!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;inode %d has size %d\n&quot;</span>, v14, (<span class="type">unsigned</span> <span class="type">int</span>)v13);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: getsize &lt;inumber&gt;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;create&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">1</span> )</span><br><span class="line">            sub_5615516A216A();</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: create&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;delete&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v15 = atoi(v27);</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A2DD1(v15) )</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;inode %d deleted.\n&quot;</span>, v15);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;delete failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: delete &lt;inumber&gt;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;cat&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">2</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v16 = atoi(v27);</span><br><span class="line">            <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A2017(v16, <span class="string">&quot;/dev/stdout&quot;</span>) )</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;cat failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: cat &lt;inumber&gt;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;captureflag&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Are you kidding?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;plantflag&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          v8 = time(&amp;v24);</span><br><span class="line">          srand(v8);</span><br><span class="line">          v22 = rand() % <span class="number">100</span>;</span><br><span class="line">          v23 = rand() % <span class="number">100</span>;</span><br><span class="line">          <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v22; ++i )</span><br><span class="line">          &#123;</span><br><span class="line">            v17 = sub_5615516A216A();</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A1E16(<span class="string">&quot;flag&quot;</span>, v17, <span class="number">2</span>) )<span class="comment">//在这</span></span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;copied file %s to inode %d\n&quot;</span>, v27, v17);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;copy failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          v18 = sub_5615516A216A();</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A1E16(<span class="string">&quot;flag&quot;</span>, v18, <span class="number">1</span>) )</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;plant flag to inode %d!\n&quot;</span>, v18);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;copy failed!&quot;</span>);</span><br><span class="line">          <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v23; ++j )</span><br><span class="line">          &#123;</span><br><span class="line">            v19 = sub_5615516A216A();</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A1E16(<span class="string">&quot;flag&quot;</span>, v19, <span class="number">2</span>) )</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;copied file %s to inode %d\n&quot;</span>, v27, v19);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;copy failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;copyin&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">3</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v20 = atoi(v28);</span><br><span class="line">            <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A1E16(v27, v20, <span class="number">0</span>) )</span><br><span class="line">              <span class="keyword">goto</span> LABEL_69;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;copied file %s to inode %d\n&quot;</span>, v27, v20);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: copyin &lt;filename&gt; &lt;inumber&gt;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;copyout&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12 == <span class="number">3</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v21 = atoi(v27);</span><br><span class="line">            <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_5615516A2017(v21, v28) )</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;copied inode %d to file %s\n&quot;</span>, v21, v28);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">LABEL_69:</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;copy failed!&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;use: copyout &lt;inumber&gt; &lt;filename&gt;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;help&quot;</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Commands are:&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    format&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    mount&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    debug&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    create&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    delete  &lt;inode&gt;&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    cat     &lt;inode&gt;&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    captureflag&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    plantflag&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    copyin  &lt;file&gt; &lt;inode&gt;&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    copyout &lt;inode&gt; &lt;file&gt;&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    help&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    quit&quot;</span>);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;    exit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;quit&quot;</span>) || !<span class="built_in">strcmp</span>(v26, <span class="string">&quot;exit&quot;</span>) )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;unknown command: %s\n&quot;</span>, v26);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;type &#x27;help&#x27; for a list of commands.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;closing emulated disk.&quot;</span>);</span><br><span class="line">  sub_5615516A3E6B();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实就是跟一个终端一样，我们发现还有一个记事本，记录了一些操作：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># instructions</span><br><span class="line"></span><br><span class="line">I implemented a very simple file system and buried my flag in it.</span><br><span class="line"></span><br><span class="line">The image file are initiated as follows: </span><br><span class="line">./simplefs image.flag 500</span><br><span class="line"> simplefs&gt; format</span><br><span class="line"> simplefs&gt; mount</span><br><span class="line"> simplefs&gt; plantflag</span><br><span class="line"> simplefs&gt; exit</span><br><span class="line"></span><br><span class="line">And you cold run &quot;help&quot; to explore other commands.</span><br></pre></td></tr></table></figure>

<p>那么我们很自然的怀疑到plantflag里有东西，我们查看一下，定位到关键函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad sp value at call has been detected, the output may be wrong!</span></span><br><span class="line">__int64 __fastcall <span class="title function_">sub_5615516A1E16</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [rsp+1Ch] [rbp-4024h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [rsp+20h] [rbp-4020h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+24h] [rbp-401Ch]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-4018h]</span></span><br><span class="line">  <span class="type">char</span> ptr[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-4010h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [rsp+40h] [rbp-4000h] BYREF</span></span><br><span class="line">  __int64 v13[<span class="number">512</span>]; <span class="comment">// [rsp+3040h] [rbp-1000h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( v13 != (__int64 *)&amp;v12 )</span><br><span class="line">    ;</span><br><span class="line">  v13[<span class="number">511</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  stream = fopen(a1, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = fread(ptr, <span class="number">1uLL</span>, <span class="number">0x4000</span>uLL, stream);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">int</span>)v8 &lt;= <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">if</span> ( a3 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_5615516A21B2(ptr, v8);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( a3 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_5615516A2305(ptr, v8);</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = sub_5615516A3585(a2, ptr, v8, v7);</span><br><span class="line">      <span class="keyword">if</span> ( v9 &lt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;ERROR: fs_write return invalid result %d\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v9);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v7 += v9;</span><br><span class="line">      <span class="keyword">if</span> ( v9 != v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;WARNING: fs_write only wrote %d bytes, not %d bytes\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v9, v8);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d bytes copied\n&quot;</span>, v7);</span><br><span class="line">    fclose(stream);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = __errno_location();</span><br><span class="line">    v4 = strerror(*v3);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;couldn&#x27;t open %s: %s\n&quot;</span>, a1, v4);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个函数一个函数看，发现a3 &#x3D; 1时，里面的函数可逆，我们查看一下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_5615516A21B2</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  _BYTE *v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = sub_5615516A30A3();</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (_BYTE *)(i + a1);</span><br><span class="line">    *v5 = (*v5 &gt;&gt; <span class="number">1</span>) | (*v5 &lt;&lt; <span class="number">7</span>);</span><br><span class="line">    *v5 ^= v4;</span><br><span class="line">    *v5 = ((<span class="type">unsigned</span> __int8)*v5 &gt;&gt; <span class="number">2</span>) | (*v5 &lt;&lt; <span class="number">6</span>);</span><br><span class="line">    *v5 ^= BYTE1(v4);</span><br><span class="line">    *v5 = ((<span class="type">unsigned</span> __int8)*v5 &gt;&gt; <span class="number">3</span>) | (<span class="number">32</span> * *v5);</span><br><span class="line">    *v5 ^= BYTE2(v4);</span><br><span class="line">    *v5 = ((<span class="type">unsigned</span> __int8)*v5 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * *v5);</span><br><span class="line">    *v5 ^= HIBYTE(v4);</span><br><span class="line">    *v5 = (*v5 &gt;&gt; <span class="number">5</span>) | (<span class="number">8</span> * *v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在有几个问题是，没找到原来的数据或者对比的数据，（这个数据哦经过我的调试应该是从图片的文件中读取的）还不知道v4是啥，v4这个值的函数太恶心了，所以我们动调一下，把所有文件都扔到目录下：</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220418233932982.png" alt="image-20220418233932982"></p>
<p>先输入：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./simplefs image.flag <span class="number">500</span></span><br></pre></td></tr></table></figure>

<p>然后进行attach一下，程序就动起来了，最好在sub_5615516A21B2函数进行断点。</p>
<p>然后按照指示的命令调下去，然后点F9，进入断点</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220418234244165.png" alt="image-20220418234244165"></p>
<p>调试出v4的值，然后我们其中能动调出v5的每个值，前三个0x00和0xD2和0xFC，那么我们直接去flag图片里找就行了，当然我们可以直接动态调试出原来的flag，可以不用写脚本。</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220418235157590.png" alt="image-20220418235157590"></p>
<p>当然还是写一下逆向的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x00</span>,<span class="number">0xD2</span>,<span class="number">0xFC</span>,<span class="number">0xD8</span>,<span class="number">0xA2</span>,<span class="number">0xDA</span>,<span class="number">0xBA</span>,<span class="number">0x9E</span>,<span class="number">0x9C</span>,<span class="number">0x26</span>,<span class="number">0xF8</span>,<span class="number">0xF6</span>,<span class="number">0xB4</span>,<span class="number">0xCE</span>,<span class="number">0x3C</span>,<span class="number">0xCC</span>,<span class="number">0x96</span>,<span class="number">0x88</span>,<span class="number">0x98</span>,<span class="number">0x34</span>,<span class="number">0x82</span>,<span class="number">0xDE</span>,<span class="number">0x80</span>,<span class="number">0x36</span>,<span class="number">0x8a</span>,<span class="number">0xd8</span>,<span class="number">0xc0</span>,<span class="number">0xf0</span>,<span class="number">0x38</span>,<span class="number">0xae</span>,<span class="number">0x40</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    v1 = a[i]</span><br><span class="line">    v1 = ((v1&lt;&lt; <span class="number">5</span>) | (v1 &gt;&gt; <span class="number">3</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    v1 ^= <span class="number">0xde</span></span><br><span class="line">    v1 = ((v1 &lt;&lt; <span class="number">4</span>) | (v1 &gt;&gt; <span class="number">4</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    v1 ^= <span class="number">0xed</span></span><br><span class="line">    v1 = ((v1 &lt;&lt; <span class="number">3</span>) | (v1 &gt;&gt; <span class="number">5</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    v1 ^= <span class="number">0xbe</span></span><br><span class="line">    v1 = ((v1 &lt;&lt; <span class="number">2</span>) | (v1 &gt;&gt; <span class="number">6</span>))&amp;<span class="number">0xff</span></span><br><span class="line">    v1 ^= <span class="number">0xef</span></span><br><span class="line">    v1 = ((v1 &lt;&lt; <span class="number">1</span>) | (v1 &gt;&gt; <span class="number">7</span>))&amp;<span class="number">0xff</span> </span><br><span class="line">    flag += <span class="built_in">chr</span>(v1)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#*CTF&#123;Gwed9VQpM4Lanf0kEj1oFJR6&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="NaCl"><a href="#NaCl" class="headerlink" title="NaCl"></a>NaCl</h3><p>这个题看一早上，汇编没学好，出不来，近些天上课正在看汇编，等我汇编看的差不多了，就开始整一下这个题的汇编。</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220421184638338.png" alt="image-20220421184638338"></p>
<p>函数逻辑很清晰，但这个函数里的内容就不敢苟同了，很杂很乱：</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220421184911788.png" alt="image-20220421184911788"></p>
<p>我只能说不太好看懂，经过动态调试后，发现其到38行后进入下面的汇编：</p>
<p><img src="/2022/04/17/starCTF2022/../../blog/source/_posts/xctf2022/image-20220419151306919.png" alt="image-20220419151306919"></p>
<p>然后会进入一个巨大的循环，里面进行着加密，经过43次循环后，进入下一个汇编，这个汇编是xtea加密，这个xtea改了两处，第一是循环轮次，第二是delta。</p>
<p>参考了PZ师傅的解题思路，我们可以采用idapython去掉花指令的方法来生成可视的代码，从而避免看汇编。</p>
<p>不能反汇编的原因是因为，在这些汇编的后面是很奇怪的，他们有着统一的格式</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">nop</span></span><br><span class="line"><span class="keyword">lea</span>    <span class="built_in">r15</span>，   [<span class="built_in">r15</span>+<span class="number">8</span>]</span><br><span class="line"><span class="keyword">mov</span>    <span class="built_in">edi</span>,    [<span class="built_in">r15</span>-<span class="number">8</span>]</span><br><span class="line"><span class="keyword">and</span>    <span class="built_in">edi</span>,    0xffffffe0h</span><br><span class="line"><span class="keyword">lea</span>    <span class="built_in">rdi</span>,    [<span class="built_in">r13</span>+<span class="built_in">rdi</span>+<span class="number">0</span>]</span><br><span class="line"><span class="keyword">jmp</span>    <span class="built_in">rdi</span></span><br><span class="line">其实这样看来，很像是<span class="keyword">retn</span>的做法，而这些指令的操作对象全部是堆栈,通过调试发现，<span class="built_in">r13</span>一直为<span class="number">0</span>，<span class="built_in">r15</span>的操作像是栈的储存，即这个是用<span class="built_in">r15</span>表示<span class="built_in">rsp</span>，<span class="built_in">r14</span>代表<span class="built_in">rbp</span>，</span><br></pre></td></tr></table></figure>

<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">还有地方似乎更像是<span class="keyword">call</span>指令</span><br><span class="line"><span class="keyword">nop</span></span><br><span class="line"><span class="keyword">lea</span>    <span class="built_in">r15</span>,     [<span class="built_in">r15</span>-<span class="number">8</span>]</span><br><span class="line"><span class="keyword">lea</span>    <span class="built_in">r12</span>,     loc_8080980</span><br><span class="line"><span class="keyword">mov</span>    [<span class="built_in">r15</span>],   <span class="built_in">r12</span></span><br><span class="line"><span class="keyword">jmp</span>    loc_8080720</span><br><span class="line">其实这个就是要跳转到那个函数</span><br></pre></td></tr></table></figure>

<p>那么我们要用idapython修改的地方已经出来了，我们只需要将像上面第一个的改成retn，第二个改成call指令就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line">start = <span class="number">0x807FEC0</span></span><br><span class="line">end = <span class="number">0x8080AD1</span></span><br><span class="line"></span><br><span class="line">address = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">callTarget = [<span class="string">&quot;lea&quot;</span>, <span class="string">&quot;lea&quot;</span>, <span class="string">&quot;mov&quot;</span>, <span class="string">&quot;jmp&quot;</span>]</span><br><span class="line">retnTarget = [<span class="string">&quot;lea&quot;</span>, <span class="string">&quot;mov&quot;</span>, <span class="string">&quot;and&quot;</span>, <span class="string">&quot;lea&quot;</span>, <span class="string">&quot;jmp&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nop</span>(<span class="params">s, e</span>):</span><br><span class="line">	<span class="keyword">while</span> (s &lt; e):</span><br><span class="line">		patch_byte(s, <span class="number">0x90</span>)</span><br><span class="line">		s += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turnCall</span>(<span class="params">s, e</span>):</span><br><span class="line">	nop(s, e)</span><br><span class="line">	patch_byte(e, <span class="number">0xE8</span>)</span><br><span class="line">	huaStart = next_head(e)</span><br><span class="line">	huaEnd = next_head(huaStart)</span><br><span class="line">	nop(huaStart, huaEnd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turnRetn</span>(<span class="params">s, e</span>):</span><br><span class="line">	nop(s, e)</span><br><span class="line">	patch_byte(e, <span class="number">0x90</span>)</span><br><span class="line">	patch_byte(e + <span class="number">1</span>, <span class="number">0xC3</span>)</span><br><span class="line"></span><br><span class="line">p = start</span><br><span class="line"><span class="keyword">while</span> p &lt; end:</span><br><span class="line">	address[<span class="number">0</span>] = p</span><br><span class="line">	address[<span class="number">1</span>] = next_head(p)<span class="comment">#下一个指令</span></span><br><span class="line">	address[<span class="number">2</span>] = next_head(address[<span class="number">1</span>])</span><br><span class="line">	address[<span class="number">3</span>] = next_head(address[<span class="number">2</span>])</span><br><span class="line">	address[<span class="number">4</span>] = next_head(address[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">		<span class="keyword">if</span> print_insn_mnem(address[i]) != callTarget[i]:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		turnCall(address[<span class="number">0</span>], address[<span class="number">3</span>])</span><br><span class="line">		p = next_head(next_head(address[<span class="number">3</span>]))</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">		<span class="keyword">if</span> print_insn_mnem(address[i]) != retnTarget[i]:</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		turnRetn(address[<span class="number">0</span>], address[<span class="number">4</span>])</span><br><span class="line">		p = next_head(next_head(address[<span class="number">4</span>]))</span><br><span class="line">		<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">	p = next_head(p)</span><br></pre></td></tr></table></figure>

<p>然后我们点edit–patch program–最后一项，重进ida刷新，就会发现进入一片有反汇编的世界！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_8080900</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// er15</span></span><br><span class="line">  struct_v3 *v3; <span class="comment">// r15</span></span><br><span class="line"></span><br><span class="line">  v3 = (struct_v3 *)(v1 + (<span class="type">unsigned</span> <span class="type">int</span>)(v2 - <span class="number">40</span>));</span><br><span class="line">  v3-&gt;input = a1;</span><br><span class="line">  v3-&gt;count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( v3-&gt;count = <span class="number">0</span>; v3-&gt;count &lt;= <span class="number">3</span>; ++v3-&gt;count )</span><br><span class="line">  &#123;</span><br><span class="line">    v3-&gt;t = <span class="number">8</span> * v3-&gt;count + v3-&gt;input;<span class="comment">//取8位，flag长32位</span></span><br><span class="line">    v3-&gt;qword10 = sub_8080720(v3-&gt;t);<span class="comment">//第一个加密</span></span><br><span class="line">    sub_8080100(<span class="number">1</span> &lt;&lt; (LOBYTE(v3-&gt;count) + <span class="number">1</span>), (__int64)&amp;v3-&gt;qword10);<span class="comment">// 循环轮次2，4，8，16</span></span><br><span class="line">    sub_807FEC0((<span class="type">char</span> *)&amp;unk_80AFC80 + <span class="number">8</span> * v3-&gt;count, &amp;v3-&gt;qword10, <span class="number">8LL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_807FF20(&amp;byte_80AFC60, &amp;unk_80AFC80, <span class="number">32LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">4096LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我学习到了比如像*(v3+36),*(v3+18),这样的，我们其实可以将其定义成一个结构体右键–creat new struct即可。</p>
<p>先进入第一个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_8080720</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v2; <span class="comment">// r13</span></span><br><span class="line">  __int64 v3; <span class="comment">// r15</span></span><br><span class="line">  _QWORD *v4; <span class="comment">// r15</span></span><br><span class="line">  struct_v5 *v5; <span class="comment">// r15</span></span><br><span class="line"></span><br><span class="line">  v4 = (_QWORD *)(v3 - <span class="number">8</span>);</span><br><span class="line">  *v4 = v1;</span><br><span class="line">  v5 = (struct_v5 *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)((_DWORD)v4 - <span class="number">56</span>));</span><br><span class="line">  v5-&gt;qword0 = a1;</span><br><span class="line">  v5-&gt;xorkey = sub_8080360();</span><br><span class="line">  v5-&gt;qword18 = *(_QWORD *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)v5-&gt;qword0);</span><br><span class="line">  v5-&gt;HIGHER = little(HIDWORD(v5-&gt;qword18));    <span class="comment">// 小端序</span></span><br><span class="line">  v5-&gt;LOWER = little(v5-&gt;qword18);</span><br><span class="line">  <span class="keyword">for</span> ( v5-&gt;int2C = <span class="number">0</span>; v5-&gt;int2C &lt;= <span class="number">43</span>; ++v5-&gt;int2C )</span><br><span class="line">  &#123;</span><br><span class="line">    v5-&gt;dword14 = v5-&gt;LOWER;</span><br><span class="line">    ROL(v5-&gt;LOWER, <span class="number">1</span>);</span><br><span class="line">    ROL(v5-&gt;LOWER, <span class="number">8</span>);</span><br><span class="line">    v5-&gt;LOWER = v5-&gt;HIGHER ^ ROL(v5-&gt;LOWER, <span class="number">2</span>) ^ *(_DWORD *)(v2 + <span class="number">4</span> * v5-&gt;int2C + (<span class="type">unsigned</span> <span class="type">int</span>)v5-&gt;xorkey);</span><br><span class="line">    v5-&gt;HIGHER = v5-&gt;dword14;</span><br><span class="line">  &#125;</span><br><span class="line">  v5-&gt;qword18 = <span class="number">0LL</span>;</span><br><span class="line">  v5-&gt;qword18 = ((v5-&gt;qword18 | v5-&gt;LOWER) &lt;&lt; <span class="number">32</span>) | v5-&gt;HIGHER;</span><br><span class="line">  <span class="keyword">return</span> v5-&gt;qword18;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是先将8个字节又分为2组，每组4字节并将其倒置，然后对其低位左移，然后进行异或，这个异或很复杂，我们可以通过动调把xorkey调试出来。然后再看第二个加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_8080100</span><span class="params">(<span class="type">int</span> a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// r13</span></span><br><span class="line">  mylist *v3; <span class="comment">// r15</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3[<span class="number">-1</span>].count = a1;</span><br><span class="line">  *(_QWORD *)&amp;v3[<span class="number">-1</span>].t0 = a2;</span><br><span class="line">  *(_QWORD *)&amp;v3[<span class="number">-1</span>].t6 = &amp;dword_80AFB40;       <span class="comment">// key</span></span><br><span class="line">  v3[<span class="number">-1</span>].t10 = *(_DWORD *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t0);</span><br><span class="line">  v3[<span class="number">-1</span>].t9 = *(_DWORD *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t0 + <span class="number">4</span>);</span><br><span class="line">  v3[<span class="number">-1</span>].t8 = <span class="number">0</span>;</span><br><span class="line">  v3[<span class="number">-1</span>].t5 = <span class="number">271733878</span>;                        <span class="comment">// delata</span></span><br><span class="line">  <span class="keyword">for</span> ( v3[<span class="number">-1</span>].t11 = <span class="number">0</span>; v3[<span class="number">-1</span>].t11 &lt; (<span class="type">unsigned</span> <span class="type">int</span>)v3[<span class="number">-1</span>].count; ++v3[<span class="number">-1</span>].t11 )</span><br><span class="line">  &#123;</span><br><span class="line">    v3[<span class="number">-1</span>].t10 += ((((<span class="type">unsigned</span> <span class="type">int</span>)v3[<span class="number">-1</span>].t9 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v3[<span class="number">-1</span>].t9)) + v3[<span class="number">-1</span>].t9) ^ (*(_DWORD *)(v2</span><br><span class="line">                                                                                                 + <span class="number">4</span> * (v3[<span class="number">-1</span>].t8 &amp; <span class="number">3</span>)</span><br><span class="line">                                                                                                 + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t6)</span><br><span class="line">                                                                                     + v3[<span class="number">-1</span>].t8);</span><br><span class="line">    v3[<span class="number">-1</span>].t8 += v3[<span class="number">-1</span>].t5;</span><br><span class="line">    v3[<span class="number">-1</span>].t9 += ((((<span class="type">unsigned</span> <span class="type">int</span>)v3[<span class="number">-1</span>].t10 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v3[<span class="number">-1</span>].t10)) + v3[<span class="number">-1</span>].t10) ^ (*(_DWORD *)(v2 + <span class="number">4</span> * (((<span class="type">unsigned</span> <span class="type">int</span>)v3[<span class="number">-1</span>].t8 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>) + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t6)</span><br><span class="line">                                                                                       + v3[<span class="number">-1</span>].t8);</span><br><span class="line">  &#125;</span><br><span class="line">  *(_DWORD *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t0) = v3[<span class="number">-1</span>].t10;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)v3[<span class="number">-1</span>].t9;</span><br><span class="line">  *(_DWORD *)(v2 + (<span class="type">unsigned</span> <span class="type">int</span>)*(_QWORD *)&amp;v3[<span class="number">-1</span>].t0 + <span class="number">4</span>) = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中我们还是可以通过右键–convert to struct把v3转换成内含12个int的结构体，不难发现这是个xtea加密，传入参数第一个是循环轮次，这个轮次是2，4，8，16，delta变化了，所以逻辑理清了，就把脚本搞出来：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHL(x, n) ( ((x) &amp; 0xFFFFFFFF) &lt;&lt; n )</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROTL(x, n) ( SHL((x), n) | ((x) &gt;&gt; (32 - n)) )</span></span><br><span class="line">  </span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> xorKey[<span class="number">44</span>] = &#123;</span><br><span class="line">      <span class="number">0x04050607</span>, <span class="number">0x00010203</span>, <span class="number">0x0C0D0E0F</span>, <span class="number">0x08090A0B</span>, <span class="number">0xCD3FE81B</span>, <span class="number">0xD7C45477</span>, <span class="number">0x9F3E9236</span>, <span class="number">0x0107F187</span>, </span><br><span class="line">      <span class="number">0xF993CB81</span>, <span class="number">0xBF74166C</span>, <span class="number">0xDA198427</span>, <span class="number">0x1A05ABFF</span>, <span class="number">0x9307E5E4</span>, <span class="number">0xCB8B0E45</span>, <span class="number">0x306DF7F5</span>, <span class="number">0xAD300197</span>, </span><br><span class="line">      <span class="number">0xAA86B056</span>, <span class="number">0x449263BA</span>, <span class="number">0x3FA4401B</span>, <span class="number">0x1E41F917</span>, <span class="number">0xC6CB1E7D</span>, <span class="number">0x18EB0D7A</span>, <span class="number">0xD4EC4800</span>, <span class="number">0xB486F92B</span>, </span><br><span class="line">      <span class="number">0x8737F9F3</span>, <span class="number">0x765E3D25</span>, <span class="number">0xDB3D3537</span>, <span class="number">0xEE44552B</span>, <span class="number">0x11D0C94C</span>, <span class="number">0x9B605BCB</span>, <span class="number">0x903B98B3</span>, <span class="number">0x24C2EEA3</span>, </span><br><span class="line">      <span class="number">0x896E10A2</span>, <span class="number">0x2247F0C0</span>, <span class="number">0xB84E5CAA</span>, <span class="number">0x8D2C04F0</span>, <span class="number">0x3BC7842C</span>, <span class="number">0x1A50D606</span>, <span class="number">0x49A1917C</span>, <span class="number">0x7E1CB50C</span>, </span><br><span class="line">      <span class="number">0xFC27B826</span>, <span class="number">0x5FDDDFBC</span>, <span class="number">0xDE0FC404</span>, <span class="number">0xB2B30907</span></span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">      <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">      <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], delta = <span class="number">0x10325476</span>, sum=delta*num_rounds;</span><br><span class="line">      <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">          v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">          sum -= delta;</span><br><span class="line">          v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[(sum &amp; <span class="number">3</span>)]);</span><br><span class="line">        &#125;</span><br><span class="line">        v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">XorRol</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">  	<span class="type">uint32_t</span> encLow = v[<span class="number">1</span>];</span><br><span class="line">  	<span class="type">uint32_t</span> encHigh = v[<span class="number">0</span>];</span><br><span class="line">  	<span class="type">uint32_t</span> orgLow, orgHigh, v6, v7, v8;</span><br><span class="line">  	<span class="type">int</span> i;	</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">for</span> ( i = <span class="number">43</span>; i &gt;= <span class="number">0</span>; i-- )</span><br><span class="line">  	&#123;</span><br><span class="line">  		orgLow = encHigh;</span><br><span class="line">  		v6 = ROTL(orgLow, <span class="number">1</span>);</span><br><span class="line">  		v7 = ROTL(orgLow, <span class="number">8</span>) &amp; v6;</span><br><span class="line">  		v8 = v7 ^ ROTL(orgLow, <span class="number">2</span>);</span><br><span class="line">  		orgHigh = encLow ^ xorKey[i] ^ v8;</span><br><span class="line">  		</span><br><span class="line">  		encHigh = orgHigh;</span><br><span class="line">  		encLow = orgLow;</span><br><span class="line">  	&#125;</span><br><span class="line">  	v[<span class="number">0</span>] = orgLow; v[<span class="number">1</span>] = orgHigh;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[] = &#123; <span class="number">0xFDF5C266</span>, <span class="number">0x7A328286</span>, <span class="number">0xCE944004</span>, <span class="number">0x5DE08ADC</span>, <span class="number">0xA6E4BD0A</span>, <span class="number">0x16CAADDC</span>, <span class="number">0x13CD6F0C</span>, <span class="number">0x1A75D936</span> &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>] = &#123; <span class="number">0x03020100</span>, <span class="number">0x07060504</span>, <span class="number">0x0B0A0908</span>, <span class="number">0x0F0E0D0C</span> &#125;;</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">uint32_t</span> teaData[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++ )</span><br><span class="line">  	&#123;</span><br><span class="line">  		decipher(<span class="number">1</span> &lt;&lt; (i + <span class="number">1</span>), v + i * <span class="number">2</span>, k);</span><br><span class="line">  		<span class="built_in">printf</span>(<span class="string">&quot;0x%X, 0x%X, &quot;</span>, v[i * <span class="number">2</span>], v[i * <span class="number">2</span> + <span class="number">1</span>]);</span><br><span class="line">  		teaData[i * <span class="number">2</span>] = v[i * <span class="number">2</span>];</span><br><span class="line">  		teaData[i * <span class="number">2</span> + <span class="number">1</span>] = v[i * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line">  	&#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  	</span><br><span class="line">  	<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; i++ )</span><br><span class="line">  	&#123;</span><br><span class="line">  		XorRol(teaData + i * <span class="number">2</span>);</span><br><span class="line">  	&#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  	</span><br><span class="line">  	<span class="type">unsigned</span> <span class="type">char</span> * t = (<span class="type">unsigned</span> <span class="type">char</span> *)&amp;teaData;</span><br><span class="line">  	<span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i += <span class="number">4</span> )</span><br><span class="line">  		<span class="built_in">printf</span>(<span class="string">&quot;%c%c%c%c&quot;</span>, t[i + <span class="number">3</span>], t[i + <span class="number">2</span>], t[i + <span class="number">1</span>], t[i]);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>*CTF{mM7pJIobsCTQPO6R0g-L8kFExhYuivBN}</p>
<h3 id="Jump"><a href="#Jump" class="headerlink" title="Jump"></a>Jump</h3><p>属实是把这题整明白了，看了一下午一直在想为什么这个会一直为0，原来是有setjump和longjump函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">setjmp</span><span class="params">(jmp_buf env)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">longjmp</span><span class="params">(jmp_buf env, <span class="type">int</span> value)</span>;</span><br></pre></td></tr></table></figure>

<p>众所周知，env一般代表的是上下文环境，在这也是如此，什么时候会用到这类函数捏。我们知道goto只能用于函数的局部跳转，跨函数是不行的，那么我们采用setjump和longjump就很好的解决了这个问题，这两个函数保存当前上下文，比如保存现有堆栈环境，在嵌套函数中进行随心所欲的跳转。</p>
<p>setjump返回值永远是0，这就说明了为什么在题中ifelse语句中，永远只进else语句。当先调用了setjump后，再调用longjump，那么返回回值由value参数确定，然后setjump也要返回非0值。这个和信号处理的一些函数很相似。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_40293E</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v4; <span class="comment">// r8</span></span><br><span class="line">  __int64 v5; <span class="comment">// r9</span></span><br><span class="line">  __int64 v7; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v9; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v10; <span class="comment">// r8</span></span><br><span class="line">  __int64 v11; <span class="comment">// r9</span></span><br><span class="line">  __int64 v12; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v13; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v14; <span class="comment">// r8</span></span><br><span class="line">  __int64 v15; <span class="comment">// r9</span></span><br><span class="line">  __int64 v16; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v17; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v18; <span class="comment">// r8</span></span><br><span class="line">  __int64 v19; <span class="comment">// r9</span></span><br><span class="line">  __int64 v20; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v21; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v22; <span class="comment">// r8</span></span><br><span class="line">  __int64 v23; <span class="comment">// r9</span></span><br><span class="line">  __int64 v24; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v25; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v26; <span class="comment">// r8</span></span><br><span class="line">  __int64 v27; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v28; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v29; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v30; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v31; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v32; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line">  <span class="type">int</span> v34; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line">  <span class="type">int</span> v35; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line">  <span class="type">int</span> v36; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">scanf</span>(input);</span><br><span class="line">  v33 = setjump((__int64)&amp;unk_4C9680, a2, v2, v3, v4, v5, v28);<span class="comment">//v33=0</span></span><br><span class="line">  <span class="keyword">if</span> ( v33 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v33 == <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    de();<span class="comment">//是一个添加函数</span></span><br><span class="line">  &#125;</span><br><span class="line">  v7 = <span class="number">1LL</span>;</span><br><span class="line">  qword_4C9400 = longjump(dword_4C613C + <span class="number">1</span>, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)setjump((__int64)&amp;unk_4C9680, <span class="number">1LL</span>, v8, v9, v10, v11, v29) )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">1LL</span>;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  &#125;</span><br><span class="line">  qword_4C9408 = sub_427140(<span class="number">8LL</span> * dword_4C613C);</span><br><span class="line">  v34 = setjump((__int64)&amp;unk_4C9680, <span class="number">1LL</span>, v12, v13, v14, v15, v30);</span><br><span class="line">  <span class="keyword">if</span> ( v34 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v34 &lt;= dword_4C613C )                  <span class="comment">// 循环0x23次</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (<span class="type">unsigned</span> <span class="type">int</span>)(v34 + <span class="number">1</span>);</span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">1LL</span>;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401F62((<span class="type">char</span> *)qword_4C9408);             <span class="comment">// 对字符排序</span></span><br><span class="line">  v35 = setjump((__int64)&amp;unk_4C9680, v7, v16, v17, v18, v19, v31);</span><br><span class="line">  <span class="keyword">if</span> ( v35 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v35 &lt;= dword_4C613C )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = (<span class="type">unsigned</span> <span class="type">int</span>)v35;</span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_402826((__int64)&amp;unk_4C9680, v7, v20, v21, v22, v23);<span class="comment">// 对比处</span></span><br><span class="line">  &#125;</span><br><span class="line">  sub_427730(qword_4C9408);</span><br><span class="line">  sub_427730(qword_4C9400);</span><br><span class="line">  v36 = setjump((__int64)&amp;unk_4C9680, v7, v24, v25, v26, v27, v32);</span><br><span class="line">  <span class="keyword">if</span> ( !v36 )</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  <span class="keyword">if</span> ( v36 == <span class="number">1</span> )</span><br><span class="line">    sub_411920((__int64)<span class="string">&quot;*CTF&#123;%s&#125;\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)input);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们先看de函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">de</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v3; <span class="comment">// r8</span></span><br><span class="line">  __int64 v4; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// er9</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v8; <span class="comment">// r8</span></span><br><span class="line">  __int64 v9; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( sub_4011A0() || (v0 = <span class="number">3LL</span>, sub_4011A0()) )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 = <span class="number">1LL</span>;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)setjump((__int64)&amp;unk_4C9460, v0, v1, v2, v3, v4, v10) )</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  <span class="built_in">sprintf</span>(qword_4C9400, (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;%c%s%c&quot;</span>, <span class="number">2</span>, (<span class="type">unsigned</span> <span class="type">int</span>)input, <span class="number">3</span>, v5);<span class="comment">// 在输入前添加2，输入后添加3</span></span><br><span class="line">  v12 = setjump((__int64)&amp;unk_4C9460, (__int64)<span class="string">&quot;%c%s%c&quot;</span>, v6, v7, v8, v9, v11);</span><br><span class="line">  <span class="keyword">if</span> ( !v12 )</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  <span class="keyword">if</span> ( v12 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_4C9660 = longjump(dword_4C613C + <span class="number">1</span>, <span class="number">1uLL</span>);</span><br><span class="line">    sub_401020(qword_4C9660, qword_4C9400 + v12 - <span class="number">1LL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v12 &gt; <span class="number">1</span> )</span><br><span class="line">      sub_401100();</span><br><span class="line">    *(_QWORD *)(qword_4C9408 + <span class="number">8LL</span> * v12 - <span class="number">8</span>) = qword_4C9660;</span><br><span class="line">  &#125;</span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们首先要盯着input里的变化，这个函数只在我们输入的字符串前增加2，字符串后加3</p>
<p>我是先看到了对比函数，所以先查看一下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_402826</span><span class="params">(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v7 = setjump((__int64)&amp;unk_4C9540, a2, a3, a4, a5, a6, v6);</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v7 &lt;= dword_4C613C )</span><br><span class="line">    &#123;</span><br><span class="line">      byte_4C9420[v7 - <span class="number">1</span>] = *(_BYTE *)(dword_4C613C - <span class="number">1LL</span> + *(_QWORD *)(<span class="number">8LL</span> * v7 - <span class="number">8</span> + qword_4C9408));<span class="comment">// 取每个字符串的最后一位</span></span><br><span class="line">      sub_427730(*(_QWORD *)(<span class="number">8LL</span> * v7 - <span class="number">8</span> + qword_4C9408));</span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401DC1(byte_4C9420, &amp;unk_4C6100, (<span class="type">unsigned</span> <span class="type">int</span>)dword_4C613C);<span class="comment">// 对比处</span></span><br><span class="line">  ((<span class="type">void</span> (__fastcall *)())((<span class="type">char</span> *)&amp;sub_401D44 + <span class="number">1</span>))();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对比处藏着我们需要逆向的字符串，然后我们在byte_4C9420发现我们输入的字符串变化了，但变化我们不清楚，返回主函数，继续找，找到sub_401F62，其参数是经过de函数后的字符串，我们进去查看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_401F62</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+13h] [rbp-49Dh]</span></span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// [rsp+18h] [rbp-498h]</span></span><br><span class="line">  <span class="type">char</span> *v6; <span class="comment">// [rsp+20h] [rbp-490h]</span></span><br><span class="line">  <span class="type">char</span> **v7; <span class="comment">// [rsp+28h] [rbp-488h]</span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// [rsp+30h] [rbp-480h]</span></span><br><span class="line">  <span class="type">char</span> *v9; <span class="comment">// [rsp+38h] [rbp-478h]</span></span><br><span class="line">  <span class="type">char</span> *v10; <span class="comment">// [rsp+40h] [rbp-470h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+48h] [rbp-468h]</span></span><br><span class="line">  <span class="type">char</span> *k; <span class="comment">// [rsp+48h] [rbp-468h]</span></span><br><span class="line">  <span class="type">char</span> *v13; <span class="comment">// [rsp+48h] [rbp-468h]</span></span><br><span class="line">  <span class="type">char</span> *j; <span class="comment">// [rsp+50h] [rbp-460h]</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// [rsp+50h] [rbp-460h]</span></span><br><span class="line">  <span class="type">char</span> *v16; <span class="comment">// [rsp+58h] [rbp-458h]</span></span><br><span class="line">  <span class="type">char</span> *m; <span class="comment">// [rsp+60h] [rbp-450h]</span></span><br><span class="line">  <span class="type">char</span> *v18; <span class="comment">// [rsp+68h] [rbp-448h]</span></span><br><span class="line">  <span class="type">char</span> *v19; <span class="comment">// [rsp+98h] [rbp-418h]</span></span><br><span class="line">  __int64 v20[<span class="number">2</span>]; <span class="comment">// [rsp+A0h] [rbp-410h] BYREF</span></span><br><span class="line">  __int64 v21; <span class="comment">// [rsp+B0h] [rbp-400h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v22; <span class="comment">// [rsp+4A8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v22 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = a1;</span><br><span class="line">  v6 = a1 + <span class="number">264</span>;</span><br><span class="line">  v20[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v20[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v7 = (<span class="type">char</span> **)&amp;v21;</span><br><span class="line">  <span class="keyword">while</span> ( v7 &gt; (<span class="type">char</span> **)v20 )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = &amp;v5[<span class="number">8</span> * (((v6 - v5) / <span class="number">8</span>) &gt;&gt; <span class="number">1</span>)];</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)sub_401EB7(v10, v5) &lt; <span class="number">0</span> )</span><br><span class="line">      sub_401EF6(v10, v5, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)sub_401EB7(v6, v10) &lt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_401EF6(v10, v6, <span class="number">8</span>);                   <span class="comment">// 循环右移1位</span></span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">int</span>)sub_401EB7(v10, v5) &lt; <span class="number">0</span> )</span><br><span class="line">        sub_401EF6(v10, v5, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v8 = v5 + <span class="number">8</span>;</span><br><span class="line">    v9 = v6 - <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = sub_401EB7((_QWORD *)v5 + <span class="number">1</span>, v10); ; i = sub_401EB7(v8, v10) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i &lt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v8 += <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( (<span class="type">int</span>)sub_401EB7(v10, v9) &lt; <span class="number">0</span> )</span><br><span class="line">        v9 -= <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt;= v9 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      sub_401EF6(v8, v9, <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v10 == v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v10 == v9 )</span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v8;</span><br><span class="line">      &#125;</span><br><span class="line">      v8 += <span class="number">8</span>;</span><br><span class="line">      v9 -= <span class="number">8</span>;</span><br><span class="line">LABEL_22:</span><br><span class="line">      <span class="keyword">if</span> ( v8 &gt; v9 )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v8 != v9 )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_22;</span><br><span class="line">    v8 += <span class="number">8</span>;</span><br><span class="line">    v9 -= <span class="number">8</span>;</span><br><span class="line">LABEL_23:</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(v9 - v5) &gt; <span class="number">0x20</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(v6 - v8) &gt; <span class="number">0x20</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v9 - v5 &lt;= v6 - v8 )</span><br><span class="line">        &#123;</span><br><span class="line">          *v7 = v8;</span><br><span class="line">          v7[<span class="number">1</span>] = v6;</span><br><span class="line">          v7 += <span class="number">2</span>;</span><br><span class="line">          v6 = v9;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          *v7 = v5;</span><br><span class="line">          v7[<span class="number">1</span>] = v9;</span><br><span class="line">          v7 += <span class="number">2</span>;</span><br><span class="line">          v5 = v8;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v6 = v9;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)(v6 - v8) &gt; <span class="number">0x20</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 -= <span class="number">2</span>;</span><br><span class="line">      v5 = *v7;</span><br><span class="line">      v6 = v7[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v11 = a1;</span><br><span class="line">  v2 = a1 + <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a1 + <span class="number">264</span> &lt;= a1 + <span class="number">32</span> )</span><br><span class="line">    v2 = a1 + <span class="number">264</span>;</span><br><span class="line">  v19 = v2;</span><br><span class="line">  <span class="keyword">for</span> ( j = a1 + <span class="number">8</span>; j &lt;= v19; j += <span class="number">8</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)sub_401EB7(j, v11) &lt; <span class="number">0</span> )</span><br><span class="line">      v11 = j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v11 != a1 )</span><br><span class="line">    sub_401EF6(v11, a1, <span class="number">8</span>);</span><br><span class="line">  v15 = a1 + <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v15 += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v15 &gt; a1 + <span class="number">264</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">for</span> ( k = v15 - <span class="number">8</span>; (<span class="type">int</span>)sub_401EB7(v15, k) &lt; <span class="number">0</span>; k -= <span class="number">8</span> )</span><br><span class="line">      ;</span><br><span class="line">    v13 = k + <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v13 != v15 )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = v15 + <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">while</span> ( --v16 &gt;= v15 )</span><br><span class="line">      &#123;</span><br><span class="line">        v4 = *v16;</span><br><span class="line">        v18 = v16;</span><br><span class="line">        <span class="keyword">for</span> ( m = v16; ; m = v18 )</span><br><span class="line">        &#123;</span><br><span class="line">          v18 -= <span class="number">8</span>;</span><br><span class="line">          <span class="keyword">if</span> ( v18 &lt; v13 )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          *m = *v18;</span><br><span class="line">        &#125;</span><br><span class="line">        *m = v4;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v22;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_459C10();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个排序函数很长，很难搞，我们先动调搞一下，发现经过sub_401EF6(v10, v6, 8); 函数时会让字符串循环左移一位，然后我们直接略过这个循环函数，直接看循环后的结果，发现在藏字符串的地方存了许多长字符串，那么我们经过观察，能发现几个规律，这个字符串的第一个字符是经过从小到大排列的，而且第一个字符和最后一个字符是永远绑定在一起的，而我们要解密的字符串经过：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">byte_4C9420[v7 - <span class="number">1</span>] = *(_BYTE *)(dword_4C613C - <span class="number">1LL</span> + *(_QWORD *)(<span class="number">8LL</span> * v7 - <span class="number">8</span> + qword_4C9408));</span><br></pre></td></tr></table></figure>

<p>也就是取字符串最后一位连起来并且首位是2，末位是3，所以很简单了，直接手算就出了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\x02\x03+<span class="number">1246</span>=BCDEFGLNRSTVZ_acjkmnpquvwx   #第一位字符，按升序排列</span><br><span class="line">\x03jmGn_=uaSZLvN4wFxE6R+p\x02D2qV1CBTck   #对比时的字符串，也就是每个字符串最后一位</span><br><span class="line"></span><br><span class="line">\x02cwNG1paBu=<span class="number">6</span>Vn2kxSCqm+_4LETvFRZDj\x03</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/04/11/idapython%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">idapython初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-11 15:30:31" itemprop="dateCreated datePublished" datetime="2022-04-11T15:30:31+08:00">2022-04-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:43:34" itemprop="dateModified" datetime="2022-07-18T00:43:34+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="idapython初探"><a href="#idapython初探" class="headerlink" title="idapython初探"></a>idapython初探</h1><p>也到了该系统学习idapython的阶段了！</p>
<p>之前看别人的wp用的idapython在新的版本中已经不能用来，idapython升级了！现大概学习一下怎么用，然后在文档中学习：</p>
<p>idapython官方函数文档：<a target="_blank" rel="noopener" href="https://www.hex-rays.com/products/ida/support/idapython_docs/">https://www.hex-rays.com/products/ida/support/idapython_docs/</a></p>
<p>旧版本和新版本差异：<a target="_blank" rel="noopener" href="https://www.hex-rays.com/products/ida/support/ida74_idapython_no_bc695_porting_guide.shtml">https://www.hex-rays.com/products/ida/support/ida74_idapython_no_bc695_porting_guide.shtml</a></p>
<p>idapython图片集合版：<a target="_blank" rel="noopener" href="https://github.com/inforion/idapython-cheatsheet/blob/master/IDAPython-7x_cheatsheet_web_en.png">https://github.com/inforion/idapython-cheatsheet/blob/master/IDAPython-7x_cheatsheet_web_en.png</a></p>
<h2 id="1、获取函数地址"><a href="#1、获取函数地址" class="headerlink" title="1、获取函数地址"></a>1、获取函数地址</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(idc.here()))/<span class="comment">#获取当前在查看函数地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(idc.get_screen_ea()))<span class="comment">#获取当前在查看的函数地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(ida_ida.inf_get_min_ea()))<span class="comment">#获取这个程序最小的地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(ida_ida.inf_get_max_ea()))<span class="comment">#获取这个程序最大的地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(idc.read_selection_start()))<span class="comment">#如果你选择了某块地址 那么使用此函数则返回你选择的这块地址的起始地址,否则返回-1，选择的意思是光标选择其地址</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(idc.read_selection_end()))<span class="comment">#同上</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> idaapi.BADADDR == idc.here():</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;BadAddress addr invalid&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;addr is ok&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>idaapi.BADADDR</strong>，用来判断函数是否存在</p>
<h2 id="2-获取数值"><a href="#2-获取数值" class="headerlink" title="2.获取数值"></a>2.获取数值</h2><p>在之前看wp，用Byte永远是错的，今天才知道原来改了函数：</p>
<p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411155039777.png" alt="image-20220411155039777"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">idc.get_wide_byte(addr)//以字节为单位获取地址处的值</span><br><span class="line">idc.get_wide_word(addr)//获取<span class="number">2</span>字节的值</span><br><span class="line">idc.get_wide_dword(addr)//获取<span class="number">4</span>字节</span><br><span class="line">idc.get_qword(addr)//获取<span class="number">8</span>字节</span><br></pre></td></tr></table></figure>

<p>下面进行一个获取当前地址下的数值操作，如果不是数据段，获得的是硬编码，在hex显示中能看到的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line">ea = idc.get_screen_ea()</span><br><span class="line">value = idc.get_wide_byte(ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(value)))</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">idc.isByte() Word Dwrd Qwrd</th>
<th align="center">ida_bytes.is_byte word dword qword</th>
</tr>
</thead>
</table>
<p>上面是对应的判断函数</p>
<h2 id="3-修改数值操作"><a href="#3-修改数值操作" class="headerlink" title="3.修改数值操作"></a>3.修改数值操作</h2><p>修改数值的方法，一般用patch，或者用python也行。</p>
<p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411162518089.png" alt="image-20220411162518089"></p>
<p>当然修改的值韩式byte是1字节，word2字节，Dword4字节，Qword8字节</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ea = idc.get_screen_ea()</span><br><span class="line">value = idc.get_wide_byte(ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;修改前&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(value)))</span><br><span class="line">ida_bytes.patch_byte(ea,<span class="number">0x90</span>)</span><br><span class="line">value = idc.get_wide_byte(ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;修改前&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(value)))</span><br><span class="line"><span class="comment">#修改前0x0</span></span><br><span class="line"><span class="comment">#修改前0x90</span></span><br></pre></td></tr></table></figure>

<p>我们修改当前选中地址的数据</p>
<p>如果要将一段地址中所有0x0换成0x77，如何写呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line">start_addr = <span class="number">0x0040b1cd</span></span><br><span class="line">end_addr = <span class="number">0x0040b1ff</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(end_addr - start_addr):</span><br><span class="line">    now_addr = i + start_addr</span><br><span class="line">    tmp = idc.get_wide_byte(now_addr)</span><br><span class="line">    <span class="keyword">if</span> tmp == <span class="number">0</span>:</span><br><span class="line">        ida_bytes.patch_byte(now_addr,<span class="number">0x77</span>)</span><br></pre></td></tr></table></figure>

<p>我的建议是每次写的时候将三个import全部导入，反正就这三个。</p>
<h2 id="4-汇编提取"><a href="#4-汇编提取" class="headerlink" title="4.汇编提取"></a>4.汇编提取</h2><p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411170422358.png" alt="image-20220411170422358"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line">ea = idc.here()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前模块基址&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(idaapi.get_imagebase())))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前汇编指令&#123;&#125;&quot;</span>.<span class="built_in">format</span>(idc.print_insn_mnem(ea)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前汇编语句&#123;&#125;&quot;</span>.<span class="built_in">format</span>(idc.GetDisasm(ea)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前操作数&#123;&#125;&quot;</span>.<span class="built_in">format</span>(idc.print_operand(ea,<span class="number">0</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前的操作数值为: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(idc.get_operand_value(ea,<span class="number">0</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#当前模块基址0x400000</span></span><br><span class="line"><span class="comment">#当前汇编指令xor</span></span><br><span class="line"><span class="comment">#当前汇编语句xor     rsi, qword ptr [rsp+58h+PerformanceCount]</span></span><br><span class="line"><span class="comment">#当前操作数rsi</span></span><br><span class="line"><span class="comment">#当前的操作数值为: 6</span></span><br></pre></td></tr></table></figure>

<h2 id="5-段操作"><a href="#5-段操作" class="headerlink" title="5.段操作"></a>5.段操作</h2><p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411181105721.png" alt="image-20220411181105721"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> seg <span class="keyword">in</span> idautils.Segments():</span><br><span class="line">    segname = idc.get_segm_name(seg)</span><br><span class="line">    segstart = idc.get_segm_start(seg)</span><br><span class="line">    segend = idc.get_segm_end(seg)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;段名 = &#123;&#125; 起始地址 = &#123;&#125; 结束地址 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(segname, <span class="built_in">hex</span>(segstart), <span class="built_in">hex</span>(segend)))</span><br><span class="line"><span class="comment">#段名 = .text 起始地址 = 0x401000 结束地址 = 0x404000</span></span><br><span class="line"><span class="comment">#段名 = .data 起始地址 = 0x404000 结束地址 = 0x405000</span></span><br><span class="line"><span class="comment">#段名 = .rdata 起始地址 = 0x405000 结束地址 = 0x406000</span></span><br><span class="line"><span class="comment">#段名 = .pdata 起始地址 = 0x406000 结束地址 = 0x407000</span></span><br><span class="line"><span class="comment">#段名 = .xdata 起始地址 = 0x407000 结束地址 = 0x408000</span></span><br><span class="line"><span class="comment">#段名 = .bss 起始地址 = 0x408000 结束地址 = 0x409000</span></span><br><span class="line"><span class="comment">#段名 = .idata 起始地址 = 0x4091dc 结束地址 = 0x40937c</span></span><br><span class="line"><span class="comment">#段名 = .CRT 起始地址 = 0x40a000 结束地址 = 0x40b000</span></span><br><span class="line"><span class="comment">#段名 = .tls 起始地址 = 0x40b000 结束地址 = 0x40c000</span></span><br></pre></td></tr></table></figure>

<h2 id="6-函数操作"><a href="#6-函数操作" class="headerlink" title="6.函数操作"></a>6.函数操作</h2><p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411182506660.png" alt="image-20220411182506660"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> seg <span class="keyword">in</span> idautils.Segments():</span><br><span class="line">    segname = idc.get_segm_name(seg)</span><br><span class="line">    segstart = idc.get_segm_start(seg)</span><br><span class="line">    segend   = idc.get_segm_end(seg)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;段名 = &#123;&#125; 起始地址= &#123;&#125; 结束地址 = &#123;&#125; &quot;</span>.<span class="built_in">format</span>(segname,<span class="built_in">hex</span>(segstart),<span class="built_in">hex</span>(segend)))</span><br><span class="line">    <span class="keyword">if</span> segname == <span class="string">&#x27;.text&#x27;</span>:</span><br><span class="line">        <span class="keyword">for</span> funcaddr <span class="keyword">in</span> Functions(segstart, segend):</span><br><span class="line">            funname = idc.get_func_name(funcaddr)</span><br><span class="line">            funend = idc.find_func_end(funcaddr)</span><br><span class="line">            funnext = idc.get_next_func(funcaddr)</span><br><span class="line">            funnextname = idc.get_func_name(funnext)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;当前函数名 = &#123;&#125; 当前结束地址 = &#123;&#125; 下一个函数地址 = &#123;&#125; 下一个函数名 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(funname, <span class="built_in">hex</span>(funend), <span class="built_in">hex</span>(funnext), funnextname)) </span><br><span class="line">ea = idc.get_screen_ea()</span><br><span class="line">funnextoffset = idc.get_func_off_str(ea)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;当前选择地址距离当前函数的偏移：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(funnextoffset))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">段名 = .text 起始地址= <span class="number">0x401000</span> 结束地址 = <span class="number">0x404000</span> </span><br><span class="line">当前函数名 = __mingw_invalidParameterHandler 当前结束地址 = <span class="number">0x401001</span> 下一个函数地址 = <span class="number">0x401010</span> 下一个函数名 = pre_c_init</span><br><span class="line">当前函数名 = pre_c_init 当前结束地址 = <span class="number">0x401121</span> 下一个函数地址 = <span class="number">0x401130</span> 下一个函数名 = pre_cpp_init</span><br><span class="line">当前函数名 = pre_cpp_init 当前结束地址 = <span class="number">0x401179</span> 下一个函数地址 = <span class="number">0x401180</span> 下一个函数名 = __tmainCRTStartup</span><br><span class="line">当前函数名 = __tmainCRTStartup 当前结束地址 = <span class="number">0x4014a6</span> 下一个函数地址 = <span class="number">0x4014b0</span> 下一个函数名 = WinMainCRTStartup</span><br><span class="line">当前函数名 = WinMainCRTStartup 当前结束地址 = <span class="number">0x4014d2</span> 下一个函数地址 = <span class="number">0x4014e0</span> 下一个函数名 = mainCRTStartup</span><br><span class="line">当前函数名 = mainCRTStartup 当前结束地址 = <span class="number">0x401502</span> 下一个函数地址 = <span class="number">0x401510</span> 下一个函数名 = atexit</span><br><span class="line">当前函数名 = atexit 当前结束地址 = <span class="number">0x401529</span> 下一个函数地址 = <span class="number">0x401530</span> 下一个函数名 = __gcc_register_frame</span><br><span class="line">当前函数名 = __gcc_register_frame 当前结束地址 = <span class="number">0x40153c</span> 下一个函数地址 = <span class="number">0x401540</span> 下一个函数名 = __gcc_deregister_frame</span><br><span class="line">当前函数名 = __gcc_deregister_frame 当前结束地址 = <span class="number">0x401541</span> 下一个函数地址 = <span class="number">0x401550</span> 下一个函数名 = <span class="built_in">input</span></span><br><span class="line">当前函数名 = <span class="built_in">input</span> 当前结束地址 = <span class="number">0x40163d</span> 下一个函数地址 = <span class="number">0x40163d</span> 下一个函数名 = output</span><br><span class="line">当前函数名 = output 当前结束地址 = <span class="number">0x401725</span> 下一个函数地址 = <span class="number">0x401725</span> 下一个函数名 = Findmax</span><br><span class="line">当前函数名 = Findmax 当前结束地址 = <span class="number">0x4017a6</span> 下一个函数地址 = <span class="number">0x4017a6</span> 下一个函数名 = sort</span><br><span class="line">当前函数名 = sort 当前结束地址 = <span class="number">0x4019a0</span> 下一个函数地址 = <span class="number">0x4019a0</span> 下一个函数名 = main</span><br><span class="line">当前函数名 = main 当前结束地址 = <span class="number">0x401aeb</span> 下一个函数地址 = <span class="number">0x401af0</span> 下一个函数名 = __do_global_dtors</span><br><span class="line">当前函数名 = __do_global_dtors 当前结束地址 = <span class="number">0x401b25</span> 下一个函数地址 = <span class="number">0x401b30</span> 下一个函数名 = __do_global_ctors</span><br><span class="line">当前函数名 = __do_global_ctors 当前结束地址 = <span class="number">0x401b96</span> 下一个函数地址 = <span class="number">0x401ba0</span> 下一个函数名 = __main</span><br><span class="line">当前函数名 = __main 当前结束地址 = <span class="number">0x401bbf</span> 下一个函数地址 = <span class="number">0x401bc0</span> 下一个函数名 = my_lconv_init</span><br><span class="line">当前函数名 = my_lconv_init 当前结束地址 = <span class="number">0x401bc7</span> 下一个函数地址 = <span class="number">0x401bd0</span> 下一个函数名 = _setargv</span><br><span class="line">当前函数名 = _setargv 当前结束地址 = <span class="number">0x401bd3</span> 下一个函数地址 = <span class="number">0x401be0</span> 下一个函数名 = __security_init_cookie</span><br><span class="line">当前函数名 = __security_init_cookie 当前结束地址 = <span class="number">0x401cb6</span> 下一个函数地址 = <span class="number">0x401cc0</span> 下一个函数名 = __report_gsfailure</span><br><span class="line">当前函数名 = __report_gsfailure 当前结束地址 = <span class="number">0x401db8</span> 下一个函数地址 = <span class="number">0x401dc0</span> 下一个函数名 = __dyn_tls_dtor</span><br><span class="line">当前函数名 = __dyn_tls_dtor 当前结束地址 = <span class="number">0x401def</span> 下一个函数地址 = <span class="number">0x401df0</span> 下一个函数名 = __dyn_tls_init</span><br><span class="line">当前函数名 = __dyn_tls_init 当前结束地址 = <span class="number">0x401e63</span> 下一个函数地址 = <span class="number">0x401e70</span> 下一个函数名 = __tlregdtor</span><br><span class="line">当前函数名 = __tlregdtor 当前结束地址 = <span class="number">0x401e73</span> 下一个函数地址 = <span class="number">0x401e80</span> 下一个函数名 = __mingw_raise_matherr</span><br><span class="line">当前函数名 = __mingw_raise_matherr 当前结束地址 = <span class="number">0x401ec1</span> 下一个函数地址 = <span class="number">0x401ed0</span> 下一个函数名 = __mingw_setusermatherr</span><br><span class="line">当前函数名 = __mingw_setusermatherr 当前结束地址 = <span class="number">0x401edc</span> 下一个函数地址 = <span class="number">0x401ee0</span> 下一个函数名 = _matherr</span><br><span class="line">当前函数名 = _matherr 当前结束地址 = <span class="number">0x401fdc</span> 下一个函数地址 = <span class="number">0x401fe0</span> 下一个函数名 = fpreset</span><br><span class="line">当前函数名 = fpreset 当前结束地址 = <span class="number">0x401fe3</span> 下一个函数地址 = <span class="number">0x401ff0</span> 下一个函数名 = _decode_pointer</span><br><span class="line">当前函数名 = _decode_pointer 当前结束地址 = <span class="number">0x401ff4</span> 下一个函数地址 = <span class="number">0x402000</span> 下一个函数名 = _encode_pointer</span><br><span class="line">当前函数名 = _encode_pointer 当前结束地址 = <span class="number">0x402004</span> 下一个函数地址 = <span class="number">0x402010</span> 下一个函数名 = __write_memory.part<span class="number">.0</span></span><br><span class="line">当前函数名 = __write_memory.part<span class="number">.0</span> 当前结束地址 = <span class="number">0x4021dc</span> 下一个函数地址 = <span class="number">0x4021e0</span> 下一个函数名 = _pei386_runtime_relocator</span><br><span class="line">当前函数名 = _pei386_runtime_relocator 当前结束地址 = <span class="number">0x40249a</span> 下一个函数地址 = <span class="number">0x4024a0</span> 下一个函数名 = __mingw_SEH_error_handler</span><br><span class="line">当前函数名 = __mingw_SEH_error_handler 当前结束地址 = <span class="number">0x402640</span> 下一个函数地址 = <span class="number">0x402640</span> 下一个函数名 = __mingw_init_ehandler</span><br><span class="line">当前函数名 = __mingw_init_ehandler 当前结束地址 = <span class="number">0x40272c</span> 下一个函数地址 = <span class="number">0x402920</span> 下一个函数名 = __mingwthr_run_key_dtors.part<span class="number">.0</span></span><br><span class="line">当前函数名 = __mingwthr_run_key_dtors.part<span class="number">.0</span> 当前结束地址 = <span class="number">0x40298a</span> 下一个函数地址 = <span class="number">0x402990</span> 下一个函数名 = ___w64_mingwthr_add_key_dtor</span><br><span class="line">当前函数名 = ___w64_mingwthr_add_key_dtor 当前结束地址 = <span class="number">0x402a0f</span> 下一个函数地址 = <span class="number">0x402a10</span> 下一个函数名 = ___w64_mingwthr_remove_key_dtor</span><br><span class="line">当前函数名 = ___w64_mingwthr_remove_key_dtor 当前结束地址 = <span class="number">0x402ab0</span> 下一个函数地址 = <span class="number">0x402ab0</span> 下一个函数名 = __mingw_TLScallback</span><br><span class="line">当前函数名 = __mingw_TLScallback 当前结束地址 = <span class="number">0x402b8a</span> 下一个函数地址 = <span class="number">0x402b90</span> 下一个函数名 = _ValidateImageBase.part<span class="number">.0</span></span><br><span class="line">当前函数名 = _ValidateImageBase.part<span class="number">.0</span> 当前结束地址 = <span class="number">0x402bae</span> 下一个函数地址 = <span class="number">0x402bb0</span> 下一个函数名 = _ValidateImageBase</span><br><span class="line">当前函数名 = _ValidateImageBase 当前结束地址 = <span class="number">0x402bc2</span> 下一个函数地址 = <span class="number">0x402bd0</span> 下一个函数名 = _FindPESection</span><br><span class="line">当前函数名 = _FindPESection 当前结束地址 = <span class="number">0x402c14</span> 下一个函数地址 = <span class="number">0x402c20</span> 下一个函数名 = _FindPESectionByName</span><br><span class="line">当前函数名 = _FindPESectionByName 当前结束地址 = <span class="number">0x402cad</span> 下一个函数地址 = <span class="number">0x402cb0</span> 下一个函数名 = __mingw_GetSectionForAddress</span><br><span class="line">当前函数名 = __mingw_GetSectionForAddress 当前结束地址 = <span class="number">0x402d24</span> 下一个函数地址 = <span class="number">0x402d30</span> 下一个函数名 = __mingw_GetSectionCount</span><br><span class="line">当前函数名 = __mingw_GetSectionCount 当前结束地址 = <span class="number">0x402d6e</span> 下一个函数地址 = <span class="number">0x402d70</span> 下一个函数名 = _FindPESectionExec</span><br><span class="line">当前函数名 = _FindPESectionExec 当前结束地址 = <span class="number">0x402ddf</span> 下一个函数地址 = <span class="number">0x402de0</span> 下一个函数名 = _GetPEImageBase</span><br><span class="line">当前函数名 = _GetPEImageBase 当前结束地址 = <span class="number">0x402e17</span> 下一个函数地址 = <span class="number">0x402e20</span> 下一个函数名 = _IsNonwritableInCurrentImage</span><br><span class="line">当前函数名 = _IsNonwritableInCurrentImage 当前结束地址 = <span class="number">0x402eb1</span> 下一个函数地址 = <span class="number">0x402ec0</span> 下一个函数名 = __mingw_enum_import_library_names</span><br><span class="line">当前函数名 = __mingw_enum_import_library_names 当前结束地址 = <span class="number">0x402f66</span> 下一个函数地址 = <span class="number">0x402f70</span> 下一个函数名 = ___chkstk_ms</span><br><span class="line">当前函数名 = ___chkstk_ms 当前结束地址 = <span class="number">0x402fa2</span> 下一个函数地址 = <span class="number">0x402fb0</span> 下一个函数名 = vfprintf</span><br><span class="line">当前函数名 = vfprintf 当前结束地址 = <span class="number">0x402fb6</span> 下一个函数地址 = <span class="number">0x402fb8</span> 下一个函数名 = strncmp</span><br><span class="line">当前函数名 = strncmp 当前结束地址 = <span class="number">0x402fbe</span> 下一个函数地址 = <span class="number">0x402fc0</span> 下一个函数名 = strlen</span><br><span class="line">当前函数名 = strlen 当前结束地址 = <span class="number">0x402fc6</span> 下一个函数地址 = <span class="number">0x402fc8</span> 下一个函数名 = signal</span><br><span class="line">当前函数名 = signal 当前结束地址 = <span class="number">0x402fce</span> 下一个函数地址 = <span class="number">0x402fd0</span> 下一个函数名 = scanf</span><br><span class="line">当前函数名 = scanf 当前结束地址 = <span class="number">0x402fd6</span> 下一个函数地址 = <span class="number">0x402fd8</span> 下一个函数名 = printf</span><br><span class="line">当前函数名 = printf 当前结束地址 = <span class="number">0x402fde</span> 下一个函数地址 = <span class="number">0x402fe0</span> 下一个函数名 = memcpy</span><br><span class="line">当前函数名 = memcpy 当前结束地址 = <span class="number">0x402fe6</span> 下一个函数地址 = <span class="number">0x402fe8</span> 下一个函数名 = malloc</span><br><span class="line">当前函数名 = malloc 当前结束地址 = <span class="number">0x402fee</span> 下一个函数地址 = <span class="number">0x402ff0</span> 下一个函数名 = fwrite</span><br><span class="line">当前函数名 = fwrite 当前结束地址 = <span class="number">0x402ff6</span> 下一个函数地址 = <span class="number">0x402ff8</span> 下一个函数名 = free</span><br><span class="line">当前函数名 = free 当前结束地址 = <span class="number">0x402ffe</span> 下一个函数地址 = <span class="number">0x403000</span> 下一个函数名 = fprintf</span><br><span class="line">当前函数名 = fprintf 当前结束地址 = <span class="number">0x403006</span> 下一个函数地址 = <span class="number">0x403008</span> 下一个函数名 = exit</span><br><span class="line">当前函数名 = exit 当前结束地址 = <span class="number">0x40300e</span> 下一个函数地址 = <span class="number">0x403010</span> 下一个函数名 = calloc</span><br><span class="line">当前函数名 = calloc 当前结束地址 = <span class="number">0x403016</span> 下一个函数地址 = <span class="number">0x403018</span> 下一个函数名 = abort</span><br><span class="line">当前函数名 = abort 当前结束地址 = <span class="number">0x40301e</span> 下一个函数地址 = <span class="number">0x403020</span> 下一个函数名 = _onexit</span><br><span class="line">当前函数名 = _onexit 当前结束地址 = <span class="number">0x403026</span> 下一个函数地址 = <span class="number">0x403028</span> 下一个函数名 = _initterm</span><br><span class="line">当前函数名 = _initterm 当前结束地址 = <span class="number">0x40302e</span> 下一个函数地址 = <span class="number">0x403030</span> 下一个函数名 = _cexit</span><br><span class="line">当前函数名 = _cexit 当前结束地址 = <span class="number">0x403036</span> 下一个函数地址 = <span class="number">0x403038</span> 下一个函数名 = _amsg_exit</span><br><span class="line">当前函数名 = _amsg_exit 当前结束地址 = <span class="number">0x40303e</span> 下一个函数地址 = <span class="number">0x403040</span> 下一个函数名 = __setusermatherr</span><br><span class="line">当前函数名 = __setusermatherr 当前结束地址 = <span class="number">0x403046</span> 下一个函数地址 = <span class="number">0x403048</span> 下一个函数名 = __set_app_type</span><br><span class="line">当前函数名 = __set_app_type 当前结束地址 = <span class="number">0x40304e</span> 下一个函数地址 = <span class="number">0x403050</span> 下一个函数名 = __lconv_init</span><br><span class="line">当前函数名 = __lconv_init 当前结束地址 = <span class="number">0x403056</span> 下一个函数地址 = <span class="number">0x403058</span> 下一个函数名 = __getmainargs</span><br><span class="line">当前函数名 = __getmainargs 当前结束地址 = <span class="number">0x40305e</span> 下一个函数地址 = <span class="number">0x403060</span> 下一个函数名 = __C_specific_handler</span><br><span class="line">当前函数名 = __C_specific_handler 当前结束地址 = <span class="number">0x403066</span> 下一个函数地址 = <span class="number">0x403070</span> 下一个函数名 = __acrt_iob_func</span><br><span class="line">当前函数名 = __acrt_iob_func 当前结束地址 = <span class="number">0x40308f</span> 下一个函数地址 = <span class="number">0x403090</span> 下一个函数名 = _get_invalid_parameter_handler</span><br><span class="line">当前函数名 = _get_invalid_parameter_handler 当前结束地址 = <span class="number">0x403098</span> 下一个函数地址 = <span class="number">0x4030a0</span> 下一个函数名 = _set_invalid_parameter_handler</span><br><span class="line">当前函数名 = _set_invalid_parameter_handler 当前结束地址 = <span class="number">0x4030ab</span> 下一个函数地址 = <span class="number">0x4030b0</span> 下一个函数名 = __p__acmdln</span><br><span class="line">当前函数名 = __p__acmdln 当前结束地址 = <span class="number">0x4030bb</span> 下一个函数地址 = <span class="number">0x4030c0</span> 下一个函数名 = __p__fmode</span><br><span class="line">当前函数名 = __p__fmode 当前结束地址 = <span class="number">0x4030cb</span> 下一个函数地址 = <span class="number">0x4030d0</span> 下一个函数名 = __iob_func</span><br><span class="line">当前函数名 = __iob_func 当前结束地址 = <span class="number">0x4030d6</span> 下一个函数地址 = <span class="number">0x4030e0</span> 下一个函数名 = VirtualQuery</span><br><span class="line">当前函数名 = VirtualQuery 当前结束地址 = <span class="number">0x4030e6</span> 下一个函数地址 = <span class="number">0x4030e8</span> 下一个函数名 = VirtualProtect</span><br><span class="line">当前函数名 = VirtualProtect 当前结束地址 = <span class="number">0x4030ee</span> 下一个函数地址 = <span class="number">0x4030f0</span> 下一个函数名 = UnhandledExceptionFilter</span><br><span class="line">当前函数名 = UnhandledExceptionFilter 当前结束地址 = <span class="number">0x4030f6</span> 下一个函数地址 = <span class="number">0x4030f8</span> 下一个函数名 = TlsGetValue</span><br><span class="line">当前函数名 = TlsGetValue 当前结束地址 = <span class="number">0x4030fe</span> 下一个函数地址 = <span class="number">0x403100</span> 下一个函数名 = TerminateProcess</span><br><span class="line">当前函数名 = TerminateProcess 当前结束地址 = <span class="number">0x403106</span> 下一个函数地址 = <span class="number">0x403108</span> 下一个函数名 = Sleep</span><br><span class="line">当前函数名 = Sleep 当前结束地址 = <span class="number">0x40310e</span> 下一个函数地址 = <span class="number">0x403110</span> 下一个函数名 = SetUnhandledExceptionFilter</span><br><span class="line">当前函数名 = SetUnhandledExceptionFilter 当前结束地址 = <span class="number">0x403116</span> 下一个函数地址 = <span class="number">0x403118</span> 下一个函数名 = RtlVirtualUnwind</span><br><span class="line">当前函数名 = RtlVirtualUnwind 当前结束地址 = <span class="number">0x40311e</span> 下一个函数地址 = <span class="number">0x403120</span> 下一个函数名 = RtlLookupFunctionEntry</span><br><span class="line">当前函数名 = RtlLookupFunctionEntry 当前结束地址 = <span class="number">0x403126</span> 下一个函数地址 = <span class="number">0x403128</span> 下一个函数名 = RtlCaptureContext</span><br><span class="line">当前函数名 = RtlCaptureContext 当前结束地址 = <span class="number">0x40312e</span> 下一个函数地址 = <span class="number">0x403130</span> 下一个函数名 = RtlAddFunctionTable</span><br><span class="line">当前函数名 = RtlAddFunctionTable 当前结束地址 = <span class="number">0x403136</span> 下一个函数地址 = <span class="number">0x403138</span> 下一个函数名 = QueryPerformanceCounter</span><br><span class="line">当前函数名 = QueryPerformanceCounter 当前结束地址 = <span class="number">0x40313e</span> 下一个函数地址 = <span class="number">0x403140</span> 下一个函数名 = LeaveCriticalSection</span><br><span class="line">当前函数名 = LeaveCriticalSection 当前结束地址 = <span class="number">0x403146</span> 下一个函数地址 = <span class="number">0x403148</span> 下一个函数名 = InitializeCriticalSection</span><br><span class="line">当前函数名 = InitializeCriticalSection 当前结束地址 = <span class="number">0x40314e</span> 下一个函数地址 = <span class="number">0x403150</span> 下一个函数名 = GetTickCount</span><br><span class="line">当前函数名 = GetTickCount 当前结束地址 = <span class="number">0x403156</span> 下一个函数地址 = <span class="number">0x403158</span> 下一个函数名 = GetSystemTimeAsFileTime</span><br><span class="line">当前函数名 = GetSystemTimeAsFileTime 当前结束地址 = <span class="number">0x40315e</span> 下一个函数地址 = <span class="number">0x403160</span> 下一个函数名 = GetStartupInfoA</span><br><span class="line">当前函数名 = GetStartupInfoA 当前结束地址 = <span class="number">0x403166</span> 下一个函数地址 = <span class="number">0x403168</span> 下一个函数名 = GetLastError</span><br><span class="line">当前函数名 = GetLastError 当前结束地址 = <span class="number">0x40316e</span> 下一个函数地址 = <span class="number">0x403170</span> 下一个函数名 = GetCurrentThreadId</span><br><span class="line">当前函数名 = GetCurrentThreadId 当前结束地址 = <span class="number">0x403176</span> 下一个函数地址 = <span class="number">0x403178</span> 下一个函数名 = GetCurrentProcessId</span><br><span class="line">当前函数名 = GetCurrentProcessId 当前结束地址 = <span class="number">0x40317e</span> 下一个函数地址 = <span class="number">0x403180</span> 下一个函数名 = GetCurrentProcess</span><br><span class="line">当前函数名 = GetCurrentProcess 当前结束地址 = <span class="number">0x403186</span> 下一个函数地址 = <span class="number">0x403188</span> 下一个函数名 = EnterCriticalSection</span><br><span class="line">当前函数名 = EnterCriticalSection 当前结束地址 = <span class="number">0x40318e</span> 下一个函数地址 = <span class="number">0x403190</span> 下一个函数名 = DeleteCriticalSection</span><br><span class="line">当前函数名 = DeleteCriticalSection 当前结束地址 = <span class="number">0x403196</span> 下一个函数地址 = <span class="number">0x4031a0</span> 下一个函数名 = .text_46</span><br><span class="line">当前函数名 = .text_46 当前结束地址 = <span class="number">0x403209</span> 下一个函数地址 = <span class="number">0x403210</span> 下一个函数名 = register_frame_ctor</span><br><span class="line">当前函数名 = register_frame_ctor 当前结束地址 = <span class="number">0x403215</span> 下一个函数地址 = <span class="number">0xffffffffffffffff</span> 下一个函数名 = </span><br><span class="line">段名 = .data 起始地址= <span class="number">0x404000</span> 结束地址 = <span class="number">0x405000</span> </span><br><span class="line">段名 = .rdata 起始地址= <span class="number">0x405000</span> 结束地址 = <span class="number">0x406000</span> </span><br><span class="line">段名 = .pdata 起始地址= <span class="number">0x406000</span> 结束地址 = <span class="number">0x407000</span> </span><br><span class="line">段名 = .xdata 起始地址= <span class="number">0x407000</span> 结束地址 = <span class="number">0x408000</span> </span><br><span class="line">段名 = .bss 起始地址= <span class="number">0x408000</span> 结束地址 = <span class="number">0x409000</span> </span><br><span class="line">段名 = .idata 起始地址= <span class="number">0x4091dc</span> 结束地址 = <span class="number">0x40937c</span> </span><br><span class="line">段名 = .CRT 起始地址= <span class="number">0x40a000</span> 结束地址 = <span class="number">0x40b000</span> </span><br><span class="line">段名 = .tls 起始地址= <span class="number">0x40b000</span> 结束地址 = <span class="number">0x40c000</span> </span><br><span class="line">当前选择地址距离当前函数的偏移：__security_init_cookie+9B</span><br></pre></td></tr></table></figure>

<h2 id="7-搜索函数"><a href="#7-搜索函数" class="headerlink" title="7.搜索函数"></a>7.搜索函数</h2><p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411185445159.png" alt="image-20220411185445159"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flag的取值：</span><br><span class="line">SEARCH_DOWN 向下搜索</span><br><span class="line">SEARCH_UP 向上搜索</span><br><span class="line">SEARCH_NEXT 获取下一个找到的对象。</span><br><span class="line">SEARCH_CASE 指定大小写敏感度</span><br><span class="line">SEARCH_UNICODE 搜索 Unicode 字符串。</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"></span><br><span class="line">ea = idc.here()</span><br><span class="line">value = ida_search.find_binary(ea, SEARCH_DOWN, <span class="string">&#x27;8D 4D 08&#x27;</span>)</span><br><span class="line">value1 = ida_search.find_code(ea, SEARCH_DOWN)</span><br><span class="line">value2 = ida_search.find_data(ea, SEARCH_DOWN)</span><br></pre></td></tr></table></figure>

<p>上述idc.find_binary已经不用了，被ida_search.find_binary代替了</p>
<h2 id="8-数据检验函数"><a href="#8-数据检验函数" class="headerlink" title="8.数据检验函数"></a>8.数据检验函数</h2><p>也就是相当于进行一个判断，判断是否传回正确的值！</p>
<p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411190928332.png" alt="image-20220411190928332"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line">ea = here()</span><br><span class="line">value1 = idc.find_code(ea,SEARCH_DOWN)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(value1))</span><br><span class="line">flag = ida_bytes.get_full_flags(value1)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(ida_bytes.is_code(flag))</span><br><span class="line"><span class="comment">#0x401c6e</span></span><br><span class="line"><span class="comment">#67465</span></span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></figure>

<h2 id="9-交叉引用"><a href="#9-交叉引用" class="headerlink" title="9.交叉引用"></a>9.交叉引用</h2><p><img src="/2022/04/11/idapython%E5%88%9D%E6%8E%A2/image-20220411191332094.png" alt="image-20220411191332094"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idc</span><br><span class="line">ea = here()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> CodeRefsTo(ea,<span class="literal">False</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(i))</span><br></pre></td></tr></table></figure>

<p>这个一般是对着函数用的。</p>
<p>就先写这么多，什么时候遇到再补充，最起码现在遇见idapython不慌了！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/03/21/classic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/21/classic/" class="post-title-link" itemprop="url">classicproblem</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-21 17:48:34" itemprop="dateCreated datePublished" datetime="2022-03-21T17:48:34+08:00">2022-03-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:32:11" itemprop="dateModified" datetime="2022-07-18T00:32:11+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="VMproblem"><a href="#VMproblem" class="headerlink" title="VMproblem"></a>VMproblem</h1><p>这是一道vm+golong的题，我们主要学习vm的解题技巧。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">main_main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+10h] [rbp-18h]</span></span><br><span class="line">  <span class="type">void</span> *v2; <span class="comment">// [rsp+18h] [rbp-10h]</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [rsp+28h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;retaddr &lt;= *(_QWORD *)(*(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  v1 = runtime_newobject((__int64)&amp;unk_4D3F60);</span><br><span class="line">  main___ptr_MzVm__init(v1);</span><br><span class="line">  v2 = (<span class="type">void</span> *)runtime_newobject((__int64)&amp;unk_4C3940);</span><br><span class="line">  qmemcpy(v2, &amp;unk_57D8A0, <span class="number">0x2EE0</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( dword_5B97D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v0 = v1;</span><br><span class="line">    *(_QWORD *)(v1 + <span class="number">4096</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  main___ptr_MzVm__run(v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是主函数，能猜测出unk_57D8A0，就是opcode，我个人认为opcode相当于是出题人在这台vm机器上做了什么事！</p>
<p>接下来我们进入函数main___ptr_MzVm__run(v0)，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __golang <span class="title function_">main___ptr_MzVm__run</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// er8</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// esi</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [rsp+18h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;retaddr &lt;= *(_QWORD *)(*(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  v1 = a1;</span><br><span class="line">  <span class="keyword">while</span> ( !*(_BYTE *)(v1 + <span class="number">4904</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_QWORD *)(v1 + <span class="number">4096</span>);</span><br><span class="line">    v3 = *(<span class="type">unsigned</span> <span class="type">int</span> *)(v1 + <span class="number">4084</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt;= <span class="number">0xBB8</span> )</span><br><span class="line">      runtime_panicIndex(v9);</span><br><span class="line">    v4 = *(<span class="type">unsigned</span> <span class="type">int</span> *)(v2 + <span class="number">4</span> * v3);</span><br><span class="line">    v5 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v5 &gt;= <span class="number">0xBB8</span> )</span><br><span class="line">      runtime_panicIndex(v9);</span><br><span class="line">    v6 = *(_DWORD *)(v2 + <span class="number">4</span> * v5);</span><br><span class="line">    v7 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v7 &gt;= <span class="number">0xBB8</span> )</span><br><span class="line">      runtime_panicIndex(v9);</span><br><span class="line">    v8 = *(_DWORD *)(v2 + <span class="number">4</span> * v7);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt;= <span class="number">0x64</span> )                                <span class="comment">//组合为64位</span></span><br><span class="line">      runtime_panicIndex(v9);</span><br><span class="line">    v9 = __PAIR64__(v8, v6);</span><br><span class="line">    (**(<span class="type">void</span> (***)(<span class="type">void</span>))(v1 + <span class="number">8</span> * v4 + <span class="number">4104</span>))();<span class="comment">//这个是opcode的地址，也就是func2的指令</span></span><br><span class="line">    v1 = a1;</span><br><span class="line">    *(_DWORD *)(a1 + <span class="number">4084</span>) += <span class="number">3</span>;<span class="comment">//指令长度3字节</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是说，我们通过对地址偏移的分析，就能够还原每个opcode的指令</p>
<p>先看init的函数，我们的opcode是在这里执行的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line">__int64 (__usercall **__usercall main___ptr_MzVm__init@&lt;rax&gt;(__int64 a1))@&lt;rax&gt;(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 (__usercall **result)@&lt;rax&gt;(__int64); <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [rsp+18h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;retaddr &lt;= *(_QWORD *)(*(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">4904</span>) = <span class="number">0</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">4084</span>) = <span class="number">0x3E800000000</span>LL;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4104</span>) = &amp;off_9462D0;<span class="comment">//这个地址对应的是1，0，87,我们要将func2与其对应</span></span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func2;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4112</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func3;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4120</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func4;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4128</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func5;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4136</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func6;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4144</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func7;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4152</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func8;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4160</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func9;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4168</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func10;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4176</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func11;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4184</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func12;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4192</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func13;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4200</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func14;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4208</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func15;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4216</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func16;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4224</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func17;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4232</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func18;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4880</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func19;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4888</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  runtime_newobject((__int64)&amp;unk_9295E0);</span><br><span class="line">  result = (__int64 (__usercall **)@&lt;rax&gt;(__int64))v2;</span><br><span class="line">  *(_QWORD *)v2 = main___ptr_MzVm__init_func20;</span><br><span class="line">  <span class="keyword">if</span> ( dword_A197D0 )</span><br><span class="line">  &#123;</span><br><span class="line">    runtime_gcWriteBarrierCX();</span><br><span class="line">    <span class="keyword">return</span> (__int64 (__usercall **)@&lt;rax&gt;(__int64))runtime_gcWriteBarrier();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)(v2 + <span class="number">8</span>) = a1;</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">4896</span>) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单分析几个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int64 __usercall main___ptr_MzVm__init_func2@&lt;rax&gt;(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *(_QWORD *)(v1 + <span class="number">8</span>);</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)a1;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)a1 &gt;= <span class="number">0x15</span>uLL )<span class="comment">//存在0x14个寄存器</span></span><br><span class="line">    runtime_panicIndex(v4);</span><br><span class="line">  *(_DWORD *)(v2 + <span class="number">4LL</span> * (<span class="type">unsigned</span> <span class="type">int</span>)a1) = HIDWORD(a1);<span class="comment">//取高位</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>func3  mov r[{Lnum}],r[{Rnum}]</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">__int64 __usercall main___ptr_MzVm__init_func15@&lt;rax&gt;(__int64 a1)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *(_QWORD *)(v1 + <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)a1 &gt;= <span class="number">0x15</span>uLL )</span><br><span class="line">    runtime_panicIndex(v4);</span><br><span class="line">  <span class="keyword">if</span> ( HIDWORD(a1) &gt;= <span class="number">0x15</span>uLL )</span><br><span class="line">    runtime_panicIndex(v4);</span><br><span class="line">  result = *(<span class="type">unsigned</span> <span class="type">int</span> *)(v2 + <span class="number">4LL</span> * HIDWORD(a1));</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result != *(_DWORD *)(v2 + <span class="number">4LL</span> * (<span class="type">unsigned</span> <span class="type">int</span>)a1) )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="number">3</span> * *(_DWORD *)(v2 + <span class="number">76</span>));</span><br><span class="line">    *(_DWORD *)(v2 + <span class="number">4084</span>) = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个明显是个对比函数，cmp R[{num}] R[{right}], jne R[19]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">op=[[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">87</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">101</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">108</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">99</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">111</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">109</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">101</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">32</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">116</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">111</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">32</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">86</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">78</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">67</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">84</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">70</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">50</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">48</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">50</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">50</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">33</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">10</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">105</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">110</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">112</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">117</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">116</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">32</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">102</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">108</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">97</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">103</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">58</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">10</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">73</span>], [<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">43</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>], [<span class="number">97</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">8</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">7</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">7</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">8</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">8</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">10</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">10</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">11</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">11</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">12</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">12</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">13</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">13</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">15</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">15</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">256</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">16</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">16</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">7</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">7</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">11</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">12</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">13</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">5</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">284</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">340</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">3906065887</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">387</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">339</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">4125344020</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">295</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">340</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">579781142</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">387</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">339</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2312395361</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">306</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">340</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1700499305</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">387</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">339</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">612671610</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">317</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">340</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">3655723000</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">387</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">339</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">977540402</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">328</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">340</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">2443935368</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">387</span>], [<span class="number">1</span>, <span class="number">20</span>, <span class="number">339</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1778148540</span>], [<span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">6</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">8206181</span>], [<span class="number">14</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">393</span>], [<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">99</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2654435769</span>], [<span class="number">1</span>, <span class="number">4</span>, <span class="number">613452</span>], [<span class="number">1</span>, <span class="number">5</span>, <span class="number">34589</span>], [<span class="number">1</span>, <span class="number">6</span>, <span class="number">108471</span>], [<span class="number">1</span>, <span class="number">7</span>, <span class="number">1230791</span>], [<span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">17</span>, <span class="number">16</span>], [<span class="number">1</span>, <span class="number">18</span>, <span class="number">32</span>], [<span class="number">1</span>, <span class="number">19</span>, <span class="number">352</span>], [<span class="number">1</span>, <span class="number">10</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">11</span>, <span class="number">32</span>], [<span class="number">1</span>, <span class="number">12</span>, <span class="number">1</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">17</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">8</span>], [<span class="number">2</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>], [<span class="number">9</span>, <span class="number">0</span>, <span class="number">18</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">5</span>], [<span class="number">2</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>], [<span class="number">11</span>, <span class="number">0</span>, <span class="number">15</span>], [<span class="number">11</span>, <span class="number">0</span>, <span class="number">16</span>], [<span class="number">7</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">10</span>, <span class="number">0</span>, <span class="number">17</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">6</span>], [<span class="number">2</span>, <span class="number">14</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">8</span>], [<span class="number">2</span>, <span class="number">15</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">9</span>, <span class="number">0</span>, <span class="number">18</span>], [<span class="number">7</span>, <span class="number">0</span>, <span class="number">7</span>], [<span class="number">2</span>, <span class="number">16</span>, <span class="number">0</span>], [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>], [<span class="number">11</span>, <span class="number">0</span>, <span class="number">15</span>], [<span class="number">11</span>, <span class="number">0</span>, <span class="number">16</span>], [<span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>], [<span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>], [<span class="number">14</span>, <span class="number">11</span>, <span class="number">10</span>], [<span class="number">12</span>, <span class="number">20</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">110</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">111</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">12</span>, <span class="number">20</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">121</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">101</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">115</span>], [<span class="number">98</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">12</span>, <span class="number">20</span>, <span class="number">0</span>]]</span><br><span class="line">f=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(op),<span class="number">1</span>):</span><br><span class="line">   <span class="keyword">if</span> op[i][<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> f:</span><br><span class="line">       f.append(op[i][<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(op)):</span><br><span class="line"></span><br><span class="line">    adr=op[i][<span class="number">0</span>]</span><br><span class="line">    Lnum=op[i][<span class="number">1</span>]</span><br><span class="line">    Rnum=op[i][<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> adr==<span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;nop&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;mov r[<span class="subst">&#123;Lnum&#125;</span>],<span class="subst">&#123;<span class="built_in">hex</span>(Rnum)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;mov r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">5</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;push r[<span class="subst">&#123;Lnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">6</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;pop r[<span class="subst">&#123;Lnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">7</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;add r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">8</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;sub r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">9</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;div r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">10</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;mul r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">11</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;xor r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">12</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;jmp r[<span class="subst">&#123;Lnum&#125;</span>]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">14</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;cmp r[<span class="subst">&#123;Lnum&#125;</span>],r[<span class="subst">&#123;Rnum&#125;</span>] -- jnz r[19]&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">0x61</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;getchar(r[<span class="subst">&#123;Lnum&#125;</span>])&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">0x62</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&#x27;putchar(r[<span class="subst">&#123;Lnum&#125;</span>)]&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> adr==<span class="number">0x63</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s: &quot;</span>%<span class="built_in">hex</span>(i)+<span class="string">f&quot;exit()&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0</span>: nop</span><br><span class="line"><span class="number">0x1</span>: nop</span><br><span class="line"><span class="number">0x2</span>: mov r[<span class="number">0</span>],<span class="number">0x57</span></span><br><span class="line"><span class="number">0x3</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x4</span>: mov r[<span class="number">0</span>],<span class="number">0x65</span></span><br><span class="line"><span class="number">0x5</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x6</span>: mov r[<span class="number">0</span>],<span class="number">0x6c</span></span><br><span class="line"><span class="number">0x7</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x8</span>: mov r[<span class="number">0</span>],<span class="number">0x63</span></span><br><span class="line"><span class="number">0x9</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0xa</span>: mov r[<span class="number">0</span>],<span class="number">0x6f</span></span><br><span class="line"><span class="number">0xb</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0xc</span>: mov r[<span class="number">0</span>],<span class="number">0x6d</span></span><br><span class="line"><span class="number">0xd</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0xe</span>: mov r[<span class="number">0</span>],<span class="number">0x65</span></span><br><span class="line"><span class="number">0xf</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x10</span>: mov r[<span class="number">0</span>],<span class="number">0x20</span></span><br><span class="line"><span class="number">0x11</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x12</span>: mov r[<span class="number">0</span>],<span class="number">0x74</span></span><br><span class="line"><span class="number">0x13</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x14</span>: mov r[<span class="number">0</span>],<span class="number">0x6f</span></span><br><span class="line"><span class="number">0x15</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x16</span>: mov r[<span class="number">0</span>],<span class="number">0x20</span></span><br><span class="line"><span class="number">0x17</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x18</span>: mov r[<span class="number">0</span>],<span class="number">0x56</span></span><br><span class="line"><span class="number">0x19</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x1a</span>: mov r[<span class="number">0</span>],<span class="number">0x4e</span></span><br><span class="line"><span class="number">0x1b</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x1c</span>: mov r[<span class="number">0</span>],<span class="number">0x43</span></span><br><span class="line"><span class="number">0x1d</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x1e</span>: mov r[<span class="number">0</span>],<span class="number">0x54</span></span><br><span class="line"><span class="number">0x1f</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x20</span>: mov r[<span class="number">0</span>],<span class="number">0x46</span></span><br><span class="line"><span class="number">0x21</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x22</span>: mov r[<span class="number">0</span>],<span class="number">0x32</span></span><br><span class="line"><span class="number">0x23</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x24</span>: mov r[<span class="number">0</span>],<span class="number">0x30</span></span><br><span class="line"><span class="number">0x25</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x26</span>: mov r[<span class="number">0</span>],<span class="number">0x32</span></span><br><span class="line"><span class="number">0x27</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x28</span>: mov r[<span class="number">0</span>],<span class="number">0x32</span></span><br><span class="line"><span class="number">0x29</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x2a</span>: mov r[<span class="number">0</span>],<span class="number">0x21</span></span><br><span class="line"><span class="number">0x2b</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x2c</span>: mov r[<span class="number">0</span>],<span class="number">0xa</span></span><br><span class="line"><span class="number">0x2d</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x2e</span>: mov r[<span class="number">0</span>],<span class="number">0x69</span></span><br><span class="line"><span class="number">0x2f</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x30</span>: mov r[<span class="number">0</span>],<span class="number">0x6e</span></span><br><span class="line"><span class="number">0x31</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x32</span>: mov r[<span class="number">0</span>],<span class="number">0x70</span></span><br><span class="line"><span class="number">0x33</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x34</span>: mov r[<span class="number">0</span>],<span class="number">0x75</span></span><br><span class="line"><span class="number">0x35</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x36</span>: mov r[<span class="number">0</span>],<span class="number">0x74</span></span><br><span class="line"><span class="number">0x37</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x38</span>: mov r[<span class="number">0</span>],<span class="number">0x20</span></span><br><span class="line"><span class="number">0x39</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x3a</span>: mov r[<span class="number">0</span>],<span class="number">0x66</span></span><br><span class="line"><span class="number">0x3b</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x3c</span>: mov r[<span class="number">0</span>],<span class="number">0x6c</span></span><br><span class="line"><span class="number">0x3d</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x3e</span>: mov r[<span class="number">0</span>],<span class="number">0x61</span></span><br><span class="line"><span class="number">0x3f</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x40</span>: mov r[<span class="number">0</span>],<span class="number">0x67</span></span><br><span class="line"><span class="number">0x41</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x42</span>: mov r[<span class="number">0</span>],<span class="number">0x3a</span></span><br><span class="line"><span class="number">0x43</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x44</span>: mov r[<span class="number">0</span>],<span class="number">0xa</span></span><br><span class="line"><span class="number">0x45</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)] <span class="comment">//输出函数，下面要输入了</span></span><br><span class="line"><span class="number">0x46</span>: mov r[<span class="number">19</span>],<span class="number">0x49</span> </span><br><span class="line"><span class="number">0x47</span>: mov r[<span class="number">3</span>],<span class="number">0x0</span></span><br><span class="line"><span class="number">0x48</span>: mov r[<span class="number">1</span>],<span class="number">0x2b</span>  <span class="comment">//循环43次，知道了字符串长度</span></span><br><span class="line"><span class="number">0x49</span>: mov r[<span class="number">2</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">0x4a</span>: getchar(r[<span class="number">0</span>])<span class="comment">//获取输入</span></span><br><span class="line"><span class="number">0x4b</span>: push r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x4c</span>: sub r[<span class="number">1</span>],r[<span class="number">2</span>]  <span class="comment">//循环递减</span></span><br><span class="line"><span class="number">0x4d</span>: cmp r[<span class="number">1</span>],r[<span class="number">3</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x4e</span>: mov r[<span class="number">0</span>],<span class="number">0x0</span></span><br><span class="line"><span class="number">0x4f</span>: push r[<span class="number">0</span>]  <span class="comment">//多push⼀个0，44个byte转成11个int</span></span><br><span class="line"><span class="number">0x50</span>: nop</span><br><span class="line"><span class="number">0x51</span>: nop                <span class="comment">// 检验flag</span></span><br><span class="line"><span class="number">0x52</span>: pop r[<span class="number">0</span>]           </span><br><span class="line"><span class="number">0x53</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span>     <span class="comment">// 2的8次⽅，⽤于代替位移运算</span></span><br><span class="line"><span class="number">0x54</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]      <span class="comment">// r0=r0*256 -&gt; &lt;&lt; 8</span></span><br><span class="line"><span class="number">0x55</span>: mov r[<span class="number">6</span>],r[<span class="number">0</span>]      <span class="comment">// r6=r0</span></span><br><span class="line"><span class="number">0x56</span>: pop r[<span class="number">0</span>]           <span class="comment">// 将输⼊从末尾取出来</span></span><br><span class="line"><span class="number">0x57</span>: add r[<span class="number">6</span>],r[<span class="number">0</span>]      <span class="comment">// 加上之前的</span></span><br><span class="line"><span class="number">0x58</span>: mov r[<span class="number">0</span>],r[<span class="number">6</span>] </span><br><span class="line"><span class="number">0x59</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>] </span><br><span class="line"><span class="number">0x5a</span>: mov r[<span class="number">6</span>],r[<span class="number">0</span>]      <span class="comment">// 再次位移后放到r6</span></span><br><span class="line"><span class="number">0x5b</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x5c</span>: add r[<span class="number">6</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x5d</span>: mov r[<span class="number">0</span>],r[<span class="number">6</span>]</span><br><span class="line"><span class="number">0x5e</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x5f</span>: mov r[<span class="number">6</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x60</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x61</span>: add r[<span class="number">6</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x62</span>: nop                <span class="comment">//用nop分割，下面是重复上面的</span></span><br><span class="line"><span class="number">0x63</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x64</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0x65</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x66</span>: mov r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x67</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x68</span>: add r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x69</span>: mov r[<span class="number">0</span>],r[<span class="number">7</span>]</span><br><span class="line"><span class="number">0x6a</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x6b</span>: mov r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x6c</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x6d</span>: add r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x6e</span>: mov r[<span class="number">0</span>],r[<span class="number">7</span>]</span><br><span class="line"><span class="number">0x6f</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x70</span>: mov r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x71</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x72</span>: add r[<span class="number">7</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x73</span>: nop</span><br><span class="line"><span class="number">0x74</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x75</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0x76</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x77</span>: mov r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x78</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x79</span>: add r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x7a</span>: mov r[<span class="number">0</span>],r[<span class="number">8</span>]</span><br><span class="line"><span class="number">0x7b</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x7c</span>: mov r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x7d</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x7e</span>: add r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x7f</span>: mov r[<span class="number">0</span>],r[<span class="number">8</span>]</span><br><span class="line"><span class="number">0x80</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x81</span>: mov r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x82</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x83</span>: add r[<span class="number">8</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x84</span>: nop</span><br><span class="line"><span class="number">0x85</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x86</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0x87</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x88</span>: mov r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x89</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x8a</span>: add r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x8b</span>: mov r[<span class="number">0</span>],r[<span class="number">9</span>]</span><br><span class="line"><span class="number">0x8c</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x8d</span>: mov r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x8e</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x8f</span>: add r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x90</span>: mov r[<span class="number">0</span>],r[<span class="number">9</span>]</span><br><span class="line"><span class="number">0x91</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x92</span>: mov r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x93</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x94</span>: add r[<span class="number">9</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x95</span>: nop</span><br><span class="line"><span class="number">0x96</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x97</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0x98</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x99</span>: mov r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x9a</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x9b</span>: add r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x9c</span>: mov r[<span class="number">0</span>],r[<span class="number">10</span>]</span><br><span class="line"><span class="number">0x9d</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x9e</span>: mov r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x9f</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa0</span>: add r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa1</span>: mov r[<span class="number">0</span>],r[<span class="number">10</span>]</span><br><span class="line"><span class="number">0xa2</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xa3</span>: mov r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa4</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa5</span>: add r[<span class="number">10</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa6</span>: nop</span><br><span class="line"><span class="number">0xa7</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xa8</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xa9</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xaa</span>: mov r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xab</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xac</span>: add r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xad</span>: mov r[<span class="number">0</span>],r[<span class="number">11</span>]</span><br><span class="line"><span class="number">0xae</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xaf</span>: mov r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb0</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb1</span>: add r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb2</span>: mov r[<span class="number">0</span>],r[<span class="number">11</span>]</span><br><span class="line"><span class="number">0xb3</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xb4</span>: mov r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb5</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb6</span>: add r[<span class="number">11</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb7</span>: nop</span><br><span class="line"><span class="number">0xb8</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xb9</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xba</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xbb</span>: mov r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xbc</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xbd</span>: add r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xbe</span>: mov r[<span class="number">0</span>],r[<span class="number">12</span>]</span><br><span class="line"><span class="number">0xbf</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xc0</span>: mov r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc1</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc2</span>: add r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc3</span>: mov r[<span class="number">0</span>],r[<span class="number">12</span>]</span><br><span class="line"><span class="number">0xc4</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xc5</span>: mov r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc6</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc7</span>: add r[<span class="number">12</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xc8</span>: nop</span><br><span class="line"><span class="number">0xc9</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xca</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xcb</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xcc</span>: mov r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xcd</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xce</span>: add r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xcf</span>: mov r[<span class="number">0</span>],r[<span class="number">13</span>]</span><br><span class="line"><span class="number">0xd0</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xd1</span>: mov r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd2</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd3</span>: add r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd4</span>: mov r[<span class="number">0</span>],r[<span class="number">13</span>]</span><br><span class="line"><span class="number">0xd5</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xd6</span>: mov r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd7</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd8</span>: add r[<span class="number">13</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xd9</span>: nop</span><br><span class="line"><span class="number">0xda</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xdb</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xdc</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xdd</span>: mov r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xde</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xdf</span>: add r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe0</span>: mov r[<span class="number">0</span>],r[<span class="number">14</span>]</span><br><span class="line"><span class="number">0xe1</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xe2</span>: mov r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe3</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe4</span>: add r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe5</span>: mov r[<span class="number">0</span>],r[<span class="number">14</span>]</span><br><span class="line"><span class="number">0xe6</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xe7</span>: mov r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe8</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xe9</span>: add r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xea</span>: nop</span><br><span class="line"><span class="number">0xeb</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xec</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xed</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xee</span>: mov r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xef</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf0</span>: add r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf1</span>: mov r[<span class="number">0</span>],r[<span class="number">15</span>]</span><br><span class="line"><span class="number">0xf2</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xf3</span>: mov r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf4</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf5</span>: add r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf6</span>: mov r[<span class="number">0</span>],r[<span class="number">15</span>]</span><br><span class="line"><span class="number">0xf7</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xf8</span>: mov r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xf9</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xfa</span>: add r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xfb</span>: nop</span><br><span class="line"><span class="number">0xfc</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0xfd</span>: mov r[<span class="number">5</span>],<span class="number">0x100</span></span><br><span class="line"><span class="number">0xfe</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0xff</span>: mov r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x100</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x101</span>: add r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x102</span>: mov r[<span class="number">0</span>],r[<span class="number">16</span>]</span><br><span class="line"><span class="number">0x103</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x104</span>: mov r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x105</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x106</span>: add r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x107</span>: mov r[<span class="number">0</span>],r[<span class="number">16</span>]</span><br><span class="line"><span class="number">0x108</span>: mul r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x109</span>: mov r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x10a</span>: pop r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x10b</span>: add r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x10c</span>: nop</span><br><span class="line"><span class="number">0x10d</span>: push r[<span class="number">6</span>]</span><br><span class="line"><span class="number">0x10e</span>: push r[<span class="number">7</span>]</span><br><span class="line"><span class="number">0x10f</span>: push r[<span class="number">8</span>]</span><br><span class="line"><span class="number">0x110</span>: push r[<span class="number">9</span>]</span><br><span class="line"><span class="number">0x111</span>: push r[<span class="number">10</span>]</span><br><span class="line"><span class="number">0x112</span>: push r[<span class="number">11</span>]</span><br><span class="line"><span class="number">0x113</span>: push r[<span class="number">12</span>]</span><br><span class="line"><span class="number">0x114</span>: push r[<span class="number">13</span>]</span><br><span class="line"><span class="number">0x115</span>: push r[<span class="number">14</span>]</span><br><span class="line"><span class="number">0x116</span>: push r[<span class="number">15</span>]</span><br><span class="line"><span class="number">0x117</span>: push r[<span class="number">16</span>]  <span class="comment">//十个值在寄存器中，此时全部转化为了uint32 将他们全部压栈</span></span><br><span class="line"><span class="number">0x118</span>: pop r[<span class="number">1</span>]    </span><br><span class="line"><span class="number">0x119</span>: pop r[<span class="number">2</span>]    <span class="comment">//调用两个参数</span></span><br><span class="line"><span class="number">0x11a</span>: mov r[<span class="number">20</span>],<span class="number">0x11c</span></span><br><span class="line"><span class="number">0x11b</span>: mov r[<span class="number">0</span>],<span class="number">0x154</span></span><br><span class="line"><span class="number">0x11c</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x11d</span>: mov r[<span class="number">0</span>],<span class="number">0xe8d1d5df</span>            <span class="comment">// 对⽐结果</span></span><br><span class="line"><span class="number">0x11e</span>: mov r[<span class="number">19</span>],<span class="number">0x183</span>               <span class="comment">// 错误输出的地址</span></span><br><span class="line"><span class="number">0x11f</span>: mov r[<span class="number">20</span>],<span class="number">0x153</span>               <span class="comment">//  返回地址，直接结束</span></span><br><span class="line"><span class="number">0x120</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]  <span class="comment">// ⽐较，不同就到错误输出</span></span><br><span class="line"><span class="number">0x121</span>: mov r[<span class="number">0</span>],<span class="number">0xf5e3c114</span></span><br><span class="line"><span class="number">0x122</span>: cmp r[<span class="number">2</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]  <span class="comment">// ⽐较，不同就到错误输出</span></span><br><span class="line"><span class="number">0x123</span>: pop r[<span class="number">1</span>]    ---------------------------第⼆轮加密和比较以此类推</span><br><span class="line"><span class="number">0x124</span>: pop r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x125</span>: mov r[<span class="number">20</span>],<span class="number">0x127</span></span><br><span class="line"><span class="number">0x126</span>: mov r[<span class="number">0</span>],<span class="number">0x154</span></span><br><span class="line"><span class="number">0x127</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x128</span>: mov r[<span class="number">0</span>],<span class="number">0x228ec216</span></span><br><span class="line"><span class="number">0x129</span>: mov r[<span class="number">19</span>],<span class="number">0x183</span></span><br><span class="line"><span class="number">0x12a</span>: mov r[<span class="number">20</span>],<span class="number">0x153</span></span><br><span class="line"><span class="number">0x12b</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x12c</span>: mov r[<span class="number">0</span>],<span class="number">0x89d45a61</span></span><br><span class="line"><span class="number">0x12d</span>: cmp r[<span class="number">2</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x12e</span>: pop r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x12f</span>: pop r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x130</span>: mov r[<span class="number">20</span>],<span class="number">0x132</span></span><br><span class="line"><span class="number">0x131</span>: mov r[<span class="number">0</span>],<span class="number">0x154</span></span><br><span class="line"><span class="number">0x132</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x133</span>: mov r[<span class="number">0</span>],<span class="number">0x655b8f69</span></span><br><span class="line"><span class="number">0x134</span>: mov r[<span class="number">19</span>],<span class="number">0x183</span></span><br><span class="line"><span class="number">0x135</span>: mov r[<span class="number">20</span>],<span class="number">0x153</span></span><br><span class="line"><span class="number">0x136</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x137</span>: mov r[<span class="number">0</span>],<span class="number">0x2484a07a</span></span><br><span class="line"><span class="number">0x138</span>: cmp r[<span class="number">2</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x139</span>: pop r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x13a</span>: pop r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x13b</span>: mov r[<span class="number">20</span>],<span class="number">0x13d</span></span><br><span class="line"><span class="number">0x13c</span>: mov r[<span class="number">0</span>],<span class="number">0x154</span></span><br><span class="line"><span class="number">0x13d</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x13e</span>: mov r[<span class="number">0</span>],<span class="number">0xd9e5e7f8</span></span><br><span class="line"><span class="number">0x13f</span>: mov r[<span class="number">19</span>],<span class="number">0x183</span></span><br><span class="line"><span class="number">0x140</span>: mov r[<span class="number">20</span>],<span class="number">0x153</span></span><br><span class="line"><span class="number">0x141</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x142</span>: mov r[<span class="number">0</span>],<span class="number">0x3a441532</span></span><br><span class="line"><span class="number">0x143</span>: cmp r[<span class="number">2</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x144</span>: pop r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x145</span>: pop r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x146</span>: mov r[<span class="number">20</span>],<span class="number">0x148</span></span><br><span class="line"><span class="number">0x147</span>: mov r[<span class="number">0</span>],<span class="number">0x154</span></span><br><span class="line"><span class="number">0x148</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x149</span>: mov r[<span class="number">0</span>],<span class="number">0x91ab7e88</span></span><br><span class="line"><span class="number">0x14a</span>: mov r[<span class="number">19</span>],<span class="number">0x183</span></span><br><span class="line"><span class="number">0x14b</span>: mov r[<span class="number">20</span>],<span class="number">0x153</span></span><br><span class="line"><span class="number">0x14c</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x14d</span>: mov r[<span class="number">0</span>],<span class="number">0x69fc64bc</span></span><br><span class="line"><span class="number">0x14e</span>: cmp r[<span class="number">2</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x14f</span>: pop r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x150</span>: mov r[<span class="number">0</span>],<span class="number">0x7d3765</span></span><br><span class="line"><span class="number">0x151</span>: cmp r[<span class="number">1</span>],r[<span class="number">0</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x152</span>: mov r[<span class="number">0</span>],<span class="number">0x189</span></span><br><span class="line"><span class="number">0x153</span>: jmp r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x154</span>: <span class="built_in">exit</span>()</span><br><span class="line"><span class="number">0x155</span>: mov r[<span class="number">3</span>],<span class="number">0x9e3779b9</span>    <span class="comment">//delta，太经典了</span></span><br><span class="line"><span class="number">0x156</span>: mov r[<span class="number">4</span>],<span class="number">0x95c4c</span>       <span class="comment">//key1</span></span><br><span class="line"><span class="number">0x157</span>: mov r[<span class="number">5</span>],<span class="number">0x871d</span>        <span class="comment">//key2</span></span><br><span class="line"><span class="number">0x158</span>: mov r[<span class="number">6</span>],<span class="number">0x1a7b7</span>       <span class="comment">//key3</span></span><br><span class="line"><span class="number">0x159</span>: mov r[<span class="number">7</span>],<span class="number">0x12c7c7</span>      <span class="comment">//key4</span></span><br><span class="line"><span class="number">0x15a</span>: mov r[<span class="number">8</span>],<span class="number">0x0</span>           <span class="comment">// sum</span></span><br><span class="line"><span class="number">0x15b</span>: mov r[<span class="number">17</span>],<span class="number">0x10</span>         <span class="comment">// 常量16 ⽤于位移4</span></span><br><span class="line"><span class="number">0x15c</span>: mov r[<span class="number">18</span>],<span class="number">0x20</span>         <span class="comment">// 常量32 ⽤于位移5</span></span><br><span class="line"><span class="number">0x15d</span>: mov r[<span class="number">19</span>],<span class="number">0x160</span></span><br><span class="line"><span class="number">0x15e</span>: mov r[<span class="number">10</span>],<span class="number">0x0</span>          <span class="comment">//⽤来对⽐次数</span></span><br><span class="line"><span class="number">0x15f</span>: mov r[<span class="number">11</span>],<span class="number">0x20</span>         <span class="comment">//循环次数32次 加密轮数</span></span><br><span class="line"><span class="number">0x160</span>: mov r[<span class="number">12</span>],<span class="number">0x1</span>          <span class="comment">// 跳转回这⾥的下⼀⾏</span></span><br><span class="line"><span class="number">0x161</span>: add r[<span class="number">8</span>],r[<span class="number">3</span>]          <span class="comment">// sum += delta</span></span><br><span class="line"><span class="number">0x162</span>: mov r[<span class="number">0</span>],r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x163</span>: mul r[<span class="number">0</span>],r[<span class="number">17</span>]</span><br><span class="line"><span class="number">0x164</span>: add r[<span class="number">0</span>],r[<span class="number">4</span>]</span><br><span class="line"><span class="number">0x165</span>: mov r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x166</span>: mov r[<span class="number">0</span>],r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x167</span>: add r[<span class="number">0</span>],r[<span class="number">8</span>]</span><br><span class="line"><span class="number">0x168</span>: mov r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x169</span>: mov r[<span class="number">0</span>],r[<span class="number">2</span>]</span><br><span class="line"><span class="number">0x16a</span>: div r[<span class="number">0</span>],r[<span class="number">18</span>]</span><br><span class="line"><span class="number">0x16b</span>: add r[<span class="number">0</span>],r[<span class="number">5</span>]</span><br><span class="line"><span class="number">0x16c</span>: mov r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x16d</span>: mov r[<span class="number">0</span>],r[<span class="number">14</span>]</span><br><span class="line"><span class="number">0x16e</span>: xor r[<span class="number">0</span>],r[<span class="number">15</span>]</span><br><span class="line"><span class="number">0x16f</span>: xor r[<span class="number">0</span>],r[<span class="number">16</span>]</span><br><span class="line"><span class="number">0x170</span>: add r[<span class="number">1</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x171</span>: mov r[<span class="number">0</span>],r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x172</span>: mul r[<span class="number">0</span>],r[<span class="number">17</span>]</span><br><span class="line"><span class="number">0x173</span>: add r[<span class="number">0</span>],r[<span class="number">6</span>]</span><br><span class="line"><span class="number">0x174</span>: mov r[<span class="number">14</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x175</span>: mov r[<span class="number">0</span>],r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x176</span>: add r[<span class="number">0</span>],r[<span class="number">8</span>]</span><br><span class="line"><span class="number">0x177</span>: mov r[<span class="number">15</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x178</span>: mov r[<span class="number">0</span>],r[<span class="number">1</span>]</span><br><span class="line"><span class="number">0x179</span>: div r[<span class="number">0</span>],r[<span class="number">18</span>]</span><br><span class="line"><span class="number">0x17a</span>: add r[<span class="number">0</span>],r[<span class="number">7</span>]</span><br><span class="line"><span class="number">0x17b</span>: mov r[<span class="number">16</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x17c</span>: mov r[<span class="number">0</span>],r[<span class="number">14</span>]</span><br><span class="line"><span class="number">0x17d</span>: xor r[<span class="number">0</span>],r[<span class="number">15</span>]</span><br><span class="line"><span class="number">0x17e</span>: xor r[<span class="number">0</span>],r[<span class="number">16</span>]</span><br><span class="line"><span class="number">0x17f</span>: add r[<span class="number">2</span>],r[<span class="number">0</span>]</span><br><span class="line"><span class="number">0x180</span>: sub r[<span class="number">11</span>],r[<span class="number">12</span>]</span><br><span class="line"><span class="number">0x181</span>: cmp r[<span class="number">11</span>],r[<span class="number">10</span>] -- jnz r[<span class="number">19</span>]</span><br><span class="line"><span class="number">0x182</span>: jmp r[<span class="number">20</span>]                <span class="comment">// jmp r20 函数返回</span></span><br><span class="line"><span class="number">0x183</span>: nop </span><br><span class="line"><span class="number">0x184</span>: mov r[<span class="number">0</span>],<span class="number">0x6e</span></span><br><span class="line"><span class="number">0x185</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x186</span>: mov r[<span class="number">0</span>],<span class="number">0x6f</span></span><br><span class="line"><span class="number">0x187</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br><span class="line"><span class="number">0x188</span>: jmp r[<span class="number">20</span>]</span><br><span class="line"><span class="number">0x189</span>: nop</span><br><span class="line"><span class="number">0x18a</span>: mov r[<span class="number">0</span>],<span class="number">0x79</span></span><br><span class="line"><span class="number">0x18b</span>: <span class="built_in">putchar</span>(r[<span class="number">0</span>)]</span><br></pre></td></tr></table></figure>

<p>这个delta一出来，应该是个tea加密，key也有了，我们解密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span> <span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0=v[<span class="number">0</span>], v1=v[<span class="number">1</span>], sum=<span class="number">0xC6EF3720</span>, i;  <span class="comment">/* set up */</span></span><br><span class="line">    <span class="type">uint32_t</span> delta=<span class="number">0x9e3779b9</span>;                     <span class="comment">/* a key schedule constant */</span></span><br><span class="line">    <span class="type">uint32_t</span> k0=k[<span class="number">0</span>], k1=k[<span class="number">1</span>], k2=k[<span class="number">2</span>], k3=k[<span class="number">3</span>];   <span class="comment">/* cache key */</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;                         <span class="comment">/* basic cycle start */</span></span><br><span class="line">        v1 -= ((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;                                              <span class="comment">/* end cycle */</span></span><br><span class="line">    v[<span class="number">0</span>]=v0; v[<span class="number">1</span>]=v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">12</span>] = &#123;<span class="number">0xe8d1d5df</span>, <span class="number">0xf5e3c114</span>, <span class="number">0x228ec216</span>, <span class="number">0x89d45a61</span>, <span class="number">0x655b8f69</span>, <span class="number">0x2484a07a</span>, <span class="number">0xd9e5e7f8</span>, <span class="number">0x3a441532</span>, <span class="number">0x91ab7e88</span>, <span class="number">0x69fc64bc</span>, <span class="number">0x7d3765</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>] = &#123;<span class="number">0x95c4c</span>, <span class="number">0x871d</span>, <span class="number">0x1a7b7</span>, <span class="number">0x12c7c7</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        decrypt(v+i*<span class="number">2</span>, k);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>*)v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到flag：VNCTF{ecd63ae5-8945-4ac4-b5a5-34fc3ade81e7}</p>
<p>从这道题，还学会了稍微恢复一下vm，即创造结构体。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="constructor">HIDWORD(<span class="params">a1</span>)</span> &gt;= <span class="number">0x15</span>uLL )<span class="comment">//我们能推测出寄存器个数</span></span><br></pre></td></tr></table></figure>

<p>还可以推测栈的大小</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">func</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">void</span> *call;</span><br><span class="line">  vm *ptr;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">REG</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  _DWORD R[<span class="number">21</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vm</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  REG reg;</span><br><span class="line">  _DWORD Memory[<span class="number">1000</span>];</span><br><span class="line">  _DWORD rip;</span><br><span class="line">  _DWORD index;</span><br><span class="line">  <span class="type">void</span> *data;</span><br><span class="line">  func *func[<span class="number">100</span>];</span><br><span class="line">  _QWORD isExit;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>从而创建结构体，然后更好的分析。</p>
<p>未完待续</p>
<h1 id="wasm"><a href="#wasm" class="headerlink" title="wasm"></a>wasm</h1><p>WebAssembly是一种全新的Web编程语言，但是与JavaScript不同，它不是一种让你直接手动编写的语言，而是C &#x2F; C ++，Rust，C＃和TypeScript等<a href="https://link.zhihu.com/?target=https://stackoverflow.com/a/47483989/249933">不断增加的上层语言</a>的编译目标。</p>
<p>wasm是基于堆栈的虚拟机的二进制指令格式</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wat2wasm.1.html">wat2wasm</a>：从WebAssembly文本格式转换为 WebAssembly二进制格式</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm2wat.1.html">wasm2wat</a>：<a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm2wat.1.html">wat2wasm</a>的逆函数，从二进制格式转换回文本格式（也称为.wat）</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-objdump.1.html">wasm-objdump</a>：显示有关wasm二进制文件的信息。与objdump类似。</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-interp.1.html">wasm-interp</a>：使用基于堆栈的解释器解码并运行WebAssembly二进制文件</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-decompile.1.html">wasm-decompile</a>：将wasm二进制文件反编译为可读的类似C的语法。</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wat-desugar.1.html">wat-</a> desugar：解析规范解释程序支持的.wat文本格式（S表达式，平面语法或混合格式）并打印“规范”平面格式</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm2c.1.html">wasm2c</a>：将WebAssembly二进制文件转换为C源代码和标头</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-strip.1.html">wasm-strip</a>：删除WebAssembly二进制文件的部分</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-validate.1.html">wasm-validate</a>：验证WebAssembly二进制格式的文件</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wast2json.1.html">wast2json</a>：将wasm spec测试格式的文件转换为JSON文件和关联的wasm二进制文件</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/wasm-opcodecnt.1.html">wasm-opcodecnt</a>：计算指令的操作码使用量</li>
<li><a target="_blank" rel="noopener" href="https://webassembly.github.io/wabt/doc/spectest-interp.1.html">spectest-interp</a>：读取Spectest JSON文件，然后在解释器中运行其测</li>
</ul>
<p>这种类型的题，主要是看处理阶段比较难办，分为两种方法</p>
<p>第一种就是静态分析</p>
<p>我们需要先下载wabt包，然后make一下，之后再进行对wasm文件的反编译</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm<span class="number">2</span><span class="keyword">c</span> xorwasm.wasm -o xorwasm.<span class="keyword">c</span></span><br></pre></td></tr></table></figure>

<p>然后得到还原的c文件和h头文件，之后将wasm-rt.h和wasm-rt-impl.h头⽂件移动到我们反编译出来的.c和.h⽂件夹下，采用gcc编译</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -<span class="keyword">c</span> xorwasm.<span class="keyword">c</span> -o xorwasm.o</span><br></pre></td></tr></table></figure>

<p>得到的文件虽然不能执行，但可以静态分析。</p>
<p>第二种是动态分析</p>
<p>如果给了html文件，我们可以在google中直接调试，我们先在终端中起个指令：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http<span class="selector-class">.server</span> -<span class="selector-tag">b</span> localhost</span><br></pre></td></tr></table></figure>

<p>然后就能分析了，打开网址，f12中的source，可以下断点</p>
<p>下完断点就刷新，发现断在了下断点的地方，然后进行调试：F8执⾏(等价于IDA的F9)，F10单步步过，F11单步步⼊ ,右侧还有stack中有memory可以看。</p>
<h1 id="OLLVM"><a href="#OLLVM" class="headerlink" title="OLLVM"></a>OLLVM</h1><p><strong>控制流平坦化</strong></p>
<p>如果不把ollvm给恢复，那么就很麻烦了，这个ollvm浅层的理解就是将几个跳转转换成很多switch，再搞很多分支，这样就显得很麻烦看起来，我们一般先对这些进行去除控制流平坦化，我们采用deplat.py文件进行去除，这个python文件运行是基于angr环境的。</p>
<p>操作：</p>
<p>先将文件放在deflat-master&#x2F;flat_control_flow目录下，然后更改deplat文件的第十二行，换成文件路径。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env python3</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.<span class="keyword">append</span>(<span class="string">&quot;..&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> pyvex</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">sys.path.<span class="keyword">append</span>(<span class="string">&#x27;./normal12&#x27;</span>)<span class="comment">//此处要更改</span></span><br><span class="line"><span class="keyword">import</span> am_graph</span><br><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.getLogger(<span class="string">&#x27;angr.state_plugins.symbolic_memory&#x27;</span>).setLevel(logging.ERROR)</span><br><span class="line"># logging.getLogger(<span class="string">&#x27;angr.sim_manager&#x27;</span>).setLevel(logging.DEBUG)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> get_relevant_nop_nodes(supergraph, pre_dispatcher_node, prologue_node, retn_node):</span><br><span class="line">    # relevant_nodes = list(supergraph.predecessors(pre_dispatcher_node))</span><br><span class="line">    relevant_nodes = []</span><br><span class="line">    nop_nodes = []</span><br><span class="line">    <span class="keyword">for</span> node in supergraph.nodes():</span><br><span class="line">        <span class="keyword">if</span> supergraph.has_edge(node, pre_dispatcher_node) and node.<span class="keyword">size</span> &gt; <span class="number">8</span>:</span><br><span class="line">            # XXX: use node.<span class="keyword">size</span> is faster than to create a block</span><br><span class="line">            relevant_nodes.<span class="keyword">append</span>(node)</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>进入ida找到main函数起始位置。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python deflat.py -f normal12 --addr <span class="number">0x401040</span></span><br></pre></td></tr></table></figure>

<p>使用上面命令，如果终端中出现success就行了，得到的文件很美妙！</p>
<h1 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h1><p>第一次减这样类型的题，而且这道题还很复杂。</p>
<p>给了两个文件，一个login一个check，很烦，先看login</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">sub_401DB1</span><span class="params">(<span class="type">int</span> a1, _QWORD *a2, __int64 a3, __int64 a4, <span class="type">int</span> a5, <span class="type">int</span> a6)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// er8</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// er9</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [rsp+0h] [rbp-810h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> clientfd; <span class="comment">// [rsp+10h] [rbp-800h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+14h] [rbp-7FCh]</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+18h] [rbp-7F8h]</span></span><br><span class="line">  _QWORD server_addr[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-7F0h] BYREF</span></span><br><span class="line">  __int64 v17[<span class="number">126</span>]; <span class="comment">// [rsp+30h] [rbp-7E0h] BYREF</span></span><br><span class="line">  u32 uaddr2[<span class="number">2</span>]; <span class="comment">// [rsp+420h] [rbp-3F0h] BYREF</span></span><br><span class="line">  __int64 v19; <span class="comment">// [rsp+428h] [rbp-3E8h]</span></span><br><span class="line">  <span class="type">char</span> v20[<span class="number">984</span>]; <span class="comment">// [rsp+430h] [rbp-3E0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// [rsp+808h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = (<span class="type">char</span>)a2;</span><br><span class="line">  v21 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v17, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">  *(_QWORD *)uaddr2 = <span class="number">0LL</span>;</span><br><span class="line">  v19 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v20, <span class="number">0</span>, <span class="keyword">sizeof</span>(v20));</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;Usage: %s &lt;IP Address&gt;\n&quot;</span>, *a2, (<span class="type">unsigned</span> <span class="type">int</span>)v20, <span class="number">0</span>, a5, a6, (<span class="type">char</span>)a2);</span><br><span class="line">    sub_410400(<span class="number">1LL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v15 = sub_454A70(a2[<span class="number">1</span>], a2, v20);</span><br><span class="line">  <span class="keyword">if</span> ( !v15 )</span><br><span class="line">    sub_410400(<span class="number">1LL</span>);</span><br><span class="line">  clientfd = socket(<span class="number">2LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( clientfd == <span class="number">-1</span> )</span><br><span class="line">    sub_410400(<span class="number">1LL</span>);</span><br><span class="line">  server_addr[<span class="number">0</span>] = <span class="number">2LL</span>;</span><br><span class="line">  server_addr[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *(_DWORD *)((<span class="type">char</span> *)server_addr + <span class="number">2</span>) = (<span class="type">unsigned</span> __int16)sub_454A60((<span class="type">unsigned</span> __int16)dword_4DA120);<span class="comment">// 端口1234</span></span><br><span class="line">  HIDWORD(server_addr[<span class="number">0</span>]) = ***(_DWORD ***)(v15 + <span class="number">24</span>);<span class="comment">// ip</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)connect(clientfd, server_addr, <span class="number">16LL</span>) == <span class="number">-1</span> )<span class="comment">// connect请求</span></span><br><span class="line">    sub_410400(<span class="number">1LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 = sub_454550(clientfd, v17, <span class="number">1000LL</span>, <span class="number">0LL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v14 &lt; <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *((_BYTE *)v17 + v14) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;%s&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v17 + <span class="number">1</span>, v6, v7, v8, v9, v12);</span><br><span class="line">    <span class="keyword">if</span> ( LOBYTE(v17[<span class="number">0</span>]) == <span class="string">&#x27;0&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_450F60(clientfd);                     <span class="comment">// 退出</span></span><br><span class="line">      sub_410400(<span class="number">0LL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( LOBYTE(v17[<span class="number">0</span>]) == <span class="string">&#x27;2&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v10 = sub_4011B0(a52096ad53036a5);</span><br><span class="line">      send(clientfd, a52096ad53036a5, v10, <span class="number">0LL</span>);<span class="comment">// 发送过去hex字符串</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">scanf</span>(uaddr2);                              <span class="comment">// 输入</span></span><br><span class="line">    v11 = sub_4011B0(uaddr2);</span><br><span class="line">    send(clientfd, uaddr2, v11, <span class="number">0LL</span>);           <span class="comment">// 发送输入</span></span><br><span class="line">  &#125;</span><br><span class="line">  sub_410400(<span class="number">1LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个socket发送字符串的程序</p>
<p> socket编程是一门技术，它主要是在网络通信中经常用到，我的理解是用户在tcp&#x2F;ip的基础上通过socket进行信息交互</p>
<p><img src="/2022/03/21/classic/../../blog/source/_posts/vmproblem/image-20220329202342794.png" alt="image-20220329202342794"></p>
<p>一般socket使用时先传送端口再传送ip，在发送connect请求</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">socket</span><span class="params">(<span class="type">int</span> domain, <span class="type">int</span> type, <span class="type">int</span> protocol)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>

<p>connect函数反编译后：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">connect</span><span class="params">(<span class="type">int</span> a1, <span class="keyword">struct</span> sockaddr *a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// er8</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> fd; <span class="comment">// [rsp+8h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( __readfsdword(<span class="number">0x18</span>u) )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_47CDF0();</span><br><span class="line">    v4 = sys_connect(a1, a2, a3);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &gt; <span class="number">0xFFFFFFFFFFFFF000</span>LL )</span><br><span class="line">    &#123;</span><br><span class="line">      __writefsdword(<span class="number">0xFFFFFFB0</span>, -(<span class="type">int</span>)v4);</span><br><span class="line">      LODWORD(v4) = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fd = v4;</span><br><span class="line">    sub_47CE50(v5);</span><br><span class="line">    <span class="keyword">return</span> fd;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = sys_connect(a1, a2, a3);</span><br><span class="line">    <span class="keyword">if</span> ( result &gt; <span class="number">0xFFFFFFFFFFFFF000</span>LL )</span><br><span class="line">    &#123;</span><br><span class="line">      __writefsdword(<span class="number">0xFFFFFFB0</span>, -(<span class="type">int</span>)result);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>LL;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>限定了我们第一个发过去的必须是2，如果不是就退出，我们查看发送的东西</p>
<p><img src="/2022/03/21/classic/../../blog/source/_posts/vmproblem/image-20220329202855655.png" alt="image-20220329202855655"></p>
<p>这个0x52很明显是aes的INV_SBOX，这个还是能看出来的。</p>
<p>看完login再看server的check</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_405DA7</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// er8</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// er9</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-44h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+10h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> listenfd; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  _QWORD v10[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">clientaddr</span>;</span> <span class="comment">// [rsp+30h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  listenfd = sub_55C220(<span class="number">2LL</span>, <span class="number">1LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( listenfd == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  v6 = <span class="number">2</span>;</span><br><span class="line">  sub_55C1F0(listenfd, <span class="number">1LL</span>, <span class="number">2LL</span>, &amp;v6, <span class="number">4LL</span>);</span><br><span class="line">  v10[<span class="number">0</span>] = <span class="number">2LL</span>;</span><br><span class="line">  v10[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  WORD1(v10[<span class="number">0</span>]) = sub_55CCC0((<span class="type">unsigned</span> __int16)dword_609150);<span class="comment">// 端口1234</span></span><br><span class="line">  HIDWORD(v10[<span class="number">0</span>]) = sub_55CCB0(<span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_55C010(listenfd, v10, <span class="number">16LL</span>) == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_55C040(listenfd, <span class="number">100LL</span>) == <span class="number">-1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  sub_4FDD90(<span class="string">&quot;\n----------------Welcome----------------&quot;</span>);</span><br><span class="line">  v5 = <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = accept(listenfd, &amp;clientaddr, &amp;v5);</span><br><span class="line">    <span class="keyword">if</span> ( !v8 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v8 == <span class="number">-1</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    v9 = fork();                                <span class="comment">// 创建子进程来处理接收到的内容</span></span><br><span class="line">    <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !v9 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_559590(<span class="number">0</span>, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;clientaddr, v0, v1, v2, v3);<span class="comment">// 函数看不懂</span></span><br><span class="line">        close(listenfd);</span><br><span class="line">        sub_405F6A(v8, *(_QWORD *)&amp;clientaddr.sa_family, *(_QWORD *)&amp;clientaddr.sa_data[<span class="number">6</span>]);<span class="comment">// 这个是重点</span></span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    close(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v12 )</span><br><span class="line">    sub_55CC60();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经典fork函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">fork</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v0; <span class="comment">// ebp</span></span><br><span class="line">  _BOOL4 v1; <span class="comment">// er12</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// er13</span></span><br><span class="line">  __int64 i; <span class="comment">// rbp</span></span><br><span class="line">  _QWORD *v6; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v0 = __readfsdword(<span class="number">0x18</span>u);</span><br><span class="line">  v1 = v0 != <span class="number">0</span>;</span><br><span class="line">  sub_571900(<span class="number">0LL</span>, v0 != <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_507EF0();</span><br><span class="line">    <span class="keyword">if</span> ( sub_50D8B0 )</span><br><span class="line">      sub_50D8B0();</span><br><span class="line">  &#125;</span><br><span class="line">  v2 = sys_clone(<span class="number">0x1200011</span>uLL, <span class="number">0LL</span>, <span class="number">0LL</span>, (<span class="type">void</span> *)(__readfsqword(<span class="number">0x10</span>u) + <span class="number">720</span>));</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt; <span class="number">0xFFFFFFFFFFFFF000</span>LL )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">-1</span>;</span><br><span class="line">    __writefsdword(<span class="number">0xFFFFFFC0</span>, -(<span class="type">int</span>)v2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = v2;</span><br><span class="line">    <span class="keyword">if</span> ( !(_DWORD)v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( qword_610A40 )</span><br><span class="line">        *(_QWORD *)qword_610A40 += <span class="number">4LL</span>;</span><br><span class="line">      *(__m128i *)(v3 + <span class="number">728</span>) = _mm_unpacklo_epi64(</span><br><span class="line">                                 (__m128i)(<span class="type">unsigned</span> __int64)(v3 + <span class="number">736</span>),</span><br><span class="line">                                 (__m128i)(<span class="type">unsigned</span> __int64)(v3 + <span class="number">736</span>));</span><br><span class="line">      <span class="keyword">if</span> ( v0 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( sub_50DA20 )</span><br><span class="line">          sub_50DA20();</span><br><span class="line">        <span class="keyword">for</span> ( i = sub_507EB0(); i != sub_507EC0(); i = sub_507ED0(i) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( (BYTE1(*(_DWORD *)sub_507EE0(i)) &amp; <span class="number">0x80</span>u) == <span class="number">0</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v6 = *(_QWORD **)(sub_507EE0(i) + <span class="number">136</span>);</span><br><span class="line">            *v6 = <span class="number">0LL</span>;</span><br><span class="line">            v6[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sub_507FB0();</span><br><span class="line">      &#125;</span><br><span class="line">      qword_60A660 = <span class="number">0LL</span>;</span><br><span class="line">      xmmword_60A650 = <span class="number">0LL</span>;</span><br><span class="line">      xmmword_60A640 = <span class="number">0LL</span>;</span><br><span class="line">      LODWORD(xmmword_60A650) = <span class="number">1</span>;</span><br><span class="line">      sub_571900(<span class="number">1LL</span>, v1);</span><br><span class="line">      <span class="keyword">return</span> v4;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( sub_50D960 )</span><br><span class="line">      sub_50D960();</span><br><span class="line">    sub_507F50();</span><br><span class="line">  &#125;</span><br><span class="line">  sub_571900(<span class="number">2LL</span>, v0 != <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们直接看主函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_405F6A</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> connfd, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 *v4; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+28h] [rbp-898h]</span></span><br><span class="line">  <span class="type">int</span> len; <span class="comment">// [rsp+28h] [rbp-898h]</span></span><br><span class="line">  <span class="type">int</span> lena; <span class="comment">// [rsp+28h] [rbp-898h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+2Ch] [rbp-894h]</span></span><br><span class="line">  <span class="type">char</span> token[<span class="number">32</span>]; <span class="comment">// [rsp+30h] [rbp-890h] BYREF</span></span><br><span class="line">  <span class="type">char</span> psd[<span class="number">32</span>]; <span class="comment">// [rsp+50h] [rbp-870h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">48</span>]; <span class="comment">// [rsp+70h] [rbp-850h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v19[<span class="number">64</span>]; <span class="comment">// [rsp+A0h] [rbp-820h] BYREF</span></span><br><span class="line">  __int64 psd_1[<span class="number">126</span>]; <span class="comment">// [rsp+E0h] [rbp-7E0h] BYREF</span></span><br><span class="line">  __int64 token_1[<span class="number">125</span>]; <span class="comment">// [rsp+4D0h] [rbp-3F0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v22; <span class="comment">// [rsp+8B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v22 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(psd_1, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">memset</span>(token_1, <span class="number">0</span>, <span class="keyword">sizeof</span>(token_1));</span><br><span class="line">  <span class="built_in">strcpy</span>(token, <span class="string">&quot;Please enter the token: &quot;</span>);    <span class="comment">// 输入token</span></span><br><span class="line">  <span class="built_in">strcpy</span>(psd, <span class="string">&quot;Please input the password: &quot;</span>);   <span class="comment">// 输入密码</span></span><br><span class="line">  <span class="built_in">strcpy</span>(v19, <span class="string">&quot;Login successful.\nNow, you can enter flag to verify: &quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(v18, <span class="string">&quot;Forbidden, wrong token or password.\n&quot;</span>);</span><br><span class="line">  send(connfd, <span class="string">&quot;1&quot;</span>, <span class="number">1uLL</span>, <span class="number">0</span>);</span><br><span class="line">  v3 = sub_401118((__int64)token);</span><br><span class="line">  send(connfd, token, v3, <span class="number">0</span>);</span><br><span class="line">  v4 = token_1;</span><br><span class="line">  v12 = sub_55C070(connfd, token_1, <span class="number">1000LL</span>, <span class="number">0LL</span>);<span class="comment">// 接收token，应该是长度</span></span><br><span class="line">  <span class="keyword">if</span> ( v12 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)token_1 + v12) = <span class="number">0</span>;</span><br><span class="line">    send(connfd, <span class="string">&quot;1&quot;</span>, <span class="number">1uLL</span>, <span class="number">0</span>);</span><br><span class="line">    v5 = sub_401118((__int64)psd);</span><br><span class="line">    send(connfd, psd, v5, <span class="number">0</span>);</span><br><span class="line">    v4 = psd_1;</span><br><span class="line">    len = sub_55C070(connfd, psd_1, <span class="number">1000LL</span>, <span class="number">0LL</span>);<span class="comment">// 接受psd的</span></span><br><span class="line">    <span class="keyword">if</span> ( len &gt;= <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)psd_1 + len) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( rsa((__int64)token_1) &amp;&amp; (<span class="type">unsigned</span> <span class="type">int</span>)pswcheck((__int64)psd_1) )<span class="comment">// psdcheck</span></span><br><span class="line">      &#123;</span><br><span class="line">        send(connfd, <span class="string">&quot;2&quot;</span>, <span class="number">1uLL</span>, <span class="number">0</span>);</span><br><span class="line">        v7 = sub_401118((__int64)v19);</span><br><span class="line">        send(connfd, v19, v7, <span class="number">0</span>);</span><br><span class="line">        v4 = (__int64 *)INV_SBOX;</span><br><span class="line">        lena = sub_55C070(connfd, INV_SBOX, <span class="number">1000LL</span>, <span class="number">0LL</span>);<span class="comment">// 接受发送过来的INV_SBOX</span></span><br><span class="line">        <span class="keyword">if</span> ( lena &gt;= <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          INV_SBOX[lena] = <span class="number">0</span>;</span><br><span class="line">          sub_4058DB((__int64)INV_SBOX);        <span class="comment">// hex字符串转换成值</span></span><br><span class="line">          v15 = fork();</span><br><span class="line">          <span class="keyword">if</span> ( v15 &lt;= <span class="number">0</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( !v15 )</span><br><span class="line">            &#123;</span><br><span class="line">              check(connfd, a2, a3, token_1, psd_1);</span><br><span class="line">              <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          close(connfd);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        send(connfd, <span class="string">&quot;0&quot;</span>, <span class="number">1uLL</span>, <span class="number">0</span>);</span><br><span class="line">        v8 = sub_401118((__int64)v18);</span><br><span class="line">        v4 = (__int64 *)v18;</span><br><span class="line">        send(connfd, v18, v8, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  close(connfd);</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v22;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_55CC60(connfd, v4);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_55C070传入的三个参数分别是connfd，客户端的ip和端口,要输入两个东西，要进行三个函数的逆向</p>
<p>第一个checkrsa：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">sub_405A10</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  _BOOL8 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-310h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-300h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-2F0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">26</span>]; <span class="comment">// [rsp+40h] [rbp-2E0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">70</span>]; <span class="comment">// [rsp+5Ah] [rbp-2C6h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">632</span>]; <span class="comment">// [rsp+A0h] [rbp-280h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+318h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(</span><br><span class="line">    v8,</span><br><span class="line">    <span class="string">&quot;13123058934861171416713230498081453101147538789122070079961388806126697916963123413431108069961369055630747412550900&quot;</span></span><br><span class="line">    <span class="string">&quot;23940271082784791796087035865396294828238135174112188452839936976453044650993624026229024830522655211710058472661625&quot;</span></span><br><span class="line">    <span class="string">&quot;52929639711415105186785526790332203152463777462705158539879031845129488013974521045545898037256190760663399689993089&quot;</span></span><br><span class="line">    <span class="string">&quot;10127885089547678968793196148780382182445270838659078189316664538631875879022325427220682805580410213245364855569367&quot;</span></span><br><span class="line">    <span class="string">&quot;70291915788136708567728312473287462156937990127266216202578060866957754654833327476605875578644949127700234991859897&quot;</span></span><br><span class="line">    <span class="string">&quot;1841605936268030140638579388226573929&quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;v7[<span class="number">6</span>], <span class="string">&quot;By reading we enrich the mind, by conversation we polish it.&quot;</span>);</span><br><span class="line">  <span class="built_in">strcpy</span>(v7, <span class="string">&quot;10001&quot;</span>);                          <span class="comment">// e的值</span></span><br><span class="line">  sub_406990(v3, v8, <span class="number">10LL</span>);</span><br><span class="line">  v1 = sub_4057A9(&amp;v7[<span class="number">6</span>]);</span><br><span class="line">  sub_406990(v4, v1, <span class="number">16LL</span>);</span><br><span class="line">  sub_406990(v5, v7, <span class="number">16LL</span>);</span><br><span class="line">  sub_406990(v6, a1, <span class="number">10LL</span>);</span><br><span class="line">  sub_4069B0(v6, v6, v5, v3);</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)sub_406910(v6, v4) == <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v9 )</span><br><span class="line">    sub_55CC60();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里要注意，m转换成16进制要是小端序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line">p=<span class="number">98197216341757567488149177586991336976901080454854408243068885480633972200382596026756300968618883148721598031574296054706280190113587145906781375704611841087782526897314537785060868780928063942914187241017272444601926795083433477673935377466676026146695321415853502288291409333200661670651818749836420808033</span></span><br><span class="line">q=<span class="number">133639826298015917901017908376475546339925646165363264658181838203059432536492968144231040597990919971381628901127402671873954769629458944972912180415794436700950304720548263026421362847590283353425105178540468631051824814390421486132775876582962969734956410033443729557703719598998956317920674659744121941513</span></span><br><span class="line">n=p*q</span><br><span class="line">m=<span class="number">0x2e7469206873696c6f70206577206e6f697461737265766e6f63207962202c646e696d2065687420686369726e6520657720676e6964616572207942</span></span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">flag=<span class="built_in">pow</span>(m,<span class="built_in">int</span>(d),n)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#n=13123058934861171416713230498081453101147538789122070079961388806126697916963123413431108069961369055630747412550900239402710827847917960870358653962948282381351741121884528399369764530446509936240262290248305226552117100584726616255292963971141510518678552679033220315246377746270515853987903184512948801397452104554589803725619076066339968999308910127885089547678968793196148780382182445270838659078189316664538631875879022325427220682805580410213245364855569367702919157881367085677283124732874621569379901272662162025780608669577546548333274766058755786449491277002349918598971841605936268030140638579388226573929</span></span><br></pre></td></tr></table></figure>

<p>第二个函数是一个矩阵：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_405BDE</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-80h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+14h] [rbp-7Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+18h] [rbp-78h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+1Ch] [rbp-74h]</span></span><br><span class="line">  __int64 v6[<span class="number">4</span>]; <span class="comment">// [rsp+20h] [rbp-70h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+40h] [rbp-50h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+50h] [rbp-40h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+58h] [rbp-38h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+60h] [rbp-30h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+68h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+70h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+78h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">0xA34C0F7A2E25DB71</span>LL;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">0x7AA91B6E29AA226A</span>LL;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">0x56AA0EF0802F278A</span>LL;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">0x9AF6F2A9005859F7</span>LL;</span><br><span class="line">  v7 = <span class="number">-918021042</span>;</span><br><span class="line">  v8 = <span class="number">0xFCF1BE5355A297A3</span>LL;                    <span class="comment">// 这里的对比函数没有删除</span></span><br><span class="line">  v9 = <span class="number">0xE2E91314526B79F9</span>LL;</span><br><span class="line">  v10 = <span class="number">0x275708561F8E512D</span>LL;</span><br><span class="line">  v11 = <span class="number">0x75778252D0D405A7</span>LL;</span><br><span class="line">  v12 = <span class="number">-313878245</span>;</span><br><span class="line">  sub_4058DB(a1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">5</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">5</span>; ++k )</span><br><span class="line">        v4 += *((<span class="type">unsigned</span> __int8 *)v6 + <span class="number">6</span> * i + k) * *(<span class="type">unsigned</span> __int8 *)(<span class="number">6</span> * k + j + a1);<span class="comment">// 矩阵相乘</span></span><br><span class="line">      <span class="keyword">if</span> ( v4 % <span class="number">0x101</span> != (<span class="type">int</span>)sub_4F1880() % <span class="number">255</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = <span class="number">0LL</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_13;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  result = <span class="number">1LL</span>;</span><br><span class="line">LABEL_13:</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v13 )</span><br><span class="line">    sub_55CC60();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>矩阵 * 我们要求的 &#x3D;&#x3D; random() % 255，而这个random%255已经存在，听师傅说好像没删。<br>我们采用z3来搞：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">s = Solver()</span><br><span class="line">flag = [Int(<span class="string">&#x27;flag%d&#x27;</span>%i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)]</span><br><span class="line">g=<span class="number">0</span></span><br><span class="line">arr2 = [<span class="number">0xA3</span>, <span class="number">0x97</span>, <span class="number">0xA2</span>, <span class="number">0x55</span>, <span class="number">0x53</span>, <span class="number">0xBE</span>, <span class="number">0xF1</span>, <span class="number">0xFC</span>, <span class="number">0xF9</span>, <span class="number">0x79</span>, <span class="number">0x6B</span>, <span class="number">0x52</span>,<span class="number">0x14</span>, <span class="number">0x13</span>, <span class="number">0xE9</span>, <span class="number">0xE2</span>, <span class="number">0x2D</span>, <span class="number">0x51</span>, <span class="number">0x8E</span>, <span class="number">0x1F</span>, <span class="number">0x56</span>, <span class="number">0x08</span>, <span class="number">0x57</span>, <span class="number">0x27</span>, <span class="number">0xA7</span>, <span class="number">0x05</span>, <span class="number">0xD4</span>, <span class="number">0xD0</span>, <span class="number">0x52</span>, <span class="number">0x82</span>,<span class="number">0x77</span>, <span class="number">0x75</span>, <span class="number">0x1B</span>, <span class="number">0x99</span>, <span class="number">0x4A</span>, <span class="number">0xED</span>]</span><br><span class="line">arr1 = [<span class="number">0x71</span>, <span class="number">0xDB</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x7A</span>, <span class="number">0x0F</span>,<span class="number">0x4C</span>, <span class="number">0xA3</span>, <span class="number">0x6A</span>, <span class="number">0x22</span>, <span class="number">0xAA</span>, <span class="number">0x29</span>, <span class="number">0x6E</span>, <span class="number">0x1B</span>, <span class="number">0xA9</span>, <span class="number">0x7A</span>, <span class="number">0x8A</span>, <span class="number">0x27</span>,<span class="number">0x2F</span>, <span class="number">0x80</span>, <span class="number">0xF0</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x56</span>,<span class="number">0xF7</span>, <span class="number">0x59</span>, <span class="number">0x58</span>, <span class="number">0x00</span>, <span class="number">0xA9</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0x9A</span>, <span class="number">0x4E</span>, <span class="number">0x1C</span>, <span class="number">0x48</span>, <span class="number">0xC9</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">        data = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">            data += arr1[i * <span class="number">6</span> + k] * flag[<span class="number">6</span> * k + j]</span><br><span class="line">        s.add(data % <span class="number">257</span> == arr2[g])</span><br><span class="line">        g += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:                              <span class="comment">#检查机制，如果有解就输出，无解就错误</span></span><br><span class="line">    m = s.model()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>):</span><br><span class="line">        res.append(<span class="built_in">chr</span>(m[flag[i]].as_long()))</span><br><span class="line">        s=<span class="string">&#x27;&#x27;</span>.join(res)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;nope&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>或者采用syj师傅的sage脚本</p>
<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">arr1 = [[0x71, 0xDB, 0x25, 0x2E, 0x7A, 0x0F], </span><br><span class="line">         [0x4C, 0xA3, 0x6A, 0x22, 0xAA, 0x29], </span><br><span class="line">         [0x6E, 0x1B, 0xA9, 0x7A, 0x8A, 0x27],</span><br><span class="line">         [0x2F, 0x80, 0xF0, 0x0E, 0xAA, 0x56],</span><br><span class="line">         [0xF7, 0x59, 0x58, 0x00, 0xA9, 0xF2], </span><br><span class="line">         [0xF6, 0x9A, 0x4E, 0x1C, 0x48, 0xC9]]</span><br><span class="line"></span><br><span class="line">dst = [[0xA3, 0x97, 0xA2, 0x55, 0x53, 0xBE], </span><br><span class="line">       [0xF1, 0xFC, 0xF9, 0x79, 0x6B, 0x52],</span><br><span class="line">       [0x14, 0x13, 0xE9, 0xE2, 0x2D, 0x51], </span><br><span class="line">       [0x8E, 0x1F, 0x56, 0x08, 0x57, 0x27], </span><br><span class="line">       [0xA7, 0x05, 0xD4, 0xD0, 0x52, 0x82],</span><br><span class="line">       [0x77, 0x75, 0x1B, 0x99, 0x4A, 0xED]]</span><br><span class="line"></span><br><span class="line">arr1 = Matrix(Z<span class="meta">mod</span>(257), arr1)</span><br><span class="line">dst = Matrix(Z<span class="meta">mod</span>(257), dst)</span><br><span class="line">A = arr1.solve_<span class="meta">right</span>(dst)</span><br><span class="line">pr<span class="meta">int</span>(A)</span><br></pre></td></tr></table></figure>

<p>得到矩阵再转换成16进制5132d202c32d95b9f978d514e3294220513b15623482b4c02e9afde8bad5ec07486a5488</p>
<p>得到password</p>
<p>最后check分析，展示一下aes的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_4055C0</span><span class="params">(__int64 roundkeys, __int64 flag, __int64 a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 *v4; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// er8</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// er9</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+2Ch] [rbp-34h]</span></span><br><span class="line">  __int64 v13[<span class="number">5</span>]; <span class="comment">// [rsp+30h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v14; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+60h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v14 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v13[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v13[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  sub_404C1A(roundkeys, flag, a4);              <span class="comment">// flag的前16字节异或</span></span><br><span class="line">  sub_40554A(roundkeys, v13, flag);             <span class="comment">// 行列置换</span></span><br><span class="line">  sub_404F60(roundkeys, v13, roundkeys);        <span class="comment">// 轮密钥</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_404FF4(roundkeys, v13);                 <span class="comment">// s盒字节代换</span></span><br><span class="line">    sub_405078(roundkeys, (__int64)v13);        <span class="comment">// 行移位</span></span><br><span class="line">    <span class="keyword">if</span> ( i == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_4053C8(roundkeys, v13);                 <span class="comment">// 列混合</span></span><br><span class="line">    sub_404F60(roundkeys, v13, <span class="number">16</span> * i + roundkeys);<span class="comment">// 轮密钥加</span></span><br><span class="line">  &#125;</span><br><span class="line">  v4 = v13;</span><br><span class="line">  sub_404F60(roundkeys, v13, roundkeys + <span class="number">160</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; ++k )</span><br><span class="line">      *((_BYTE *)&amp;savedregs + <span class="number">4</span> * j + k - <span class="number">32</span>) = *((_BYTE *)&amp;savedregs + <span class="number">4</span> * k + j - <span class="number">48</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">15</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = (__int64 *)<span class="string">&quot;%02x&quot;</span>;</span><br><span class="line">    roundkeys = a3 + <span class="number">2</span> * m;</span><br><span class="line">    sub_4FC580(roundkeys, (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;%02x&quot;</span>, *((<span class="type">unsigned</span> __int8 *)&amp;v13[<span class="number">2</span>] + m), roundkeys, v5, v6);</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v14;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_55CC60(roundkeys, v4);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个第一次见还真不好搞出来是个aes</p>
<p>行列置换：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_40554A</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      result = i;</span><br><span class="line">      *(_BYTE *)(a2 + <span class="number">4LL</span> * j + i) = *(_BYTE *)(<span class="number">4</span> * i + j + a3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>轮密钥：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_404F60</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      result = j;</span><br><span class="line">      *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j) ^= *(_BYTE *)(<span class="number">4</span> * j + i + a3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>行移位：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">sub_405078</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">bool</span> result; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = v6++;</span><br><span class="line">      result = i &gt; v2;</span><br><span class="line">      <span class="keyword">if</span> ( !result )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v7 = *(_BYTE *)(<span class="number">4LL</span> * i + a2);</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">1</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">        *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j - <span class="number">1</span>) = *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j);</span><br><span class="line">      *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j - <span class="number">1</span>) = v7;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>S盒替换</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_404FF4</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      result = j;</span><br><span class="line">      *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j) = INV_SBOX[*(<span class="type">unsigned</span> __int8 *)(a2 + <span class="number">4LL</span> * i + j)];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>列混合：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_4053C8</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  __int64 savedregs; <span class="comment">// [rsp+40h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = a1;</span><br><span class="line">  v3 = a2;</span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v10 = <span class="number">0LL</span>;</span><br><span class="line">  v11 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">3</span>; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        a2 = *(<span class="type">unsigned</span> __int8 *)(v3 + <span class="number">4LL</span> * k + j);</span><br><span class="line">        a1 = v4;</span><br><span class="line">        *((_BYTE *)&amp;savedregs + <span class="number">4</span> * i + j - <span class="number">32</span>) ^= sub_405158(v4, a2, byte_5A4030[<span class="number">4</span> * i + k]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">      *(_BYTE *)(<span class="number">4LL</span> * m + v3 + n) = *((_BYTE *)&amp;savedregs + <span class="number">4</span> * m + n - <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v12;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_55CC60(a1, a2);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>轮密钥加：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_404F60</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      result = j;</span><br><span class="line">      *(_BYTE *)(a2 + <span class="number">4LL</span> * i + j) ^= *(_BYTE *)(<span class="number">4</span> * j + i + a3);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给出aes（256）解密脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_BLOCK_SIZE      16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_ROUNDS          10  <span class="comment">// 12, 14</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AES_ROUND_KEY_SIZE  176 <span class="comment">// AES-128 has 10 rounds, and there is a AddRoundKey before first round. (10+1)x16=176.</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * round constants</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> RC[] = &#123;<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1b</span>, <span class="number">0x36</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Sbox</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0xf2</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">    <span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>,</span><br><span class="line">    <span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">    <span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">    <span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>,</span><br><span class="line">    <span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">    <span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Inverse Sboxs</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> INV_SBOX[<span class="number">256</span>] = &#123;</span><br><span class="line">    <span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6a</span>, <span class="number">0xd5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xa5</span>, <span class="number">0x38</span>, <span class="number">0xbf</span>, <span class="number">0x40</span>, <span class="number">0xa3</span>, <span class="number">0x9e</span>, <span class="number">0x81</span>, <span class="number">0xf3</span>, <span class="number">0xd7</span>, <span class="number">0xfb</span>,</span><br><span class="line">    <span class="number">0x7c</span>, <span class="number">0xe3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9b</span>, <span class="number">0x2f</span>, <span class="number">0xff</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8e</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xe9</span>, <span class="number">0xcb</span>,</span><br><span class="line">    <span class="number">0x54</span>, <span class="number">0x7b</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xa6</span>, <span class="number">0xc2</span>, <span class="number">0x23</span>, <span class="number">0x3d</span>, <span class="number">0xee</span>, <span class="number">0x4c</span>, <span class="number">0x95</span>, <span class="number">0x0b</span>, <span class="number">0x42</span>, <span class="number">0xfa</span>, <span class="number">0xc3</span>, <span class="number">0x4e</span>,</span><br><span class="line">    <span class="number">0x08</span>, <span class="number">0x2e</span>, <span class="number">0xa1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xd9</span>, <span class="number">0x24</span>, <span class="number">0xb2</span>, <span class="number">0x76</span>, <span class="number">0x5b</span>, <span class="number">0xa2</span>, <span class="number">0x49</span>, <span class="number">0x6d</span>, <span class="number">0x8b</span>, <span class="number">0xd1</span>, <span class="number">0x25</span>,</span><br><span class="line">    <span class="number">0x72</span>, <span class="number">0xf8</span>, <span class="number">0xf6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xd4</span>, <span class="number">0xa4</span>, <span class="number">0x5c</span>, <span class="number">0xcc</span>, <span class="number">0x5d</span>, <span class="number">0x65</span>, <span class="number">0xb6</span>, <span class="number">0x92</span>,</span><br><span class="line">    <span class="number">0x6c</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xfd</span>, <span class="number">0xed</span>, <span class="number">0xb9</span>, <span class="number">0xda</span>, <span class="number">0x5e</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xa7</span>, <span class="number">0x8d</span>, <span class="number">0x9d</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x90</span>, <span class="number">0xd8</span>, <span class="number">0xab</span>, <span class="number">0x00</span>, <span class="number">0x8c</span>, <span class="number">0xbc</span>, <span class="number">0xd3</span>, <span class="number">0x0a</span>, <span class="number">0xf7</span>, <span class="number">0xe4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xb8</span>, <span class="number">0xb3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>,</span><br><span class="line">    <span class="number">0xd0</span>, <span class="number">0x2c</span>, <span class="number">0x1e</span>, <span class="number">0x8f</span>, <span class="number">0xca</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x02</span>, <span class="number">0xc1</span>, <span class="number">0xaf</span>, <span class="number">0xbd</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8a</span>, <span class="number">0x6b</span>,</span><br><span class="line">    <span class="number">0x3a</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4f</span>, <span class="number">0x67</span>, <span class="number">0xdc</span>, <span class="number">0xea</span>, <span class="number">0x97</span>, <span class="number">0xf2</span>, <span class="number">0xcf</span>, <span class="number">0xce</span>, <span class="number">0xf0</span>, <span class="number">0xb4</span>, <span class="number">0xe6</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x96</span>, <span class="number">0xac</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xe7</span>, <span class="number">0xad</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xe2</span>, <span class="number">0xf9</span>, <span class="number">0x37</span>, <span class="number">0xe8</span>, <span class="number">0x1c</span>, <span class="number">0x75</span>, <span class="number">0xdf</span>, <span class="number">0x6e</span>,</span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0xf1</span>, <span class="number">0x1a</span>, <span class="number">0x71</span>, <span class="number">0x1d</span>, <span class="number">0x29</span>, <span class="number">0xc5</span>, <span class="number">0x89</span>, <span class="number">0x6f</span>, <span class="number">0xb7</span>, <span class="number">0x62</span>, <span class="number">0x0e</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0xbe</span>, <span class="number">0x1b</span>,</span><br><span class="line">    <span class="number">0xfc</span>, <span class="number">0x56</span>, <span class="number">0x3e</span>, <span class="number">0x4b</span>, <span class="number">0xc6</span>, <span class="number">0xd2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9a</span>, <span class="number">0xdb</span>, <span class="number">0xc0</span>, <span class="number">0xfe</span>, <span class="number">0x78</span>, <span class="number">0xcd</span>, <span class="number">0x5a</span>, <span class="number">0xf4</span>,</span><br><span class="line">    <span class="number">0x1f</span>, <span class="number">0xdd</span>, <span class="number">0xa8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xc7</span>, <span class="number">0x31</span>, <span class="number">0xb1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7f</span>, <span class="number">0xa9</span>, <span class="number">0x19</span>, <span class="number">0xb5</span>, <span class="number">0x4a</span>, <span class="number">0x0d</span>, <span class="number">0x2d</span>, <span class="number">0xe5</span>, <span class="number">0x7a</span>, <span class="number">0x9f</span>, <span class="number">0x93</span>, <span class="number">0xc9</span>, <span class="number">0x9c</span>, <span class="number">0xef</span>,</span><br><span class="line">    <span class="number">0xa0</span>, <span class="number">0xe0</span>, <span class="number">0x3b</span>, <span class="number">0x4d</span>, <span class="number">0xae</span>, <span class="number">0x2a</span>, <span class="number">0xf5</span>, <span class="number">0xb0</span>, <span class="number">0xc8</span>, <span class="number">0xeb</span>, <span class="number">0xbb</span>, <span class="number">0x3c</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>,</span><br><span class="line">    <span class="number">0x17</span>, <span class="number">0x2b</span>, <span class="number">0x04</span>, <span class="number">0x7e</span>, <span class="number">0xba</span>, <span class="number">0x77</span>, <span class="number">0xd6</span>, <span class="number">0x26</span>, <span class="number">0xe1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0c</span>, <span class="number">0x7d</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">output_mem16</span><span class="params">(<span class="type">uint8_t</span>* data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>, *(data+i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint8_t</span> <span class="title function_">mul2</span><span class="params">(<span class="type">uint8_t</span> a)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (a&amp;<span class="number">0x80</span>) ? ((a&lt;&lt;<span class="number">1</span>)^<span class="number">0x1b</span>) : (a&lt;&lt;<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> 0 1 2 3     《0</span></span><br><span class="line"><span class="comment"> 4 5 6 7     《1</span></span><br><span class="line"><span class="comment"> 8 9 10 11   《2</span></span><br><span class="line"><span class="comment"> 12 13 14 15 《3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">shift_rows</span><span class="params">(<span class="type">uint8_t</span> *state)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="comment">// row1: 下标为1的行左移1</span></span><br><span class="line">    temp        = *(state+<span class="number">4</span>);</span><br><span class="line">    *(state+<span class="number">4</span>)  = *(state+<span class="number">5</span>);</span><br><span class="line">    *(state+<span class="number">5</span>)  = *(state+<span class="number">6</span>);</span><br><span class="line">    *(state+<span class="number">6</span>)  = *(state+<span class="number">7</span>);</span><br><span class="line">    *(state+<span class="number">7</span>) = temp;</span><br><span class="line">    <span class="comment">// row2： 下标为2的行左移2</span></span><br><span class="line">    temp        = *(state+<span class="number">8</span>);</span><br><span class="line">    *(state+<span class="number">8</span>)  = *(state+<span class="number">10</span>);</span><br><span class="line">    *(state+<span class="number">10</span>) = temp;</span><br><span class="line">    temp        = *(state+<span class="number">9</span>);</span><br><span class="line">    *(state+<span class="number">9</span>)  = *(state+<span class="number">11</span>);</span><br><span class="line">    *(state+<span class="number">11</span>) = temp;</span><br><span class="line">    <span class="comment">// row3:  下标为3的行左移3</span></span><br><span class="line">    temp        = *(state+<span class="number">15</span>);</span><br><span class="line">    *(state+<span class="number">15</span>) = *(state+<span class="number">14</span>);</span><br><span class="line">    *(state+<span class="number">14</span>) = *(state+<span class="number">13</span>);</span><br><span class="line">    *(state+<span class="number">13</span>)  = *(state+<span class="number">12</span>);</span><br><span class="line">    *(state+<span class="number">12</span>)  = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_schedule_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *roundkeys)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> temp[<span class="number">4</span>];</span><br><span class="line">    <span class="type">uint8_t</span> *last4bytes; <span class="comment">// point to the last 4 bytes of one round</span></span><br><span class="line">    <span class="type">uint8_t</span> *lastround;</span><br><span class="line">    <span class="type">uint8_t</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        *roundkeys++ = *key++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    last4bytes = roundkeys<span class="number">-4</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_ROUNDS; ++i) &#123;</span><br><span class="line">        <span class="comment">// k0-k3 for next round</span></span><br><span class="line">        temp[<span class="number">3</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">0</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">1</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">2</span>] = SBOX[*last4bytes++];</span><br><span class="line">        temp[<span class="number">0</span>] ^= RC[i];</span><br><span class="line">        lastround = roundkeys<span class="number">-16</span>;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">0</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">1</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">2</span>] ^ *lastround++;</span><br><span class="line">        *roundkeys++ = temp[<span class="number">3</span>] ^ *lastround++;</span><br><span class="line">        <span class="comment">// k4-k7 for next round</span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        <span class="comment">// k8-k11 for next round</span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        <span class="comment">// k12-k15 for next round</span></span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">        *roundkeys++ = *last4bytes++ ^ *lastround++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列混合要用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> colM[<span class="number">4</span>][<span class="number">4</span>] = &#123; &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>&#125;,&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>&#125;,&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;,&#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul2</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="type">int</span> result = s &lt;&lt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> a7 = result &amp; <span class="number">0x00000100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(a7 != <span class="number">0</span>) &#123;</span><br><span class="line">		result = result &amp; <span class="number">0x000000ff</span>;</span><br><span class="line">		result = result ^ <span class="number">0x1b</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul3</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul4</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(GFMul2(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul8</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul2(GFMul4(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul9</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul8(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul11</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul9(s) ^ GFMul2(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul12</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul8(s) ^ GFMul4(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul13</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul12(s) ^ s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul14</span><span class="params">(<span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> GFMul12(s) ^ GFMul2(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GF上的二元运算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GFMul</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s)</span> &#123;</span><br><span class="line">	<span class="type">int</span> result;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">1</span>)</span><br><span class="line">		result = s;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">2</span>)</span><br><span class="line">		result = GFMul2(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">3</span>)</span><br><span class="line">		result = GFMul3(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0x9</span>)</span><br><span class="line">		result = GFMul9(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xb</span>)<span class="comment">//11</span></span><br><span class="line">		result = GFMul11(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xd</span>)<span class="comment">//13</span></span><br><span class="line">		result = GFMul13(s);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(n == <span class="number">0xe</span>)<span class="comment">//14</span></span><br><span class="line">		result = GFMul14(s);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mixColumns</span><span class="params">(<span class="type">uint8_t</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = <span class="built_in">array</span>[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)&#123;</span><br><span class="line">			<span class="built_in">array</span>[i][j] = GFMul(colM[i][<span class="number">0</span>],tempArray[<span class="number">0</span>][j]) ^ GFMul(colM[i][<span class="number">1</span>],tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ GFMul(colM[i][<span class="number">2</span>],tempArray[<span class="number">2</span>][j]) ^ GFMul(colM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_encrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *roundkeys, <span class="type">uint8_t</span> *plaintext, <span class="type">uint8_t</span> *ciphertext, <span class="type">uint8_t</span>*iv)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> i, j, m, n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//output_mem16(plaintext);</span></span><br><span class="line">    <span class="comment">//和iv的16字节先进行异或</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        *(plaintext+i) = *(plaintext+i) ^ *iv++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(plaintext);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//矩阵转置</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * j + i] = plaintext[<span class="number">4</span> * i + j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(tmp);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//first AddRoundKey</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * i + j] ^= roundkeys[<span class="number">4</span> * j + i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(tmp);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9 rounds</span></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; AES_ROUNDS; ++j)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SubBytes</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(tmp+i) = INV_SBOX[*(tmp+i)];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//shift_rows</span></span><br><span class="line">        shift_rows(tmp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//MixColumns</span></span><br><span class="line">        mixColumns(tmp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// AddRoundKey</span></span><br><span class="line">        <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">            &#123;</span><br><span class="line">                tmp[<span class="number">4</span> * m + n] ^= roundkeys[<span class="number">16</span>*j + <span class="number">4</span> * n + m];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// last round</span></span><br><span class="line">    <span class="comment">//output_mem16(tmp);</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(ciphertext+i) = INV_SBOX[*(tmp+i)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(ciphertext);</span></span><br><span class="line">    shift_rows(ciphertext);</span><br><span class="line">    <span class="comment">//output_mem16(ciphertext);</span></span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">        &#123;</span><br><span class="line">            ciphertext[<span class="number">4</span> * m + n] ^= roundkeys[<span class="number">16</span>*j + <span class="number">4</span> * n + m];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//output_mem16(ciphertext);</span></span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )  <span class="comment">//转置</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * n + m] = ciphertext[<span class="number">4</span> * m + n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        ciphertext[i] = tmp[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(ciphertext);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合用到的矩阵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> deColM[<span class="number">4</span>][<span class="number">4</span>] = &#123;&#123;<span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>&#125;,&#123;<span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>&#125;,&#123;<span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>&#125;,&#123;<span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆列混合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">deMixColumns</span><span class="params">(<span class="type">uint8_t</span> <span class="built_in">array</span>[<span class="number">4</span>][<span class="number">4</span>])</span> &#123;</span><br><span class="line">	<span class="type">uint8_t</span> tempArray[<span class="number">4</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			tempArray[i][j] = <span class="built_in">array</span>[i][j];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)&#123;</span><br><span class="line">			<span class="built_in">array</span>[i][j] = GFMul(deColM[i][<span class="number">0</span>],tempArray[<span class="number">0</span>][j]) ^ GFMul(deColM[i][<span class="number">1</span>],tempArray[<span class="number">1</span>][j])</span><br><span class="line">				^ GFMul(deColM[i][<span class="number">2</span>],tempArray[<span class="number">2</span>][j]) ^ GFMul(deColM[i][<span class="number">3</span>], tempArray[<span class="number">3</span>][j]);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0 1 2 3</span></span><br><span class="line"><span class="comment">5 6 7 4      4 5 6 7</span></span><br><span class="line"><span class="comment">10 11 8 9    8 9 10 11</span></span><br><span class="line"><span class="comment">15 12 13 14  12 13 14 15</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(<span class="type">uint8_t</span> *state)</span> &#123;</span><br><span class="line">    <span class="type">uint8_t</span> temp;</span><br><span class="line">    <span class="comment">// row1</span></span><br><span class="line">    temp        = *(state+<span class="number">4</span>);</span><br><span class="line">    *(state+<span class="number">4</span>) = *(state+<span class="number">7</span>);</span><br><span class="line">    *(state+<span class="number">7</span>)  = *(state+<span class="number">6</span>);</span><br><span class="line">    *(state+<span class="number">6</span>)  = *(state+<span class="number">5</span>);</span><br><span class="line">    *(state+<span class="number">5</span>)  = temp;</span><br><span class="line">    <span class="comment">// row2</span></span><br><span class="line">    temp        = *(state+<span class="number">10</span>);</span><br><span class="line">    *(state+<span class="number">10</span>) = *(state+<span class="number">8</span>);</span><br><span class="line">    *(state+<span class="number">8</span>)  = temp;</span><br><span class="line">    temp        = *(state+<span class="number">11</span>);</span><br><span class="line">    *(state+<span class="number">11</span>) = *(state+<span class="number">9</span>);</span><br><span class="line">    *(state+<span class="number">9</span>)  = temp;</span><br><span class="line">    <span class="comment">// row3</span></span><br><span class="line">    temp        = *(state+<span class="number">12</span>);</span><br><span class="line">    *(state+<span class="number">12</span>)  = *(state+<span class="number">13</span>);</span><br><span class="line">    *(state+<span class="number">13</span>)  = *(state+<span class="number">14</span>);</span><br><span class="line">    *(state+<span class="number">14</span>) = *(state+<span class="number">15</span>);</span><br><span class="line">    *(state+<span class="number">15</span>) = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_decrypt_128</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *roundkeys, <span class="type">const</span> <span class="type">uint8_t</span> *ciphertext, <span class="type">uint8_t</span> *plaintext, <span class="type">uint8_t</span>*iv)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint8_t</span> tmp[<span class="number">16</span>];</span><br><span class="line">    <span class="type">uint8_t</span> t, u, v, m, n;</span><br><span class="line">    <span class="type">uint8_t</span> i, j;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )  <span class="comment">//转置</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * n + m] = ciphertext[<span class="number">4</span> * m + n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * m + n] ^= roundkeys[<span class="number">160</span> + <span class="number">4</span> * n + m];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    inv_shift_rows(tmp);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">        *(plaintext+i) = SBOX[*(tmp+i)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">9</span>; j &gt; <span class="number">0</span>; --j) &#123;</span><br><span class="line">        <span class="comment">// Inverse AddRoundKey</span></span><br><span class="line">        <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">3</span>; ++m )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">3</span>; ++n )</span><br><span class="line">            &#123;</span><br><span class="line">                plaintext[<span class="number">4</span> * m + n] ^= roundkeys[<span class="number">16</span>*j + <span class="number">4</span> * n + m];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        deMixColumns(plaintext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Inverse ShiftRows</span></span><br><span class="line">        inv_shift_rows(plaintext);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Inverse SubBytes</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i) &#123;</span><br><span class="line">            *(plaintext+i) = SBOX[*(plaintext+i)];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// last AddRoundKey</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">            plaintext[<span class="number">4</span> * i + j] ^= roundkeys[<span class="number">4</span> * j + i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">            tmp[<span class="number">4</span> * j + i] = plaintext[<span class="number">4</span> * i + j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">        *(plaintext+i) = *(tmp+i) ^ *iv++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//output_mem16(plaintext);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> i, r;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> key[] =</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="number">50</span>, <span class="number">48</span>, <span class="number">7</span>, <span class="number">54</span>, <span class="number">106</span>, <span class="number">55</span>, <span class="number">120</span>, <span class="number">49</span>, <span class="number">72</span>, <span class="number">57</span>, <span class="number">66</span>, <span class="number">57</span>, <span class="number">20</span>, <span class="number">49</span>, <span class="number">213</span>, <span class="number">50</span></span><br><span class="line">	&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> iv1[<span class="number">16</span>] = &#123;<span class="number">98</span>, <span class="number">54</span>, <span class="number">249</span>, <span class="number">56</span>, <span class="number">66</span>, <span class="number">48</span>, <span class="number">195</span>, <span class="number">49</span>, <span class="number">106</span>, <span class="number">53</span>, <span class="number">72</span>, <span class="number">56</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">84</span>, <span class="number">52</span>&#125;;</span><br><span class="line">    <span class="type">uint8_t</span> iv2[<span class="number">16</span>] = &#123;<span class="number">41</span>, <span class="number">52</span>, <span class="number">81</span>, <span class="number">54</span>, <span class="number">21</span>, <span class="number">57</span>, <span class="number">210</span>, <span class="number">56</span>, <span class="number">210</span>, <span class="number">57</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">185</span>, <span class="number">50</span>, <span class="number">46</span>, <span class="number">48</span>&#125;;</span><br><span class="line">	<span class="comment">//uint8_t plaintext[] = &#123;0x30, 0x30, 0x31, 0x31, 0x32, 0x32, 0x33, 0x33, 0x34, 0x34, 0x35, 0x35, 0x36, 0x36, 0x37, 0x37&#125;;//加密</span></span><br><span class="line">	<span class="type">uint8_t</span> ciphertext1[AES_BLOCK_SIZE] = &#123;<span class="number">254</span>, <span class="number">249</span>, <span class="number">231</span>, <span class="number">62</span>, <span class="number">246</span>, <span class="number">161</span>, <span class="number">35</span>, <span class="number">204</span>, <span class="number">87</span>, <span class="number">97</span>, <span class="number">193</span>, <span class="number">21</span>, <span class="number">119</span>, <span class="number">251</span>, <span class="number">156</span>, <span class="number">187</span>&#125;;</span><br><span class="line">	<span class="type">uint8_t</span> ciphertext2[AES_BLOCK_SIZE] = &#123;<span class="number">202</span>, <span class="number">47</span>, <span class="number">177</span>, <span class="number">232</span>, <span class="number">79</span>, <span class="number">217</span>, <span class="number">7</span>, <span class="number">216</span>, <span class="number">12</span>, <span class="number">107</span>, <span class="number">234</span>, <span class="number">207</span>, <span class="number">232</span>, <span class="number">66</span>, <span class="number">162</span>, <span class="number">250</span>&#125;;</span><br><span class="line">	<span class="type">uint8_t</span> dec_data[AES_BLOCK_SIZE];</span><br><span class="line">	<span class="type">uint8_t</span> roundkeys[AES_ROUND_KEY_SIZE];</span><br><span class="line"></span><br><span class="line">	<span class="comment">// key schedule</span></span><br><span class="line">	aes_key_schedule_128(key, roundkeys);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Round Keys:\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> ( r = <span class="number">0</span>; r &lt;= AES_ROUNDS; r++ )</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; i++) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%2x &quot;</span>, roundkeys[r*AES_BLOCK_SIZE+i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">    //测试加密</span></span><br><span class="line"><span class="comment">	aes_encrypt_128(roundkeys, plaintext, ciphertext, iv);</span></span><br><span class="line"><span class="comment">	printf(&quot;Cipher data:\n&quot;);</span></span><br><span class="line"><span class="comment">	for (i = 0; i &lt; AES_BLOCK_SIZE; i++)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">		printf(&quot;%2x &quot;, ciphertext[i]);</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	putchar(10);</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">	aes_decrypt_128(roundkeys, ciphertext1, dec_data, iv1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypt data:\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, dec_data[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	aes_decrypt_128(roundkeys, ciphertext2, dec_data, iv2);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; AES_BLOCK_SIZE; i++)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, dec_data[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到：7026271d7bb5d404d63a72b88e6b4d63</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/03/12/angr/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/12/angr/" class="post-title-link" itemprop="url">angr</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-12 11:40:18" itemprop="dateCreated datePublished" datetime="2022-03-12T11:40:18+08:00">2022-03-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:18:47" itemprop="dateModified" datetime="2022-07-18T00:18:47+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Angr"><a href="#Angr" class="headerlink" title="Angr"></a>Angr</h1><p>有好几个题目，我们全部用angr来做，</p>
<h2 id="00-angr-find"><a href="#00-angr-find" class="headerlink" title="00_angr_find"></a>00_angr_find</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">9</span>]; <span class="comment">// [esp+23h] [ebp-15h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s&quot;</span>, s1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    s1[i] = complex_function(s1[i], i);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, <span class="string">&quot;ILIUFVJF&quot;</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>comlex函数中也就是一个if函数和return，并不难，如何用angr写脚本是一个难的问题</p>
<p>angr的使用也比较麻烦，因为angr带有z3，如果直接安装，会出现问题，这个z3与python的z3是由一点去别的，所以我们每次用都要搞一个虚拟环境，我们每次使用先打开虚拟环境：</p>
<p>其实只用后两个命令都行</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">sudo apt-<span class="built_in">get</span> install python-dev libffi-dev build-essential virtualenvwrapper</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">WORKON_HOME</span>=~/HOME</span><br><span class="line"><span class="attribute">VIRTUALENVWRAPPER_PYTHON</span>=/usr/bin/python3</span><br><span class="line">source /usr/share/virtualenvwrapper/virtualenvwrapper.sh</span><br><span class="line">mkvirtualenv <span class="attribute">--python</span>=$(which python3) angr &amp;&amp; pip install angr</span><br></pre></td></tr></table></figure>

<p>这样就行了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv</span>):</span><br><span class="line">    <span class="comment">#目标文件路径</span></span><br><span class="line">    path_to_binary = <span class="string">&#x27;./00_angr_find/00_angr_find&#x27;</span></span><br><span class="line">    <span class="comment">#创建项目</span></span><br><span class="line">    project = angr.Project(path_to_binary)</span><br><span class="line">    <span class="comment">#设置项目起点，entry_state是程序的入口处，相当于main</span></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line">    <span class="comment">#设置模拟器</span></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="comment">#设置目标地址</span></span><br><span class="line">    print_good_addr = <span class="number">0x08048694</span></span><br><span class="line">    simulation.explore(find=print_good_addr)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#如果到达目标地址，打印此时符号向量</span></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#无解或出错抛出异常</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(angr) ┌─(~/syclover/angr/decode)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────(jonathan@DESKTOP-4L3BSKM:pts/0)─┐</span><br><span class="line">└─(12:51:45)──&gt; python3 angr0.py</span><br><span class="line">WARNING | 2022-03-12 12:53:13,212 | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line">WARNING | 2022-03-12 12:53:13,212 | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line">WARNING | 2022-03-12 12:53:13,212 | angr.storage.memory_mixins.default_filler_mixin | 1) setting a value to the initial state</span><br><span class="line">WARNING | 2022-03-12 12:53:13,212 | angr.storage.memory_mixins.default_filler_mixin | 2) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line">WARNING | 2022-03-12 12:53:13,212 | angr.storage.memory_mixins.default_filler_mixin | 3) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line">WARNING | 2022-03-12 12:53:13,213 | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with 4 unconstrained bytes referenced from 0x80486c1 (__libc_csu_init+0x1 in 00_angr_find (0x80486c1))</span><br><span class="line">WARNING | 2022-03-12 12:53:14,270 | angr.storage.memory_mixins.default_filler_mixin | Filling memory at 0x7ffeff50 with 4 unconstrained bytes referenced from 0x8186b80 (strcmp+0x0 in libc.so.6 (0x86b80))</span><br><span class="line">b&#x27;IICLTGRK&#x27;</span><br></pre></td></tr></table></figure>

<p>得到结果。</p>
<p><strong>sys.argv</strong></p>
<p>传递给Python脚本的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%91%BD%E4%BB%A4%E8%A1%8C&spm=1001.2101.3001.7020">命令行</a>参数列表。argv[0]是脚本名称（依赖于操作系统，无论这是否是完整路径名）。如果使用-c解释器的命令行选项执行命令，argv[0]则将其设置为字符串’-c’。如果没有脚本名称传递给Python解释器，argv[0]则为空字符串。</p>
<p>这个就是命令行输入</p>
<h3 id="if-name-x3D-x3D-‘main‘"><a href="#if-name-x3D-x3D-‘main‘" class="headerlink" title="if name &#x3D;&#x3D; ‘main‘:"></a>if <strong>name</strong> &#x3D;&#x3D; ‘<strong>main</strong>‘:</h3><p>不能在import引用的脚本中执行。一个python文件通常有两种使用方法，第一是作为脚本直接执行，第二是 import 到其他的 python 脚本中被调用（模块重用）执行。因此 if <strong>name</strong> &#x3D;&#x3D; ‘main’: 的作用就是控制这两种情况执行代码的过程，在 if <strong>name</strong> &#x3D;&#x3D; ‘main’: 下的代码只有在第一种情况下</p>
<h3 id="factory"><a href="#factory" class="headerlink" title="factory"></a>factory</h3><p>angr中有许多使用时需要一个实例化的project的类，可以使用project.factory而不用把project到处传递。</p>
<p><strong>states</strong></p>
<p>Project对象只代表程序的一个初始化镜像，当你使用angr来执行时，你在使用一个表示模拟程序状态的一个特殊对象SimState</p>
<h2 id="01-angr-avoid"><a href="#01-angr-avoid" class="headerlink" title="01_angr_avoid"></a>01_angr_avoid</h2><p>通过字符串搜索到good job</p>
<p>这一题是明显让我们使用avoid，那么avoid其实就是告诉脚本不要走哪边。</p>
<p>主函数太大，无法反编译，估计是有很多别的路，所以要加avoid，我们可以用上一个脚本，但稍微改一下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> doctest <span class="keyword">import</span> FAIL_FAST</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv</span>):</span><br><span class="line">    path_to_binary = <span class="string">&#x27;../solutions/01_angr_avoid/01_angr_avoid&#x27;</span></span><br><span class="line">    project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    print_good_address = <span class="number">0x080485FC</span></span><br><span class="line">    fail_address = <span class="number">0x0804860E</span></span><br><span class="line">    simulation.explore(find=print_good_address,avoid=fail_address)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find solution&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>

<p>我们只是在模拟器中添加了avoid。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">299</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">299</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">299</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">299</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">299</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">22</span>,<span class="number">300</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80d45b1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">01</span>_angr_avoid (<span class="number">0</span>x80d45b1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">51</span>,<span class="number">054</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeff1d with <span class="number">11</span> unconstrained bytes referenced from <span class="number">0</span>x8187170 (strncmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x87170))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">12</span>:<span class="number">51</span>,<span class="number">054</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeff40 with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8187170 (strncmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x87170))</span><br><span class="line"><span class="attribute">b</span>&#x27;JLVUSGJZ&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="02-angr-find-condition"><a href="#02-angr-find-condition" class="headerlink" title="02_angr_find_condition"></a>02_angr_find_condition</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+18h] [ebp-40h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1Ch] [ebp-3Ch]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">20</span>]; <span class="comment">// [esp+24h] [ebp-34h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">20</span>]; <span class="comment">// [esp+38h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">19</span>; ++i )</span><br><span class="line">    s2[i] = <span class="number">0</span>;</span><br><span class="line">  qmemcpy(s2, <span class="string">&quot;CAWMCZTB&quot;</span>, <span class="number">8</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s&quot;</span>, s1);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">    s1[j] = complex_function(s1[j], j + <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个题哦，看上去没啥区别，当我们找puts时，就会出现问题</p>
<p><img src="/2022/03/12/angr/image-20220312141817120.png"></p>
<p>这么多puts：good，应该怎么办，解决方法是通过判断控制台输出数据是不是”Good Job” 和”Try again” 来确认执行到了成功还是失败分支.即我们不再确认地址，我们只看输出是不是我们想要的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv</span>):</span><br><span class="line">    path = <span class="string">&#x27;../solutions/02_angr_find_condition/02_angr_find_condition&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    state = project.factory.entry_state()</span><br><span class="line">    simulation = project.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    <span class="comment">#含义就是在所有输出里找try again</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">try_again</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    </span><br><span class="line">    simulation.explore(find=good_job,avoid=try_again)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#下面是打印输入流，输出是stdout</span></span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;NOooooooo!&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">20</span>,<span class="number">664</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x804d2a1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">02</span>_angr_find_condition (<span class="number">0</span>x804d2a1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">21</span>,<span class="number">644</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeff0d with <span class="number">11</span> unconstrained bytes referenced from <span class="number">0</span>x8186b80 (strcmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x86b80))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">41</span>:<span class="number">21</span>,<span class="number">644</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeff30 with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8186b80 (strcmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x86b80))</span><br><span class="line"><span class="attribute">b</span>&#x27;OHYJUMBE&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="03-angr-symbolic-registers"><a href="#03-angr-symbolic-registers" class="headerlink" title="03_angr_symbolic_registers"></a>03_angr_symbolic_registers</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 user_input; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  user_input = get_user_input();</span><br><span class="line">  v7 = HIDWORD(user_input);</span><br><span class="line">  v5 = complex_function_1(user_input);</span><br><span class="line">  v6 = complex_function_2();</span><br><span class="line">  v8 = complex_function_3(v7);</span><br><span class="line">  <span class="keyword">if</span> ( v5 || v6 || v8 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三个complex，里面全是运算，有一点这三个函数只有两个有参数，但我们看汇编发现其实是有三个值，那么我们只需要求出eax，ebx，edx的值就行了</p>
<p><img src="/2022/03/12/angr/image-20220312150126326.png"></p>
<p>那么我们就要学会如何从寄存器中获得输入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/03_angr_symbolic_registers/03_angr_symbolic_registers&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    <span class="comment">#自己设置项目起始地址</span></span><br><span class="line">    start_addr = <span class="number">0x080488C7</span></span><br><span class="line">    state = project.factory.blank_state(addr=start_addr)</span><br><span class="line"></span><br><span class="line">    bit_lenth = <span class="number">32</span></span><br><span class="line">    psd0 = claripy.BVS(<span class="string">&#x27;psd0&#x27;</span>,bit_lenth)</span><br><span class="line">    psd1 = claripy.BVS(<span class="string">&#x27;psd1&#x27;</span>,bit_lenth)</span><br><span class="line">    psd2 = claripy.BVS(<span class="string">&#x27;psd2&#x27;</span>,bit_lenth)</span><br><span class="line"></span><br><span class="line">    state.regs.eax = psd0</span><br><span class="line">    state.regs.ebx = psd1</span><br><span class="line">    state.regs.edx = psd2</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    good_add = <span class="number">0x0804892F</span></span><br><span class="line">    fail_add = <span class="number">0x0804891D</span></span><br><span class="line">    simulation.explore(find=good_add,avoid=fail_add)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">#如何进行寄存器输出</span></span><br><span class="line">        solution0 =solution_state.se.<span class="built_in">eval</span>(psd0)</span><br><span class="line">        solution1 =solution_state.se.<span class="built_in">eval</span>(psd1)</span><br><span class="line">        solution2 =solution_state.se.<span class="built_in">eval</span>(psd2)</span><br><span class="line">        solution = <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">map</span>(<span class="string">&#x27;&#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>,[solution0,solution1,solution2]))</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Noooooooo!&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最主要的是，如果我们要从寄存器中找数据，那么我们一定要自己把函数位置找到，因为寄存器是会变的。</p>
<p>初始化寄存器操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bit_length = <span class="number">32</span></span><br><span class="line">psd0 = claripy.BVS(<span class="string">&#x27;psd0&#x27;</span>, bit_length)</span><br><span class="line">initial_state.regs.eax = psd0</span><br></pre></td></tr></table></figure>

<h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p>是Python的一个内置函数，功能十分强大，这个函数的作用是，返回传入字符串的表达式的结果。就是说：将字符串当成有效的表达式 来求值 并 返回计算结果。</p>
<h3 id="formamt"><a href="#formamt" class="headerlink" title="formamt"></a>formamt</h3><p>fotmat作为Python的的格式字符串函数，主要通过字符串中的花括号{}，来识别替换字段，从而完成字符串的格式化。</p>
<p>上面主要是变成十六进制再连起来</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">675</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">58</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80488c7 (main+<span class="number">0</span>x26 in <span class="number">03</span>_angr_symbolic_registers (<span class="number">0</span>x80488c7))</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">33</span>:<span class="number">59</span>,<span class="number">119</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">e9b37483</span> <span class="number">7</span>aab5fde <span class="number">8</span>f5b48ea</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">project<span class="selector-class">.factory</span><span class="selector-class">.blank_state</span>(addr=start_address) =&gt; 创建自定义入口的状态上下文</span><br><span class="line"></span><br><span class="line">initial_state<span class="selector-class">.regs</span> =&gt; 操作状态上下文的寄存器</span><br><span class="line"></span><br><span class="line">claripy<span class="selector-class">.BVS</span>(<span class="string">&#x27;变量名&#x27;</span>, 变量大小) =&gt; 创建求解变量</span><br><span class="line"></span><br><span class="line">solution_state<span class="selector-class">.se</span><span class="selector-class">.eval</span>(变量) =&gt; 求解符号变量</span><br></pre></td></tr></table></figure>



<h2 id="04-angr-symbolic-stack"><a href="#04-angr-symbolic-stack" class="headerlink" title="04_angr_symbolic_stack"></a>04_angr_symbolic_stack</h2><p>这个题又不一样了，这个是局部变量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  handle_user();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">handle_user</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v2[<span class="number">3</span>]; <span class="comment">// [esp+Ch] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u %u&quot;</span>, v2, &amp;v1);</span><br><span class="line">  v2[<span class="number">0</span>] = complex_function0(v2[<span class="number">0</span>]);</span><br><span class="line">  v1 = complex_function1(v1);</span><br><span class="line">  <span class="keyword">if</span> ( v2[<span class="number">0</span>] == <span class="number">2083606899</span> &amp;&amp; v1 == <span class="number">-99478518</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们知道局部变量是储存在栈中的，所以我们要构造栈上的内存</p>
<p><img src="/2022/03/12/angr/image-20220312161752967.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mimetypes <span class="keyword">import</span> init</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    binary_path = <span class="string">&#x27;../solutions/04_angr_symbolic_stack/04_angr_symbolic_stack&#x27;</span></span><br><span class="line">    project = angr.Project(binary_path)</span><br><span class="line"></span><br><span class="line">    start_addr = <span class="number">0x080486AE</span></span><br><span class="line">    initial_state = project.factory.blank_state(addr=start_addr)</span><br><span class="line"></span><br><span class="line">    initial_state.regs.ebp = initial_state.regs.esp <span class="comment"># 初始化栈，令ebp等于esp</span></span><br><span class="line"></span><br><span class="line">    password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, <span class="number">32</span>) <span class="comment"># 初始化两个位向量</span></span><br><span class="line">    password1 = claripy.BVS(<span class="string">&#x27;password1&#x27;</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    padding_length_in_bytes = <span class="number">0x8</span> <span class="comment"># 填充栈 integer * 2</span></span><br><span class="line">    initial_state.regs.esp -= padding_length_in_bytes </span><br><span class="line"></span><br><span class="line">    initial_state.stack_push(password0) <span class="comment"># 将位向量压入栈中</span></span><br><span class="line">    initial_state.stack_push(password1)</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Good Job&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Try again&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(password0)</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(password1)</span><br><span class="line"></span><br><span class="line">        solution = <span class="string">&#x27;%u %u&#x27;</span> % (solution0, solution1)</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>符号化栈空间的运用：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">initial_state<span class="number">.</span>regs<span class="number">.</span><span class="built_in">ebp</span> = initial_state<span class="number">.</span>regs<span class="number">.</span><span class="built_in">esp</span> # 初始化栈，令<span class="built_in">ebp</span>等于<span class="built_in">esp</span></span><br><span class="line"></span><br><span class="line">padding_length_in_bytes = <span class="number">0xC</span> # 填充栈</span><br><span class="line">initial_state<span class="number">.</span>regs<span class="number">.</span><span class="built_in">esp</span> -= padding_length_in_bytes </span><br><span class="line"></span><br><span class="line">initial_state<span class="number">.</span>stack_push(password0) # 将位向量压入栈中</span><br></pre></td></tr></table></figure>

<h2 id="05-angr-symbolic-memory"><a href="#05-angr-symbolic-memory" class="headerlink" title="05_angr_symbolic_memory"></a>05_angr_symbolic_memory</h2><p>这个题考的是bss段的输入，我们要构造bss段符号表示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(user_input, <span class="number">0</span>, <span class="number">0x21</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s %8s %8s&quot;</span>, user_input, &amp;unk_AB232C8, &amp;unk_AB232D0, &amp;unk_AB232D8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">179450560</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">179450560</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(user_input, <span class="string">&quot;OSIWHBXIFOQVSBZBISILSCLBIAXSEWUT&quot;</span>, <span class="number">0x20</span>u) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">complex_function</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt;= <span class="number">64</span> || a1 &gt; <span class="number">90</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="number">9</span> * a2 + a1 - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给出脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">agrv</span>):</span><br><span class="line">    path = <span class="string">&#x27;../solutions/05_angr_symbolic_memory/05_angr_symbolic_memory&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    adds = <span class="number">0x08048618</span><span class="comment">#scanf后</span></span><br><span class="line">    state = project.factory.blank_state(add=adds)</span><br><span class="line">    <span class="comment"># 64 = 8(8个字符) * 1(每个字符一字节) * 8(每个字节8比特)</span></span><br><span class="line">    psd0 =claripy.BVS(<span class="string">&#x27;psd0&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">    psd1 =claripy.BVS(<span class="string">&#x27;psd1&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">    psd2 =claripy.BVS(<span class="string">&#x27;psd2&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">    psd3 =claripy.BVS(<span class="string">&#x27;psd3&#x27;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    psd0_add = <span class="number">0x0AB232C0</span></span><br><span class="line">    psd1_add = <span class="number">0x0AB232C8</span></span><br><span class="line">    psd2_add = <span class="number">0x0AB232D0</span></span><br><span class="line">    psd3_add = <span class="number">0x0AB232D8</span> </span><br><span class="line"></span><br><span class="line">    state.memory.store(psd0_add,psd0)<span class="comment">#把位向量存入内存</span></span><br><span class="line">    state.memory.store(psd1_add,psd1)</span><br><span class="line">    state.memory.store(psd2_add,psd2)</span><br><span class="line">    state.memory.store(psd3_add,psd3)</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_add</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fail_add</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=good_add,avoid=fail_add)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(psd0)</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(psd1)</span><br><span class="line">        solution2 = solution_state.se.<span class="built_in">eval</span>(psd2)</span><br><span class="line">        solution3 = solution_state.se.<span class="built_in">eval</span>(psd3)</span><br><span class="line">        solution = <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">map</span>(<span class="string">&#x27;&#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>, [ solution0, solution1,solution2,solution3 ]))</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Noooooooo!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">666</span> | angr.sim_state | Unused keyword arguments passed to SimState: add</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">673</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">674</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">674</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">674</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">674</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">674</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7fff0000 with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8048432 (_start+<span class="number">0</span>x2 in <span class="number">05</span>_angr_symbolic_memory (<span class="number">0</span>x8048432))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">675</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register eax with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8048438 (_start+<span class="number">0</span>x8 in <span class="number">05</span>_angr_symbolic_memory (<span class="number">0</span>x8048438))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">676</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edx with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x804843a (_start+<span class="number">0</span>xa in <span class="number">05</span>_angr_symbolic_memory (<span class="number">0</span>x804843a))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">00</span>,<span class="number">746</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80486a1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">05</span>_angr_symbolic_memory (<span class="number">0</span>x80486a1))</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">12</span> <span class="number">20</span>:<span class="number">06</span>:<span class="number">05</span>,<span class="number">988</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h2 id="06-angr-symbolic-dynamic-memory"><a href="#06-angr-symbolic-dynamic-memory" class="headerlink" title="06_angr_symbolic_dynamic_memory"></a>06_angr_symbolic_dynamic_memory</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  buffer0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  buffer1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer0, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer1, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s&quot;</span>, buffer0, buffer1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    buffer0[i] = complex_function(buffer0[i], i);</span><br><span class="line">    buffer1[i] = complex_function(buffer1[i], i + <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buffer0, <span class="string">&quot;OSIWHBXI&quot;</span>, <span class="number">8u</span>) &amp;&amp; !<span class="built_in">strncmp</span>(buffer1, <span class="string">&quot;FOQVSBZB&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(buffer0);</span><br><span class="line">  <span class="built_in">free</span>(buffer1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次scanf() 有两个输入参数,数据保存的位置是通过全局变量的char* 指针来保存到buffer 中,大小为8 字节.我们主要是对buffer两个内存进行求解。我们如何将两块动态申请来的内存符号化，malloc申请的空间是动态的，但存放malloc的buffer是再bss段，属于静态，我们选择伪造指针使其指向一片可写的内存，将内存符号化</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20220313151556700.png" alt="image-20220313151556700">	</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> is_</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/06_angr_symbolic_dynamic_memory/06_angr_symbolic_dynamic_memory&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    start_address = <span class="number">0x080486AF</span></span><br><span class="line">    state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    psd0 = claripy.BVS(<span class="string">&#x27;psd0&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">    psd1 = claripy.BVS(<span class="string">&#x27;psd1&#x27;</span>,<span class="number">64</span>)</span><br><span class="line">    fake_address0 = <span class="number">0x0A2DEF30</span><span class="comment"># 伪造malloc得来的内存，在bss上随便找的</span></span><br><span class="line">    pointer_to_address0 = <span class="number">0x0A2DEF74</span><span class="comment"># 指向伪造内存的指针</span></span><br><span class="line">    state.memory.store(pointer_to_address0,fake_address0,endness=project.arch.memory_endness)<span class="comment"># 将指针指向伪造的内存</span></span><br><span class="line">    fake_address1 = <span class="number">0x0A2DEF40</span></span><br><span class="line">    pointer_to_address1 = <span class="number">0x0A2DEF7C</span></span><br><span class="line">    state.memory.store(pointer_to_address1,fake_address1,endness=project.arch.memory_endness)</span><br><span class="line">    state.memory.store(fake_address0,psd0)<span class="comment"># 将伪造的内存符号化</span></span><br><span class="line">    state.memory.store(fake_address1,psd1)</span><br><span class="line">    simulation = project.factory.simgr(state)</span><br><span class="line">    simulation.explore(find=<span class="number">0x0804877A</span>,avoid=<span class="number">0x08048768</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(psd0)</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(psd1)</span><br><span class="line">        solution = <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">map</span>(<span class="string">&#x27;&#123;:x&#125;&#x27;</span>.<span class="built_in">format</span>,[solution0,solution1]))</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Nooooooooo!&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">666</span> | angr.storage.memory_mixins.bvv_conversion_mixin | Unknown size for memory data <span class="number">0</span>xa2def30. Default to arch.bits.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">667</span> | angr.storage.memory_mixins.bvv_conversion_mixin | Unknown size for memory data <span class="number">0</span>xa2def40. Default to arch.bits.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">11</span>,<span class="number">672</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80486af (main+<span class="number">0</span>x8c in <span class="number">06</span>_angr_symbolic_dynamic_memory (<span class="number">0</span>x80486af))</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">07</span>:<span class="number">15</span>,<span class="number">521</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">4f46494a484f5856</span> <span class="number">46425149534</span>f5a4f</span><br></pre></td></tr></table></figure>

<p>这节学到了符号化申请动态内存，通过伪造内存方式：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">initial_state.memory.store(buffer0_addr, fake0_addr, endness=<span class="keyword">project</span>.arch.memory_endness) <span class="comment"># 将指针指向伪造的内存</span></span><br><span class="line">initial_state.memory.store(fake0_addr, password0) <span class="comment"># 将伪造的内存符号化</span></span><br></pre></td></tr></table></figure>

<p>endness的参数是小端写入，因为angr默认大端。</p>
<h2 id="07-angr-symbolic-file"><a href="#07-angr-symbolic-file" class="headerlink" title="07_angr_symbolic_file"></a>07_angr_symbolic_file</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [esp-14h] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp-10h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp-Ch] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-8h] [ebp-24h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp-4h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+0h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, buffer, v3, v4, v5, v6, v7, v8);</span><br><span class="line">  ignore_me((<span class="type">int</span>)buffer, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  fp = fopen(<span class="string">&quot;FOQVSBZB.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  fread(buffer, <span class="number">1u</span>, <span class="number">0x40</span>u, fp);</span><br><span class="line">  fclose(fp);</span><br><span class="line">  unlink(<span class="string">&quot;FOQVSBZB.txt&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">134520992</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">134520992</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(buffer, <span class="string">&quot;OSIWHBXI&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是将输入写入文件，然后再打开文件进行加密</p>
<p>所以要构建文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/07_angr_symbolic_file/07_angr_symbolic_file&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    start_address = <span class="number">0x080488BC</span></span><br><span class="line">    initial_state = project.factory.blank_state(add=start_address)</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&#x27;FOQVSBZB.txt&#x27;</span></span><br><span class="line">    symbolic_file_size_bytes = <span class="number">0x40</span><span class="comment">#64位</span></span><br><span class="line"></span><br><span class="line">    psd = claripy.BVS(<span class="string">&#x27;psd&#x27;</span>,symbolic_file_size_bytes * <span class="number">8</span>)</span><br><span class="line">    psd_file = angr.SimFile(filename, content=psd, size=symbolic_file_size_bytes) <span class="comment"># 符号化文件</span></span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.blank_state(addr=start_address, fs=&#123;filename: psd_file&#125;) <span class="comment"># 再初始状态中添加一个虚拟的文件系统</span></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">try_again</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=good_job,avoid=try_again)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution = n2s(solution_state.solver.<span class="built_in">eval</span>(psd))</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Nooooooo!!!&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">858</span> | angr.sim_state | Unused keyword arguments passed to SimState: add</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">908</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">909</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">909</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">909</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">909</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">33</span>,<span class="number">909</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8048922 (main+<span class="number">0</span>xc4 in <span class="number">07</span>_angr_symbolic_file (<span class="number">0</span>x8048922))</span><br><span class="line"><span class="attribute">OBAXRUZT</span></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">angr<span class="selector-class">.storage</span><span class="selector-class">.SimFile</span>(文件名,文件内容, size = 文件大小) =&gt; 创建一个模拟文件,当有被执行的程序fopen 打开文件时,我们可以控制其里面的内容</span><br><span class="line"></span><br><span class="line">initial_state<span class="selector-class">.posix</span><span class="selector-class">.fs</span> =&gt; 状态上下文的文件系统对象</span><br></pre></td></tr></table></figure>

<p>要注意点，但我们创建符号good_job其参数是state，所以我们在创建项目时，不能用state，可以用initial_state</p>
<h2 id="08-angr-constraints"><a href="#08-angr-constraints" class="headerlink" title="08_angr_constraints"></a>08_angr_constraints</h2><p>这道题的特点就是会一个一个字符比较，所以不能用之前的方法，否则会有2的16次方中可能，会爆炸的，我们要做的就是符号化buffer，然后进行加密加密后获得控制权，从而检查psd是否与对比的一致</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  qmemcpy(&amp;password, <span class="string">&quot;OSIWHBXIFOQVSBZB&quot;</span>, <span class="number">16</span>);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;buffer, <span class="number">0</span>, <span class="number">0x11</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%16s&quot;</span>, &amp;buffer);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">134520896</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">134520896</span>), <span class="number">15</span> - i);</span><br><span class="line">  <span class="keyword">if</span> ( check_equals_OSIWHBXIFOQVSBZB(&amp;buffer, <span class="number">16</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给出脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> n2s</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/08_angr_constraints/08_angr_constraints&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    start_add = <span class="number">0x0804863C</span> <span class="comment">#scanf后面</span></span><br><span class="line">    initial_state = project.factory.blank_state(add=start_add)</span><br><span class="line">    buffer = claripy.BVS(<span class="string">&#x27;buffer&#x27;</span>,<span class="number">0x10</span>*<span class="number">8</span>)<span class="comment">#buffer的大小是0x10 字节,也就是0x10 * 8 比特</span></span><br><span class="line">    buffer_address = <span class="number">0x0804A040</span></span><br><span class="line">    initial_state.memory.store(buffer_address,buffer)<span class="comment">#buffer 是全局变量,地址是0x804A040</span></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    address_to_check_constraint = <span class="number">0x08048683</span></span><br><span class="line">    simulation.explore(find=address_to_check_constraint)<span class="comment">#  compilex_function() 计算结束位置</span></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        constrained_parameter_address = <span class="number">0x0804A040</span> <span class="comment">#  计算约束的内存位置</span></span><br><span class="line">        constrained_parameter_size_bytes = <span class="number">0x10</span> <span class="comment">#  计算约束的内存大小</span></span><br><span class="line">        constrained_parameter_bitvector = solution_state.memory.load(  constrained_parameter_address,constrained_parameter_size_bytes) <span class="comment">#  加载内存</span></span><br><span class="line"></span><br><span class="line">        constrained_parameter_desired_value = <span class="string">&quot;OSIWHBXIFOQVSBZB&quot;</span><span class="comment">#  Key-String</span></span><br><span class="line">        solution_state.add_constraints(constrained_parameter_bitvector == constrained_parameter_desired_value )<span class="comment"># 添加约束</span></span><br><span class="line">        solution = solution_state.se.<span class="built_in">eval</span>(buffer)</span><br><span class="line">        <span class="built_in">print</span>(n2s(solution))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;nooooooooo!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>学到：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solution_state<span class="selector-class">.memory</span><span class="selector-class">.load</span>(内存地址,内存大小) =&gt; 加载内存</span><br><span class="line"></span><br><span class="line">solution_state<span class="selector-class">.add_constraints</span>(约束条件) =&gt; 添加约束条件</span><br></pre></td></tr></table></figure>

<h2 id="09-angr-hooks"><a href="#09-angr-hooks" class="headerlink" title="09_angr_hooks"></a>09_angr_hooks</h2><p>这个题主要是对比的时候在遍历分支的时候会用很长时间，我们直接hook掉，然后替换成我们自己对比函数就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/09_angr_hooks/09_angr_hooks&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    check_equals = <span class="number">0x080486CA</span></span><br><span class="line">    instruction_to_skip_lenth = <span class="number">5</span></span><br><span class="line"><span class="meta">    @project.hook(<span class="params">check_equals, length=instruction_to_skip_lenth</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">skip_check_equals</span>(<span class="params">state</span>):</span><br><span class="line">        user_input_buffer_addr = <span class="number">0x0804A044</span><span class="comment">#buffer地址</span></span><br><span class="line">        user_input_buffer_lenth = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">        user_input_string = state.memory.laod( user_input_buffer_addr,user_input_buffer_lenth)</span><br><span class="line">        check_against_string = <span class="string">&#x27;OSIWHBXIFOQVSBZB&#x27;</span></span><br><span class="line">        state.regs.eax = claripy.If(user_input_string == check_against_string,claripy.BVV(<span class="number">1</span>,<span class="number">32</span>),claripy.BVV(<span class="number">0</span>,<span class="number">32</span>))</span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=is_successful, avoid=should_abort)  <span class="comment">#  Try Explore Execute Path</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution = solution_state.posix.dumps(sys.stdin.fileno())  <span class="comment">#  Get data ..</span></span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>上面脚本不如下面脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/09_angr_hooks/09_angr_hooks&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementCheckEquals</span>(angr.SimProcedure):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, check_data_address, check_data_length</span>):</span><br><span class="line">            check_input_string = self.state.memory.load(check_data_address,check_data_length)</span><br><span class="line">            check_against_string = <span class="string">&#x27;OSIWHBXIFOQVSBZB&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> claripy.If(check_input_string == check_against_string,claripy.BVV(<span class="number">1</span>,<span class="number">32</span>),claripy.BVV(<span class="number">0</span>,<span class="number">32</span>))</span><br><span class="line">        </span><br><span class="line">    check_equals_symbol = <span class="string">&#x27;check_equals_OSIWHBXIFOQVSBZB&#x27;</span></span><br><span class="line">    project.hook_symbol(check_equals_symbol,ReplacementCheckEquals())</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=good_job,avoid=should_abort)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">538</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">538</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">538</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">538</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">538</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">43</span>,<span class="number">539</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80487a1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">09</span>_angr_hooks (<span class="number">0</span>x80487a1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">46</span>,<span class="number">867</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">b</span>&#x27;QREPXOHPJPOQKQLKNOBMULEMGMLNHNIH&#x27;</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Hook回调函数格式:</span><br><span class="line"></span><br><span class="line">@project.hook(Hook地址,执行完Hook函数后指令往后跳转n字节) def skip_check_equals_(<span class="keyword">state</span>):</span><br><span class="line"></span><br><span class="line"><span class="built_in">pass</span></span><br><span class="line"></span><br><span class="line">claripy.If(条件,条件为True时的返回值,条件为False时的返回值) =&gt; 创建条件判断</span><br><span class="line"></span><br><span class="line">claripy.BVV(值,值大小) =&gt; 创建一个数值</span><br></pre></td></tr></table></figure>

<h2 id="10-angr-simprocedures"><a href="#10-angr-simprocedures" class="headerlink" title="10_angr_simprocedures"></a>10_angr_simprocedures</h2><p>还是一样，先输入flag然后循环运算，接下来函数中对比。逐字节比较太麻烦，我们仍需对比</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+20h] [ebp-28h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">17</span>]; <span class="comment">// [esp+2Bh] [ebp-1Dh] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+3Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;password, <span class="string">&quot;OSIWHBXIFOQVSBZB&quot;</span>, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%16s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    s[i] = complex_function(s[i], <span class="number">18</span> - i);</span><br><span class="line">  <span class="keyword">if</span> ( check_equals_OSIWHBXIFOQVSBZB(s, <span class="number">16</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本题跟9题的区别就在于，本题call equal指令太多，不像9题只有一个，所以我们需要多个hook</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/10_angr_simprocedures/10_angr_simprocedures&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementCheckEquals</span>(angr.SimProcedure):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, check_data_address, check_data_length</span>):</span><br><span class="line">            check_input_string = self.state.memory.load(check_data_address,check_data_length)</span><br><span class="line">            check_against_string = <span class="string">&#x27;OSIWHBXIFOQVSBZB&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> claripy.If(check_input_string == check_against_string,claripy.BVV(<span class="number">1</span>,<span class="number">32</span>),claripy.BVV(<span class="number">0</span>,<span class="number">32</span>))</span><br><span class="line">        </span><br><span class="line">    check_equals_symbol = <span class="string">&#x27;check_equals_OSIWHBXIFOQVSBZB&#x27;</span></span><br><span class="line">    project.hook_symbol(check_equals_symbol,ReplacementCheckEquals())</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=good_job,avoid=should_abort)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        solution = solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">40</span>,<span class="number">607</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x804a9d1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">10</span>_angr_simprocedures (<span class="number">0</span>x804a9d1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">43</span>,<span class="number">850</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">b</span>&#x27;MTMDRONBBNSAAMNS&#x27;</span><br></pre></td></tr></table></figure>

<p>这个题hook整个函数。采用SimProcedure类</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Hook</span> 回调函数格式:</span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">ReplacementCheckEquals</span>(<span class="title">angr</span>.<span class="type">SimProcedure</span>):</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">def run(<span class="title">self</span>, <span class="type">Hook</span>的函数参数列表):</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   ….</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   return 函数返回值 # 如果是void函数可以省略</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">project.hook_symbol(要<span class="type">Hook</span>的函数名,<span class="type">SimProcedure</span>类实例)</span></span><br></pre></td></tr></table></figure>

<p>通过这个题，我在想上个题是否也能用这个回调函数呢，这个脚本会省去很多事，成功了！</p>
<h2 id="11-angr-sim-scanf"><a href="#11-angr-sim-scanf" class="headerlink" title="11_angr_sim_scanf"></a>11_angr_sim_scanf</h2><p>本题加密的是对比数据，加密完再输入，然后对比</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+20h] [ebp-28h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">20</span>]; <span class="comment">// [esp+28h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+3Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  qmemcpy(s, <span class="string">&quot;LOGMHXHI&quot;</span>, <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    s[i] = complex_function(s[i], i);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u %u&quot;</span>, buffer0, buffer1);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buffer0, s, <span class="number">4u</span>) &amp;&amp; !<span class="built_in">strncmp</span>(buffer1, &amp;s[<span class="number">4</span>], <span class="number">4u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这道题是让我们模拟scanf</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr </span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/11_angr_sim_scanf/11_angr_sim_scanf&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,format_string,scanf0_address,scanf1_address</span>):</span><br><span class="line">            scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">            scanf1 = claripy.BVS(<span class="string">&#x27;scanf1&#x27;</span>, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">            self.state.memory.store(scanf0_address,scanf0,endness=project.arch.memory_endness)</span><br><span class="line">            self.state.memory.store(scanf1_address,scanf1,endness=project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>] = scanf0</span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>] = scanf1</span><br><span class="line"></span><br><span class="line">    scanf_symbol = <span class="string">&#x27;__isoc99_scanf&#x27;</span></span><br><span class="line">    project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=good_job,avoid=should_abort)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        store_solution0 = solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>]</span><br><span class="line">        store_solution1 = solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>]</span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(store_solution0)</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(store_solution1)</span><br><span class="line">        <span class="built_in">print</span>(solution0,solution1)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">831</span> | angr.project | Address is already hooked, during hook(<span class="number">0</span>x81513a0, &lt;SimProcedure ReplacementScanf&gt;). Re-hooking.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">33</span>,<span class="number">903</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x804fce1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">11</span>_angr_sim_scanf (<span class="number">0</span>x804fce1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">34</span>,<span class="number">137</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeff40 with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x8187170 (strncmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x87170))</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">09</span>:<span class="number">34</span>,<span class="number">334</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">1447907916</span> <span class="number">1146768724</span></span><br></pre></td></tr></table></figure>

<p>这个题学到了构造scanf的hook：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将位向量储存到当前状态并且获取位向量的方法</span></span><br><span class="line"><span class="literal">self</span>.<span class="keyword">state</span>.globals[&#x27;solution0&#x27;] = scanf0</span><br><span class="line"><span class="comment">#保存当前状态</span></span><br><span class="line">solution0 = solution_state.globals[&#x27;solution0&#x27;]</span><br><span class="line"><span class="comment">#去出scanf</span></span><br></pre></td></tr></table></figure>

<h2 id="12-angr-veritesting"><a href="#12-angr-veritesting" class="headerlink" title="12_angr_veritesting"></a>12_angr_veritesting</h2><p>如果说这个题跟第一题有什么区别的话，就是这个输入32位，很容易爆炸，所以有veritesting参数来表示是否合并路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/12_angr_veritesting/12_angr_veritesting&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line">    simulation = project.factory.simgr(initial_state,veritesting = <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)  <span class="comment"># :boolean</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line">    </span><br><span class="line">    simulation.explore(find=is_successful,avoid=should_abort)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution.posix.dumps(sys.stdin.fileno()))</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">745</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">745</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">745</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">745</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">745</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">746</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x80486e1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">12</span>_angr_veritesting (<span class="number">0</span>x80486e1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">757</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">758</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">Deprecation</span> warning: Use self.model.get_any_node() instead of get_any_node</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">789</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">790</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">852</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">853</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">887</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">57</span>,<span class="number">887</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">001</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">001</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">098</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">099</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">209</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">209</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x0 (not part of a loaded object)</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">322</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">564</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">58</span>,<span class="number">807</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span>,<span class="number">033</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span>,<span class="number">259</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span>,<span class="number">507</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">59</span>,<span class="number">751</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">001</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">253</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">526</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">00</span>,<span class="number">801</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">01</span>,<span class="number">072</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">01</span>,<span class="number">352</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">01</span>,<span class="number">645</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">01</span>,<span class="number">934</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">02</span>,<span class="number">240</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">02</span>,<span class="number">541</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">02</span>,<span class="number">851</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">03</span>,<span class="number">179</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">03</span>,<span class="number">504</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">03</span>,<span class="number">826</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">04</span>,<span class="number">170</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">04</span>,<span class="number">519</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">04</span>,<span class="number">869</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">05</span>,<span class="number">314</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">05</span>,<span class="number">676</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">06</span>,<span class="number">060</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">06</span>,<span class="number">456</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">06</span>,<span class="number">859</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">07</span>,<span class="number">269</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">07</span>,<span class="number">704</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">08</span>,<span class="number">188</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge <span class="literal">all</span> states.</span><br><span class="line"><span class="attribute">b</span>&#x27;YNCRGVKZODSHWLAPETIXMBQFUJYNCRGV&#x27;</span><br></pre></td></tr></table></figure>

<p>学习了如何自动合并路径：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">simulation</span> = project.factory.simgr(initial_state, veritesting=<span class="literal">True</span>) </span><br></pre></td></tr></table></figure>

<h2 id="13-angr-static-binary"><a href="#13-angr-static-binary" class="headerlink" title="13_angr_static_binary"></a>13_angr_static_binary</h2><p>看起来很简单，用第一问的脚本就行了，实际不行，因为这个是用静态链接编译的，我们还要实现或者引用一些函数的hook</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+20h] [ebp-38h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">20</span>]; <span class="comment">// [esp+24h] [ebp-34h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">20</span>]; <span class="comment">// [esp+38h] [ebp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">19</span>; ++i )</span><br><span class="line">    v7[i] = <span class="number">0</span>;</span><br><span class="line">  qmemcpy(v7, <span class="string">&quot;ELZXQOOQ&quot;</span>, <span class="number">8</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  _isoc99_scanf(<span class="string">&quot;%8s&quot;</span>, v6);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">    v6[j] = complex_function(v6[j], j);</span><br><span class="line">  <span class="keyword">if</span> ( j_strcmp_ifunc(v6, v7) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/13_angr_static_binary/13_angr_static_binary&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line">    simulation = project.factory.simgr(initial_state,veritesting = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    project.hook(<span class="number">0x0804FAB0</span>,angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;printf&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x0804FB10</span>,angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;scanf&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x080503F0</span>,angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;puts&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x08048D60</span>,angr.SIM_PROCEDURES[<span class="string">&#x27;glibc&#x27;</span>][<span class="string">&#x27;__libc_start_main&#x27;</span>]())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)  <span class="comment"># :boolean</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>):</span><br><span class="line">        stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Try again.&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)</span><br><span class="line"></span><br><span class="line">    simulation.explore(find=is_successful,avoid=should_abort)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">180</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">180</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">180</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">180</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">181</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">181</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x80497b1</span> (__libc_csu_init+<span class="number">0x1</span> in <span class="number">13</span>_angr_static_binary (<span class="number">0x80497b1</span>))</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">185</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">186</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">Deprecation warning: Use self.model.get_any_node() instead of get_any_node</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">255</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">255</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">279</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">279</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">323</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">325</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">406</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">406</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">422</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">422</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">502</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">502</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">528</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">528</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">566</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">19</span>,<span class="number">566</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">020</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">021</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">310</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">311</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">391</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">20</span>,<span class="number">392</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">21</span>,<span class="number">303</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">21</span>,<span class="number">304</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">24</span>,<span class="number">416</span> | angr.sim_manager | Cannot find states with common history line to merge. Fall back to the naive merging strategy and merge all states.</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">25</span>,<span class="number">412</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> es with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">WARNING | <span class="number">2022</span><span class="number">-03</span><span class="number">-14</span> <span class="number">16</span>:<span class="number">55</span>:<span class="number">25</span>,<span class="number">412</span> | angr.storage.memory_mixins.default_filler_mixin | Filling <span class="keyword">register</span> gs with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0x0</span> (not part of a loaded object)</span><br><span class="line">b<span class="number">&#x27;</span>EADQYLAR<span class="number">&#x27;</span></span><br></pre></td></tr></table></figure>

<p>我们学到了获取angr内部系统函数：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angr<span class="selector-class">.SIM_PROCEDURES</span><span class="selector-attr">[ 系统库名 ]</span> <span class="selector-attr">[ 系统函数名 ]</span> () =&gt; 获取Angr 内部实现的系统函数</span><br></pre></td></tr></table></figure>

<h2 id="14-angr-shared-library"><a href="#14-angr-shared-library" class="headerlink" title="14_angr_shared_library"></a>14_angr_shared_library</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [esp+1Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( validate(s, <span class="number">8</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好像很简单，但我们发现validate函数在另一个so文件，该题考的是动态链接的符号执行，我们只要搞出validate的符号执行就ok</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/14_angr_shared_library/lib14_angr_shared_library.so&#x27;</span></span><br><span class="line">    base = <span class="number">0x40000000</span><span class="comment">#随意</span></span><br><span class="line">    project = angr.Project(path,load_options=&#123;<span class="string">&#x27;main_opts&#x27;</span> : &#123;<span class="string">&#x27;custom_base_addr&#x27;</span> : base&#125;&#125;)</span><br><span class="line">    buffer_pointer = claripy.BVV(<span class="number">0x30000000</span>,<span class="number">32</span>)<span class="comment">#创建buffer指针</span></span><br><span class="line">    validate_function_address = base + <span class="number">0x670</span> <span class="comment">#在该文件中的调用地址</span></span><br><span class="line">    initial_state = project.factory.call_state(validate_function_address,buffer_pointer,claripy.BVV(<span class="number">8</span>,<span class="number">32</span>))</span><br><span class="line">    <span class="comment">#  调用validate_function,因为函数声明validata_function(buffer_point,buffer_length) ,所以我们构造出调用validata_function(0x3000000,0x8) .</span></span><br><span class="line">    password = claripy.BVS(<span class="string">&#x27;password&#x27;</span>, <span class="number">64</span>)</span><br><span class="line">    </span><br><span class="line">    initial_state.memory.store(buffer_pointer,password) </span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    simulation.explore(find=base+<span class="number">0x71C</span>)<span class="comment">#  执行到validate 函数的RETN 指令</span></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution_state.add_constraints(solution_state.regs.eax !=<span class="number">0</span>)</span><br><span class="line">        solution = solution_state.se.<span class="built_in">eval</span>(password)</span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">605</span> | cle.backends | Deprecation warning: the custom_base_addr parameter has been renamed to base_addr</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">862</span> | angr.calling_conventions | Guessing call prototype. Please specify prototype.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">868</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">869</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">869</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">869</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">869</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">869</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebp with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x40000670 (validate+<span class="number">0</span>x0 in lib14_angr_shared_library.so (<span class="number">0</span>x670))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">36</span>,<span class="number">870</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register ebx with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x40000673 (validate+<span class="number">0</span>x3 in lib14_angr_shared_library.so (<span class="number">0</span>x673))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">37</span>,<span class="number">842</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x30000008 with <span class="number">121</span> unconstrained bytes referenced from <span class="number">0</span>x40186b80 (strcmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x86b80))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">37</span>,<span class="number">911</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7ffeffe8 with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x40186b80 (strcmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x86b80))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">37</span>,<span class="number">911</span> | angr.storage.memory_mixins.default_filler_mixin | Filling memory at <span class="number">0</span>x7fff0000 with <span class="number">77</span> unconstrained bytes referenced from <span class="number">0</span>x40186b80 (strcmp+<span class="number">0</span>x0 in libc.so.<span class="number">6</span> (<span class="number">0</span>x86b80))</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">14</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">38</span>,<span class="number">105</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">6076275416825026394</span></span><br></pre></td></tr></table></figure>

<p>学习到了：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">如何加载共享库</span><br><span class="line">base = <span class="number">0x40000000</span>#随意</span><br><span class="line">    project = angr.<span class="constructor">Project(<span class="params">path</span>,<span class="params">load_options</span>=&#123;&#x27;<span class="params">main_opts</span>&#x27; : &#123;&#x27;<span class="params">custom_base_addr</span>&#x27; : <span class="params">base</span>&#125;&#125;)</span></span><br><span class="line">    initial_state = project.factory.call<span class="constructor">_state(<span class="params">validate_function_address</span>,<span class="params">buffer_pointer</span>,<span class="params">claripy</span>.BVV(8,32)</span>)</span><br><span class="line">    #  构造指针给函数使用.</span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<h2 id="15-angr-arbitrary-read"><a href="#15-angr-arbitrary-read" class="headerlink" title="15_angr_arbitrary_read"></a>15_angr_arbitrary_read</h2><p>当if成立，s输出，以为会输出tryagain，但v4要写入20字节，就会有溢出，因为s到v4只有16字节</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> *s; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  s = try_again;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u %20s&quot;</span>, &amp;key, &amp;v4);</span><br><span class="line">  <span class="keyword">if</span> ( key == <span class="number">2358019</span> )</span><br><span class="line">    <span class="built_in">puts</span>(s);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(try_again);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/15_angr_arbitrary_read/15_angr_arbitrary_read&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):<span class="comment">#  实现Scanf Hook 函数</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,format_string, check_key_address,input_buffer_address</span>):</span><br><span class="line">            scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>,<span class="number">32</span>)<span class="comment">#check_key</span></span><br><span class="line">            scanf1 = claripy.BVS(<span class="string">&#x27;scanf1&#x27;</span>,<span class="number">160</span>)<span class="comment">#inputbuffer</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">                self.state.add_constraints(char &gt;= <span class="string">&#x27;0&#x27;</span>, char &lt;= <span class="string">&#x27;z&#x27;</span>)<span class="comment">#  对input_buffer 的输入约束</span></span><br><span class="line"></span><br><span class="line">            self.state.memory.store(check_key_address,scanf0 ,endness =project.arch.memory_endness)<span class="comment">#  保存求解变量到指定的内存中</span></span><br><span class="line"></span><br><span class="line">            self.state.memory.store(input_buffer_address,scanf1 ,endness =project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>] = scanf0<span class="comment">#  保存这两个变量到state 中,后续求解需要用到</span></span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>] = scanf1</span><br><span class="line"></span><br><span class="line">    scanf_symbol = <span class="string">&#x27;__isoc99_scanf&#x27;</span></span><br><span class="line">    project.hook_symbol(scanf_symbol,ReplacementScanf())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_puts</span>(<span class="params">state</span>):</span><br><span class="line">        puts_parameter = state.memory.load(state.regs.esp + <span class="number">4</span>,<span class="number">4</span>,endness=project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> state.se.symbolic(puts_parameter):</span><br><span class="line">            good_job_string_address = <span class="number">0x08048562</span><span class="comment">#利用try again的函数调用</span></span><br><span class="line">            copied_state = state.copy() <span class="comment">#  复制执行状态上下文进行约束求解,不影响原理的执行上下文</span></span><br><span class="line">            copied_state.add_constraints(puts_parameter == good_job_string_address)<span class="comment">#  puts 的参数地址是否可以被指定为 0x08048562 ,如果可以的话,那就证明这个值是可控的</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> copied_state.satisfiable():<span class="comment">#  判断添加了上面这个约束是否有解</span></span><br><span class="line">                state.add_constrains(puts_parameter == good_job_string_address) <span class="comment">#  如果有解的话就保存到我们执行的那个状态对象</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line">        puts_address = <span class="number">0x0804854F</span><span class="comment">#  当程序执行到puts() 函数时,我们就认为路径探索到了这里,然后再去通过check_puts() 判断这里是否存在漏洞,告诉Angr这是不是我们需要找的那条执行路径</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> state.addr == puts_address:</span><br><span class="line">            <span class="keyword">return</span> check_puts(state)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    simulation.explore(find=is_successful)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>])</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>],cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        <span class="built_in">print</span>(solution0,solution1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">state</span>.copy() =&gt; 复制状态上下文</span><br><span class="line"></span><br><span class="line"><span class="keyword">state</span>.satisfiable() =&gt; 判断当前的所有约束是否有解</span><br><span class="line"></span><br><span class="line">solution_state.se.eval(求解变量,cast_to=bytes) =&gt; 序列化变量内容为字符串</span><br></pre></td></tr></table></figure>

<h2 id="16-angr-arbitrary-write"><a href="#16-angr-arbitrary-write" class="headerlink" title="16_angr_arbitrary_write"></a>16_angr_arbitrary_write</h2><p>这个题很明显，password是不等于NEDVTNOP，所以我们可以用s溢出覆盖dest的值，使其指向password，这样就能修改其内容了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">16</span>]; <span class="comment">// [esp+Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> *dest; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  dest = unimportant_buffer;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="built_in">strncpy</span>(password_buffer, <span class="string">&quot;PASSWORD&quot;</span>, <span class="number">0xC</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%u %20s&quot;</span>, &amp;key, s);</span><br><span class="line">  <span class="keyword">if</span> ( key == <span class="number">6712341</span> )</span><br><span class="line">    <span class="built_in">strncpy</span>(dest, s, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">strncpy</span>(unimportant_buffer, s, <span class="number">0x10</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(password_buffer, <span class="string">&quot;NEDVTNOP&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/03/12/angr/image-20220315122941509.png"></p>
<p>我们输入20个字节是正好覆盖s的16个字节+的dest的字节的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;../solutions/16_angr_arbitrary_write/16_angr_arbitrary_write&#x27;</span></span><br><span class="line">    project = angr.Project(path)</span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self,format_string,check_key,input_buffer</span>):</span><br><span class="line">            scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">            scanf1 = claripy.BVS(<span class="string">&#x27;scanf1&#x27;</span>,<span class="number">160</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">                self.state.add_constraints(char &gt;= <span class="string">&#x27;a&#x27;</span>,char &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            self.state.memory.store(check_key,scanf0,endness=project.arch.memory_endness)</span><br><span class="line">            self.state.memory.store(input_buffer,scanf1,endness=project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>] = scanf0</span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>] = scanf1</span><br><span class="line">    </span><br><span class="line">    scanf_symbol = <span class="string">&#x27;__isoc99_scanf&#x27;</span></span><br><span class="line">    project.hook_symbol(scanf_symbol,ReplacementScanf())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_strnpy</span>(<span class="params">state</span>):</span><br><span class="line">        strncpy_dest = state.memory.load(state.regs.esp + <span class="number">4</span>,<span class="number">4</span>,endness=project.arch.memory_endness)</span><br><span class="line">        strncpy_src  = state.memory.load(state.regs.esp + <span class="number">8</span>, <span class="number">4</span>, endness=project.arch.memory_endness)</span><br><span class="line">        strncpy_len  = state.memory.load(state.regs.esp + <span class="number">12</span>, <span class="number">4</span>, endness=project.arch.memory_endness)</span><br><span class="line">        src_contents = state.memory.load(strncpy_src, strncpy_len)</span><br><span class="line">        <span class="comment">#  因为参数中只保存了地址,我们需要根据这个地址去获取内容</span></span><br><span class="line">        <span class="keyword">if</span> state.se.symbolic(strncpy_dest) <span class="keyword">and</span> state.se.symbolic(src_contents):</span><br><span class="line">            <span class="comment">#  判断dest 和src 的内容是不是符号化对象</span></span><br><span class="line">            <span class="keyword">if</span> state.satisfiable(extra_constraints=(src_contents[-<span class="number">1</span>:-<span class="number">64</span>] == <span class="string">&#x27;NEDVTNOP&#x27;</span>,strncpy_dest == <span class="number">0x4D43523C</span>)):</span><br><span class="line">                <span class="comment">#  尝试求解,其中strncpy_dest == 0x4D43523C 的意思是判断dest 是否可控为password 的地址;src_contents[ -1 : -64 ] == &#x27;KZYRKMKE&#x27; 是判断input_buffer 的内容是否可控为&#x27;KZYRKMKE&#x27; ,因为这块内存是倒序,所以需要通过[ -1 : -64 ] 倒转(contentes 的内容是比特,获取8 字节的大小为:8*8 = 64),然后判断该值是否为字符串&#x27;KZYRKMKE&#x27;</span></span><br><span class="line">                state.add_constraints(src_contents[ -<span class="number">1</span> : -<span class="number">64</span> ] == <span class="string">&#x27;NEDVTNOP&#x27;</span>,strncpy_dest == <span class="number">0x4D43523C</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">good_job</span>(<span class="params">state</span>):</span><br><span class="line">        strncpy_address = <span class="number">0x0804860D</span></span><br><span class="line">        <span class="keyword">if</span> state.addr == strncpy_address:</span><br><span class="line">            <span class="keyword">return</span> check_strnpy(state)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    simulation.explore(find=good_job)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        solution0 = solution_state.se.<span class="built_in">eval</span>(solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>])</span><br><span class="line">        solution1 = solution_state.se.<span class="built_in">eval</span>(solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>],cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        <span class="built_in">print</span>(solution0,solution1)</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>总结：state.satisfiable(extra_constraints&#x3D;(条件1,条件2)) &#x3D;&gt; 合并多个条件计算是否存在满足约束的解(注意两个或多个条件之间是And 合并判断,不是Or )</p>
<h2 id="17-angr-arbitrary-jump"><a href="#17-angr-arbitrary-jump" class="headerlink" title="17_angr_arbitrary_jump"></a>17_angr_arbitrary_jump</h2><p>最后一题，在read_print中检查返回地址是否是godjob</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  read_input();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    binary_path = <span class="string">&#x27;../solutions/17_angr_arbitrary_jump/17_angr_arbitrary_jump&#x27;</span></span><br><span class="line">    project = angr.Project(binary_path)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line">    simulation = project.factory.simgr(</span><br><span class="line">    initial_state,</span><br><span class="line">    save_unconstrained=<span class="literal">True</span>,</span><br><span class="line">    stashes=&#123;</span><br><span class="line">      <span class="string">&#x27;active&#x27;</span> : [initial_state],</span><br><span class="line">      <span class="string">&#x27;unconstrained&#x27;</span> : [],</span><br><span class="line">      <span class="string">&#x27;found&#x27;</span> : [],</span><br><span class="line">      <span class="string">&#x27;not_needed&#x27;</span> : []</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, fmt, string_addr</span>):</span><br><span class="line">            exploit = claripy.BVS(<span class="string">&#x27;exploit&#x27;</span>, <span class="number">8</span> * <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> exploit.chop(bits=<span class="number">8</span>):</span><br><span class="line">                self.state.add_constraints(char &gt;= <span class="string">&#x27;0&#x27;</span>, char &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            exploit_addr = string_addr</span><br><span class="line">            self.state.memory.store(exploit_addr, exploit)</span><br><span class="line">            </span><br><span class="line">            self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution&#x27;</span>] = exploit</span><br><span class="line">    </span><br><span class="line">    scanf_symbol = <span class="string">&#x27;__isoc99_scanf&#x27;</span></span><br><span class="line">    project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (simulation.active <span class="keyword">or</span> simulation.unconstrained) <span class="keyword">and</span> (<span class="keyword">not</span> simulation.found):  </span><br><span class="line">        <span class="keyword">for</span> unconstrained_state <span class="keyword">in</span> simulation.unconstrained:</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">should_move</span>(<span class="params">s</span>):</span><br><span class="line">                <span class="keyword">return</span> s <span class="keyword">is</span> unconstrained_state</span><br><span class="line">      </span><br><span class="line">            simulation.move(<span class="string">&#x27;unconstrained&#x27;</span>, <span class="string">&#x27;found&#x27;</span>, filter_func=should_move)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">        simulation.step() </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        solution_state.add_constraints(solution_state.regs.eip == <span class="number">0x4D435250</span>) </span><br><span class="line"></span><br><span class="line">        solution = solution_state.se.<span class="built_in">eval</span>(solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution&#x27;</span>],cast_to = <span class="built_in">bytes</span>) </span><br><span class="line">        <span class="built_in">print</span>(solution)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">088</span> | angr.project | Address is already hooked, during hook(<span class="number">0</span>x4d5513a0, &lt;SimProcedure ReplacementScanf&gt;). Re-hooking.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | The program is accessing memory or registers with an unspecified value. This could indicate unwanted behavior.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | angr will cope with this by generating an unconstrained symbolic variable and continuing. You can resolve this by:</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">1</span>) setting a value to the initial state</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">2</span>) adding the state option ZERO_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to make unknown regions hold null</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | <span class="number">3</span>) adding the state option SYMBOL_FILL_UNCONSTRAINED_&#123;MEMORY,REGISTERS&#125;, to suppress these messages.</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">226</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x4d4352e1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">17</span>_angr_arbitrary_jump (<span class="number">0</span>x4d4352e1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">229</span> | angr.storage.memory_mixins.default_filler_mixin | Filling register edi with <span class="number">4</span> unconstrained bytes referenced from <span class="number">0</span>x4d4352e1 (__libc_csu_init+<span class="number">0</span>x1 in <span class="number">17</span>_angr_arbitrary_jump (<span class="number">0</span>x4d4352e1))</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">340</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">340</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">341</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">342</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">343</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">344</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">345</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">346</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">347</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">348</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">349</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">350</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">351</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">352</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">353</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">354</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">354</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">354</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">354</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">393</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">394</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">394</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">394</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">394</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">394</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">395</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">396</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">397</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">398</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">399</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">400</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">401</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">402</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">403</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">404</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">405</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">406</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">407</span> | claripy.ast.bv | BVV value is being coerced from a unicode string, encoding as utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">38</span>,<span class="number">766</span> | angr.engines.successors | Exit state has over <span class="number">256</span> possible solutions. Likely unconstrained; skipping. &lt;BV32 Reverse(exploit_11_512[<span class="number">135</span>:<span class="number">104</span>])&gt;</span><br><span class="line"><span class="attribute">WARNING</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">39</span>,<span class="number">144</span> | angr.engines.successors | Exit state has over <span class="number">256</span> possible solutions. Likely unconstrained; skipping. &lt;BV32 Reverse(exploit_12_512[<span class="number">135</span>:<span class="number">104</span>])&gt;</span><br><span class="line"><span class="attribute">CRITICAL</span> | <span class="number">2022</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">13</span>:<span class="number">47</span>:<span class="number">39</span>,<span class="number">181</span> | angr.sim_state | The name state.se is deprecated; please use state.solver.</span><br><span class="line"><span class="attribute">b</span>&#x27;<span class="number">00000000000000000000000000000000000000000000000</span>PRCM00@<span class="number">0000000000</span>&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):<span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):<span class="keyword">import</span> angr</span><br><span class="line"><span class="comment">#导入文件</span></span><br><span class="line">path = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#打开二进制文件</span></span><br><span class="line">project = angr.Project(path)</span><br><span class="line"><span class="comment">#接下来两种选择</span></span><br><span class="line"><span class="comment">#第一种</span></span><br><span class="line">initial_state = project.factory.entry_state()<span class="comment">#直接创建空白的执行上下文环境</span></span><br><span class="line"><span class="comment">#第二种</span></span><br><span class="line">start_address = xxxx</span><br><span class="line">initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"><span class="comment">#创建模拟器,第二个参数是指定是否合并路径，路径多会爆炸</span></span><br><span class="line">simulation = project.factory.simgr(initial_state，veritesting = <span class="literal">True</span>)</span><br><span class="line"><span class="comment">#good和try有两种方法，第一个是找到call puts的地址不再说了</span></span><br><span class="line"><span class="comment">#第二种是进行函数定义</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_successful</span>(<span class="params">state</span>):</span><br><span class="line"><span class="comment">#从输出中提取</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Good Job&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output) <span class="comment"># :boolean</span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">should_abort</span>(<span class="params">state</span>): </span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Try again&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(stdout_output)  <span class="comment"># :boolean</span></span><br><span class="line"><span class="comment">#执行搜索路径(里面是要到达的地址)</span></span><br><span class="line">simulation.explore(find=print_good_address，avoid=print_try_avoid)</span><br><span class="line"><span class="comment">#打印出结果,搜索结果的集合，simulation.found是python的list集合</span></span><br><span class="line"><span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    <span class="comment">#获取标准输入</span></span><br><span class="line">    <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">    </span><br><span class="line"><span class="comment">#寄存器类，比如输入了好几个参数，我们能从寄存器下手找到输入源</span></span><br><span class="line"><span class="comment">#创建求解变量</span></span><br><span class="line">password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, password0_size_in_bits)</span><br><span class="line"><span class="comment">#告诉符号执行，执行的寄存器是什么</span></span><br><span class="line">initial_state.regs.eax = password0 </span><br><span class="line"><span class="comment">#在if中进行求解符号变量</span></span><br><span class="line">solution0 = solution_state.se.<span class="built_in">eval</span>(password0)</span><br><span class="line"><span class="comment">#栈类，如果结果保存在栈中</span></span><br><span class="line"><span class="comment">#将创建的变量从stack中取出来</span></span><br><span class="line">initial_state.stack_push(password0)</span><br><span class="line"><span class="comment">#变量存在bss段，符号化内存</span></span><br><span class="line"><span class="comment">#第一个参数是变量的地址</span></span><br><span class="line">initial_state.memory.store(password0_address, password0)</span><br><span class="line"><span class="comment">#数字字节顺序，可以表示为：project.arch.memory_endness</span></span><br><span class="line">initial_state.memory.store(地址,数据,endness = 数据字节顺序) =&gt; 设置初始化内存数据</span><br><span class="line"><span class="comment">#有关文件就是第七题</span></span><br><span class="line"><span class="comment">#多分支比较，建立比较机制</span></span><br><span class="line"><span class="comment">#先在if里进行约束</span></span><br><span class="line">constrained_parameter_address = <span class="number">0x804A050</span>  <span class="comment">#  计算约束的内存位置</span></span><br><span class="line">constrained_parameter_size_bytes = <span class="number">0x10</span>    <span class="comment">#  计算约束的内存大小</span></span><br><span class="line">constrained_parameter_bitvector = solution_state.memory.load(  <span class="comment">#  加载内存</span></span><br><span class="line">      constrained_parameter_address,</span><br><span class="line">      constrained_parameter_size_bytes</span><br><span class="line">    )</span><br><span class="line"><span class="comment">#再用下述的进行字符串比较</span></span><br><span class="line">solution_state.memory.load(内存地址,内存大小) =&gt; 加载内存</span><br><span class="line">solution_state.add_constraints(约束条件) =&gt; 添加约束条件</span><br><span class="line"><span class="comment">#hook的写法</span></span><br><span class="line"><span class="comment">#连个参数分别是，hook的地址，执行后往后跳过几个字节</span></span><br><span class="line"><span class="meta">@project.hook(<span class="params">check_equals_called_address, length=instruction_to_skip_length</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">skip_check_equals_</span>(<span class="params">state</span>):</span><br><span class="line">    加载内存</span><br><span class="line">    claripy.If(条件,条件为<span class="literal">True</span>时的返回值,条件为<span class="literal">False</span>时的返回值) =&gt; 创建条件判断</span><br><span class="line">    claripy.BVV(值,值大小) =&gt; 创建一个数值</span><br><span class="line"><span class="comment">#另一种常见hook方法，常见于想hook的函数太多，无法定位情况</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReplacementCheckEquals</span>(angr.SimProcedure):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, Hook的函数参数列表</span>):</span><br><span class="line">        加载内存</span><br><span class="line">        <span class="keyword">return</span> 用claripy.If对比来返回值<span class="comment"># 如果是void函数可以省略</span></span><br><span class="line"><span class="comment">#hook的函数名是真实函数名，第二个参数是ReplacementCheckEquals（）</span></span><br><span class="line">project.hook_symbol(要Hook的函数名,SimProcedure类实例)</span><br><span class="line"><span class="comment">#scanf太多，hookscanf</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReplacementScanf</span>(angr.SimProcedure):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, format_string, scanf0_address, scanf1_address </span>)：</span><br><span class="line">    <span class="comment">#创建求解变量</span></span><br><span class="line">        scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>, <span class="number">4</span> * <span class="number">8</span>)</span><br><span class="line">    <span class="comment">#初始化内存</span></span><br><span class="line">        self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">    <span class="comment">#保存当前状态</span></span><br><span class="line">        self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>] = scanf0</span><br><span class="line">project.hook_symbol(要Hook的函数名,SimProcedure类实例)</span><br><span class="line"><span class="comment">#用angr自带hook程序</span></span><br><span class="line"><span class="comment">#用在simgr后</span></span><br><span class="line">project.hook(<span class="number">0x804ed40</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;printf&#x27;</span>]())</span><br><span class="line">angr.SIM_PROCEDURES[ 系统库名 ] [ 系统函数名 ] () =&gt; 获取Angr 内部实现的系统函数</span><br><span class="line"><span class="comment">#遇到函数是动态链接的</span></span><br><span class="line"><span class="comment">#现设基地址</span></span><br><span class="line">base = <span class="number">0x40000000</span>（随便）</span><br><span class="line"><span class="comment">#我们的path是指那个so文件</span></span><br><span class="line">project = angr.Project(path_to_binary, load_options=&#123;</span><br><span class="line">    <span class="string">&#x27;main_opts&#x27;</span> : &#123;</span><br><span class="line">      <span class="string">&#x27;custom_base_addr&#x27;</span> : base</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">initial_state = project.factory.call_state(validate_function_address, buffer_pointer,claripy.BVV(<span class="number">8</span>, <span class="number">32</span>))  <span class="comment">#  调用validate_function,因为函数声明validata_function(buffer_point,buffer_length) ,所以我们构造出调用validata_function(0x3000000,0x8) </span></span><br><span class="line"><span class="comment">#对于溢出而覆盖的题</span></span><br><span class="line"><span class="comment">#下面是约束的写法</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">        self.state.add_constraints(char &gt;= <span class="string">&#x27;0&#x27;</span>, char &lt;= <span class="string">&#x27;z&#x27;</span>)  <span class="comment">#  对input_buffer 的输入约束</span></span><br><span class="line"><span class="comment">#约束完，存入内存，获取想要的puts</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_puts</span>(<span class="params">state</span>):</span><br><span class="line">    puts_parameter = state.memory.load(state.regs.esp + <span class="number">4</span>, <span class="number">4</span>, endness=project.arch.memory_endness)  </span><br><span class="line"><span class="comment">#检查这个参数是否为符号化对象</span></span><br><span class="line"><span class="keyword">if</span> state.se.symbolic(puts_parameter):</span><br><span class="line"><span class="comment">#复制执行状态上下文进行约束求解,不影响原理的执行上下文</span></span><br><span class="line">    copied_state = state.copy()</span><br><span class="line">    <span class="keyword">if</span> copied_state.satisfiable():  <span class="comment">#  判断添加了上面这个约束是否有解</span></span><br><span class="line">        state.add_constraints(puts_parameter == good_job_string_address)  <span class="comment">#  如果有解的话就保存到我们执行的那个状态对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="comment">#序列化变量内容为字符串</span></span><br><span class="line">solution_state.se.<span class="built_in">eval</span>(求解变量,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"><span class="comment">#合并多个条件计算是否存在满足约束的解(注意两个或多个条件之间是And 合并判断,不是Or )</span></span><br><span class="line">state.satisfiable(extra_constraints=(条件<span class="number">1</span>,条件<span class="number">2</span>))</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/02/28/LC-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/28/LC-3/" class="post-title-link" itemprop="url">LC-3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-28 18:11:03" itemprop="dateCreated datePublished" datetime="2022-02-28T18:11:03+08:00">2022-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-18 00:44:08" itemprop="dateModified" datetime="2022-07-18T00:44:08+08:00">2022-07-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="动手写个虚拟机"><a href="#动手写个虚拟机" class="headerlink" title="动手写个虚拟机"></a>动手写个虚拟机</h1><p>​    写这个东西首先要知道大概的分区，刚开始是头文件，然后是定义的一些东西（包括函数），然后是主函数，在主函数中我们需要用switch来对一些东西进行操作，我们不可能直接写什么vm虚拟机那种东西，所以先从LC-3这个虚拟机开始。不过<a target="_blank" rel="noopener" href="https://justinmeiners.github.io/lc3-vm/%E6%96%87%E7%AB%A0%E6%98%AF%E6%9C%89%E4%BA%9B%E4%B9%B1%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E5%86%8D%E5%B0%86%E6%96%87%E7%AB%A0%E6%95%B4%E7%90%86%E4%B8%80%E9%81%8D">https://justinmeiners.github.io/lc3-vm/文章是有些乱的，所以我再将文章整理一遍</a>.</p>
<p>   虚拟机：虚拟机就是像一台电脑那样运行的程序。它主要模拟了CPU以及其他一小部分硬件，让被模拟的CPU就做算术运算，读写内存，与I&#x2F;O设备交互，就像一台真正的电脑一样。我们所写的虚拟机是LC-3，能够模仿一些简单的操作，在c语言编成的虚拟机的基础上运行一些程序。</p>
<h2 id="1、读取文件"><a href="#1、读取文件" class="headerlink" title="1、读取文件"></a>1、读取文件</h2><p>我们要在一台机器上加载文件，从而运行，那就必须开辟空间</p>
<h4 id="代码1-1"><a href="#代码1-1" class="headerlink" title="代码1-1"></a>代码1-1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> UINT16_MAX 65536</span></span><br><span class="line"><span class="type">uint16_t</span> memory[UINT16_MAX];<span class="comment">//创建2的16次方内存即128kb</span></span><br></pre></td></tr></table></figure>

<h4 id="代码1-2"><a href="#代码1-2" class="headerlink" title="代码1-2"></a>代码1-2</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (argc &lt; <span class="number">2</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;lc3 [image-file1]...\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; argc; ++j)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!read_image(argv[j]))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;failed to load image: %s\n&quot;</span>,argv[j]);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;<span class="comment">/*&#123;Load Arguments,5&#125;*/</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>}</p>
<p>这个主函数中最前面一段是牵扯到了内存，argc 和 argv 是 main 函数参数，第一个代表main参数个数，第二个代表为地址的参数；</p>
<p>该if函数是加载VM映像来使这台VM能够运行。如果命令行参数没有给出镜像路径的话就打印一条错误信息。</p>
<p>也就是运行程序的时候的路径要对：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\<span class="number">16</span>VM.exe C:<span class="regexp">/Users/</span><span class="number">86159</span><span class="regexp">/Downloads/</span><span class="number">2048</span>.obj</span><br></pre></td></tr></table></figure>

<p>用 read_image() 函数计算参数并判断，若返回值是0，就会说：装载映像失败；那么这个函数是什么呢：</p>
<h4 id="代码1-3"><a href="#代码1-3" class="headerlink" title="代码1-3"></a>代码1-3</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> <span class="title function_">swap16</span><span class="params">(<span class="type">uint16_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &lt;&lt; <span class="number">8</span>) | (x &gt;&gt; <span class="number">8</span>);<span class="comment">/*改成小端序，交换前8位和后8位*/</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="type">void</span> <span class="title function_">read_image_file</span><span class="params">(FILE* file)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint16_t</span> origin;</span><br><span class="line">  fread(&amp;origin,<span class="keyword">sizeof</span>(origin), <span class="number">1</span>, file);</span><br><span class="line">  origin = swap16(origin);</span><br><span class="line">  <span class="type">uint16_t</span> max_read = UINT16_MAX - origin;</span><br><span class="line">  <span class="type">uint16_t</span>* p = memory + origin;</span><br><span class="line">  <span class="type">size_t</span> read = fread(p,<span class="keyword">sizeof</span>(<span class="type">uint16_t</span>), max_read,file);</span><br><span class="line">  <span class="keyword">while</span>(read-- &gt; <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    *p = swap16(*p);</span><br><span class="line">    ++p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">read_image</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* image_path)</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE* file = fopen(image_path, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(!file)&#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;;</span><br><span class="line">  read_image_file(file);</span><br><span class="line">  fclose(file);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后者代码就是来判断是否读取到正确路径，没有就返回0，然后进入前者代码。</p>
<p>read_image_file() 函数的作用是将要在该虚拟机上运行的程序内存装入之前设定好的memory数组中；首先fread读取起始地址：origin，然后使用swap16函数进行大小端序的转换，在LC-3上采用大端序！！之后计算最大可容纳地址，并用p指针标记，最后使用循环不断缩小范围；</p>
<h2 id="2、寄存器"><a href="#2、寄存器" class="headerlink" title="2、寄存器"></a>2、寄存器</h2><p>我们需要模拟cpu中的寄存器，我们用枚举的方法来创建寄存器：</p>
<h3 id="代码2-1"><a href="#代码2-1" class="headerlink" title="代码2-1"></a>代码2-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  R_R0 = <span class="number">0</span>,</span><br><span class="line">  R_R1,</span><br><span class="line">  R_R2,</span><br><span class="line">  R_R3,</span><br><span class="line">  R_R4,</span><br><span class="line">  R_R5,</span><br><span class="line">  R_R6,</span><br><span class="line">  R_R7,</span><br><span class="line">  R_PC, <span class="comment">/*程序计数器，相当于rip*/</span></span><br><span class="line">  R_COND,</span><br><span class="line">  R_COUNT<span class="comment">/*寄存器数量*/</span></span><br><span class="line">&#125;;<span class="comment">/*前10个为寄存器，前八个为通用寄存器，cond为条件标志寄存器*/</span></span><br></pre></td></tr></table></figure>

<p>然后将其存放在数组里：</p>
<h3 id="代码2-2"><a href="#代码2-2" class="headerlink" title="代码2-2"></a>代码2-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> reg[R_COUNT];</span><br></pre></td></tr></table></figure>

<p>接下来还有flag的表示方法：</p>
<h3 id="代码2-3"><a href="#代码2-3" class="headerlink" title="代码2-3"></a>代码2-3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FL_POS = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,<span class="comment">/*P*/</span></span><br><span class="line">  FL_ZRO = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,<span class="comment">/*Z*/</span></span><br><span class="line">  FL_NEG = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,<span class="comment">/*N*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>移位的值就是他们的意义！</p>
<h2 id="3、指令集"><a href="#3、指令集" class="headerlink" title="3、指令集"></a>3、指令集</h2><p>指令集是对cpu中的寄存器发出命令的东西</p>
<h3 id="代码3-1"><a href="#代码3-1" class="headerlink" title="代码3-1"></a>代码3-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  OP_BR = <span class="number">0</span>,<span class="comment">/*分支*/</span></span><br><span class="line">  OP_ADD,<span class="comment">/*添加*/</span></span><br><span class="line">  OP_LD,<span class="comment">/*加载*/</span></span><br><span class="line">  OP_ST,<span class="comment">/*存储*/</span></span><br><span class="line">  OP_JSR,<span class="comment">/*跳转寄存器*/</span></span><br><span class="line">  OP_AND,<span class="comment">/*按位和*/</span></span><br><span class="line">  OP_LDR,<span class="comment">/*加载寄存器*/</span></span><br><span class="line">  OP_STR,<span class="comment">/*存储寄存器*/</span></span><br><span class="line">  OP_RTI,<span class="comment">/*未使用*/</span></span><br><span class="line">  OP_NOT,<span class="comment">/*按位非*/</span></span><br><span class="line">  OP_LDI,<span class="comment">/*加载间接*/</span></span><br><span class="line">  OP_STI,<span class="comment">/*存储间接*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  OP_JMP,<span class="comment">/*跳转*/</span></span><br><span class="line">  OP_RES,<span class="comment">/*保留（未使用）*/</span></span><br><span class="line">  OP_LEA,<span class="comment">/*加载有效地址*/</span></span><br><span class="line">  OP_TRAP<span class="comment">/*执行陷阱*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们简单模拟了几个操作，要注意的是LC-3只有16种操作码。CPU所能做的只是执行一系列指令而已。每条指令都是16位长，高4位用来存放操作码，剩下的12位存放参数。所以在我们眼中只有前4位是有用的！</p>
<h3 id="代码3-2"><a href="#代码3-2" class="headerlink" title="代码3-2"></a>代码3-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> <span class="title function_">sign_extend</span><span class="params">(<span class="type">uint16_t</span> x, <span class="type">int</span> bit_count)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span>((x &gt;&gt; (bit_count - <span class="number">1</span>)) &amp; <span class="number">1</span>)<span class="comment">//判断输入数少了右边bit-1位后是否等于0</span></span><br><span class="line">  &#123;</span><br><span class="line">    x |= (<span class="number">0xffff</span> &lt;&lt; bit_count);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">update_flags</span><span class="params">(<span class="type">uint16_t</span> r)</span><span class="comment">/*更新标志位*/</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (reg[r] == <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    reg[R_COND] = FL_ZRO;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (reg[r] &gt;&gt; <span class="number">15</span>)<span class="comment">/*最左侧1为负数*/</span></span><br><span class="line">  &#123;</span><br><span class="line">    reg[R_COND] = FL_NEG;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    reg[R_COND] = FL_POS;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个是符号拓展,符号拓展将正数前面补上0，负数前面补上1，这样得到的16位数字依然和我们最初赋的值相等。这样能使数全是16位，且值不变，很巧妙。下面的函数是对寄存器进行flags的赋值，即更新标志位</p>
<h2 id="4、内存访问"><a href="#4、内存访问" class="headerlink" title="4、内存访问"></a>4、内存访问</h2><h3 id="代码4-1"><a href="#代码4-1" class="headerlink" title="代码4-1"></a>代码4-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  MR_KBSR = <span class="number">0XFE00</span>,<span class="comment">/*键盘状态*/</span></span><br><span class="line">  MR_KBDR = <span class="number">0XFE02</span><span class="comment">/*键盘数据*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>上面是模拟LC-3 的两个内存寄存器；第一个为状态管理，第二个是数据管理；</p>
<h3 id="代码4-2"><a href="#代码4-2" class="headerlink" title="代码4-2"></a>代码4-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint16_t</span> <span class="title function_">check_key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> WaitForSingleObject(hStdin, <span class="number">1000</span>) == WAIT_OBJECT_0 &amp;&amp; _kbhit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mem_write</span><span class="params">(<span class="type">uint16_t</span> address, <span class="type">uint16_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">    memory[address] = val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">mem_read</span><span class="params">(<span class="type">uint16_t</span> address)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (address == MR_KBSR)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (check_key())</span><br><span class="line">        &#123;</span><br><span class="line">            memory[MR_KBSR] = (<span class="number">1</span> &lt;&lt; <span class="number">15</span>);</span><br><span class="line">            memory[MR_KBDR] = getchar();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            memory[MR_KBSR] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> memory[address];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有三个函数，这个属于调用了windows的api，第一个是设置windows终端输入的代码，第二个是写入内存的代码，第三个是读入内存的代码。</p>
<h2 id="5、c语言模拟指令"><a href="#5、c语言模拟指令" class="headerlink" title="5、c语言模拟指令"></a>5、c语言模拟指令</h2><p>ADD指令</p>
<h3 id="代码5-1"><a href="#代码5-1" class="headerlink" title="代码5-1"></a>代码5-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;<span class="comment">/*目标寄存器*/</span></span><br><span class="line">        <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;<span class="comment">/*第一个操作数SR1*/</span></span><br><span class="line">        <span class="type">uint16_t</span> imm_flag = (instr &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1</span>;<span class="comment">/*是否是立即模式*/</span></span><br><span class="line">        <span class="keyword">if</span>(imm_flag)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">uint16_t</span> imm5 =sign_extend(instr &amp; <span class="number">0x1f</span>,<span class="number">5</span>);</span><br><span class="line">          reg[r0] = reg[r1] + imm5;          <span class="comment">//立即模式</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">uint16_t</span> r2 = instr &amp; <span class="number">0x7</span>;</span><br><span class="line">          reg[r0] = reg[r1] + reg[r2];     <span class="comment">//寄存器模式</span></span><br><span class="line">        &#125;</span><br><span class="line">        update_flags(r0);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2022/02/28/LC-3/image-20220228205847150.png"></p>
<p>这是两种形式，其实从csapp里看是有三种形式的，这时两行开始出现不同，第一行第5位为0，而第二行为1。这个位表示<code>ADD</code>指令是立即模式还是寄存器模式，这就是判断是否用立即模式的标准！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD R2, R0, R1  ; R2 = R0 + R1   //寄存器模式</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD R0, R0, 1 ; R0 = R0 + 1   //立即模式</span><br></pre></td></tr></table></figure>

<p>AND指令：</p>
<h3 id="代码5-2"><a href="#代码5-2" class="headerlink" title="代码5-2"></a>代码5-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> imm_flag = (instr &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imm_flag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint16_t</span> imm5 = sign_extend(instr &amp; <span class="number">0x1F</span>, <span class="number">5</span>);</span><br><span class="line">        reg[r0] = reg[r1] &amp; imm5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint16_t</span> r2 = instr &amp; <span class="number">0x7</span>;</span><br><span class="line">        reg[r0] = reg[r1] &amp; reg[r2];</span><br><span class="line">    &#125;</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按位和也是分两种模式，立即和寄存器。</p>
<p>NOT指令：</p>
<h3 id="代码5-3"><a href="#代码5-3" class="headerlink" title="代码5-3"></a>代码5-3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line"></span><br><span class="line">    reg[r0] = ~reg[r1];</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>按位非不存在有立即数这一种说法。</p>
<p>BR指令：</p>
<h3 id="代码5-4"><a href="#代码5-4" class="headerlink" title="代码5-4"></a>代码5-4</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="type">uint16_t</span> cond_flag = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="keyword">if</span> (cond_flag &amp; reg[R_COND])</span><br><span class="line">    &#123;</span><br><span class="line">        reg[R_PC] += pc_offset;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JMP指令：</p>
<h3 id="代码5-5"><a href="#代码5-5" class="headerlink" title="代码5-5"></a>代码5-5</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Also handles RET */</span></span><br><span class="line">    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    reg[R_PC] = reg[r1];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JSR指令：</p>
<h3 id="代码5-6"><a href="#代码5-6" class="headerlink" title="代码5-6"></a>代码5-6</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> long_flag = (instr &gt;&gt; <span class="number">11</span>) &amp; <span class="number">1</span>;</span><br><span class="line">    reg[R_R7] = reg[R_PC];</span><br><span class="line">    <span class="keyword">if</span> (long_flag)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint16_t</span> long_pc_offset = sign_extend(instr &amp; <span class="number">0x7FF</span>, <span class="number">11</span>);</span><br><span class="line">        reg[R_PC] += long_pc_offset;  <span class="comment">/* JSR */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">        reg[R_PC] = reg[r1]; <span class="comment">/* JSRR */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是寄存器跳转指令</p>
<p>LD指令：</p>
<h3 id="代码5-7"><a href="#代码5-7" class="headerlink" title="代码5-7"></a>代码5-7</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">    reg[r0] = mem_read(reg[R_PC] + pc_offset);</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加载是在内存中进行，所以要算地址。</p>
<p>LDI指令：</p>
<h3 id="代码5-8"><a href="#代码5-8" class="headerlink" title="代码5-8"></a>代码5-8</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">        <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp;<span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">        reg[r0] = mem_read(mem_read(reg[R_PC] + pc_offset));</span><br><span class="line">        update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LDR指令：</p>
<h3 id="代码5-9"><a href="#代码5-9" class="headerlink" title="代码5-9"></a>代码5-9</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* destination register (DR) */</span></span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="comment">/* PCoffset 9*/</span></span><br><span class="line">    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">    <span class="comment">/* add pc_offset to the current PC, look at that memory location to get the final address */</span></span><br><span class="line">    reg[r0] = mem_read(mem_read(reg[R_PC] + pc_offset));</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LEA指令：</p>
<h3 id="代码5-10"><a href="#代码5-10" class="headerlink" title="代码5-10"></a>代码5-10</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">          <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">          <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">          reg[r0] = reg[R_PC] + pc_offset;</span><br><span class="line">          update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ST指令：</p>
<h3 id="代码5-11"><a href="#代码5-11" class="headerlink" title="代码5-11"></a>代码5-11</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">    mem_write(reg[R_PC] + pc_offset, reg[r0]);</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加载寄存器</p>
<p>STI指令：</p>
<h3 id="代码5-12"><a href="#代码5-12" class="headerlink" title="代码5-12"></a>代码5-12</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">    mem_write(mem_read(reg[R_PC] + pc_offset),reg[r0]);</span><br><span class="line">    update_flags(r0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加载地址</p>
<p>STR指令：</p>
<h3 id="代码5-13"><a href="#代码5-13" class="headerlink" title="代码5-13"></a>代码5-13</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">    <span class="type">uint16_t</span> offset = sign_extend(instr &amp; <span class="number">0x3F</span>, <span class="number">6</span>);</span><br><span class="line">    mem_write(reg[r1] + offset, reg[r0]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6、I-x2F-O交互"><a href="#6、I-x2F-O交互" class="headerlink" title="6、I&#x2F;O交互"></a>6、I&#x2F;O交互</h2><p>LC-3提供了少量的预定义好的过程来完成一般的任务以及与I&#x2F;O设备交互。比如有的过程可以读取键盘输入，有的可以在控制台上显示字符串。这些过程叫<em>Trap过程</em>，你可以理解为LC-3的操作系统或者API。每个Trap过程都有一个自己的编码（跟操作码类似）。为了执行Trap过程，需要用到<code>TRAP</code>指令，参数为需要的TRAP号。</p>
<h3 id="代码6-1"><a href="#代码6-1" class="headerlink" title="代码6-1"></a>代码6-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    TRAP_GETC = <span class="number">0x20</span>,  <span class="comment">/* get character from keyboard, not echoed onto the terminal */</span></span><br><span class="line">    TRAP_OUT = <span class="number">0x21</span>,   <span class="comment">/* output a character */</span></span><br><span class="line">    TRAP_PUTS = <span class="number">0x22</span>,  <span class="comment">/* output a word string */</span></span><br><span class="line">    TRAP_IN = <span class="number">0x23</span>,    <span class="comment">/* get character from keyboard, echoed onto the terminal */</span></span><br><span class="line">    TRAP_PUTSP = <span class="number">0x24</span>, <span class="comment">/* output a byte string */</span></span><br><span class="line">    TRAP_HALT = <span class="number">0x25</span>   <span class="comment">/* halt the program */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="代码6-2"><a href="#代码6-2" class="headerlink" title="代码6-2"></a>代码6-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> OP_TRAP:</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">switch</span>(instr &amp; <span class="number">0xff</span>)</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">case</span> TRAP_GETC:</span><br><span class="line">            &#123;</span><br><span class="line">              reg[R_R0] = (<span class="type">uint16_t</span>)getchar(); <span class="comment">//输入字符</span></span><br><span class="line">              update_flags(R_R0);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRAP_OUT:</span><br><span class="line">            &#123;</span><br><span class="line">              putc((<span class="type">char</span>)reg[R_R0],<span class="built_in">stdout</span>); <span class="comment">//输出字符</span></span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRAP_PUTS:</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="type">uint16_t</span>* c = memory + reg[R_R0];</span><br><span class="line">              <span class="keyword">while</span>(*c)</span><br><span class="line">              &#123;</span><br><span class="line">                putc((<span class="type">char</span>)*c,<span class="built_in">stdout</span>);</span><br><span class="line">                ++c;</span><br><span class="line">              &#125;</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRAP_IN:</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">&quot;Enter a character: &quot;</span>); <span class="comment">//准备输入字符</span></span><br><span class="line">              <span class="type">char</span> c = getchar();</span><br><span class="line">              putc(c,<span class="built_in">stdout</span>);</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              reg[R_R0] = (<span class="type">uint16_t</span>)c;</span><br><span class="line">              update_flags(R_R0);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRAP_PUTSP:   <span class="comment">//输出字符串</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="type">uint16_t</span>* c = memory + reg[R_R0];</span><br><span class="line">              <span class="keyword">while</span>(*c)</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="type">char</span> char1 = (*c) &amp; <span class="number">0xff</span>;</span><br><span class="line">                putc(char1, <span class="built_in">stdout</span>);</span><br><span class="line">                <span class="type">char</span> char2 = (*c) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                <span class="keyword">if</span> (char2) putc(char2,<span class="built_in">stdout</span>);</span><br><span class="line">                ++c;</span><br><span class="line">              &#125;</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> TRAP_HALT:   <span class="comment">//终止程序</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">puts</span>(<span class="string">&quot;HALT&quot;</span>);</span><br><span class="line">              fflush(<span class="built_in">stdout</span>);</span><br><span class="line">              running = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>上面是在trap中嵌套了switch</p>
<h2 id="7、补全代码"><a href="#7、补全代码" class="headerlink" title="7、补全代码"></a>7、补全代码</h2><h3 id="代码7-1"><a href="#代码7-1" class="headerlink" title="代码7-1"></a>代码7-1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span> <span class="comment">// uint16_t</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>  <span class="comment">// FILE</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span> <span class="comment">// SIGINT</span></span></span><br><span class="line"><span class="comment">/* windows only */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;conio.h&gt;</span>  <span class="comment">// _kbhit</span></span></span><br><span class="line"></span><br><span class="line">HANDLE hStdin = INVALID_HANDLE_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UINT16_MAX 65536</span></span><br></pre></td></tr></table></figure>

<p>加入api：</p>
<h3 id="代码7-2"><a href="#代码7-2" class="headerlink" title="代码7-2"></a>代码7-2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">DWORD fdwMode, fdwOldMode;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_input_buffering</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    hStdin = GetStdHandle(STD_INPUT_HANDLE);</span><br><span class="line">    GetConsoleMode(hStdin, &amp;fdwOldMode); <span class="comment">/* save old mode */</span></span><br><span class="line">    fdwMode = fdwOldMode</span><br><span class="line">            ^ ENABLE_ECHO_INPUT  <span class="comment">/* no input echo */</span></span><br><span class="line">            ^ ENABLE_LINE_INPUT; <span class="comment">/* return when one or</span></span><br><span class="line"><span class="comment">                                    more characters are available */</span></span><br><span class="line">    SetConsoleMode(hStdin, fdwMode); <span class="comment">/* set new mode */</span></span><br><span class="line">    FlushConsoleInputBuffer(hStdin); <span class="comment">/* clear buffer */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">restore_input_buffering</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    SetConsoleMode(hStdin, fdwOldMode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">handle_interrupt</span><span class="params">(<span class="type">int</span> signal)</span></span><br><span class="line">&#123;</span><br><span class="line">    restore_input_buffering();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化</p>
<h3 id="代码7-3"><a href="#代码7-3" class="headerlink" title="代码7-3"></a>代码7-3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">signal(SIGINT, handle_interrupt);</span><br><span class="line">disable_input_buffering();</span><br></pre></td></tr></table></figure>

<p>释放</p>
<h3 id="代码7-4"><a href="#代码7-4" class="headerlink" title="代码7-4"></a>代码7-4</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restore_input_buffering();</span><br></pre></td></tr></table></figure>



<p>我直接给出脚本：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;conio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">HANDLE hStdin = INVALID_HANDLE_VALUE;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UINT16_MAX 65536</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> memory[UINT16_MAX];<span class="comment">//创建2的16次方内存即128kb</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    R_R0 = <span class="number">0</span>,</span><br><span class="line">    R_R1,</span><br><span class="line">    R_R2,</span><br><span class="line">    R_R3,</span><br><span class="line">    R_R4,</span><br><span class="line">    R_R5,</span><br><span class="line">    R_R6,</span><br><span class="line">    R_R7,</span><br><span class="line">    R_PC, <span class="comment">/*程序计数器，相当于rip*/</span></span><br><span class="line">    R_COND,</span><br><span class="line">    R_COUNT<span class="comment">/*寄存器数量*/</span></span><br><span class="line">&#125;;<span class="comment">/*前10个为寄存器，前八个为通用寄存器，cond为条件标志寄存器*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> reg[R_COUNT];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    OP_BR = <span class="number">0</span>,<span class="comment">/*分支*/</span></span><br><span class="line">    OP_ADD,<span class="comment">/*添加*/</span></span><br><span class="line">    OP_LD,<span class="comment">/*加载*/</span></span><br><span class="line">    OP_ST,<span class="comment">/*存储*/</span></span><br><span class="line">    OP_JSR,<span class="comment">/*跳转寄存器*/</span></span><br><span class="line">    OP_AND,<span class="comment">/*按位和*/</span></span><br><span class="line">    OP_LDR,<span class="comment">/*加载寄存器*/</span></span><br><span class="line">    OP_STR,<span class="comment">/*存储寄存器*/</span></span><br><span class="line">    OP_RTI,<span class="comment">/*未使用*/</span></span><br><span class="line">    OP_NOT,<span class="comment">/*按位非*/</span></span><br><span class="line">    OP_LDI,<span class="comment">/*加载间接*/</span></span><br><span class="line">    OP_STI,<span class="comment">/*存储间接*/</span></span><br><span class="line"></span><br><span class="line">    OP_JMP,<span class="comment">/*跳转*/</span></span><br><span class="line">    OP_RES,<span class="comment">/*保留（未使用）*/</span></span><br><span class="line">    OP_LEA,<span class="comment">/*加载有效地址*/</span></span><br><span class="line">    OP_TRAP<span class="comment">/*执行陷阱*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    FL_POS = <span class="number">1</span> &lt;&lt; <span class="number">0</span>,<span class="comment">/*P*/</span></span><br><span class="line">    FL_ZRO = <span class="number">1</span> &lt;&lt; <span class="number">1</span>,<span class="comment">/*Z*/</span></span><br><span class="line">    FL_NEG = <span class="number">1</span> &lt;&lt; <span class="number">2</span>,<span class="comment">/*N*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    TRAP_GETC = <span class="number">0X20</span>,<span class="comment">/*从键盘获取字符，不回显到终端*/</span></span><br><span class="line">    TRAP_OUT = <span class="number">0X21</span>,<span class="comment">/*输出一个字符*/</span></span><br><span class="line">    TRAP_PUTS = <span class="number">0X22</span>,<span class="comment">/*输出一个单词字符串*/</span></span><br><span class="line">    TRAP_IN = <span class="number">0X23</span>,<span class="comment">/*获取来自键盘的字符，回显到终端*/</span></span><br><span class="line">    TRAP_PUTSP = <span class="number">0X24</span>,<span class="comment">/*输出一个字符串*/</span></span><br><span class="line">    TRAP_HALT =<span class="number">0X25</span><span class="comment">/*停止程序*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    MR_KBSR = <span class="number">0XFE00</span>,<span class="comment">/*键盘状态*/</span></span><br><span class="line">    MR_KBDR = <span class="number">0XFE02</span><span class="comment">/*键盘数据*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">swap16</span><span class="params">(<span class="type">uint16_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &lt;&lt; <span class="number">8</span>) | (x &gt;&gt; <span class="number">8</span>);<span class="comment">/*改成小端序，交换前8位和后8位*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">sign_extend</span><span class="params">(<span class="type">uint16_t</span> x, <span class="type">int</span> bit_count)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>((x &gt;&gt; (bit_count - <span class="number">1</span>)) &amp; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        x |= (<span class="number">0xffff</span> &lt;&lt; bit_count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">update_flags</span><span class="params">(<span class="type">uint16_t</span> r)</span><span class="comment">/*更新标志位*/</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (reg[r] == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        reg[R_COND] = FL_ZRO;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (reg[r] &gt;&gt; <span class="number">15</span>)<span class="comment">/*最左侧1为负数*/</span></span><br><span class="line">    &#123;</span><br><span class="line">        reg[R_COND] = FL_NEG;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        reg[R_COND] = FL_POS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">read_image_file</span><span class="params">(FILE* file)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint16_t</span> origin;</span><br><span class="line">    fread(&amp;origin,<span class="keyword">sizeof</span>(origin), <span class="number">1</span>, file);</span><br><span class="line">    origin = swap16(origin);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint16_t</span> max_read = UINT16_MAX - origin;</span><br><span class="line">    <span class="type">uint16_t</span>* p = memory + origin;</span><br><span class="line">    <span class="type">size_t</span> read = fread(p,<span class="keyword">sizeof</span>(<span class="type">uint16_t</span>), max_read,file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(read-- &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        *p = swap16(*p);</span><br><span class="line">        ++p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">read_image</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* image_path)</span></span><br><span class="line">&#123;</span><br><span class="line">    FILE* file = fopen(image_path, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!file)&#123;<span class="keyword">return</span> <span class="number">0</span>;&#125;;</span><br><span class="line">    read_image_file(file);</span><br><span class="line">    fclose(file);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">check_key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> WaitForSingleObject(hStdin, <span class="number">1000</span>) == WAIT_OBJECT_0 &amp;&amp; _kbhit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mem_write</span><span class="params">(<span class="type">uint16_t</span> address,<span class="type">uint16_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">    memory[address] = val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">uint16_t</span> <span class="title function_">mem_read</span><span class="params">(<span class="type">uint16_t</span> address)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(address == MR_KBSR)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (check_key())</span><br><span class="line">        &#123;</span><br><span class="line">            memory[MR_KBSR] = (<span class="number">1</span> &lt;&lt; <span class="number">15</span>);</span><br><span class="line">            memory[MR_KBDR] = getchar();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            memory[MR_KBSR] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> memory[address];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD fdwMode, fdwOldMode;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disable_input_buffering</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    hStdin = GetStdHandle(STD_INPUT_HANDLE);</span><br><span class="line">    GetConsoleMode(hStdin, &amp;fdwOldMode); <span class="comment">/* save old mode */</span></span><br><span class="line">    fdwMode = fdwOldMode</span><br><span class="line">            ^ ENABLE_ECHO_INPUT  <span class="comment">/* no input echo */</span></span><br><span class="line">            ^ ENABLE_LINE_INPUT; <span class="comment">/* return when one or</span></span><br><span class="line"><span class="comment">                                    more characters are available */</span></span><br><span class="line">    SetConsoleMode(hStdin, fdwMode); <span class="comment">/* set new mode */</span></span><br><span class="line">    FlushConsoleInputBuffer(hStdin); <span class="comment">/* clear buffer */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">restore_input_buffering</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    SetConsoleMode(hStdin, fdwOldMode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">handle_interrupt</span><span class="params">(<span class="type">int</span> signal)</span></span><br><span class="line">&#123;</span><br><span class="line">    restore_input_buffering();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;lc3 [image-file1]...\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt; argc; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!read_image(argv[j]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;failed to load image: %s\n&quot;</span>,argv[j]);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="comment">/*&#123;Load Arguments,5&#125;*/</span></span><br><span class="line">    </span><br><span class="line">    signal(SIGINT,handle_interrupt);</span><br><span class="line">    disable_input_buffering();</span><br><span class="line">    reg[R_COND] = FL_ZRO;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span> PC_START = <span class="number">0x3000</span> &#125;;</span><br><span class="line">    reg[R_PC] = PC_START;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> running = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (running)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">uint16_t</span> instr = mem_read(reg[R_PC]++);</span><br><span class="line">        <span class="type">uint16_t</span> op = instr &gt;&gt; <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (op)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> OP_ADD:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;<span class="comment">/*目标寄存器*/</span></span><br><span class="line">                <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;<span class="comment">/*第一个操作数SR1*/</span></span><br><span class="line">                <span class="type">uint16_t</span> imm_flag = (instr &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1</span>;<span class="comment">/*是否是立即模式*/</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(imm_flag)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> imm5 =sign_extend(instr &amp; <span class="number">0x1f</span>,<span class="number">5</span>);</span><br><span class="line">                    reg[r0] = reg[r1] + imm5;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r2 = instr &amp; <span class="number">0x7</span>;</span><br><span class="line">                    reg[r0] = reg[r1] + reg[r2];</span><br><span class="line">                &#125;</span><br><span class="line">                update_flags(r0);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_AND:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;<span class="comment">/*第一个操作数SR1*/</span></span><br><span class="line">                <span class="type">uint16_t</span> imm_flag = (instr &gt;&gt; <span class="number">5</span>) &amp; <span class="number">0x1</span>;<span class="comment">/*是否是立即模式*/</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(imm_flag)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> imm5 =sign_extend(instr &amp; <span class="number">0x1f</span>,<span class="number">5</span>);</span><br><span class="line">                    reg[r0] = reg[r1] &amp; imm5;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r2 = instr &amp; <span class="number">0x7</span>;</span><br><span class="line">                    reg[r0] = reg[r1] &amp; reg[r2];</span><br><span class="line">                &#125;</span><br><span class="line">                update_flags(r0);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_NOT:</span><br><span class="line">            &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                reg[r0] = ~reg[r1];</span><br><span class="line">                update_flags(r0);</span><br><span class="line">            </span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_BR:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">                <span class="type">uint16_t</span> cond_flag = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                <span class="keyword">if</span>(cond_flag &amp; reg[R_COND])</span><br><span class="line">                &#123;</span><br><span class="line">                    reg[R_PC] += pc_offset;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_JMP:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    reg[R_PC] = reg[r1];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_JSR:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> long_flag = (instr &gt;&gt; <span class="number">11</span>) &amp; <span class="number">1</span>;</span><br><span class="line">                    reg[R_R7] = reg[R_PC];</span><br><span class="line">                    <span class="keyword">if</span>(long_flag)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">uint16_t</span> long_pc_offset = sign_extend(instr &amp; <span class="number">0x7ff</span>,<span class="number">11</span>);</span><br><span class="line">                        reg[R_PC] += long_pc_offset;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                        reg[R_PC] = reg[r1];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_LD:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 =(instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> pc_offset =sign_extend(instr &amp; <span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">                    reg[r0] = mem_read(reg[R_PC] + pc_offset);</span><br><span class="line">                    update_flags(r0);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_LDI:</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp;<span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">                reg[r0] = mem_read(mem_read(reg[R_PC] + pc_offset));</span><br><span class="line">                update_flags(r0);</span><br><span class="line">            &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_LDR:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> offset =sign_extend(instr &amp; <span class="number">0x3f</span>,<span class="number">6</span>);</span><br><span class="line">                    reg[r0] = mem_read(reg[r1] + offset);</span><br><span class="line">                    update_flags(r0);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_LEA:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1FF</span>, <span class="number">9</span>);</span><br><span class="line">                    reg[r0] = reg[R_PC] + pc_offset;</span><br><span class="line">                    update_flags(r0);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_ST:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">                    mem_write(reg[R_PC] + pc_offset,reg[r0]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_STI:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> pc_offset = sign_extend(instr &amp; <span class="number">0x1ff</span>,<span class="number">9</span>);</span><br><span class="line">                    mem_write(mem_read(reg[R_PC] + pc_offset),reg[r0]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_STR:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="type">uint16_t</span> r0 = (instr &gt;&gt; <span class="number">9</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> r1 = (instr &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x7</span>;</span><br><span class="line">                    <span class="type">uint16_t</span> offset = sign_extend(instr &amp; <span class="number">0x3F</span>, <span class="number">6</span>);</span><br><span class="line">                    mem_write(reg[r1] + offset, reg[r0]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_TRAP:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">switch</span>(instr &amp; <span class="number">0xff</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_GETC:</span><br><span class="line">                        &#123;</span><br><span class="line">                            reg[R_R0] = (<span class="type">uint16_t</span>)getchar();</span><br><span class="line">                            update_flags(R_R0);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_OUT:</span><br><span class="line">                        &#123;</span><br><span class="line">                            putc((<span class="type">char</span>)reg[R_R0],<span class="built_in">stdout</span>);</span><br><span class="line">                            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_PUTS:</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="type">uint16_t</span>* c = memory + reg[R_R0];</span><br><span class="line">                            <span class="keyword">while</span>(*c)</span><br><span class="line">                            &#123;</span><br><span class="line">                                putc((<span class="type">char</span>)*c,<span class="built_in">stdout</span>);</span><br><span class="line">                                ++c;</span><br><span class="line">                            &#125;</span><br><span class="line">                            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_IN:</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;Enter a character: &quot;</span>);</span><br><span class="line">                            <span class="type">char</span> c = getchar();</span><br><span class="line">                            putc(c,<span class="built_in">stdout</span>);</span><br><span class="line">                            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                            reg[R_R0] = (<span class="type">uint16_t</span>)c;</span><br><span class="line">                            update_flags(R_R0);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_PUTSP:</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="type">uint16_t</span>* c = memory + reg[R_R0];</span><br><span class="line">                            <span class="keyword">while</span>(*c)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="type">char</span> char1 = (*c) &amp; <span class="number">0xff</span>;</span><br><span class="line">                                putc(char1, <span class="built_in">stdout</span>);</span><br><span class="line">                                <span class="type">char</span> char2 = (*c) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                                <span class="keyword">if</span> (char2) putc(char2,<span class="built_in">stdout</span>);</span><br><span class="line">                                ++c;</span><br><span class="line">                            &#125;</span><br><span class="line">                            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> TRAP_HALT:</span><br><span class="line">                       &#123;</span><br><span class="line">                            <span class="built_in">puts</span>(<span class="string">&quot;HALT&quot;</span>);</span><br><span class="line">                            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">                            running = <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> OP_RES:</span><br><span class="line">            <span class="keyword">case</span> OP_RTI:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">abort</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    restore_input_buffering();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们下载2048软件，来验证是否建好了虚拟机。</p>
<p><img src="/2022/02/28/LC-3/image-20220228221142260.png"></p>
<p>成功！！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bj777"
      src="/images/bitbug_favicon.ico">
  <p class="site-author-name" itemprop="name">bj777</p>
  <div class="site-description" itemprop="description">一位逆向菜狗</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jonathanbest7" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jonathanbest7" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/506611735@qq.com" title="E-Mail → 506611735@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/bang-ji-1" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;bang-ji-1" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bj777</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  
		<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
		<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
		<script type="text/javascript" src="/js/src/fireworks.js"></script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
